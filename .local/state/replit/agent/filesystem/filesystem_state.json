{"file_contents":{"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/data-entry-form.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { z } from \"zod\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Save, Percent } from \"lucide-react\";\n\nconst dataEntrySchema = z.object({\n  goalId: z.number().min(1, \"Please select a goal\"),\n  objectiveId: z.number().optional(),\n  date: z.string().min(1, \"Date is required\"),\n  progressFormat: z.enum([\"percentage\", \"fraction\", \"duration\", \"frequency\"]),\n  progressValue: z.number().min(0, \"Value must be positive\"),\n  numerator: z.number().optional(),\n  denominator: z.number().optional(),\n  // noResponseCount: z.number().min(0).optional(), // pending database migration\n  durationUnit: z.enum([\"seconds\", \"minutes\"]).optional(),\n  levelOfSupport: z.array(z.string()).min(1, \"At least one level of support is required\"),\n  setting: z.array(z.string()).min(1, \"At least one setting is required\"),\n  customSetting: z.string().optional(),\n  customSupport: z.string().optional(),\n  anecdotalInfo: z.string().optional(),\n}).refine((data) => {\n  // For duration goals, durationUnit is required\n  if (data.progressFormat === \"duration\" && (!data.durationUnit || data.durationUnit.trim() === \"\")) {\n    return false;\n  }\n  \n  // Validate duration values based on unit\n  if (data.progressFormat === \"duration\" && data.durationUnit) {\n    if (data.durationUnit === \"seconds\") {\n      // Seconds must be whole numbers 0-59\n      if (!Number.isInteger(data.progressValue) || data.progressValue < 0 || data.progressValue > 59) {\n        return false;\n      }\n    } else if (data.durationUnit === \"minutes\") {\n      // Minutes: whole number part 0-59, decimal part between .01-.59 if present\n      const wholePart = Math.floor(data.progressValue);\n      if (wholePart < 0 || wholePart > 59) {\n        return false;\n      }\n      const decimalPart = Math.round((data.progressValue % 1) * 100) / 100; // Round to avoid floating point precision issues\n      if (decimalPart !== 0 && (decimalPart < 0.01 || decimalPart > 0.59)) {\n        return false;\n      }\n    }\n  }\n  \n  return true;\n}, {\n  message: \"Minutes: whole number 0-59, decimal .00 or .01-.59 only (e.g., 5.45 not 5.90)\",\n  path: [\"progressValue\"],\n});\n\ntype DataEntryFormData = z.infer<typeof dataEntrySchema>;\n\ninterface Goal {\n  id: number;\n  title: string;\n  description: string;\n  dataCollectionType: string;\n  levelOfSupport?: string;\n  studentId: number;\n}\n\ninterface Objective {\n  id: number;\n  goalId: number;\n  studentId: number;\n  description: string;\n  targetCriteria?: string;\n  status: string;\n}\n\ninterface DataEntryFormProps {\n  studentId: number;\n  goals: Goal[];\n  selectedGoalId?: number;\n  onSuccess?: () => void;\n}\n\nexport default function DataEntryForm({ studentId, goals, selectedGoalId, onSuccess }: DataEntryFormProps) {\n  const { toast } = useToast();\n  const [progressInputType, setProgressInputType] = useState<\"percentage\" | \"fraction\">(\"percentage\");\n  const [trialCounter, setTrialCounter] = useState({\n    correct: 0,\n    total: 0,\n    noResponse: 0\n  });\n  const [selectedGoal, setSelectedGoal] = useState<Goal | null>(null);\n  const [durationUnit, setDurationUnit] = useState<string>(\"minutes\");\n  const [objectives, setObjectives] = useState<Objective[]>([]);\n  const [showCustomSetting, setShowCustomSetting] = useState(false);\n  const [showCustomSupport, setShowCustomSupport] = useState(false);\n\n  // Find the selected goal to get its data collection type\n  useEffect(() => {\n    if (selectedGoalId) {\n      const goal = goals.find(g => g.id === selectedGoalId);\n      setSelectedGoal(goal || null);\n    }\n  }, [selectedGoalId, goals]);\n\n  const form = useForm<DataEntryFormData>({\n    resolver: zodResolver(dataEntrySchema),\n    defaultValues: {\n      goalId: selectedGoalId || 0,\n      objectiveId: undefined,\n      date: new Date().toISOString().split('T')[0], // Today's date\n      progressFormat: selectedGoal?.dataCollectionType === \"duration\" ? \"duration\" : \n                     selectedGoal?.dataCollectionType === \"frequency\" ? \"frequency\" : \"percentage\",\n      progressValue: 0,\n      durationUnit: \"minutes\", // Default to minutes for duration\n      levelOfSupport: [],\n      setting: [],\n      customSetting: \"\",\n      anecdotalInfo: \"\",\n    },\n  });\n\n  // Watch for goal changes to update progress input type and selected goal\n  const selectedGoalIdValue = form.watch(\"goalId\");\n\n  // Fetch objectives for the selected goal\n  const { data: objectivesData } = useQuery<Objective[]>({\n    queryKey: [`/api/goals/${selectedGoalIdValue || selectedGoalId}/objectives`],\n    enabled: !!(selectedGoalIdValue || selectedGoalId),\n  });\n\n  useEffect(() => {\n    if (objectivesData) {\n      setObjectives(objectivesData);\n    }\n  }, [objectivesData]);\n  \n  useEffect(() => {\n    if (selectedGoalIdValue > 0) {\n      const goal = goals.find(g => g.id === selectedGoalIdValue);\n      setSelectedGoal(goal || null);\n      \n      // Update progress format based on goal's data collection type\n      if (goal?.dataCollectionType) {\n        const format = goal.dataCollectionType === \"duration\" ? \"duration\" : \n                      goal.dataCollectionType === \"frequency\" ? \"frequency\" : \"percentage\";\n        form.setValue(\"progressFormat\", format as any);\n        \n        // Set default duration unit for duration goals\n        if (goal.dataCollectionType === \"duration\") {\n          form.setValue(\"durationUnit\", \"minutes\");\n          setDurationUnit(\"minutes\");\n        }\n      }\n    }\n  }, [selectedGoalIdValue, goals, form]);\n\n  const addDataPointMutation = useMutation({\n    mutationFn: async (data: DataEntryFormData) => {\n      console.log(\"ðŸ”¥ === MUTATION FUNCTION CALLED ===\");\n      console.log(\"ðŸš€ === FRONTEND DATA SUBMISSION START ===\");\n      console.log(\"ðŸš€ Form data being submitted:\", data);\n      console.log(\"ðŸš€ Form validation status:\", form.formState.isValid);\n      console.log(\"ðŸš€ Form errors (if any):\", form.formState.errors);\n      \n      // Convert the date string to ISO format for the server and include custom support\n      const payload = {\n        ...data,\n        date: data.date, // Keep as string, server will parse it\n        levelOfSupport: data.levelOfSupport.concat(showCustomSupport && data.customSupport ? [data.customSupport] : []),\n        setting: data.setting.concat(showCustomSetting && data.customSetting ? [data.customSetting] : []),\n      };\n      \n      console.log(\"ðŸš€ Final payload being sent to server:\", payload);\n      console.log(\"ðŸš€ API endpoint:\", `/api/goals/${data.goalId}/data-points`);\n      console.log(\"ðŸš€ About to make API request...\");\n      \n      console.log(\"ðŸš€ Making API request now...\");\n      \n      try {\n        const result = await apiRequest(\"POST\", `/api/goals/${data.goalId}/data-points`, payload);\n        console.log(\"ðŸš€ API request completed successfully\");\n        console.log(\"ðŸš€ Result status:\", result.status);\n        \n        if (!result.ok) {\n          console.error(\"âŒ API request failed with status:\", result.status);\n          throw new Error(`API request failed: ${result.status}`);\n        }\n        \n        const responseData = await result.json();\n        console.log(\"âœ… API response data:\", responseData);\n        return responseData;\n      } catch (apiError) {\n        console.error(\"âŒ API REQUEST FAILED:\");\n        console.error(\"âŒ Error type:\", typeof apiError);\n        console.error(\"âŒ Error message:\", (apiError as Error).message);\n        console.error(\"âŒ Full error:\", apiError);\n        throw apiError;\n      }\n\n    },\n    onSuccess: (savedDataPoint) => {\n      const goalId = form.getValues().goalId;\n      const studentId = form.getValues().goalId ? goals?.find(g => g.id === form.getValues().goalId)?.studentId : null;\n      \n      console.log(\"âœ… Data point mutation succeeded with saved data:\", savedDataPoint);\n      \n      // Clear all cache to force immediate refresh of all data\n      queryClient.clear();\n      \n      // Force immediate refetch of critical data\n      if (studentId) {\n        queryClient.prefetchQuery({\n          queryKey: [`/api/students/${studentId}/all-data-points`],\n          staleTime: 0,\n        });\n        queryClient.prefetchQuery({\n          queryKey: [`/api/goals/${goalId}/data-points`],\n          staleTime: 0,\n        });\n      }\n      \n      console.log(\"âœ… Data point successfully added and cache cleared\");\n      \n      toast({\n        title: \"Data Added Successfully!\",\n        description: \"Your data has been saved.\",\n      });\n      \n      form.reset();\n      onSuccess?.();\n    },\n    onError: (error) => {\n      console.error(\"âŒ Error adding data point:\", error);\n      console.error(\"âŒ Error message:\", error.message);\n      console.error(\"âŒ Full error object:\", error);\n      console.error(\"âŒ Data point failed to save to database\");\n      \n      // Handle unauthorized errors\n      if (error.message.includes(\"401\") || error.message.includes(\"Unauthorized\")) {\n        toast({\n          title: \"Session Expired\",\n          description: \"Please log in again to continue.\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 2000);\n        return;\n      }\n      \n      // Show detailed error message for debugging\n      const errorDetails = error.message || \"Unknown error\";\n      console.error(\"Detailed error for user:\", errorDetails);\n      \n      toast({\n        title: \"Error Adding Data Point\",\n        description: `Failed to add data point: ${errorDetails}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: DataEntryFormData) => {\n    console.log(\"=== DATA ENTRY FORM SUBMISSION ===\");\n    console.log(\"Form submitted with data:\", data);\n    console.log(\"Form validation errors:\", form.formState.errors);\n    console.log(\"Form is valid:\", form.formState.isValid);\n    console.log(\"Selected goal:\", selectedGoal);\n    console.log(\"Progress input type:\", progressInputType);\n    \n    // Check if form has validation errors\n    if (Object.keys(form.formState.errors).length > 0) {\n      console.error(\"âŒ FORM VALIDATION FAILED - submission blocked:\", form.formState.errors);\n      return;\n    }\n    \n    console.log(\"âœ… Form validation passed, proceeding with submission...\");\n    \n    let finalData = { ...data };\n\n    // Convert fraction to percentage if needed\n    if (progressInputType === \"fraction\" && data.numerator && data.denominator) {\n      finalData.progressValue = (data.numerator / data.denominator) * 100;\n      console.log(\"Converted fraction to percentage:\", finalData.progressValue);\n    }\n\n    console.log(\"ðŸŽ¯ Final data being sent to API:\", finalData);\n    console.log(\"ðŸŽ¯ API endpoint will be:\", `/api/goals/${data.goalId}/data-points`);\n    console.log(\"ðŸŽ¯ About to call addDataPointMutation.mutate...\");\n    console.log(\"ðŸŽ¯ Mutation isPending before call:\", addDataPointMutation.isPending);\n    console.log(\"ðŸŽ¯ Mutation isError before call:\", addDataPointMutation.isError);\n    console.log(\"ðŸŽ¯ Mutation error before call:\", addDataPointMutation.error);\n    \n    try {\n      addDataPointMutation.mutate(finalData);\n      console.log(\"ðŸŽ¯ Mutation.mutate() called successfully\");\n    } catch (mutationError) {\n      console.error(\"âŒ MUTATION CALL FAILED:\", mutationError);\n    }\n  };\n\n  const handleFractionChange = (numerator: string, denominator: string) => {\n    const num = parseFloat(numerator) || 0;\n    const den = parseFloat(denominator) || 1;\n    const percentage = (num / den) * 100;\n    \n    form.setValue(\"numerator\", num);\n    form.setValue(\"denominator\", den);\n    form.setValue(\"progressValue\", Math.min(100, Math.max(0, percentage)));\n  };\n\n  if (!goals || goals.length === 0) {\n    return (\n      <div className=\"text-center py-8\">\n        <p className=\"text-gray-600 mb-4\">No goals available for data entry.</p>\n        <p className=\"text-sm text-gray-500\">Please add some goals first before entering data.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <h3 className=\"text-xl font-semibold text-gray-900 mb-6\">Add New Data Point</h3>\n      \n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          {/* Goal Selection */}\n          <FormField\n            control={form.control}\n            name=\"goalId\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Select Goal</FormLabel>\n                <Select onValueChange={(value) => field.onChange(parseInt(value))} value={field.value?.toString()}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Choose a goal...\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {goals.map((goal) => (\n                      <SelectItem key={goal.id} value={goal.id.toString()}>\n                        {goal.title}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          {/* Objective Selection (Optional) */}\n          {objectives.length > 0 && (\n            <FormField\n              control={form.control}\n              name=\"objectiveId\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Select Objective (Optional)</FormLabel>\n                  <Select \n                    onValueChange={(value) => field.onChange(value === \"general\" ? undefined : parseInt(value))} \n                    value={field.value?.toString() || \"general\"}\n                  >\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Choose an objective or leave blank for general goal data...\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"general\">General Goal (No specific objective)</SelectItem>\n                      {objectives.map((objective) => (\n                        <SelectItem key={objective.id} value={objective.id.toString()}>\n                          {objective.description}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          )}\n\n          {/* Date */}\n          <FormField\n            control={form.control}\n            name=\"date\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Date</FormLabel>\n                <FormControl>\n                  <Input type=\"date\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          {/* Progress Value - Dynamic based on goal's data collection type */}\n          <div className=\"space-y-4\">\n            <FormLabel>\n              {selectedGoal?.dataCollectionType === \"duration\" ? \"Duration\" :\n               selectedGoal?.dataCollectionType === \"frequency\" ? \"Frequency Count\" :\n               \"Progress Value\"}\n            </FormLabel>\n            \n            {selectedGoal?.dataCollectionType === \"duration\" ? (\n              /* Duration Input with Time Unit Dropdown */\n              <div className=\"flex space-x-3 items-end\">\n                <div className=\"flex-1\">\n                  <label className=\"block text-xs text-gray-600 mb-1\">Time Unit</label>\n                  <FormField\n                    control={form.control}\n                    name=\"durationUnit\"\n                    render={({ field }) => (\n                      <div className=\"space-y-1\">\n                        <select\n                          className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                          value={field.value || durationUnit}\n                          onChange={(e) => {\n                            const value = e.target.value;\n                            field.onChange(value);\n                            setDurationUnit(value);\n                            form.trigger(\"durationUnit\");\n                          }}\n                        >\n                          <option value=\"minutes\">minutes</option>\n                          <option value=\"seconds\">seconds</option>\n                        </select>\n                      </div>\n                    )}\n                  />\n                </div>\n                \n                <div className=\"flex-1\">\n                  <label className=\"block text-xs text-gray-600 mb-1\">\n                    {form.watch(\"durationUnit\") === \"seconds\" ? \"Seconds (0-59)\" : \"Minutes (0-59, decimal .01-.59)\"}\n                  </label>\n                  <FormField\n                    control={form.control}\n                    name=\"progressValue\"\n                    render={({ field }) => (\n                      <>\n                        {form.watch(\"durationUnit\") === \"seconds\" ? (\n                          <div className=\"relative\">\n                            <Select onValueChange={(value) => field.onChange(Number(value))} value={field.value?.toString() || \"\"}>\n                              <FormControl>\n                                <SelectTrigger>\n                                  <SelectValue placeholder=\"Select seconds...\" />\n                                </SelectTrigger>\n                              </FormControl>\n                              <SelectContent className=\"h-60\">\n                                {Array.from({ length: 60 }, (_, i) => (\n                                  <SelectItem key={i} value={i.toString()}>\n                                    {i} {i === 1 ? 'second' : 'seconds'}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                            {field.value !== undefined && field.value !== null && (\n                              <span className=\"absolute right-10 top-3 text-gray-500 text-sm pointer-events-none\">\n                                seconds\n                              </span>\n                            )}\n                          </div>\n                        ) : (\n                          <div className=\"relative\">\n                            <select\n                              value={field.value?.toString() || \"\"}\n                              onChange={(e) => {\n                                const value = parseFloat(e.target.value);\n                                field.onChange(value);\n                                console.log(`âœ… Selected: ${value} minutes`);\n                              }}\n                              className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pr-20\"\n                            >\n                              <option value=\"\">Select minutes...</option>\n                              {/* Generate options: whole minutes 0-59, then decimals .01-.59 for each */}\n                              {Array.from({ length: 60 }, (_, wholeMinute) => {\n                                const options = [];\n                                \n                                // Add exact whole minute (e.g., 1.00, 2.00, etc.)\n                                if (wholeMinute > 0) {\n                                  options.push(\n                                    <option key={`${wholeMinute}.00`} value={wholeMinute}>\n                                      {wholeMinute}.00 ({wholeMinute} minutes exactly)\n                                    </option>\n                                  );\n                                }\n                                \n                                // Add decimal options .01-.59 for this whole minute\n                                if (wholeMinute >= 1) {\n                                  for (let decimal = 1; decimal <= 59; decimal++) {\n                                    const value = wholeMinute + (decimal / 100);\n                                    const formattedValue = value.toFixed(2);\n                                    options.push(\n                                      <option key={formattedValue} value={formattedValue}>\n                                        {formattedValue} ({wholeMinute}m {decimal}s)\n                                      </option>\n                                    );\n                                  }\n                                }\n                                \n                                return options;\n                              }).flat()}\n                            </select>\n                            {field.value !== undefined && field.value !== null && field.value > 0 && (\n                              <span className=\"absolute right-3 top-3 text-gray-500 text-sm pointer-events-none\">\n                                minutes\n                              </span>\n                            )}\n                          </div>\n                        )}\n                      </>\n                    )}\n                  />\n                </div>\n              </div>\n            ) : selectedGoal?.dataCollectionType === \"frequency\" ? (\n              /* Frequency Count Input */\n              <div className=\"flex-1\">\n                <label className=\"block text-xs text-gray-600 mb-1\">Number of Occurrences</label>\n                <FormField\n                  control={form.control}\n                  name=\"progressValue\"\n                  render={({ field }) => (\n                    <Input\n                      type=\"number\"\n                      min=\"0\"\n                      step=\"1\"\n                      placeholder=\"3\"\n                      {...field}\n                      onChange={(e) => field.onChange(parseFloat(e.target.value) || 0)}\n                    />\n                  )}\n                />\n              </div>\n            ) : (\n              /* Trial Counter Interface - matching live collection */\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center\">\n                    <Percent className=\"h-5 w-5 mr-2\" />\n                    Trial Counter\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-center mb-6\">\n                    <div className=\"text-4xl font-bold text-purple-600 mb-2\">\n                      {trialCounter.total > 0 ? \n                        Math.round((trialCounter.correct / trialCounter.total) * 100) : 0}%\n                    </div>\n                    <div className=\"text-lg text-gray-600\">\n                      {trialCounter.correct} / {trialCounter.total} correct\n                    </div>\n                    {trialCounter.noResponse > 0 && (\n                      <div className=\"text-sm text-gray-500 mt-1\">\n                        {trialCounter.noResponse} no response{trialCounter.noResponse !== 1 ? 's' : ''}\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"flex justify-center space-x-2 mb-4\">\n                    <Button \n                      type=\"button\"\n                      size=\"lg\" \n                      onClick={() => {\n                        const newTrialCounter = {\n                          ...trialCounter,\n                          correct: trialCounter.correct + 1,\n                          total: trialCounter.total + 1\n                        };\n                        setTrialCounter(newTrialCounter);\n                        // Update form values\n                        form.setValue(\"numerator\", newTrialCounter.correct);\n                        form.setValue(\"denominator\", newTrialCounter.total);\n                        form.setValue(\"progressValue\", newTrialCounter.total > 0 ? \n                          Math.round((newTrialCounter.correct / newTrialCounter.total) * 100) : 0);\n                        setProgressInputType(\"fraction\");\n                      }}\n                      className=\"bg-green-600 hover:bg-green-700 h-16 px-6\"\n                    >\n                      âœ“ Correct\n                    </Button>\n                    <Button \n                      type=\"button\"\n                      size=\"lg\" \n                      onClick={() => {\n                        const newTrialCounter = {\n                          ...trialCounter,\n                          total: trialCounter.total + 1\n                        };\n                        setTrialCounter(newTrialCounter);\n                        // Update form values\n                        form.setValue(\"numerator\", newTrialCounter.correct);\n                        form.setValue(\"denominator\", newTrialCounter.total);\n                        form.setValue(\"progressValue\", newTrialCounter.total > 0 ? \n                          Math.round((newTrialCounter.correct / newTrialCounter.total) * 100) : 0);\n                        setProgressInputType(\"fraction\");\n                      }}\n                      className=\"bg-red-600 hover:bg-red-700 h-16 px-6\"\n                    >\n                      âœ— Incorrect\n                    </Button>\n                    <Button \n                      type=\"button\"\n                      size=\"lg\" \n                      onClick={() => {\n                        const newTrialCounter = {\n                          ...trialCounter,\n                          noResponse: trialCounter.noResponse + 1\n                        };\n                        setTrialCounter(newTrialCounter);\n                        // For no response, we don't change total trials but track separately\n                      }}\n                      className=\"bg-gray-500 hover:bg-gray-600 h-16 px-6\"\n                    >\n                      âˆ’ No Response\n                    </Button>\n                  </div>\n                  <div className=\"text-center\">\n                    <Button \n                      type=\"button\"\n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => {\n                        // Remove the last trial\n                        if (trialCounter.noResponse > 0) {\n                          // Remove no response first\n                          const newTrialCounter = {\n                            ...trialCounter,\n                            noResponse: trialCounter.noResponse - 1\n                          };\n                          setTrialCounter(newTrialCounter);\n                        } else if (trialCounter.total > 0) {\n                          // Remove last correct/incorrect trial\n                          const wasLastCorrect = trialCounter.correct > 0 && \n                            (trialCounter.correct / trialCounter.total) > ((trialCounter.correct - 1) / (trialCounter.total - 1));\n                          const newTrialCounter = {\n                            correct: wasLastCorrect ? trialCounter.correct - 1 : trialCounter.correct,\n                            total: trialCounter.total - 1,\n                            noResponse: trialCounter.noResponse\n                          };\n                          setTrialCounter(newTrialCounter);\n                          // Update form values\n                          form.setValue(\"numerator\", newTrialCounter.correct);\n                          form.setValue(\"denominator\", newTrialCounter.total);\n                          form.setValue(\"progressValue\", newTrialCounter.total > 0 ? \n                            Math.round((newTrialCounter.correct / newTrialCounter.total) * 100) : 0);\n                        }\n                      }}\n                      disabled={trialCounter.total === 0 && trialCounter.noResponse === 0}\n                    >\n                      Remove Last Trial\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n\n\n\n          {/* Level of Support and Setting - Side by Side */}\n          <div className=\"flex flex-col lg:flex-row gap-6\">\n            {/* Level of Support */}\n            <div className=\"flex-1\">\n              <FormField\n              control={form.control}\n              name=\"levelOfSupport\"\n              render={({ field }) => {\n                const supportOptions = [\n                  { id: \"independent\", label: \"Independent\" },\n                  { id: \"verbal\", label: \"Verbal\" },\n                  { id: \"visual\", label: \"Visual\" },\n                  { id: \"written\", label: \"Written\" },\n                  { id: \"model-of-task\", label: \"Model of Task\" },\n                  { id: \"self-correction\", label: \"Self-Correction\" },\n                  { id: \"gesture\", label: \"Gesture\" },\n                  { id: \"custom\", label: \"Custom\" },\n                ];\n\n                return (\n                  <FormItem>\n                    <FormLabel className=\"text-base font-medium text-gray-900 mb-4 block\">\n                      Level of Support (Select all that apply)\n                    </FormLabel>\n                    <div className=\"space-y-4\">\n                      {supportOptions.map((option) => (\n                        <div key={option.id} className=\"flex items-center space-x-3\">\n                          <Checkbox\n                            id={option.id}\n                            checked={field.value?.includes(option.id) || false}\n                            onCheckedChange={(checked) => {\n                              const currentValues = field.value || [];\n                              if (checked) {\n                                const newValues = [...currentValues, option.id];\n                                field.onChange(newValues);\n                                if (option.id === \"custom\") {\n                                  setShowCustomSupport(true);\n                                }\n                              } else {\n                                const newValues = currentValues.filter((value) => value !== option.id);\n                                field.onChange(newValues);\n                                if (option.id === \"custom\") {\n                                  setShowCustomSupport(false);\n                                  form.setValue(\"customSupport\", \"\");\n                                }\n                              }\n                            }}\n                            className=\"h-5 w-5\"\n                          />\n                          <label \n                            htmlFor={option.id} \n                            className=\"text-base font-medium text-gray-900 cursor-pointer leading-none\"\n                          >\n                            {option.label}\n                          </label>\n                        </div>\n                      ))}\n                      \n                      {/* Custom Support Input */}\n                      {showCustomSupport && (\n                        <div className=\"ml-8 mt-3\">\n                          <FormField\n                            control={form.control}\n                            name=\"customSupport\"\n                            render={({ field: customField }) => (\n                              <FormItem>\n                                <FormLabel className=\"text-sm font-medium text-gray-700\">\n                                  Custom Level of Support\n                                </FormLabel>\n                                <FormControl>\n                                  <Input\n                                    placeholder=\"Enter custom level of support...\"\n                                    {...customField}\n                                    className=\"w-full\"\n                                  />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n                      )}\n                    </div>\n                    <FormMessage />\n                  </FormItem>\n                );\n              }}\n              />\n            </div>\n\n            {/* Setting */}\n            <div className=\"flex-1\">\n              <FormField\n              control={form.control}\n              name=\"setting\"\n              render={({ field }) => {\n                const settingOptions = [\n                  { id: \"general-education\", label: \"General Education\" },\n                  { id: \"special-education\", label: \"Special Education\" },\n                  { id: \"small-group\", label: \"Small Group\" },\n                  { id: \"whole-group\", label: \"Whole Group\" },\n                  { id: \"1:1\", label: \"1:1\" },\n                  { id: \"custom\", label: \"Custom\" },\n                ];\n\n                // Update showCustomSetting when field value changes\n                useEffect(() => {\n                  setShowCustomSetting(field.value?.includes(\"custom\") || false);\n                }, [field.value]);\n\n                return (\n                  <FormItem>\n                    <FormLabel className=\"text-base font-medium text-gray-900 mb-4 block\">\n                      Setting (Select all that apply)\n                    </FormLabel>\n                    <div className=\"space-y-4\">\n                      {settingOptions.map((option) => (\n                        <div key={option.id} className=\"flex items-center space-x-3\">\n                          <Checkbox\n                            id={option.id}\n                            checked={field.value?.includes(option.id) || false}\n                            onCheckedChange={(checked) => {\n                              const currentValues = field.value || [];\n                              if (checked) {\n                                const newValues = [...currentValues, option.id];\n                                field.onChange(newValues);\n                                if (option.id === \"custom\") {\n                                  setShowCustomSetting(true);\n                                }\n                              } else {\n                                const newValues = currentValues.filter((value) => value !== option.id);\n                                field.onChange(newValues);\n                                if (option.id === \"custom\") {\n                                  setShowCustomSetting(false);\n                                  form.setValue(\"customSetting\", \"\");\n                                }\n                              }\n                            }}\n                            className=\"h-5 w-5\"\n                          />\n                          <label \n                            htmlFor={option.id} \n                            className=\"text-base font-medium text-gray-900 cursor-pointer leading-none\"\n                          >\n                            {option.label}\n                          </label>\n                        </div>\n                      ))}\n                      \n                      {/* Custom Setting Input */}\n                      {showCustomSetting && (\n                        <div className=\"ml-8 mt-3\">\n                          <FormField\n                            control={form.control}\n                            name=\"customSetting\"\n                            render={({ field: customField }) => (\n                              <FormItem>\n                                <FormLabel className=\"text-sm font-medium text-gray-700\">\n                                  Custom Setting\n                                </FormLabel>\n                                <FormControl>\n                                  <Input\n                                    placeholder=\"Enter custom setting...\"\n                                    {...customField}\n                                    className=\"w-full\"\n                                  />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n                      )}\n                    </div>\n                    <FormMessage />\n                  </FormItem>\n                );\n              }}\n              />\n            </div>\n          </div>\n\n          {/* Session Notes */}\n          <FormField\n            control={form.control}\n            name=\"anecdotalInfo\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Session Notes</FormLabel>\n                <FormControl>\n                  <Textarea\n                    rows={4}\n                    placeholder=\"Additional notes about the student's performance, behavior, or any relevant observations...\"\n                    {...field}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          {/* Submit Buttons */}\n          <div className=\"flex justify-end space-x-4 pt-6\">\n            <Button \n              type=\"button\" \n              variant=\"outline\"\n              onClick={() => form.reset()}\n              disabled={addDataPointMutation.isPending}\n            >\n              Cancel\n            </Button>\n            \n\n            \n            <Button \n              type=\"submit\" \n              disabled={addDataPointMutation.isPending}\n            >\n              {addDataPointMutation.isPending ? (\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n              ) : (\n                <Save className=\"h-4 w-4 mr-2\" />\n              )}\n              Save Data Point\n            </Button>\n          </div>\n        </form>\n      </Form>\n    </div>\n  );\n}\n","path":null,"size_bytes":39103,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/objective-charts-for-goal.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport ObjectiveChart from \"./objective-chart\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ReportingPeriod } from \"@/lib/utils\";\n\ninterface ObjectiveChartsForGoalProps {\n  goalId: number;\n  selectedPeriod?: ReportingPeriod | null;\n}\n\nexport default function ObjectiveChartsForGoal({ goalId, selectedPeriod }: ObjectiveChartsForGoalProps) {\n  // Get objectives for this goal\n  const { data: objectives, isLoading } = useQuery({\n    queryKey: [`/api/goals/${goalId}/objectives`],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-6 bg-gray-200 rounded w-1/2 mb-4\"></div>\n          <div className=\"h-64 bg-gray-200 rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!objectives || objectives.length === 0) {\n    return null; // Don't show anything if there are no objectives\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"border-t pt-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n          Objective Charts ({objectives.length})\n        </h3>\n        <div className=\"space-y-6\">\n          {objectives.map((objective: any) => (\n            <ObjectiveChart \n              key={objective.id} \n              objectiveId={objective.id} \n              goalId={goalId}\n              selectedPeriod={selectedPeriod}\n            />\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":1525,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5742,"size_tokens":null},"SECURITY.md":{"content":"# Security Configuration Guide\n\n## Environment Variables Security\n\n### Required Secure Variables\n```bash\n# Session Security (CRITICAL)\nSESSION_SECRET=generate_minimum_32_random_characters_here\n\n# Database Security\nDATABASE_URL=postgresql://secure_user:strong_password@host:5432/database\nPGPASSWORD=use_strong_database_password\n\n# Application Security\nNODE_ENV=production\nTRUST_PROXY=true\n```\n\n### Security Headers Configuration\n\nFor production deployments, ensure these security headers are configured in your reverse proxy:\n\n```nginx\n# Security Headers (Nginx example)\nadd_header X-Frame-Options DENY;\nadd_header X-Content-Type-Options nosniff;\nadd_header X-XSS-Protection \"1; mode=block\";\nadd_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\nadd_header Referrer-Policy \"strict-origin-when-cross-origin\";\nadd_header Content-Security-Policy \"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:;\";\n```\n\n## Database Security\n\n### PostgreSQL Security Configuration\n```sql\n-- Create dedicated application user\nCREATE USER special_education_app WITH PASSWORD 'secure_random_password';\n\n-- Grant minimal required permissions\nGRANT CONNECT ON DATABASE special_education_platform TO special_education_app;\nGRANT USAGE ON SCHEMA public TO special_education_app;\nGRANT CREATE ON SCHEMA public TO special_education_app;\n\n-- Enable SSL connections\nALTER SYSTEM SET ssl = on;\nALTER SYSTEM SET ssl_cert_file = '/path/to/server.crt';\nALTER SYSTEM SET ssl_key_file = '/path/to/server.key';\n```\n\n### Connection Security\n```bash\n# Enable SSL in DATABASE_URL\nDATABASE_URL=\"postgresql://user:pass@host:5432/db?sslmode=require\"\n```\n\n## Authentication Security\n\n### Session Management\n- Sessions are stored in PostgreSQL with automatic cleanup\n- Session cookies are HTTP-only and secure\n- Session timeout configured for security\n- CSRF protection enabled\n\n### User Data Protection\n- All user data isolated by user ID\n- Strict ownership validation on all operations\n- No cross-user data access possible\n- Admin functions require special verification\n\n## File Security\n\n### Upload Restrictions\n- PDF exports only (no file uploads from users)\n- Temporary files cleaned automatically\n- No executable file processing\n- All file operations sandboxed\n\n### Static File Security\n```nginx\n# Prevent access to sensitive files\nlocation ~ /\\. {\n    deny all;\n}\n\nlocation ~* \\.(env|config|log)$ {\n    deny all;\n}\n```\n\n## Network Security\n\n### Firewall Configuration\n```bash\n# UFW (Ubuntu Firewall) example\nsudo ufw default deny incoming\nsudo ufw default allow outgoing\nsudo ufw allow ssh\nsudo ufw allow http\nsudo ufw allow https\nsudo ufw enable\n```\n\n### Rate Limiting\n```nginx\n# Nginx rate limiting\nhttp {\n    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;\n    limit_req_zone $binary_remote_addr zone=login:10m rate=1r/s;\n}\n\nserver {\n    location /api/ {\n        limit_req zone=api burst=20 nodelay;\n    }\n    \n    location /api/login {\n        limit_req zone=login burst=5 nodelay;\n    }\n}\n```\n\n## Application Security Features\n\n### Input Validation\n- All user inputs validated with Zod schemas\n- SQL injection prevention through parameterized queries\n- XSS prevention through proper output encoding\n- File type validation for exports\n\n### Data Integrity\n- Foreign key constraints enforced\n- User ownership validation on all operations\n- Goal and objective limits enforced\n- Data format validation\n\n### Error Handling\n- Sensitive information not exposed in error messages\n- Proper error logging without data leakage\n- Graceful degradation for security failures\n\n## Monitoring Security\n\n### Log Security\n```bash\n# Secure log file permissions\nchmod 640 /var/log/application/*\nchown app:adm /var/log/application/*\n```\n\n### Security Monitoring\n- Monitor failed authentication attempts\n- Track unusual data access patterns\n- Log administrative actions\n- Monitor file system changes\n\n### Alerting\n```bash\n# Example log monitoring\ntail -f /var/log/application/error.log | grep -i \"unauthorized\\|forbidden\\|error\"\n```\n\n## Backup Security\n\n### Encrypted Backups\n```bash\n# Encrypted database backup\npg_dump special_education_platform | gpg --cipher-algo AES256 --compress-algo 1 --symmetric --output backup_$(date +%Y%m%d).sql.gpg\n```\n\n### Backup Access Control\n- Separate backup user with read-only access\n- Encrypted backup storage\n- Regular backup integrity verification\n- Secure backup rotation\n\n## Incident Response\n\n### Security Incident Checklist\n1. **Immediate Response**\n   - Isolate affected systems\n   - Preserve logs and evidence\n   - Notify stakeholders\n\n2. **Investigation**\n   - Analyze logs for breach scope\n   - Identify compromised data\n   - Document timeline of events\n\n3. **Recovery**\n   - Patch security vulnerabilities\n   - Reset compromised credentials\n   - Restore from clean backups if needed\n\n4. **Prevention**\n   - Update security measures\n   - Review and improve monitoring\n   - Conduct security training\n\n## Regular Security Maintenance\n\n### Weekly Tasks\n- [ ] Review access logs for anomalies\n- [ ] Check for security updates\n- [ ] Verify backup integrity\n- [ ] Monitor SSL certificate expiration\n\n### Monthly Tasks\n- [ ] Update system packages\n- [ ] Review user access permissions\n- [ ] Analyze security logs\n- [ ] Test backup restoration\n\n### Quarterly Tasks\n- [ ] Security penetration testing\n- [ ] Access control audit\n- [ ] Password policy review\n- [ ] Security documentation update\n\n## Security Contact\n\nFor security issues or vulnerabilities:\n1. DO NOT create public issues\n2. Contact system administrator directly\n3. Provide detailed reproduction steps\n4. Include impact assessment\n\n## Compliance Considerations\n\n### FERPA Compliance (Educational Records)\n- Student data encryption at rest and in transit\n- Access control and audit logging\n- Data retention policies\n- Authorized personnel access only\n\n### State Privacy Laws\n- Review applicable state student privacy laws\n- Implement required data protection measures\n- Ensure proper consent mechanisms\n- Maintain compliance documentation","path":null,"size_bytes":6112,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1128,"size_tokens":null},"client/src/components/dashboard-calendar.tsx":{"content":"import { Calendar, momentLocalizer } from 'react-big-calendar';\nimport moment from 'moment';\nimport 'react-big-calendar/lib/css/react-big-calendar.css';\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Calendar as CalendarIcon, GraduationCap, Clock } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { useState, useEffect } from \"react\";\n\nconst localizer = momentLocalizer(moment);\n\ninterface Student {\n  id: number;\n  name: string;\n  iepDueDate: string | null;\n  grade?: string;\n}\n\ninterface ReportingPeriod {\n  periodNumber: number;\n  startDate: string;\n  endDate: string;\n}\n\ninterface ReportingPeriodsData {\n  periodLength: string;\n  periods: ReportingPeriod[];\n  savedAt: string;\n}\n\ninterface CalendarEvent {\n  id: number | string;\n  title: string;\n  start: Date;\n  end: Date;\n  resource: {\n    studentId?: number;\n    studentName?: string;\n    periodNumber?: number;\n    type: 'iep-due' | 'period-start' | 'period-end';\n  };\n}\n\nexport default function DashboardCalendar() {\n  const [, navigate] = useLocation();\n  const [reportingData, setReportingData] = useState<ReportingPeriodsData | null>(null);\n\n  const { data: students, isLoading } = useQuery({\n    queryKey: [\"/api/students\"],\n  });\n\n  // Load reporting periods from database with fallback to localStorage\n  const { data: reportingPeriodsFromDB } = useQuery({\n    queryKey: [\"/api/reporting-periods\"],\n  });\n\n  useEffect(() => {\n    console.log('=== REPORTING PERIODS DEBUG ===');\n    console.log('Database response:', reportingPeriodsFromDB);\n    console.log('Current reportingData state:', reportingData);\n    \n    if (reportingPeriodsFromDB && reportingPeriodsFromDB.periods && reportingPeriodsFromDB.periods.length > 0) {\n      console.log('âœ“ Loading reporting periods from database:', reportingPeriodsFromDB);\n      setReportingData(reportingPeriodsFromDB);\n    } else {\n      console.log('âœ— No periods in database, checking localStorage...');\n      \n      // Check localStorage for existing data to migrate\n      const savedData = localStorage.getItem('reportingPeriods');\n      console.log('localStorage data:', savedData);\n      \n      if (savedData) {\n        try {\n          const parsedData = JSON.parse(savedData);\n          console.log('âœ“ Found reporting periods in localStorage:', parsedData);\n          console.log('Periods array:', parsedData.periods);\n          console.log('Period length:', parsedData.periodLength);\n          \n          // Use the localStorage data immediately\n          setReportingData(parsedData);\n          \n          // Migrate to database in background\n          fetch('/api/reporting-periods', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              periods: parsedData.periods || [],\n              periodLength: parsedData.periodLength || ''\n            }),\n          }).then(response => {\n            if (response.ok) {\n              console.log('âœ“ Successfully migrated reporting periods to database');\n              // Don't clear localStorage yet - keep as backup\n            } else {\n              console.error('âœ— Failed to migrate to database:', response.status);\n            }\n          }).catch(error => {\n            console.error('âœ— Migration request failed:', error);\n          });\n        } catch (error) {\n          console.error('âœ— Error parsing localStorage reporting periods:', error);\n        }\n      } else {\n        console.log('âœ— No reporting periods found in localStorage either');\n      }\n    }\n    console.log('=== END DEBUG ===');\n  }, [reportingPeriodsFromDB]);\n\n  // Convert student IEP due dates to calendar events\n  const iepEvents: CalendarEvent[] = (students as Student[] || [])\n    .filter(student => student.iepDueDate)\n    .map(student => ({\n      id: student.id,\n      title: `${student.name} - IEP Due`,\n      start: new Date(student.iepDueDate!),\n      end: new Date(student.iepDueDate!),\n      resource: {\n        studentId: student.id,\n        studentName: student.name,\n        type: 'iep-due' as const,\n      },\n    }));\n\n  // Convert reporting periods to calendar events\n  console.log('Current reporting data for calendar:', reportingData);\n  const reportingEvents: CalendarEvent[] = reportingData ? reportingData.periods.flatMap(period => {\n    // Create dates in local timezone to avoid timezone shift\n    const startDate = new Date(period.startDate + 'T12:00:00');\n    const endDate = new Date(period.endDate + 'T12:00:00');\n    \n    return [\n      {\n        id: `period-${period.periodNumber}-start`,\n        title: `Period ${period.periodNumber} Starts`,\n        start: startDate,\n        end: startDate,\n        resource: {\n          periodNumber: period.periodNumber,\n          type: 'period-start' as const,\n        },\n      },\n      {\n        id: `period-${period.periodNumber}-end`,\n        title: `Period ${period.periodNumber} Ends`,\n        start: endDate,\n        end: endDate,\n        resource: {\n          periodNumber: period.periodNumber,\n          type: 'period-end' as const,\n        },\n      },\n    ];\n  }) : [];\n\n  // Combine all events\n  const events: CalendarEvent[] = [...iepEvents, ...reportingEvents];\n\n  const handleSelectEvent = (event: CalendarEvent) => {\n    if (event.resource.type === 'iep-due' && event.resource.studentId) {\n      navigate(`/students/${event.resource.studentId}`);\n    }\n  };\n\n  const eventStyleGetter = (event: CalendarEvent) => {\n    let backgroundColor = '#3b82f6'; // Default blue for IEP events\n    \n    if (event.resource.type === 'period-start') {\n      backgroundColor = '#10b981'; // Green for period starts\n    } else if (event.resource.type === 'period-end') {\n      backgroundColor = '#f59e0b'; // Orange for period ends\n    }\n    \n    return {\n      style: {\n        backgroundColor,\n        borderRadius: '4px',\n        opacity: 0.8,\n        color: 'white',\n        border: '0px',\n        display: 'block',\n      },\n    };\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <CalendarIcon className=\"h-5 w-5 mr-2\" />\n            IEP Calendar\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center\">\n          <CalendarIcon className=\"h-5 w-5 mr-2\" />\n          IEP Calendar\n        </CardTitle>\n        <p className=\"text-sm text-gray-600\">\n          IEP due dates and reporting periods\n        </p>\n        {reportingData && (\n          <div className=\"flex flex-wrap gap-2 mt-2\">\n            <div className=\"flex items-center text-xs\">\n              <div className=\"w-3 h-3 bg-blue-500 rounded mr-1\"></div>\n              <span>IEP Due Dates</span>\n            </div>\n            <div className=\"flex items-center text-xs\">\n              <div className=\"w-3 h-3 bg-green-500 rounded mr-1\"></div>\n              <span>Period Starts</span>\n            </div>\n            <div className=\"flex items-center text-xs\">\n              <div className=\"w-3 h-3 bg-orange-500 rounded mr-1\"></div>\n              <span>Period Ends</span>\n            </div>\n          </div>\n        )}\n      </CardHeader>\n      <CardContent>\n        <div style={{ height: '500px' }}>\n          <Calendar\n            localizer={localizer}\n            events={events}\n            startAccessor=\"start\"\n            endAccessor=\"end\"\n            onSelectEvent={handleSelectEvent}\n            eventPropGetter={eventStyleGetter}\n            views={['month', 'agenda']}\n            defaultView=\"month\"\n            popup\n            messages={{\n              next: \"Next\",\n              previous: \"Previous\", \n              today: \"Today\",\n              month: \"Month\",\n              agenda: \"Agenda\",\n              noEventsInRange: \"No IEP due dates in this range\",\n            }}\n            components={{\n              event: ({ event }) => (\n                <div className=\"flex items-center text-xs\">\n                  {event.resource.type === 'iep-due' ? (\n                    <>\n                      <GraduationCap className=\"h-3 w-3 mr-1\" />\n                      <span className=\"truncate\">{event.resource.studentName}</span>\n                    </>\n                  ) : (\n                    <>\n                      <Clock className=\"h-3 w-3 mr-1\" />\n                      <span className=\"truncate\">P{event.resource.periodNumber}</span>\n                    </>\n                  )}\n                </div>\n              ),\n            }}\n          />\n        </div>\n        {events.length === 0 && (\n          <div className=\"text-center text-gray-500 py-8\">\n            <CalendarIcon className=\"h-12 w-12 mx-auto mb-2 text-gray-300\" />\n            <p>No events scheduled</p>\n            <p className=\"text-sm\">Add IEP due dates to students and configure reporting periods to see them here</p>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","path":null,"size_bytes":9299,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2254,"size_tokens":null},"client/src/components/edit-student-modal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { z } from \"zod\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { format } from \"date-fns\";\n\nconst RELATED_SERVICES_OPTIONS = [\n  \"None\",\n  \"Speech-Language Therapy\",\n  \"Physical Therapy\", \n  \"Occupational Therapy\",\n  \"Nursing\",\n  \"Hearing\",\n  \"Vision\"\n];\n\nconst editStudentSchema = z.object({\n  name: z.string().min(1, \"Student name is required\"),\n  grade: z.string().optional(),\n  iepDueDate: z.string().optional(),\n  relatedServices: z.array(z.string()).optional(),\n});\n\ntype EditStudentFormData = z.infer<typeof editStudentSchema>;\n\ninterface Student {\n  id: number;\n  name: string;\n  grade?: string;\n  iepDueDate?: string;\n  relatedServices?: string;\n}\n\ninterface EditStudentModalProps {\n  student: Student;\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess?: () => void;\n}\n\nexport default function EditStudentModal({ student, isOpen, onClose, onSuccess }: EditStudentModalProps) {\n  const { toast } = useToast();\n  \n  // Parse existing related services from comma-separated string to array\n  const existingServices = student.relatedServices ? student.relatedServices.split(\", \").filter(Boolean) : [];\n  const [selectedServices, setSelectedServices] = useState<string[]>(existingServices);\n\n  const form = useForm<EditStudentFormData>({\n    resolver: zodResolver(editStudentSchema),\n    defaultValues: {\n      name: student.name,\n      grade: student.grade || \"\",\n      iepDueDate: student.iepDueDate ? format(new Date(student.iepDueDate), \"yyyy-MM-dd\") : \"\",\n      relatedServices: existingServices,\n    },\n  });\n\n  // Reset form when student data changes\n  useEffect(() => {\n    const newExistingServices = student.relatedServices ? student.relatedServices.split(\", \").filter(Boolean) : [];\n    setSelectedServices(newExistingServices);\n    form.reset({\n      name: student.name,\n      grade: student.grade || \"\",\n      iepDueDate: student.iepDueDate ? format(new Date(student.iepDueDate), \"yyyy-MM-dd\") : \"\",\n      relatedServices: newExistingServices,\n    });\n  }, [student, form]);\n\n  const editStudentMutation = useMutation({\n    mutationFn: async (data: EditStudentFormData) => {\n      // Convert array of services to comma-separated string for backend\n      const formattedData = {\n        ...data,\n        relatedServices: data.relatedServices?.join(\", \") || \"\",\n      };\n      console.log(\"Frontend: Updating student data:\", formattedData);\n      await apiRequest(\"PUT\", `/api/students/${student.id}`, formattedData);\n    },\n    onSuccess: () => {\n      // Invalidate relevant caches to refresh the data - use exact query key format\n      queryClient.invalidateQueries({ queryKey: [\"/api/students\"] });\n      queryClient.invalidateQueries({ queryKey: [`/api/students/${student.id}`] });\n      \n      toast({\n        title: \"Success\",\n        description: \"Student information updated successfully!\",\n      });\n      form.reset();\n      setSelectedServices([]);\n      onSuccess?.();\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      \n      toast({\n        title: \"Error\",\n        description: \"Failed to update student information. Please try again.\",\n        variant: \"destructive\",\n      });\n      console.error(\"Error updating student:\", error);\n    },\n  });\n\n  const onSubmit = (data: EditStudentFormData) => {\n    editStudentMutation.mutate(data);\n  };\n\n  const handleClose = () => {\n    form.reset();\n    setSelectedServices(existingServices);\n    onClose();\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Edit Student Information</DialogTitle>\n        </DialogHeader>\n        \n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Student Name</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Enter student name\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"grade\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Grade Level</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select grade level\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"PreK\">Pre-K</SelectItem>\n                      <SelectItem value=\"K\">Kindergarten</SelectItem>\n                      <SelectItem value=\"1\">1st Grade</SelectItem>\n                      <SelectItem value=\"2\">2nd Grade</SelectItem>\n                      <SelectItem value=\"3\">3rd Grade</SelectItem>\n                      <SelectItem value=\"4\">4th Grade</SelectItem>\n                      <SelectItem value=\"5\">5th Grade</SelectItem>\n                      <SelectItem value=\"6\">6th Grade</SelectItem>\n                      <SelectItem value=\"7\">7th Grade</SelectItem>\n                      <SelectItem value=\"8\">8th Grade</SelectItem>\n                      <SelectItem value=\"9\">9th Grade</SelectItem>\n                      <SelectItem value=\"10\">10th Grade</SelectItem>\n                      <SelectItem value=\"11\">11th Grade</SelectItem>\n                      <SelectItem value=\"12\">12th Grade</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"iepDueDate\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>IEP Due Date</FormLabel>\n                  <FormControl>\n                    <Input type=\"date\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"relatedServices\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Related Services</FormLabel>\n                  <div className=\"space-y-2 mt-2\">\n                    {RELATED_SERVICES_OPTIONS.map((service) => (\n                      <div key={service} className=\"flex items-center space-x-2\">\n                        <Checkbox\n                          id={service}\n                          checked={field.value?.includes(service) || false}\n                          onCheckedChange={(checked) => {\n                            const currentServices = field.value || [];\n                            let updatedServices;\n                            \n                            if (service === \"None\") {\n                              // If \"None\" is selected, clear all other services\n                              updatedServices = checked ? [\"None\"] : [];\n                            } else {\n                              // If any other service is selected, remove \"None\" and add/remove the service\n                              if (checked) {\n                                updatedServices = [...currentServices.filter(s => s !== \"None\"), service];\n                              } else {\n                                updatedServices = currentServices.filter(s => s !== service);\n                              }\n                            }\n                            \n                            field.onChange(updatedServices);\n                            setSelectedServices(updatedServices);\n                          }}\n                        />\n                        <label \n                          htmlFor={service} \n                          className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                        >\n                          {service}\n                        </label>\n                      </div>\n                    ))}\n                  </div>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex justify-end space-x-3 pt-4\">\n              <Button \n                type=\"button\" \n                variant=\"outline\"\n                onClick={handleClose}\n                disabled={editStudentMutation.isPending}\n              >\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={editStudentMutation.isPending}\n              >\n                {editStudentMutation.isPending && (\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                )}\n                Update Student\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","path":null,"size_bytes":10239,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"import { useEffect, useState } from \"react\";\n\nexport function useAuth() {\n  const [authState, setAuthState] = useState({ user: null, isLoading: true, isAuthenticated: false });\n\n  useEffect(() => {\n    const checkAuth = async () => {\n      try {\n        console.log(\"Checking authentication status...\");\n        const response = await fetch(\"/api/auth/user\", {\n          credentials: \"include\",\n          cache: \"no-store\"\n        });\n        \n        if (response.ok) {\n          const userData = await response.json();\n          console.log(\"Auth check successful - user data:\", userData);\n          setAuthState({ user: userData, isLoading: false, isAuthenticated: true });\n        } else {\n          console.log(\"Auth check failed - status:\", response.status);\n          // Set as unauthenticated to show landing page\n          setAuthState({ user: null, isLoading: false, isAuthenticated: false });\n        }\n      } catch (error) {\n        console.log(\"Auth check error:\", error);\n        // Set as unauthenticated to show landing page\n        setAuthState({ user: null, isLoading: false, isAuthenticated: false });\n      }\n    };\n\n    // Initial check only, no polling to reduce network overhead\n    checkAuth();\n  }, []);\n\n  return authState;\n}\n","path":null,"size_bytes":1253,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\n// Optimized connection pool configuration\nexport const pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  // Maximum number of connections in the pool\n  max: 10,\n  // Close idle connections after 30 seconds\n  idleTimeoutMillis: 30000,\n  // Return an error after 10 seconds if connection cannot be established\n  connectionTimeoutMillis: 10000,\n});\n\n// Handle pool errors to prevent unhandled rejections\npool.on('error', (err) => {\n  console.error('Unexpected error on idle database client', err);\n});\n\nexport const db = drizzle({ client: pool, schema });","path":null,"size_bytes":921,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-transparent border border-gray-300\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-blue-500 transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":817,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"replit.md":{"content":"# Special Education Data Collection Platform\n\n## Overview\n\nThis is a full-stack web application for special education teachers to track student progress, manage IEP goals, and generate meaningful reports. The platform streamlines monitoring student achievements and documenting progress over time, aiming to provide a comprehensive tool for educators.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\nPrimary test student: User consistently works with Student 1 (ID: 5). User previously had 3 goals (\"Literacy\", \"Behavior\", and \"Focus\") with data points that were accidentally deleted during test data cleanup on July 18, 2025. These need to be recreated - Focus goal uses duration data collection type, Behavior uses frequency, Literacy uses percentage. All goals support full data entry workflow including duration-based measurements. All students now properly belong to user 4201332 for clean ownership during development.\n\nGoal limits: Each student can have a maximum of 15 goals (not required to have 15). Each goal can have a maximum of 10 objectives. Current system enforces both goal and objective limits with proper validation (September 1, 2025).\n\n## System Architecture\n\n### Data Safety Measures\n- **Database schema changes**: Always use `npm run db:push --force` for safe schema synchronization to prevent data loss during development.\n- **Data backup**: Critical data like goals and objectives should be backed up before any schema modifications.\n- **User data protection**: All data belongs to user 4201332 during development with strict ownership verification.\n\n### UI/UX Decisions\n- Consistent design system using Radix UI components with shadcn/ui.\n- Tailwind CSS for styling and custom theming.\n- Mobile-first responsive design.\n- ARIA compliant components for accessibility.\n- Visual elements include skeleton loaders, spinners, toast notifications, error boundaries, and color-coded calendar events.\n- Professional landing page with a clean white background and dark blue text, showcasing core features and calls to action.\n- Interactive calendar displaying IEP due dates and reporting periods.\n- Grade-level student organization on the dashboard with visual headers and student count badges.\n- Enhanced chart visualizations with evenly spaced Y-axis tick marks, smart interval calculation, and consistent percentage display for professional reporting.\n- Student detail tabs feature clear active state highlighting with blue background, darker text, and semi-bold font weight for improved navigation visibility (September 1, 2025).\n\n### Technical Implementations\n- **Frontend**: React 18 with TypeScript, TanStack Query for server state, Wouter for routing, React Hook Form with Zod validation, Recharts for data visualization.\n- **Backend**: Node.js with Express.js, TypeScript with ESM modules, RESTful API design.\n- **Authentication**: Replit Auth with OpenID Connect, Express sessions with PostgreSQL storage, HTTP-only cookies. Authentication can be disabled for development for simplified workflow.\n- **Database**: PostgreSQL with Drizzle ORM, Neon serverless PostgreSQL for connection pooling.\n- **Build System**: Vite for development, ESBuild for production server bundling, npm for package management. TypeScript strict mode enabled.\n- **Data Management**: Drizzle ORM for schema management, Zod for type-safe validation, proper foreign key constraints, and optimized indexing.\n- **Data Flow**: Secure authentication flow, streamlined data collection, and robust progress tracking. Data persistence is confirmed across sessions and server restarts.\n- **Data Collection Enhancements**: Dynamic form inputs adapting to goal types (percentage, frequency, duration), real-time live collection tab with session-based tracking, frequency counters, duration timers, and percentage trial counters. Support for multi-student group data collection. Enhanced UI with side-by-side Level of Support and Setting checklists for efficient data entry (September 1, 2025).\n- **Reporting**: Comprehensive raw data table with filtering, sorting, and PDF export capabilities. Individual goal scatterplots with goal-specific data filtering and trend lines. Clean Goal Summary Reports without \"Recent Performance\" statements for professional presentation.\n- **Chart Visualization**: Multiple chart types (line, bar, pie) with dropdown selection on goal cards, sessionStorage preferences, and dynamic chart type switching with proper icons and user-friendly interface.\n- **Data Point Management**: Implemented comprehensive data point editing system with dynamic forms, PATCH endpoint for updates, and real-time cache invalidation. Fixed timezone-related date consistency issues in live data collection to ensure recorded dates match data dates. Resolved critical TypeScript errors that caused application crashes when adding data points to goals (August 31, 2025), ensuring stable data entry functionality across all goal types. Fixed Level of Support bug where standard options like \"Visual\" incorrectly appeared as custom options during data entry due to JSON array storage format mismatch - now only truly custom support levels appear as additional options (August 31, 2025). Fixed Setting field validation error where array data was incorrectly processed, now properly converts array to JSON string for database storage in both POST and PATCH endpoints (September 1, 2025).\n- **Goal and Objective Management**: Full CRUD operations for goals and objectives, with validation for goal limits (max 10 goals per student) and unlimited objectives per goal. Objectives are directly associated with students. Custom Level of Support functionality allows users to create personalized support levels during goal creation, which automatically appear in data collection interfaces. Modal scrolling issues resolved with proper height constraints and inline styling (August 30, 2025). Enhanced Add Goal Modal with prominent objectives section allows users to add up to 5 objectives during goal creation, with improved visual design including objective counter, helpful guidance text, and professional styling (August 31, 2025). Both goals and objectives include comprehensive delete functionality with confirmation dialogs. Objective creation streamlined by removing title field requirement and adding target date field for better focus on meaningful content (August 31, 2025). Database schema updated to make objective title field optional while maintaining backward compatibility. **Unified Goal and Objective Data Collection**: Implemented comprehensive unified system where goal and objective data points are combined into single charts while maintaining individual objective chart options. Enhanced data entry forms support both general goal and objective-specific data collection with visual indicators (blue for general goal, green for objectives). Raw Data table and Reports section now display both data types with proper labeling and objective descriptions (August 31, 2025). **Progress Tracking Enhancement**: Added comprehensive progress bars and statistics to objectives in Goals & Progress tab matching goal progress functionality, including currentProgress, averageScore, trend, lastScore, and dataPointsCount. Implemented consistent Edit/Delete button placement for both goals and objectives in the top-right position beside status badges. Added \"Last Updated\" dates under each objective progress bar with Calendar icon to match goal card formatting for complete interface consistency (August 31, 2025).\n- **Related Services**: Enhanced Related Services functionality with \"None\" option and mutual exclusivity logic in both add and edit student modals. Users can select \"None\" if no services are provided, with automatic clearing of other services when \"None\" is selected. Edit modal shows all available services with proper form state management (September 1, 2025).\n- **Setting Field Integration**: Added comprehensive Setting field to both Data Entry and Live Collection forms with standard options (General Education, Special Education, Small Group, Whole Group, 1:1) and custom input capability. Implemented side-by-side layout with Level of Support for improved form organization and screen space utilization (September 1, 2025).\n- **Reporting Periods**: Configurable reporting periods (e.g., 4.5 weeks or 3 weeks) with persistent database storage, dynamic date input, and calendar integration. Enhanced color scheme with green for current period and blue for future periods (September 1, 2025).\n- **Monthly Reminder System**: Automated popup alerts for upcoming calendar events including IEP due dates and reporting period start/end dates. Shows once per month with color-coded event categorization, days-until counters, and clean dismissal system (September 1, 2025).\n- **Mastery Alert System**: Comprehensive automated mastery detection system that monitors goal and objective progress against target criteria. Features intelligent parsing of criteria patterns and **sliding window evaluation** that scans ALL data points to find ANY qualifying window where mastery criteria is met (not just the most recent trials). Supports \"X/Y trials\" format (e.g., \"80% in 4/5 trials\" = 4 of any 5 trials at 80%+) and \"consecutive\" format (e.g., \"80% for 3 consecutive sessions\" = any 3 consecutive sessions all at 80%+). **Important**: Goals with objectives only show mastery when ALL objectives have been mastered - the goal's own data points are not sufficient. Goals without objectives continue to use goal-level data point evaluation. Updated November 29, 2025.\n- **User Ownership**: Strict user ownership system implemented to ensure data integrity and prevent cross-user data access issues.\n- **Database Performance Optimizations**: Comprehensive database optimizations implemented December 1, 2025:\n  - Connection pool configuration: max=10 connections, 30s idle timeout, 10s connection timeout with proper error handling\n  - Database indexes added on all frequently queried columns (userId, studentId, goalId, objectiveId, date) for faster lookups\n  - N+1 query patterns eliminated via batch operations (getAllStudentsWithDetails, getAllGoalsWithDetails, getAllDataPointsForGoalWithObjectives)\n  - Transaction support for all cascade delete operations (deleteGoal, clearStudentData, removeStudentFromCaseload, clearAllUserData) ensuring atomicity\n  - Admin verification queries optimized from 6 separate queries to 1 combined query with subqueries\n  - **Error Handling**: All 50+ database operations wrapped with withDatabaseErrorHandling for automatic retry with exponential backoff, proper error classification (CONNECTION, QUERY, TRANSACTION, TIMEOUT), and contextual logging\n  - **Pagination Support**: Paginated endpoints for data points (by goal, by student) and admin tables with configurable page/limit parameters and proper metadata (total, totalPages)\n  - **Batch Operations**: Bulk create/delete for data points with validation, size limits (max 100), and atomic transactions\n  - All 147 unit tests passing after enhancements\n- **Production Readiness**: Application fully prepared for external deployment with comprehensive security configurations, documentation, and deployment guides. All development files cleaned up and debug logging removed.\n- **Resource Optimization (December 1, 2025)**:\n  - Fixed duplicate auth middleware setup that caused memory accumulation and CPU overhead\n  - React Query configured with sensible cache times (30s stale, 5min garbage collection) to reduce unnecessary refetching\n  - All debug endpoints gated behind NODE_ENV !== 'production' check\n  - Admin login credentials moved from hardcoded values to environment variables\n  - Removed excessive console.log statements from production code paths\n  - API request logging minimized to reduce CPU usage with large payloads\n\n## External Dependencies\n\n### Core Dependencies\n- `@neondatabase/serverless`: PostgreSQL connection\n- `drizzle-orm`: Database ORM and query builder\n- `@tanstack/react-query`: Server state management\n- `@radix-ui/react-***`: Headless UI components\n- `recharts`: Data visualization library\n- `wouter`: Lightweight routing\n- `zod`: Schema validation\n\n### Authentication Dependencies\n- `openid-client`: OpenID Connect implementation\n- `passport`: Authentication middleware\n- `express-session`: Session management\n- `connect-pg-simple`: PostgreSQL session store","path":null,"size_bytes":12424,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"PRODUCTION_CHECKLIST.md":{"content":"# Production Deployment Checklist\n\n## âœ… Pre-Deployment Security & Configuration\n\n### Environment Configuration\n- [ ] Copy `.env.example` to `.env` and configure all variables\n- [ ] Generate secure SESSION_SECRET (32+ random characters)\n- [ ] Configure DATABASE_URL for production PostgreSQL\n- [ ] Set NODE_ENV=production\n- [ ] Configure SSL certificates\n- [ ] Set up proper domain configuration\n\n### Database Security\n- [ ] Create production database with strong credentials\n- [ ] Enable SSL connections\n- [ ] Configure database firewall rules\n- [ ] Set up automated backups\n- [ ] Run database migrations: `npm run db:push`\n\n### Application Security\n- [ ] Review and remove any hardcoded credentials\n- [ ] Configure rate limiting\n- [ ] Enable HTTPS redirect\n- [ ] Set secure headers in reverse proxy\n- [ ] Review file upload restrictions\n- [ ] Configure CORS properly\n\n### Server Security\n- [ ] Update all system packages\n- [ ] Configure firewall (ports 22, 80, 443 only)\n- [ ] Set up SSH key authentication\n- [ ] Disable root login\n- [ ] Configure log monitoring\n\n## âœ… Code Cleanup Completed\n\n### Development Files Removed\n- [x] All debug cookie files removed\n- [x] Test data generation scripts removed  \n- [x] Development screenshots removed\n- [x] Debug logging cleaned up\n\n### Production Files Added\n- [x] `.env.example` with all required variables\n- [x] `DEPLOYMENT.md` with complete setup instructions\n- [x] `PRODUCTION_CHECKLIST.md` for deployment verification\n- [x] `.gitignore` updated for production\n- [x] `README.md` with startup instructions\n\n## âœ… Application Features Ready\n\n### Authentication Options\n- [x] OpenID Connect configuration documented\n- [x] Development bypass options documented\n- [x] Custom authentication integration points identified\n\n### Core Features Tested\n- [x] Student management system\n- [x] Goal tracking and data collection\n- [x] Progress visualization with charts\n- [x] PDF report generation\n- [x] Admin verification tools\n- [x] Live data collection features\n\n### Performance Optimizations\n- [x] Production build configuration\n- [x] Static asset optimization\n- [x] Database query optimization\n- [x] Session management optimized\n\n## âœ… Deployment Options\n\n### Quick Start Commands Available\n```bash\n# Option 1: Python launcher\npython main.py\n\n# Option 2: NPM commands\nnpm install\nnpm run build\nnpm start\n```\n\n### Production Deployment Methods\n1. **Direct Node.js** - Simple single-server deployment\n2. **PM2 Process Manager** - Production process management\n3. **Nginx Reverse Proxy** - Full production web server setup\n4. **Docker** - Containerized deployment (instructions in DEPLOYMENT.md)\n\n## âœ… Monitoring & Maintenance\n\n### Health Checks\n- [ ] Application startup verification\n- [ ] Database connectivity test\n- [ ] Authentication flow test\n- [ ] File upload test\n- [ ] PDF generation test\n\n### Ongoing Maintenance\n- [ ] Set up log rotation\n- [ ] Configure backup schedules\n- [ ] Monitor disk space\n- [ ] Update security patches\n- [ ] Monitor application performance\n\n## âœ… User Data Migration\n\n### Clean Development Data\n- [x] Development test data preserved for reference\n- [x] User ownership system ready for production users\n- [x] Goal and objective limits enforced\n- [x] Data integrity constraints in place\n\n### Production Data Setup\n- [ ] Create initial admin user\n- [ ] Configure reporting periods\n- [ ] Set up organizational structure\n- [ ] Import existing student data (if applicable)\n\n## ðŸš€ Ready for Production\n\nThe application is now prepared for production deployment with:\n- Comprehensive security configurations\n- Multiple deployment options\n- Complete documentation\n- Clean, optimized codebase\n- Robust data integrity systems\n- Professional reporting capabilities\n\nAll development files have been cleaned up and production configurations are in place.","path":null,"size_bytes":3820,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/pages/home.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Plus, Users, Target, BarChart3, Calendar, ChevronRight, Trash2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { GraduationCap } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport StudentOverviewCard from \"@/components/student-overview-card\";\nimport AddStudentModal from \"@/components/add-student-modal\";\nimport DashboardCalendar from \"@/components/dashboard-calendar\";\nimport { ReportingPeriodsButton } from \"@/components/reporting-periods-modal\";\nimport ReportingPeriodsDisplay from \"@/components/reporting-periods-display\";\nimport { ClearDataModal } from \"@/components/clear-data-modal\";\nimport MonthlyReminderPopup from \"@/components/monthly-reminder-popup\";\n\nexport default function Home() {\n  const { user, isLoading: authLoading } = useAuth();\n  const { toast } = useToast();\n  const [isAddStudentModalOpen, setIsAddStudentModalOpen] = useState(false);\n  const [isClearAllDataModalOpen, setIsClearAllDataModalOpen] = useState(false);\n\n  const { data: students, isLoading, error, refetch } = useQuery({\n    queryKey: [\"/api/students\"],\n    enabled: !!user,\n    retry: 3,\n    staleTime: 0, // Always fetch fresh data\n  });\n\n  // Handle unauthorized errors\n  useEffect(() => {\n    if (error && isUnauthorizedError(error)) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n    }\n  }, [error, toast]);\n\n  if (authLoading || isLoading) {\n    return (\n      <div className=\"min-h-screen bg-surface\">\n        <div className=\"flex items-center justify-center min-h-screen\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  const studentsArray = Array.isArray(students) ? students : [];\n  const totalStudents = studentsArray.length || 0;\n  const totalGoals = studentsArray.reduce((sum: number, student: any) => sum + (student.totalGoals || 0), 0) || 0;\n  const activeGoals = studentsArray.reduce((sum: number, student: any) => sum + (student.activeGoals || 0), 0) || 0;\n  const totalDataPoints = studentsArray.reduce((sum: number, student: any) => sum + (student.totalDataPoints || 0), 0) || 0;\n\n  return (\n    <div className=\"min-h-screen bg-surface\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b border-gray-200\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            <div className=\"flex items-center\">\n              <GraduationCap className=\"h-8 w-8 text-primary mr-3\" />\n              <h1 className=\"text-xl font-bold text-gray-900\">Special Education Data Collection</h1>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"text-sm text-gray-600\">{(user as any)?.email || 'User'}</div>\n              <Button \n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => window.location.href = '/landing'}\n                className=\"text-gray-600 hover:text-gray-800\"\n              >\n                View Landing Page\n              </Button>\n              <Button \n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => {\n                  // Clear session and reload to see customer experience\n                  fetch('/api/logout', { method: 'POST' })\n                    .then(() => window.location.reload())\n                    .catch(() => window.location.reload());\n                }}\n                className=\"text-gray-600 hover:text-gray-800\"\n              >\n                Logout\n              </Button>\n              <Button \n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => window.location.href = '/admin'}\n                className=\"text-gray-600 hover:text-gray-800\"\n              >\n                Admin Panel\n              </Button>\n              <Button \n                variant=\"ghost\"\n                onClick={() => window.location.href = '/api/logout'}\n                className=\"text-gray-400 hover:text-gray-600\"\n              >\n                Sign Out\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Header Section */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-3xl font-bold text-gray-900\">My Students</h2>\n          <p className=\"text-gray-600 mt-1\">Manage IEP goals and track student progress</p>\n        </div>\n\n        {/* Quick Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-1 gap-6 mb-8 max-w-sm\">\n          <Card \n            className=\"hover:shadow-md transition-shadow cursor-pointer hover:bg-gray-50\"\n            onClick={() => {\n              // Scroll to the students section\n              const studentsSection = document.getElementById('students-section');\n              if (studentsSection) {\n                studentsSection.scrollIntoView({ behavior: 'smooth' });\n              }\n            }}\n          >\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"p-3 bg-blue-100 rounded-lg\">\n                  <Users className=\"h-6 w-6 text-primary\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-gray-600 text-sm\">Total Students</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{totalStudents}</p>\n                </div>\n                <div className=\"ml-auto\">\n                  <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Calendar and Students Section */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8\">\n          <div className=\"lg:col-span-2\">\n            <DashboardCalendar />\n          </div>\n          <div className=\"space-y-6\">\n            {/* Quick Actions */}\n            <Card>\n              <CardContent className=\"p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Quick Actions</h3>\n                <div className=\"space-y-3\">\n                  <Button \n                    onClick={() => setIsAddStudentModalOpen(true)}\n                    className=\"w-full justify-start\"\n                    variant=\"outline\"\n                  >\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Add New Student\n                  </Button>\n                  <Button \n                    onClick={() => window.location.href = '/group-collection'}\n                    className=\"w-full justify-start\"\n                    variant=\"outline\"\n                  >\n                    <Users className=\"h-4 w-4 mr-2\" />\n                    Group Data Collection\n                  </Button>\n                  <Button \n                    onClick={() => window.location.href = '/admin'}\n                    className=\"w-full justify-start\"\n                    variant=\"outline\"\n                  >\n                    <Users className=\"h-4 w-4 mr-2\" />\n                    Admin Panel\n                  </Button>\n                  <ReportingPeriodsButton />\n                  <Button \n                    onClick={() => setIsClearAllDataModalOpen(true)}\n                    className=\"w-full justify-start border-red-300 text-red-600 hover:bg-red-50\"\n                    variant=\"outline\"\n                  >\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Clear All Data\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Reporting Periods Display */}\n            <ReportingPeriodsDisplay />\n          </div>\n        </div>\n\n        {/* Students Grid */}\n        <div id=\"students-section\">\n          <div className=\"flex justify-between items-center mb-4\">\n            <h3 className=\"text-xl font-semibold text-gray-900\">All Students</h3>\n            <Button \n              onClick={() => setIsAddStudentModalOpen(true)}\n              size=\"lg\"\n              className=\"shadow-sm\"\n            >\n              <Plus className=\"h-5 w-5 mr-2\" />\n              Add New Student\n            </Button>\n          </div>\n          {!studentsArray || studentsArray.length === 0 ? (\n            <Card className=\"p-12 text-center\">\n              <CardContent>\n                <Users className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n                <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">No Students Yet</h3>\n                <p className=\"text-gray-600 mb-6\">\n                  Get started by adding your first student to begin tracking IEP goals and progress.\n                </p>\n                <Button onClick={() => setIsAddStudentModalOpen(true)}>\n                  <Plus className=\"h-5 w-5 mr-2\" />\n                  Add Your First Student\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"space-y-8\">\n              {(() => {\n                // Normalize grade function to standardize grade formats\n                const normalizeGrade = (grade: string) => {\n                  if (!grade) return 'No Grade Assigned';\n                  const g = grade.trim();\n                  if (g === 'PreK') return 'PreK';\n                  if (g === 'K' || g === 'Kindergarten') return 'Kindergarten';\n                  if (g === '1' || g === '1st' || g === '1st Grade') return '1st Grade';\n                  if (g === '2' || g === '2nd' || g === '2nd Grade') return '2nd Grade';\n                  if (g === '3' || g === '3rd' || g === '3rd Grade') return '3rd Grade';\n                  if (g === '4' || g === '4th' || g === '4th Grade') return '4th Grade';\n                  if (g === '5' || g === '5th' || g === '5th Grade') return '5th Grade';\n                  if (g === '6' || g === '6th' || g === '6th Grade') return '6th Grade';\n                  if (g === '7' || g === '7th' || g === '7th Grade') return '7th Grade';\n                  if (g === '8' || g === '8th' || g === '8th Grade') return '8th Grade';\n                  if (g === '9' || g === '9th' || g === '9th Grade') return '9th Grade';\n                  if (g === '10' || g === '10th' || g === '10th Grade') return '10th Grade';\n                  if (g === '11' || g === '11th' || g === '11th Grade') return '11th Grade';\n                  if (g === '12' || g === '12th' || g === '12th Grade') return '12th Grade';\n                  return g; // Return as-is for other formats\n                };\n\n                // Group students by normalized grade level\n                const gradeGroups = studentsArray.reduce((groups: any, student: any) => {\n                  const normalizedGrade = normalizeGrade(student.grade);\n                  if (!groups[normalizedGrade]) {\n                    groups[normalizedGrade] = [];\n                  }\n                  groups[normalizedGrade].push(student);\n                  return groups;\n                }, {});\n\n                // Sort grades logically (PreK, K, 1st, 2nd, etc., then unassigned)\n                const sortedGrades = Object.keys(gradeGroups).sort((a, b) => {\n                  if (a === 'No Grade Assigned') return 1;\n                  if (b === 'No Grade Assigned') return -1;\n                  if (a === 'PreK') return -1;\n                  if (b === 'PreK') return 1;\n                  if (a === 'Kindergarten') return -1;\n                  if (b === 'Kindergarten') return 1;\n                  \n                  // Extract numbers from grade strings for numerical sorting\n                  const aNum = parseInt(a.match(/\\d+/)?.[0] || '999');\n                  const bNum = parseInt(b.match(/\\d+/)?.[0] || '999');\n                  return aNum - bNum;\n                });\n\n                return sortedGrades.map(grade => (\n                  <div key={grade} className=\"space-y-4\">\n                    <div className=\"flex items-center\">\n                      <GraduationCap className=\"h-5 w-5 text-blue-600 mr-2\" />\n                      <h4 className=\"text-lg font-medium text-gray-800\">{grade}</h4>\n                      <div className=\"ml-2 px-2 py-1 bg-blue-100 text-blue-700 text-sm rounded-full\">\n                        {gradeGroups[grade].length} student{gradeGroups[grade].length !== 1 ? 's' : ''}\n                      </div>\n                    </div>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                      {gradeGroups[grade].map((student: any) => (\n                        <StudentOverviewCard key={student.id} student={student} />\n                      ))}\n                    </div>\n                  </div>\n                ));\n              })()}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Add Student Modal */}\n      <AddStudentModal\n        isOpen={isAddStudentModalOpen}\n        onClose={() => setIsAddStudentModalOpen(false)}\n        onSuccess={() => {\n          refetch();\n          setIsAddStudentModalOpen(false);\n        }}\n      />\n\n      {/* Clear All Data Modal */}\n      <ClearDataModal\n        isOpen={isClearAllDataModalOpen}\n        onClose={() => setIsClearAllDataModalOpen(false)}\n        type=\"all\"\n      />\n\n      {/* Monthly Reminder Popup */}\n      <MonthlyReminderPopup />\n    </div>\n  );\n}\n","path":null,"size_bytes":13852,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":791,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    console.error(`API Error ${res.status}:`, text);\n    \n    // Special handling for authentication failures\n    if (res.status === 401) {\n      console.error(\"Authentication failed - user needs to log in\");\n    }\n    \n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: 30 * 1000,\n      gcTime: 5 * 60 * 1000,\n      retry: 1,\n      retryDelay: 1000,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1646,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0, 0%, 100%);\n  --foreground: hsl(221, 80%, 20%);\n  --muted: hsl(210, 40%, 98%);\n  --muted-foreground: hsl(221, 39%, 45%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(221, 80%, 20%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(221, 80%, 20%);\n  --border: hsl(214, 32%, 91%);\n  --input: hsl(214, 32%, 91%);\n  --primary: hsl(221, 83%, 25%);\n  --primary-foreground: hsl(0, 0%, 100%);\n  --secondary: hsl(221, 83%, 35%);\n  --secondary-foreground: hsl(0, 0%, 100%);\n  --accent: hsl(221, 70%, 45%);\n  --accent-foreground: hsl(0, 0%, 100%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(60, 9.1%, 97.8%);\n  --ring: hsl(221, 83%, 25%);\n  --radius: 0.5rem;\n  --surface: hsl(0, 0%, 100%);\n}\n\n.dark {\n  --background: hsl(240, 10%, 3.9%);\n  --foreground: hsl(0, 0%, 98%);\n  --muted: hsl(240, 3.7%, 15.9%);\n  --muted-foreground: hsl(240, 5%, 64.9%);\n  --popover: hsl(240, 10%, 3.9%);\n  --popover-foreground: hsl(0, 0%, 98%);\n  --card: hsl(240, 10%, 3.9%);\n  --card-foreground: hsl(0, 0%, 98%);\n  --border: hsl(240, 3.7%, 15.9%);\n  --input: hsl(240, 3.7%, 15.9%);\n  --primary: hsl(221, 83%, 53%);\n  --primary-foreground: hsl(210, 40%, 98%);\n  --secondary: hsl(221, 83%, 53%);\n  --secondary-foreground: hsl(210, 40%, 98%);\n  --accent: hsl(262, 83%, 58%);\n  --accent-foreground: hsl(210, 40%, 98%);\n  --destructive: hsl(0, 62.8%, 30.6%);\n  --destructive-foreground: hsl(0, 0%, 98%);\n  --ring: hsl(240, 4.9%, 83.9%);\n  --radius: 0.5rem;\n  --surface: hsl(240, 10%, 3.9%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/lib/pdf-generator.ts":{"content":"import jsPDF from 'jspdf';\nimport autoTable from 'jspdf-autotable';\nimport { format } from 'date-fns';\nimport html2canvas from 'html2canvas';\n\n// Extend jsPDF type to include autoTable\ndeclare module 'jspdf' {\n  interface jsPDF {\n    autoTable: (options: any) => jsPDF;\n  }\n}\n\nexport interface PDFStudentData {\n  id: number;\n  name: string;\n  grade: string;\n  iepDueDate: string | null;\n  relatedServices: string;\n  totalGoals: number;\n  activeGoals: number;\n  completedGoals: number;\n  totalDataPoints: number;\n}\n\nexport interface PDFGoalData {\n  id: number;\n  title: string;\n  description: string;\n  targetCriteria: string;\n  dataCollectionType: string;\n  status: string;\n  currentProgress: number;\n  dataPointsCount: number;\n  lastDataDate: string | null;\n}\n\nexport interface PDFDataPoint {\n  id: number;\n  date: string;\n  goalTitle: string;\n  progressValue: string;\n  progressFormat: string;\n  levelOfSupport: string;\n  anecdotalInfo: string;\n  createdAt: string;\n}\n\nexport class PDFGenerator {\n  private doc: jsPDF;\n\n  constructor() {\n    this.doc = new jsPDF();\n    console.log('PDF instance created successfully');\n  }\n\n  async generateChartsReport(\n    student: PDFStudentData,\n    goals: PDFGoalData[]\n  ): Promise<void> {\n    try {\n      console.log('Setting up charts PDF document...');\n      // Set up document\n      this.setupDocument();\n      \n      console.log('Adding header...');\n      // Add header\n      this.addHeader(student);\n      \n      console.log('Capturing chart images...');\n      // Capture charts from the Reports tab\n      await this.addChartsWithImages(student, goals);\n      \n      console.log('Downloading charts PDF...');\n      // Download\n      this.doc.save(`${student.name}_Progress_Charts_${format(new Date(), 'yyyy-MM-dd')}.pdf`);\n      \n      console.log('Charts PDF generation completed successfully');\n    } catch (error) {\n      console.error('Error in charts PDF generation:', error);\n      throw error;\n    }\n  }\n\n  generateStudentReport(\n    student: PDFStudentData,\n    goals: PDFGoalData[],\n    dataPoints: PDFDataPoint[]\n  ): void {\n    try {\n      console.log('Setting up PDF document...');\n      // Set up document\n      this.setupDocument();\n      \n      console.log('Adding header...');\n      // Add header\n      this.addHeader(student);\n      \n      console.log('Adding student info...');\n      // Add student information\n      this.addStudentInfo(student);\n      \n      console.log('Adding goals summary...');\n      // Add goals summary\n      this.addGoalsSummary(goals);\n      \n      console.log('Adding goals details...');\n      // Add goals details\n      this.addGoalsDetails(goals);\n      \n      console.log('Adding new page for raw data...');\n      // Start new page for raw data\n      this.doc.addPage();\n      \n      console.log('Adding raw data table...');\n      this.addRawDataTable(dataPoints);\n      \n      console.log('Downloading PDF...');\n      // Download the PDF\n      this.downloadPDF(student.name);\n    } catch (error) {\n      console.error('Error in PDF generation:', error);\n      throw error;\n    }\n  }\n\n  private setupDocument(): void {\n    this.doc.setProperties({\n      title: 'Student IEP Progress Report',\n      subject: 'Special Education Data Collection Report',\n      author: 'Special Education Data Collection App',\n      creator: 'Special Education Data Collection App'\n    });\n  }\n\n  private addHeader(student: PDFStudentData): void {\n    // Title\n    this.doc.setFontSize(20);\n    this.doc.setFont('helvetica', 'bold');\n    this.doc.text('IEP Progress Report', 105, 20, { align: 'center' });\n    \n    // Student name\n    this.doc.setFontSize(16);\n    this.doc.text(`Student: ${student.name}`, 105, 30, { align: 'center' });\n    \n    // Report date\n    this.doc.setFontSize(12);\n    this.doc.setFont('helvetica', 'normal');\n    this.doc.text(`Report Generated: ${format(new Date(), 'MMMM dd, yyyy')}`, 105, 40, { align: 'center' });\n    \n    // Horizontal line\n    this.doc.setLineWidth(0.5);\n    this.doc.line(20, 45, 190, 45);\n  }\n\n  private addStudentInfo(student: PDFStudentData): void {\n    let yPos = 55;\n    \n    this.doc.setFontSize(14);\n    this.doc.setFont('helvetica', 'bold');\n    this.doc.text('Student Information', 20, yPos);\n    \n    yPos += 10;\n    this.doc.setFontSize(11);\n    this.doc.setFont('helvetica', 'normal');\n    \n    // Student details\n    const studentInfo = [\n      ['Grade Level:', student.grade || 'Not specified'],\n      ['IEP Due Date:', student.iepDueDate ? format(new Date(student.iepDueDate), 'MMMM dd, yyyy') : 'Not set'],\n      ['Related Services:', student.relatedServices || 'None specified'],\n      ['Total Goals:', student.totalGoals.toString()],\n      ['Active Goals:', student.activeGoals.toString()],\n      ['Completed Goals:', student.completedGoals.toString()],\n      ['Total Data Points:', student.totalDataPoints.toString()]\n    ];\n\n    studentInfo.forEach(([label, value]) => {\n      this.doc.setFont('helvetica', 'bold');\n      this.doc.text(label, 25, yPos);\n      this.doc.setFont('helvetica', 'normal');\n      this.doc.text(value, 70, yPos);\n      yPos += 8;\n    });\n  }\n\n  private addGoalsSummary(goals: PDFGoalData[]): void {\n    const yPos = 130;\n    \n    this.doc.setFontSize(14);\n    this.doc.setFont('helvetica', 'bold');\n    this.doc.text('Goals Summary', 20, yPos);\n    \n    // Goals summary table\n    const tableData = goals.map(goal => [\n      goal.title,\n      goal.dataCollectionType,\n      goal.status,\n      `${Math.round(goal.currentProgress)}%`,\n      goal.dataPointsCount.toString(),\n      goal.lastDataDate ? format(new Date(goal.lastDataDate), 'MM/dd/yyyy') : 'No data'\n    ]);\n\n    autoTable(this.doc, {\n      startY: yPos + 10,\n      head: [['Goal Title', 'Data Type', 'Status', 'Progress', 'Data Points', 'Last Entry']],\n      body: tableData,\n      theme: 'striped',\n      headStyles: { fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold' },\n      styles: { fontSize: 9, cellPadding: 3 },\n      columnStyles: {\n        0: { cellWidth: 50 },\n        1: { cellWidth: 25 },\n        2: { cellWidth: 20 },\n        3: { cellWidth: 20 },\n        4: { cellWidth: 20 },\n        5: { cellWidth: 25 }\n      }\n    });\n  }\n\n  private addGoalsDetails(goals: PDFGoalData[]): void {\n    let yPos = (this.doc as any).lastAutoTable?.finalY + 20 || 200;\n    \n    this.doc.setFontSize(14);\n    this.doc.setFont('helvetica', 'bold');\n    this.doc.text('Goal Details', 20, yPos);\n    \n    yPos += 10;\n    \n    goals.forEach((goal, index) => {\n      // Check if we need a new page\n      if (yPos > 250) {\n        this.doc.addPage();\n        yPos = 20;\n      }\n      \n      this.doc.setFontSize(12);\n      this.doc.setFont('helvetica', 'bold');\n      this.doc.text(`${index + 1}. ${goal.title}`, 25, yPos);\n      \n      yPos += 8;\n      this.doc.setFontSize(10);\n      this.doc.setFont('helvetica', 'normal');\n      \n      // Goal description (wrap text)\n      const descriptionLines = this.doc.splitTextToSize(`Description: ${goal.description}`, 160);\n      this.doc.text(descriptionLines, 30, yPos);\n      yPos += descriptionLines.length * 5;\n      \n      // Target criteria (wrap text)\n      const criteriaLines = this.doc.splitTextToSize(`Target Criteria: ${goal.targetCriteria}`, 160);\n      this.doc.text(criteriaLines, 30, yPos);\n      yPos += criteriaLines.length * 5;\n      \n      // Goal stats\n      this.doc.text(`Data Collection Type: ${goal.dataCollectionType}`, 30, yPos);\n      yPos += 5;\n      this.doc.text(`Current Progress: ${Math.round(goal.currentProgress)}%`, 30, yPos);\n      yPos += 5;\n      this.doc.text(`Data Points Collected: ${goal.dataPointsCount}`, 30, yPos);\n      yPos += 15; // Extra space between goals\n    });\n  }\n\n  private async addChartsWithImages(student: PDFStudentData, goals: PDFGoalData[]): Promise<void> {\n    let yPos = 40;\n    \n    // Look for charts in multiple possible locations\n    const chartSelectors = [\n      `[data-goal-id]`, // Any chart with goal ID\n      `.recharts-wrapper`, // Recharts containers\n      `[class*=\"chart\"]`, // Any element with \"chart\" in class name\n      `svg[class*=\"recharts\"]` // SVG elements from recharts\n    ];\n    \n    let chartsFound = 0;\n    \n    // Try to capture individual goal charts from the Reports tab\n    for (let i = 0; i < goals.length; i++) {\n      const goal = goals[i];\n      let chartCaptured = false;\n      \n      try {\n        // Look for the chart element by goal ID first\n        let chartElement = document.querySelector(`[data-goal-id=\"${goal.id}\"]`) as HTMLElement;\n        \n        console.log(`Looking for chart with data-goal-id=\"${goal.id}\", found:`, !!chartElement);\n        \n        // If not found, try alternative selectors\n        if (!chartElement) {\n          // Try to find charts by card structure with goal titles\n          const goalCards = Array.from(document.querySelectorAll('.card, [class*=\"card\"]')).filter((card: any) => {\n            const cardText = card.textContent || '';\n            return cardText.includes(goal.title);\n          });\n          \n          if (goalCards.length > 0) {\n            chartElement = goalCards[0] as HTMLElement;\n            console.log(`Found chart by goal title: ${goal.title}`);\n          }\n        }\n        \n        if (chartElement && chartElement.offsetHeight > 0 && chartElement.offsetWidth > 0) {\n          console.log(`Capturing chart for goal: ${goal.title}`);\n          \n          // Add goal header\n          if (yPos > 200) {\n            this.doc.addPage();\n            yPos = 20;\n          }\n          \n          this.doc.setFontSize(14);\n          this.doc.setFont('helvetica', 'bold');\n          this.doc.text(`${i + 1}. ${goal.title}`, 20, yPos);\n          \n          yPos += 10;\n          this.doc.setFontSize(10);\n          this.doc.setFont('helvetica', 'normal');\n          \n          // Goal description\n          if (goal.description) {\n            const descLines = this.doc.splitTextToSize(`Description: ${goal.description}`, 170);\n            this.doc.text(descLines, 20, yPos);\n            yPos += descLines.length * 5 + 3;\n          }\n          \n          // Target criteria\n          if (goal.targetCriteria) {\n            const criteriaLines = this.doc.splitTextToSize(`Target: ${goal.targetCriteria}`, 170);\n            this.doc.text(criteriaLines, 20, yPos);\n            yPos += criteriaLines.length * 5 + 3;\n          }\n          \n          yPos += 5;\n          \n          // Capture the chart as image\n          const canvas = await html2canvas(chartElement, {\n            backgroundColor: '#ffffff',\n            scale: 1.5,\n            useCORS: true,\n            allowTaint: true,\n            height: chartElement.offsetHeight,\n            width: chartElement.offsetWidth\n          });\n          \n          const imgData = canvas.toDataURL('image/png');\n          \n          // Calculate dimensions to fit on page\n          const imgWidth = 170; // Max width for PDF\n          const imgHeight = (canvas.height / canvas.width) * imgWidth;\n          \n          // Check if we need a new page\n          if (yPos + imgHeight > 280) {\n            this.doc.addPage();\n            yPos = 20;\n          }\n          \n          // Add image to PDF\n          this.doc.addImage(imgData, 'PNG', 20, yPos, imgWidth, imgHeight);\n          yPos += imgHeight + 20;\n          \n          chartCaptured = true;\n          chartsFound++;\n        }\n        \n        if (!chartCaptured) {\n          console.log(`No chart element found for goal: ${goal.title}`);\n          // Add detailed goal information instead\n          if (yPos > 220) {\n            this.doc.addPage();\n            yPos = 20;\n          }\n          \n          this.doc.setFontSize(14);\n          this.doc.setFont('helvetica', 'bold');\n          this.doc.text(`${i + 1}. ${goal.title}`, 20, yPos);\n          \n          yPos += 10;\n          this.doc.setFontSize(10);\n          this.doc.setFont('helvetica', 'normal');\n          \n          // Goal description\n          if (goal.description) {\n            const descLines = this.doc.splitTextToSize(`Description: ${goal.description}`, 170);\n            this.doc.text(descLines, 20, yPos);\n            yPos += descLines.length * 5 + 3;\n          }\n          \n          // Target criteria\n          if (goal.targetCriteria) {\n            const criteriaLines = this.doc.splitTextToSize(`Target: ${goal.targetCriteria}`, 170);\n            this.doc.text(criteriaLines, 20, yPos);\n            yPos += criteriaLines.length * 5 + 3;\n          }\n          \n          yPos += 5;\n          \n          // Instructions\n          this.doc.setFontSize(9);\n          this.doc.setFont('helvetica', 'italic');\n          this.doc.text('To view visual chart: Go to Reports tab in the application and click Print Charts while viewing charts.', 20, yPos);\n          yPos += 15;\n        }\n      } catch (error) {\n        console.error(`Error capturing chart for goal ${goal.title}:`, error);\n        // Continue with next chart\n      }\n    }\n    \n    // Add summary at the end\n    if (yPos > 250) {\n      this.doc.addPage();\n      yPos = 20;\n    }\n    \n    this.doc.setFontSize(12);\n    this.doc.setFont('helvetica', 'bold');\n    this.doc.text('Chart Capture Summary', 20, yPos);\n    yPos += 10;\n    \n    this.doc.setFontSize(10);\n    this.doc.setFont('helvetica', 'normal');\n    this.doc.text(`Charts successfully captured: ${chartsFound} of ${goals.length}`, 20, yPos);\n    yPos += 8;\n    \n    if (chartsFound === 0) {\n      this.doc.text('No visual charts were captured. To include charts in PDF:', 20, yPos);\n      yPos += 6;\n      this.doc.text('1. Navigate to the Reports tab', 25, yPos);\n      yPos += 5;\n      this.doc.text('2. Wait for all charts to load completely', 25, yPos);\n      yPos += 5;\n      this.doc.text('3. Click Print Charts button while charts are visible', 25, yPos);\n    }\n  }\n\n  private addChartsSection(student: PDFStudentData, goals: PDFGoalData[]): void {\n    let yPos = 60;\n    \n    this.doc.setFontSize(16);\n    this.doc.setFont('helvetica', 'bold');\n    this.doc.text('Progress Charts', 20, yPos);\n    \n    yPos += 15;\n    this.doc.setFontSize(11);\n    this.doc.setFont('helvetica', 'normal');\n    this.doc.text('This report contains visual progress charts for each goal.', 20, yPos);\n    \n    yPos += 10;\n    this.doc.text('Charts show data points over time with trend analysis.', 20, yPos);\n    \n    yPos += 20;\n    \n    // Add goals summary for charts\n    this.doc.setFontSize(14);\n    this.doc.setFont('helvetica', 'bold');\n    this.doc.text('Goals Overview', 20, yPos);\n    \n    // Goals summary table for charts context\n    const tableData = goals.map(goal => [\n      goal.title,\n      goal.dataCollectionType,\n      `${Math.round(goal.currentProgress)}%`,\n      goal.dataPointsCount.toString()\n    ]);\n\n    autoTable(this.doc, {\n      startY: yPos + 10,\n      head: [['Goal Title', 'Data Type', 'Current Progress', 'Data Points']],\n      body: tableData,\n      theme: 'striped',\n      headStyles: { fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold' },\n      styles: { fontSize: 10, cellPadding: 4 },\n      columnStyles: {\n        0: { cellWidth: 60 },\n        1: { cellWidth: 40 },\n        2: { cellWidth: 40 },\n        3: { cellWidth: 40 }\n      }\n    });\n    \n    // Add note about charts\n    const finalY = (this.doc as any).lastAutoTable?.finalY + 20 || yPos + 80;\n    this.doc.setFontSize(12);\n    this.doc.setFont('helvetica', 'bold');\n    this.doc.text('Chart Instructions:', 20, finalY);\n    \n    this.doc.setFontSize(10);\n    this.doc.setFont('helvetica', 'normal');\n    this.doc.text('â€¢ View interactive charts in the application\\'s Reports tab', 25, finalY + 12);\n    this.doc.text('â€¢ Each goal displays as a separate scatter plot with trend lines', 25, finalY + 20);\n    this.doc.text('â€¢ Charts show progress over time with date labels on x-axis', 25, finalY + 28);\n    this.doc.text('â€¢ Different data types (percentage, frequency, duration) use appropriate scales', 25, finalY + 36);\n    this.doc.text('â€¢ This printable summary provides context for chart interpretation', 25, finalY + 44);\n  }\n\n  private addRawDataTable(dataPoints: PDFDataPoint[]): void {\n    // Start the raw data table after the header (no student info section)\n    let yPos = 60; // Start closer to header since we removed student info\n    \n    this.doc.setFontSize(16);\n    this.doc.setFont('helvetica', 'bold');\n    this.doc.text('Raw Data Points', 20, yPos);\n    \n    yPos += 15;\n    \n    // Format data for table\n    const tableData = dataPoints.map(point => [\n      format(new Date(point.date), 'MM/dd/yyyy'),\n      point.goalTitle,\n      this.formatProgressValue(point.progressValue, point.progressFormat),\n      this.formatLevelOfSupport(point.levelOfSupport),\n      point.anecdotalInfo || 'â€”',\n      format(new Date(point.createdAt), 'MM/dd/yyyy HH:mm')\n    ]);\n\n    autoTable(this.doc, {\n      startY: yPos,\n      head: [['Date', 'Goal', 'Progress', 'Support Level', 'Notes', 'Recorded']],\n      body: tableData,\n      theme: 'striped',\n      headStyles: { fillColor: [41, 128, 185], textColor: 255, fontStyle: 'bold' },\n      styles: { fontSize: 8, cellPadding: 2 },\n      columnStyles: {\n        0: { cellWidth: 25 },\n        1: { cellWidth: 35 },\n        2: { cellWidth: 25 },\n        3: { cellWidth: 30 },\n        4: { cellWidth: 40 },\n        5: { cellWidth: 30 }\n      }\n    });\n  }\n\n  private formatProgressValue(value: string, format: string): string {\n    const numValue = parseFloat(value);\n    \n    switch (format) {\n      case 'percentage':\n        return `${Math.round(numValue)}%`;\n      case 'frequency':\n        return `${numValue} times`;\n      case 'duration':\n        const minutes = Math.floor(numValue);\n        const seconds = Math.round((numValue - minutes) * 100);\n        return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n      default:\n        return value;\n    }\n  }\n\n  private formatLevelOfSupport(levelOfSupport: string): string {\n    try {\n      const parsed = JSON.parse(levelOfSupport);\n      if (Array.isArray(parsed)) {\n        return parsed.map(level => level.replace(/-/g, ' ')).join(', ');\n      }\n      return levelOfSupport;\n    } catch {\n      return levelOfSupport || 'None';\n    }\n  }\n\n  async generateRawDataReport(\n    student: PDFStudentData,\n    dataPoints: PDFDataPoint[]\n  ): Promise<void> {\n    try {\n      console.log('Setting up raw data PDF document...');\n      // Set up document\n      this.setupDocument();\n      \n      console.log('Adding header...');\n      // Add header\n      this.addHeader(student);\n      \n      console.log('Adding raw data table...');\n      // Add the raw data table directly after header (skip student info section)\n      this.addRawDataTable(dataPoints);\n      \n      console.log('Downloading raw data PDF...');\n      // Download\n      this.doc.save(`${student.name}_Raw_Data_${format(new Date(), 'yyyy-MM-dd')}.pdf`);\n      \n      console.log('Raw data PDF generation completed successfully');\n    } catch (error) {\n      console.error('Raw data PDF generation error:', error);\n      throw error;\n    }\n  }\n\n  private downloadPDF(studentName: string): void {\n    const fileName = `${studentName.replace(/\\s+/g, '_')}_IEP_Report_${format(new Date(), 'yyyy-MM-dd')}.pdf`;\n    this.doc.save(fileName);\n  }\n}","path":null,"size_bytes":19267,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/components/live-collection-tools.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Timer, Plus, Minus, Save, RotateCcw, Clock, Hash, Percent, Target, X } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { z } from \"zod\";\n\nconst liveCollectionDataSchema = z.object({\n  goalId: z.number().int().positive(\"Goal ID must be a positive integer\"),\n  objectiveId: z.number().int().positive().nullable().optional(),\n  date: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\"),\n  progressFormat: z.enum([\"percentage\", \"fraction\", \"frequency\", \"duration\"]),\n  progressValue: z.number().min(-999).max(999),\n  numerator: z.number().int().min(0).max(9999).nullable().optional(),\n  denominator: z.number().int().min(0).max(9999).nullable().optional(),\n  durationUnit: z.enum([\"seconds\", \"minutes\"]).optional(),\n  levelOfSupport: z.array(z.string().max(100)).max(20),\n  setting: z.array(z.string().max(100)).max(20),\n  anecdotalInfo: z.string().max(2000).optional(),\n});\n\ninterface LiveCollectionToolsProps {\n  goalId: number;\n  objectiveId: number | null;\n  studentId: number;\n  goals: any[];\n  objectives: any[];\n  onDataCollected: () => void;\n}\n\nexport default function LiveCollectionTools({ goalId, objectiveId, studentId, goals, objectives, onDataCollected }: LiveCollectionToolsProps) {\n  const { toast } = useToast();\n  const [isCollecting, setIsCollecting] = useState(false);\n  const [sessionStartTime, setSessionStartTime] = useState<Date | null>(null);\n  const [currentTimer, setCurrentTimer] = useState(0); // in seconds\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\n  \n  // Data collection states\n  const [frequencyCount, setFrequencyCount] = useState(0);\n  const [durationMinutes, setDurationMinutes] = useState(0);\n  const [durationSeconds, setDurationSeconds] = useState(0);\n  const [percentageTrials, setPercentageTrials] = useState({ correct: 0, total: 0, noResponse: 0 });\n  const [notes, setNotes] = useState(\"\");\n  const [levelOfSupport, setLevelOfSupport] = useState<string[]>([]);\n  const [setting, setSetting] = useState<string[]>([]);\n  const [customSetting, setCustomSetting] = useState(\"\");\n  const [showCustomSetting, setShowCustomSetting] = useState(false);\n  const [customSupport, setCustomSupport] = useState(\"\");\n  const [showCustomSupport, setShowCustomSupport] = useState(false);\n\n  const selectedGoal = goals.find(g => g.id === goalId);\n  const selectedObjective = objectives.find(obj => obj.id === objectiveId);\n  const dataType = selectedGoal?.dataCollectionType || 'percentage';\n\n  // Timer functionality\n  useEffect(() => {\n    if (isCollecting && sessionStartTime) {\n      timerRef.current = setInterval(() => {\n        const totalSeconds = Math.floor((Date.now() - sessionStartTime.getTime()) / 1000);\n        setCurrentTimer(totalSeconds);\n        \n        // For duration goals, update the duration display in real-time\n        if (dataType === 'duration') {\n          setDurationMinutes(Math.floor(totalSeconds / 60));\n          setDurationSeconds(totalSeconds % 60);\n        }\n      }, 1000);\n    } else {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n      }\n    }\n\n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n      }\n    };\n  }, [isCollecting, sessionStartTime, dataType]);\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const startSession = () => {\n    setIsCollecting(true);\n    setSessionStartTime(new Date());\n    setCurrentTimer(0);\n    setFrequencyCount(0);\n    setDurationMinutes(0);\n    setDurationSeconds(0);\n    setPercentageTrials({ correct: 0, total: 0, noResponse: 0 });\n    setNotes(\"\");\n    toast({\n      title: \"Session Started\",\n      description: \"Live data collection session is now active.\",\n    });\n  };\n\n  const stopSession = () => {\n    setIsCollecting(false);\n    setSessionStartTime(null);\n    if (timerRef.current) {\n      clearInterval(timerRef.current);\n    }\n    toast({\n      title: \"Session Stopped\",\n      description: \"Data collection session has ended.\",\n    });\n  };\n\n  const resetSession = () => {\n    stopSession();\n    setCurrentTimer(0);\n    setFrequencyCount(0);\n    setDurationMinutes(0);\n    setDurationSeconds(0);\n    setPercentageTrials({ correct: 0, total: 0, noResponse: 0 });\n    setNotes(\"\");\n    setLevelOfSupport([]);\n    setSetting([]);\n    setCustomSetting(\"\");\n    setShowCustomSetting(false);\n    setCustomSupport(\"\");\n    setShowCustomSupport(false);\n    toast({\n      title: \"Session Reset\",\n      description: \"All data has been cleared.\",\n    });\n  };\n\n  const cancelSession = () => {\n    // Stop any running timers\n    setIsCollecting(false);\n    setSessionStartTime(null);\n    if (timerRef.current) {\n      clearInterval(timerRef.current);\n    }\n    \n    // Clear all collected data\n    setCurrentTimer(0);\n    setFrequencyCount(0);\n    setDurationMinutes(0);\n    setDurationSeconds(0);\n    setPercentageTrials({ correct: 0, total: 0, noResponse: 0 });\n    setNotes(\"\");\n    setLevelOfSupport([]);\n    setSetting([]);\n    setCustomSetting(\"\");\n    setShowCustomSetting(false);\n    setCustomSupport(\"\");\n    setShowCustomSupport(false);\n    \n    toast({\n      title: \"Session Cancelled\",\n      description: \"Live collection session cancelled. All data has been discarded.\",\n      variant: \"destructive\",\n    });\n  };\n\n  const incrementFrequency = () => {\n    setFrequencyCount(prev => prev + 1);\n  };\n\n  const decrementFrequency = () => {\n    setFrequencyCount(prev => Math.max(0, prev - 1));\n  };\n\n  const addTrial = (trialType: 'correct' | 'incorrect' | 'noResponse') => {\n    setPercentageTrials(prev => ({\n      correct: prev.correct + (trialType === 'correct' ? 1 : 0),\n      total: prev.total + (trialType !== 'noResponse' ? 1 : 0), // No response doesn't count towards total\n      noResponse: prev.noResponse + (trialType === 'noResponse' ? 1 : 0)\n    }));\n  };\n\n  const removeTrial = () => {\n    setPercentageTrials(prev => {\n      if (prev.total === 0 && prev.noResponse === 0) return prev;\n      \n      // Remove the most recent trial (prioritize removing from total trials first, then no response)\n      if (prev.total > 0) {\n        return {\n          correct: Math.max(0, prev.correct - 1),\n          total: prev.total - 1,\n          noResponse: prev.noResponse\n        };\n      } else {\n        return {\n          correct: prev.correct,\n          total: prev.total,\n          noResponse: prev.noResponse - 1\n        };\n      }\n    });\n  };\n\n  const saveData = async () => {\n    try {\n      let progressValue: string;\n      let progressFormat: string;\n      let numerator: number | null = null;\n      let denominator: number | null = null;\n      let durationUnit: string = 'minutes';\n\n      switch (dataType) {\n        case 'frequency':\n          progressValue = frequencyCount.toString();\n          progressFormat = 'frequency';\n          break;\n        case 'duration':\n          const totalSeconds = (durationMinutes * 60) + durationSeconds;\n          progressValue = (totalSeconds / 60).toFixed(2); // Convert to minutes with decimals\n          progressFormat = 'duration';\n          durationUnit = 'minutes';\n          break;\n        case 'percentage':\n          if (percentageTrials.total === 0 && percentageTrials.noResponse === 0) {\n            toast({\n              title: \"Error\",\n              description: \"Please add at least one trial before saving.\",\n              variant: \"destructive\",\n            });\n            return;\n          }\n          // If there are only no response trials, record 0% with special handling\n          if (percentageTrials.total === 0 && percentageTrials.noResponse > 0) {\n            progressValue = \"0\";\n            progressFormat = 'percentage';\n            numerator = 0;\n            denominator = percentageTrials.noResponse; // Use no response count as denominator for context\n          } else {\n            const percentage = (percentageTrials.correct / percentageTrials.total) * 100;\n            progressValue = percentage.toFixed(2);\n            progressFormat = 'percentage';\n            numerator = percentageTrials.correct;\n            denominator = percentageTrials.total;\n          }\n          break;\n        default:\n          progressValue = '0';\n          progressFormat = 'percentage';\n      }\n\n      // Create date as YYYY-MM-DD string format for consistency\n      const now = new Date();\n      const today = now.getFullYear() + '-' + \n                   String(now.getMonth() + 1).padStart(2, '0') + '-' + \n                   String(now.getDate()).padStart(2, '0');\n      \n      const dataPoint = {\n        goalId,\n        objectiveId: objectiveId || null,\n        date: today,\n        progressFormat: progressFormat as \"percentage\" | \"fraction\" | \"frequency\" | \"duration\",\n        progressValue: parseFloat(progressValue),\n        numerator,\n        denominator,\n        durationUnit: durationUnit as \"seconds\" | \"minutes\",\n        levelOfSupport: levelOfSupport.concat(showCustomSupport && customSupport ? [customSupport.trim()] : []).filter(s => s.length <= 100),\n        setting: setting.concat(showCustomSetting && customSetting ? [customSetting.trim()] : []).filter(s => s.length <= 100),\n        anecdotalInfo: (notes || `Live collection session: ${formatTime(currentTimer)}${objectiveId ? ` - Objective ${objectiveId}` : ''}`).slice(0, 2000)\n      };\n\n      const validationResult = liveCollectionDataSchema.safeParse(dataPoint);\n      if (!validationResult.success) {\n        toast({\n          title: \"Validation Error\",\n          description: validationResult.error.errors[0]?.message || \"Invalid data format\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      await apiRequest('POST', `/api/goals/${goalId}/data-points`, validationResult.data);\n\n      toast({\n        title: \"Live Data Saved!\",\n        description: \"Your data has been saved successfully.\",\n      });\n\n      onDataCollected();\n      resetSession();\n    } catch (error) {\n      console.error('Error saving data:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to save data. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Session Timer - Only show for frequency goals */}\n      {dataType === 'frequency' && (\n        <Card className=\"border-2 border-blue-200 bg-blue-50\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"flex items-center text-blue-900\">\n              <Clock className=\"h-5 w-5 mr-2\" />\n              Live Collection Session - {selectedGoal?.title}\n              {objectiveId && (\n                <span className=\"ml-2 px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full\">\n                  Objective {objectiveId}\n                </span>\n              )}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"text-center\">\n                <div className=\"text-3xl font-bold text-blue-900 mb-1\">\n                  {formatTime(currentTimer)}\n                </div>\n                <div className=\"text-sm text-blue-700\">Session Duration</div>\n              </div>\n              <div className=\"flex space-x-2\">\n                {!isCollecting ? (\n                  <Button onClick={startSession} className=\"bg-green-600 hover:bg-green-700\">\n                    <Timer className=\"h-4 w-4 mr-2\" />\n                    Start Session\n                  </Button>\n                ) : (\n                  <Button onClick={stopSession} variant=\"destructive\">\n                    <Timer className=\"h-4 w-4 mr-2\" />\n                    Stop Session\n                  </Button>\n                )}\n                <Button onClick={resetSession} variant=\"outline\">\n                  <RotateCcw className=\"h-4 w-4 mr-2\" />\n                  Reset\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Goal Type Headers - Show for duration and percentage goals */}\n      {dataType === 'duration' && (\n        <Card className=\"border-2 border-green-200 bg-green-50\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"flex items-center text-green-900\">\n              <Timer className=\"h-5 w-5 mr-2\" />\n              Duration Collection - {selectedGoal?.title}\n              {objectiveId && (\n                <span className=\"ml-2 px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full\">\n                  Objective {objectiveId}\n                </span>\n              )}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-green-800\">Use the duration tracker below to record the time for this goal. Click \"Save Data Point\" when finished.</p>\n          </CardContent>\n        </Card>\n      )}\n      \n      {dataType === 'percentage' && (\n        <Card className=\"border-2 border-purple-200 bg-purple-50\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"flex items-center text-purple-900\">\n              <Target className=\"h-5 w-5 mr-2\" />\n              Percentage Collection - {selectedGoal?.title}\n              {objectiveId && (\n                <span className=\"ml-2 px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full\">\n                  Objective {objectiveId}\n                </span>\n              )}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-purple-800\">Use the trial counter below to track correct and incorrect attempts. Click \"Save Data Point\" when finished.</p>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Data Collection Tools */}\n      {dataType === 'frequency' && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Hash className=\"h-5 w-5 mr-2\" />\n              Frequency Counter\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-center mb-6\">\n              <div className=\"text-6xl font-bold text-blue-600 mb-2\">\n                {frequencyCount}\n              </div>\n              <div className=\"text-lg text-gray-600\">Occurrences</div>\n            </div>\n            {!isCollecting && (\n              <div className=\"text-center mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg\">\n                <p className=\"text-yellow-800 text-sm font-medium\">\n                  Click \"Start Session\" above to enable the frequency counter buttons\n                </p>\n              </div>\n            )}\n            <div className=\"flex justify-center space-x-4\">\n              <Button \n                size=\"lg\" \n                onClick={incrementFrequency}\n                className={`h-16 w-16 rounded-full text-2xl ${!isCollecting ? 'opacity-50 cursor-not-allowed' : ''}`}\n                disabled={!isCollecting}\n                title={!isCollecting ? \"Start session to enable\" : \"Add occurrence\"}\n              >\n                <Plus className=\"h-8 w-8\" />\n              </Button>\n              <Button \n                size=\"lg\" \n                variant=\"outline\" \n                onClick={decrementFrequency}\n                className={`h-16 w-16 rounded-full text-2xl ${!isCollecting || frequencyCount === 0 ? 'opacity-50 cursor-not-allowed' : ''}`}\n                disabled={!isCollecting || frequencyCount === 0}\n                title={!isCollecting ? \"Start session to enable\" : frequencyCount === 0 ? \"No occurrences to remove\" : \"Remove occurrence\"}\n              >\n                <Minus className=\"h-8 w-8\" />\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {dataType === 'duration' && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Timer className=\"h-5 w-5 mr-2\" />\n              Duration Tracker\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-center mb-6\">\n              <div className=\"text-6xl font-bold text-green-600 mb-2\">\n                {Math.floor((durationMinutes * 60 + durationSeconds) / 60)}:{((durationMinutes * 60 + durationSeconds) % 60).toString().padStart(2, '0')}\n              </div>\n              <div className=\"text-lg text-gray-600\">Duration Timer</div>\n            </div>\n            <div className=\"flex justify-center space-x-4\">\n              {!isCollecting ? (\n                <Button \n                  onClick={() => {\n                    setIsCollecting(true);\n                    setSessionStartTime(new Date());\n                    setDurationMinutes(0);\n                    setDurationSeconds(0);\n                    toast({\n                      title: \"Duration Timer Started\",\n                      description: \"Timing the duration for this goal.\",\n                    });\n                  }}\n                  className=\"bg-green-600 hover:bg-green-700 h-16 px-8\"\n                >\n                  <Timer className=\"h-5 w-5 mr-2\" />\n                  Start Timer\n                </Button>\n              ) : (\n                <Button \n                  onClick={() => {\n                    setIsCollecting(false);\n                    const totalSeconds = Math.floor((Date.now() - (sessionStartTime?.getTime() || 0)) / 1000);\n                    setDurationMinutes(Math.floor(totalSeconds / 60));\n                    setDurationSeconds(totalSeconds % 60);\n                    if (timerRef.current) {\n                      clearInterval(timerRef.current);\n                    }\n                    toast({\n                      title: \"Duration Timer Stopped\",\n                      description: `Recorded ${Math.floor(totalSeconds / 60)}m ${totalSeconds % 60}s`,\n                    });\n                  }}\n                  variant=\"destructive\" \n                  className=\"h-16 px-8\"\n                >\n                  <Timer className=\"h-5 w-5 mr-2\" />\n                  Stop Timer\n                </Button>\n              )}\n              <Button \n                onClick={() => {\n                  setIsCollecting(false);\n                  setSessionStartTime(null);\n                  setDurationMinutes(0);\n                  setDurationSeconds(0);\n                  setCurrentTimer(0);\n                  if (timerRef.current) {\n                    clearInterval(timerRef.current);\n                  }\n                  toast({\n                    title: \"Timer Reset\",\n                    description: \"Duration timer has been reset to 0:00\",\n                  });\n                }}\n                variant=\"outline\" \n                className=\"h-16 px-8\"\n              >\n                <RotateCcw className=\"h-5 w-5 mr-2\" />\n                Reset\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {dataType === 'percentage' && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Percent className=\"h-5 w-5 mr-2\" />\n              Trial Counter\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-center mb-6\">\n              <div className=\"text-4xl font-bold text-purple-600 mb-2\">\n                {percentageTrials.total > 0 ? \n                  Math.round((percentageTrials.correct / percentageTrials.total) * 100) : 0}%\n              </div>\n              <div className=\"text-lg text-gray-600\">\n                {percentageTrials.correct} / {percentageTrials.total} correct\n              </div>\n              {percentageTrials.noResponse > 0 && (\n                <div className=\"text-sm text-gray-500 mt-1\">\n                  {percentageTrials.noResponse} no response{percentageTrials.noResponse !== 1 ? 's' : ''}\n                </div>\n              )}\n            </div>\n            <div className=\"flex justify-center space-x-2 mb-4\">\n              <Button \n                size=\"lg\" \n                onClick={() => addTrial('correct')}\n                className=\"bg-green-600 hover:bg-green-700 h-16 px-6\"\n              >\n                âœ“ Correct\n              </Button>\n              <Button \n                size=\"lg\" \n                onClick={() => addTrial('incorrect')}\n                className=\"bg-red-600 hover:bg-red-700 h-16 px-6\"\n              >\n                âœ— Incorrect\n              </Button>\n              <Button \n                size=\"lg\" \n                onClick={() => addTrial('noResponse')}\n                className=\"bg-gray-500 hover:bg-gray-600 h-16 px-6\"\n              >\n                âˆ’ No Response\n              </Button>\n            </div>\n            <div className=\"text-center\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={removeTrial}\n                disabled={percentageTrials.total === 0 && percentageTrials.noResponse === 0}\n              >\n                Remove Last Trial\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Level of Support & Notes */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Session Details</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {/* Level of Support and Setting - Side by Side */}\n          <div className=\"flex flex-col lg:flex-row gap-6\">\n            {/* Level of Support */}\n            <div className=\"flex-1\">\n              <Label className=\"text-base font-medium text-gray-900 mb-4 block\">\n                Level of Support (Select all that apply)\n              </Label>\n              <div className=\"space-y-4\">\n                {[\n                  { id: \"independent\", label: \"Independent\" },\n                  { id: \"verbal\", label: \"Verbal\" },\n                  { id: \"visual\", label: \"Visual\" },\n                  { id: \"written\", label: \"Written\" },\n                  { id: \"model-of-task\", label: \"Model of Task\" },\n                  { id: \"self-correction\", label: \"Self-Correction\" },\n                  { id: \"gesture\", label: \"Gesture\" },\n                  { id: \"custom\", label: \"Custom\" },\n                ].map((option) => (\n                  <div key={option.id} className=\"flex items-center space-x-3\">\n                    <Checkbox\n                      id={option.id}\n                      checked={levelOfSupport.includes(option.id)}\n                      onCheckedChange={(checked) => {\n                        if (checked) {\n                          const newLevelOfSupport = [...levelOfSupport, option.id];\n                          setLevelOfSupport(newLevelOfSupport);\n                          if (option.id === \"custom\") {\n                            setShowCustomSupport(true);\n                          }\n                        } else {\n                          const newLevelOfSupport = levelOfSupport.filter((value) => value !== option.id);\n                          setLevelOfSupport(newLevelOfSupport);\n                          if (option.id === \"custom\") {\n                            setShowCustomSupport(false);\n                            setCustomSupport(\"\");\n                          }\n                        }\n                      }}\n                      className=\"h-5 w-5\"\n                    />\n                    <label \n                      htmlFor={option.id} \n                      className=\"text-base font-medium text-gray-900 cursor-pointer leading-none\"\n                    >\n                      {option.label}\n                    </label>\n                  </div>\n                ))}\n                \n                {/* Custom Support Input */}\n                {showCustomSupport && (\n                  <div className=\"ml-8 mt-3\">\n                    <Label className=\"text-sm font-medium text-gray-700\">\n                      Custom Level of Support\n                    </Label>\n                    <Input\n                      value={customSupport}\n                      onChange={(e) => setCustomSupport(e.target.value)}\n                      placeholder=\"Enter custom level of support...\"\n                      className=\"w-full mt-1\"\n                    />\n                  </div>\n                )}\n              </div>\n            </div>\n            \n            {/* Setting */}\n            <div className=\"flex-1\">\n              <Label className=\"text-base font-medium text-gray-900 mb-4 block\">\n                Setting (Select all that apply)\n              </Label>\n              <div className=\"space-y-4\">\n                {(() => {\n                  const settingOptions = [\n                    { id: \"general-education\", label: \"General Education\" },\n                    { id: \"special-education\", label: \"Special Education\" },\n                    { id: \"small-group\", label: \"Small Group\" },\n                    { id: \"whole-group\", label: \"Whole Group\" },\n                    { id: \"1:1\", label: \"1:1\" },\n                    { id: \"custom\", label: \"Custom\" },\n                  ];\n\n                  return settingOptions;\n                })().map((option) => (\n                  <div key={option.id} className=\"flex items-center space-x-3\">\n                    <Checkbox\n                      id={option.id}\n                      checked={setting.includes(option.id)}\n                      onCheckedChange={(checked) => {\n                        if (checked) {\n                          const newSetting = [...setting, option.id];\n                          setSetting(newSetting);\n                          if (option.id === \"custom\") {\n                            setShowCustomSetting(true);\n                          }\n                        } else {\n                          const newSetting = setting.filter((value) => value !== option.id);\n                          setSetting(newSetting);\n                          if (option.id === \"custom\") {\n                            setShowCustomSetting(false);\n                            setCustomSetting(\"\");\n                          }\n                        }\n                      }}\n                      className=\"h-5 w-5\"\n                    />\n                    <label \n                      htmlFor={option.id} \n                      className=\"text-base font-medium text-gray-900 cursor-pointer leading-none\"\n                    >\n                      {option.label}\n                    </label>\n                  </div>\n                ))}\n                \n                {/* Custom Setting Input */}\n                {showCustomSetting && (\n                  <div className=\"ml-8 mt-3\">\n                    <Label className=\"text-sm font-medium text-gray-700\">\n                      Custom Setting\n                    </Label>\n                    <Input\n                      value={customSetting}\n                      onChange={(e) => setCustomSetting(e.target.value)}\n                      placeholder=\"Enter custom setting...\"\n                      className=\"w-full mt-1\"\n                    />\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n          \n          <div>\n            <Label>Session Notes</Label>\n            <Textarea \n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              placeholder=\"Add notes about this observation session...\"\n              className=\"mt-1\"\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Save and Cancel Buttons */}\n      <div className=\"text-center space-y-4\">\n        <div className=\"flex justify-center space-x-4\">\n          <Button \n            size=\"lg\" \n            onClick={saveData}\n            disabled={(dataType === 'frequency' && isCollecting) || (dataType === 'frequency' && frequencyCount === 0) || (dataType === 'duration' && durationMinutes === 0 && durationSeconds === 0) || (dataType === 'percentage' && percentageTrials.total === 0 && percentageTrials.noResponse === 0)}\n            className=\"bg-blue-600 hover:bg-blue-700 px-8\"\n            data-testid=\"button-save-data\"\n          >\n            <Save className=\"h-5 w-5 mr-2\" />\n            Save Data Point\n          </Button>\n          <Button \n            size=\"lg\" \n            onClick={cancelSession}\n            variant=\"destructive\"\n            className=\"px-8\"\n            data-testid=\"button-cancel-collection\"\n          >\n            <X className=\"h-5 w-5 mr-2\" />\n            Cancel Collection\n          </Button>\n        </div>\n        {isCollecting && dataType === 'frequency' && (\n          <p className=\"text-sm text-gray-600\">\n            Stop the session to save your data\n          </p>\n        )}\n        {(dataType !== 'frequency' || !isCollecting) && (\n          <p className=\"text-sm text-gray-600\">\n            {dataType === 'frequency' && frequencyCount === 0 && \"Add at least one occurrence to save\"}\n            {dataType === 'duration' && durationMinutes === 0 && durationSeconds === 0 && \"Set duration time to save\"}\n            {dataType === 'percentage' && percentageTrials.total === 0 && percentageTrials.noResponse === 0 && \"Add at least one trial to save\"}\n            {dataType === 'frequency' && frequencyCount > 0 && \"Ready to save frequency data\"}\n            {dataType === 'duration' && (durationMinutes > 0 || durationSeconds > 0) && \"Ready to save duration data\"}\n            {dataType === 'percentage' && (percentageTrials.total > 0 || percentageTrials.noResponse > 0) && \"Ready to save percentage data\"}\n          </p>\n        )}\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":30260,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}","path":null,"size_bytes":115,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/mastery-alert-popup.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { \n  AlertDialog, \n  AlertDialogContent, \n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader, \n  AlertDialogTitle,\n  AlertDialogAction\n} from '@/components/ui/alert-dialog';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Trophy, Target, Calendar, CheckCircle } from 'lucide-react';\nimport { detectMastery, type MasteryAlert } from '@/lib/masteryDetection';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport moment from 'moment';\n\ninterface MasteryAlertPopupProps {\n  studentId: number;\n  studentName?: string;\n}\n\nexport default function MasteryAlertPopup({ studentId, studentName }: MasteryAlertPopupProps) {\n  const [showAlert, setShowAlert] = useState(false);\n  const [masteryAlerts, setMasteryAlerts] = useState<MasteryAlert[]>([]);\n  const [dismissedAlerts, setDismissedAlerts] = useState<string[]>([]);\n  const { toast } = useToast();\n\n  // Fetch goals, objectives, and data points\n  const { data: goals = [] } = useQuery<Goal[]>({\n    queryKey: [`/api/students/${studentId}/goals`],\n    enabled: !!studentId,\n  });\n\n  const { data: allDataPoints = [] } = useQuery<DataPoint[]>({\n    queryKey: [`/api/students/${studentId}/all-data-points`],\n    enabled: !!studentId,\n    refetchInterval: 5000, // Refresh every 5 seconds to catch new data\n  });\n\n  const { data: objectivesData = {}, refetch: refetchObjectives } = useQuery({\n    queryKey: [`/api/students/${studentId}/objectives`],\n    queryFn: async () => {\n      console.log('ðŸ”„ Fetching objectives for goals:', goals.map(g => g.id));\n      const objectivesByGoal: { [goalId: number]: any[] } = {};\n      \n      for (const goal of (goals as Goal[])) {\n        try {\n          // Force fresh fetch without cache\n          const response = await fetch(`/api/goals/${goal.id}/objectives`, {\n            headers: { 'Cache-Control': 'no-cache' }\n          });\n          const objectives = await response.json();\n          console.log(`ðŸ“‹ Fresh response for goal ${goal.id}:`, objectives);\n          objectivesByGoal[goal.id] = Array.isArray(objectives) ? objectives : [];\n        } catch (error) {\n          console.error(`Failed to fetch objectives for goal ${goal.id}:`, error);\n          objectivesByGoal[goal.id] = [];\n        }\n      }\n      \n      console.log('ðŸ“‹ Final objectives data:', objectivesByGoal);\n      return objectivesByGoal;\n    },\n    enabled: (goals as Goal[]).length > 0,\n    staleTime: 0,\n    gcTime: 0, // Don't cache\n  });\n\n  // Force refresh objectives when goals change\n  useEffect(() => {\n    if (goals.length > 0) {\n      refetchObjectives();\n    }\n  }, [goals.length, refetchObjectives]);\n\n  // Check for mastery when data changes\n  useEffect(() => {\n    if (!goals.length || !allDataPoints.length) return;\n\n    console.log('ðŸš¨ Mastery detection running for student:', studentId, 'with goals:', goals.length, 'dataPoints:', allDataPoints.length);\n    console.log('ðŸš¨ Objectives data:', objectivesData);\n\n    const alerts = detectMastery(goals, objectivesData, allDataPoints, studentId);\n    \n    // Filter out previously dismissed alerts for this session\n    const sessionKey = `masteryAlerts_dismissed_${studentId}`;\n    const sessionDismissed = JSON.parse(sessionStorage.getItem(sessionKey) || '[]');\n    \n    const newAlerts = alerts.filter(alert => \n      !sessionDismissed.includes(alert.id) && !dismissedAlerts.includes(alert.id)\n    );\n\n    if (newAlerts.length > 0) {\n      setMasteryAlerts(newAlerts);\n      setShowAlert(true);\n    }\n  }, [goals, allDataPoints, objectivesData, studentId, dismissedAlerts]);\n\n  const handleDismiss = async () => {\n    setShowAlert(false);\n    \n    // Mark these alerts as dismissed for this session\n    const sessionKey = `masteryAlerts_dismissed_${studentId}`;\n    const currentDismissed = JSON.parse(sessionStorage.getItem(sessionKey) || '[]');\n    const newDismissed = [...currentDismissed, ...masteryAlerts.map(a => a.id)];\n    sessionStorage.setItem(sessionKey, JSON.stringify(newDismissed));\n    \n    // Store items needing review\n    const reviewKey = `masteryAlerts_needsReview_${studentId}`;\n    const currentNeedsReview = JSON.parse(localStorage.getItem(reviewKey) || '[]');\n    const itemsToReview = masteryAlerts.map(alert => ({\n      id: alert.id,\n      type: alert.type,\n      itemId: alert.itemId,\n      title: alert.title,\n      targetCriteria: alert.targetCriteria,\n      masteryDate: alert.masteryDate\n    }));\n    localStorage.setItem(reviewKey, JSON.stringify([...currentNeedsReview, ...itemsToReview]));\n    \n    setDismissedAlerts(prev => [...prev, ...masteryAlerts.map(a => a.id)]);\n  };\n\n  const handleMarkAsMastered = async (alert: MasteryAlert) => {\n    try {\n      const endpoint = alert.type === 'goal' \n        ? `/api/goals/${alert.itemId}` \n        : `/api/objectives/${alert.itemId}`;\n      \n      await apiRequest('PATCH', endpoint, { status: 'mastered' });\n      \n      toast({\n        title: \"Marked as Mastered\",\n        description: `${alert.type === 'goal' ? 'Goal' : 'Objective'} has been marked as mastered.`,\n      });\n      \n      // Remove this alert from the list\n      setMasteryAlerts(prev => prev.filter(a => a.id !== alert.id));\n      \n      // Force refresh of relevant data to update UI\n      const { queryClient } = await import('@/lib/queryClient');\n      queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/goals`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/objectives`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/all-data-points`] });\n      \n      if (alert.type === 'goal') {\n        queryClient.invalidateQueries({ queryKey: [`/api/goals/${alert.itemId}`] });\n        queryClient.invalidateQueries({ queryKey: [`/api/goals/${alert.itemId}/objectives`] });\n      } else {\n        queryClient.invalidateQueries({ queryKey: [`/api/objectives/${alert.itemId}`] });\n        queryClient.invalidateQueries({ queryKey: [`/api/objectives/${alert.itemId}/progress`] });\n      }\n      \n      // If no more alerts, close the dialog\n      if (masteryAlerts.length === 1) {\n        setShowAlert(false);\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update status. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getAlertIcon = (type: string) => {\n    return type === 'goal' ? (\n      <Target className=\"h-5 w-5 text-blue-600\" />\n    ) : (\n      <CheckCircle className=\"h-5 w-5 text-green-600\" />\n    );\n  };\n\n  const getAlertColor = (type: string) => {\n    return type === 'goal' \n      ? 'bg-blue-50 border-blue-200 text-blue-800'\n      : 'bg-green-50 border-green-200 text-green-800';\n  };\n\n  if (masteryAlerts.length === 0) return null;\n\n  return (\n    <AlertDialog open={showAlert} onOpenChange={setShowAlert}>\n      <AlertDialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n        <AlertDialogHeader>\n          <AlertDialogTitle className=\"flex items-center gap-2\">\n            <Trophy className=\"h-6 w-6 text-yellow-500\" />\n            Mastery Achieved! ðŸŽ‰\n          </AlertDialogTitle>\n          <AlertDialogDescription>\n            {studentName && `${studentName} has`} achieved mastery on {masteryAlerts.length} item{masteryAlerts.length !== 1 ? 's' : ''}:\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n\n        <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n          {masteryAlerts.map((alert) => (\n            <Card key={alert.id} className={`border-2 ${getAlertColor(alert.type)}`}>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div className=\"flex items-start gap-3 flex-1\">\n                    {getAlertIcon(alert.type)}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <h4 className=\"font-semibold text-gray-900 truncate\">\n                          {alert.title}\n                        </h4>\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {alert.type === 'goal' ? 'Goal' : 'Objective'}\n                        </Badge>\n                      </div>\n                      \n                      <p className=\"text-sm text-gray-700 mb-2\">\n                        {alert.description}\n                      </p>\n                      \n                      <div className=\"space-y-1 text-xs text-gray-600\">\n                        <div className=\"flex items-center gap-1\">\n                          <Target className=\"h-3 w-3\" />\n                          <span>Target: {alert.targetCriteria}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"h-3 w-3\" />\n                          <span>Achieved: {moment(alert.masteryDate).format('MMM D, YYYY')}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <CheckCircle className=\"h-3 w-3\" />\n                          <span>Based on {alert.dataPointsUsed.length} data points</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <Button\n                    size=\"sm\"\n                    onClick={() => handleMarkAsMastered(alert)}\n                    className=\"bg-green-600 hover:bg-green-700 text-white\"\n                  >\n                    Mark as Mastered\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        <AlertDialogFooter>\n          <AlertDialogAction onClick={handleDismiss}>\n            I'll Review Later\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}","path":null,"size_bytes":10185,"size_tokens":null},"client/src/components/objectives-list.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Plus, Edit2, Trash2, Calendar, Bell, CheckCircle, TrendingUp, TrendingDown, Minus } from \"lucide-react\";\nimport { Objective } from \"@shared/schema\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { format } from \"date-fns\";\nimport { useMasteryReview } from \"@/hooks/use-mastery-review\";\n\n// Interface for objective progress data\ninterface ObjectiveProgress {\n  objective: Objective;\n  dataPoints: any[];\n  currentProgress: number;\n  averageScore: number;\n  trend: number;\n  lastScore: number;\n  dataPointsCount: number;\n}\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nconst objectiveSchema = z.object({\n  description: z.string().min(1, \"Objective description is required\"),\n  targetCriteria: z.string().optional(),\n  targetDate: z.string().optional().transform((val) => val || undefined),\n  status: z.enum([\"active\", \"mastered\"]).default(\"active\"),\n});\n\ntype ObjectiveFormData = z.infer<typeof objectiveSchema>;\n\ninterface ObjectivesListProps {\n  goalId: number;\n  studentId: number;\n}\n\nexport default function ObjectivesList({ goalId, studentId }: ObjectivesListProps) {\n  const { toast } = useToast();\n  const { needsReview, markAsReviewed } = useMasteryReview(studentId);\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\n  const [editingObjective, setEditingObjective] = useState<Objective | null>(null);\n  const [deletingObjectiveId, setDeletingObjectiveId] = useState<number | null>(null);\n\n\n  const form = useForm<ObjectiveFormData>({\n    resolver: zodResolver(objectiveSchema),\n    defaultValues: {\n      description: \"\",\n      targetCriteria: \"\",\n      targetDate: \"\",\n      status: \"active\",\n    },\n  });\n\n  // Query to fetch objectives\n  const { data: objectivesData, isLoading, error } = useQuery<Objective[]>({\n    queryKey: [`/api/goals/${goalId}/objectives`],\n    // Use the default query function which properly handles JSON parsing\n  });\n\n  // Ensure objectives is always an array\n  const objectives = Array.isArray(objectivesData) ? objectivesData : [];\n  \n  // Create a single query to fetch all objective progress data\n  const { data: allObjectiveProgress, isLoading: isLoadingAllProgress } = useQuery<Record<number, ObjectiveProgress>>({\n    queryKey: [`/api/goals/${goalId}/objectives-progress`],\n    queryFn: async () => {\n      if (objectives.length === 0) return {};\n      \n      const progressPromises = objectives.map(async (objective: Objective) => {\n        try {\n          const response = await fetch(`/api/objectives/${objective.id}/progress`);\n          if (!response.ok) throw new Error('Failed to fetch progress');\n          const progressData = await response.json();\n          return [objective.id, progressData];\n        } catch (error) {\n          console.error(`Error fetching progress for objective ${objective.id}:`, error);\n          return [objective.id, null];\n        }\n      });\n      \n      const results = await Promise.all(progressPromises);\n      return Object.fromEntries(results);\n    },\n    enabled: objectives.length > 0,\n  });\n  \n\n\n  // Mutation to create objective\n  const createObjectiveMutation = useMutation({\n    mutationFn: (data: ObjectiveFormData) =>\n      apiRequest('POST', `/api/goals/${goalId}/objectives`, data),\n    onSuccess: () => {\n      console.log('Objective created successfully, invalidating queries...');\n      // Clear all cached data and force fresh fetch\n      queryClient.clear();\n      toast({\n        title: \"Success\",\n        description: \"Objective added successfully!\",\n      });\n      form.reset();\n      setIsAddModalOpen(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to add objective. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mutation to update objective\n  const updateObjectiveMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: ObjectiveFormData }) =>\n      apiRequest('PUT', `/api/objectives/${id}`, data),\n    onSuccess: () => {\n      // Clear all cached data to force fresh fetch\n      queryClient.clear();\n      toast({\n        title: \"Success\",\n        description: \"Objective updated successfully!\",\n      });\n      form.reset();\n      setEditingObjective(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update objective. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mutation to delete objective\n  const deleteObjectiveMutation = useMutation({\n    mutationFn: (id: number) => apiRequest('DELETE', `/api/objectives/${id}`),\n    onSuccess: () => {\n      // Clear all cached data to force fresh fetch\n      queryClient.clear();\n      toast({\n        title: \"Success\",\n        description: \"Objective deleted successfully!\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete objective. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ObjectiveFormData) => {\n    if (editingObjective) {\n      updateObjectiveMutation.mutate({ id: editingObjective.id, data });\n    } else {\n      createObjectiveMutation.mutate(data);\n    }\n  };\n\n  const handleEdit = (objective: Objective) => {\n    setEditingObjective(objective);\n    form.reset({\n      description: objective.description,\n      targetCriteria: objective.targetCriteria || \"\",\n      targetDate: objective.targetDate ? new Date(objective.targetDate).toISOString().split('T')[0] : \"\",\n      status: objective.status as \"active\" | \"mastered\",\n    });\n    setIsAddModalOpen(true);\n  };\n\n  const handleAdd = () => {\n    setEditingObjective(null);\n    form.reset();\n    setIsAddModalOpen(true);\n  };\n\n  const handleClose = () => {\n    setIsAddModalOpen(false);\n    setEditingObjective(null);\n    form.reset();\n  };\n\n\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Objectives</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"animate-pulse space-y-3\">\n            <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n            <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between\">\n            Objectives ({objectives.length})\n            <Button\n              onClick={handleAdd}\n              size=\"sm\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Objective\n            </Button>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {objectives.length === 0 ? (\n            <p className=\"text-sm text-gray-500 text-center py-4\">\n              No objectives have been added for this goal yet.\n            </p>\n          ) : (\n            <div className=\"space-y-3\">\n              {objectives.map((objective: Objective) => {\n                const progressData = allObjectiveProgress?.[objective.id];\n                const isLoadingProgress = isLoadingAllProgress;\n                \n                const formatTrend = (trend: number) => {\n                  if (trend > 0) return `+${trend.toFixed(1)}%`;\n                  if (trend < 0) return `${trend.toFixed(1)}%`;\n                  return '0%';\n                };\n\n                return (\n                  <div\n                    key={objective.id}\n                    className=\"p-4 border rounded-lg space-y-3\"\n                  >\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm text-gray-900 font-medium\">\n                          {objective.description}\n                        </p>\n                        {objective.targetCriteria && (\n                          <p className=\"text-sm text-blue-600 mt-1\">\n                            <strong>Target:</strong> {objective.targetCriteria}\n                          </p>\n                        )}\n                        {objective.targetDate && (\n                          <p className=\"text-sm text-purple-600 mt-1\">\n                            <strong>Target Date:</strong> {new Date(objective.targetDate).toLocaleDateString()}\n                          </p>\n                        )}\n                        <div className=\"flex items-center gap-2 mt-2\">\n                          <span\n                            className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                              objective.status === \"active\"\n                                ? \"bg-green-100 text-green-800\"\n                                : objective.status === \"mastered\"\n                                ? \"bg-red-100 text-red-800\"\n                                : \"bg-gray-100 text-gray-800\"\n                            }`}\n                          >\n                            {objective.status.charAt(0).toUpperCase() + objective.status.slice(1)}\n                          </span>\n                          {needsReview(objective.id, 'objective') && (\n                            <span \n                              className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 cursor-pointer hover:bg-orange-200\"\n                              onClick={() => markAsReviewed(objective.id, 'objective')}\n                            >\n                              <Bell className=\"h-3 w-3 mr-1\" />\n                              Review Mastery\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2 ml-4\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleEdit(objective)}\n                        >\n                          <Edit2 className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => setDeletingObjectiveId(objective.id)}\n                          className=\"text-red-600 hover:bg-red-50\"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n\n                    {/* Objective Progress Bar */}\n                    {isLoadingProgress ? (\n                      <div className=\"animate-pulse\">\n                        <div className=\"flex justify-between items-center mb-2\">\n                          <div className=\"h-3 bg-gray-200 rounded w-24\"></div>\n                          <div className=\"h-3 bg-gray-200 rounded w-12\"></div>\n                        </div>\n                        <div className=\"h-2 bg-gray-200 rounded\"></div>\n                      </div>\n                    ) : progressData ? (\n                      <>\n                        <div className=\"mb-3\">\n                          <div className=\"flex justify-between items-center mb-2\">\n                            <span className=\"text-xs font-medium text-gray-600\">Current Progress</span>\n                            <span className=\"text-xs font-semibold text-gray-800\">{progressData.currentProgress?.toFixed(0) || 0}%</span>\n                          </div>\n                          <Progress \n                            value={Math.min(Math.max(progressData.currentProgress || 0, 0), 100)} \n                            className=\"h-2 bg-gray-200\"\n                          />\n                        </div>\n\n                        {/* Objective Statistics - Only show for percentage goals with data */}\n                        {progressData.dataPointsCount > 0 && (\n                          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                            <div className=\"text-center p-2 bg-gray-50 rounded-lg\">\n                              <p className=\"text-lg font-bold text-gray-900\">{progressData.dataPointsCount}</p>\n                              <p className=\"text-xs text-gray-600\">Data Points</p>\n                            </div>\n                            <div className=\"text-center p-2 bg-gray-50 rounded-lg\">\n                              <p className=\"text-lg font-bold text-gray-900\">{progressData.averageScore?.toFixed(0) || 0}%</p>\n                              <p className=\"text-xs text-gray-600\">Average Score</p>\n                            </div>\n                            <div className=\"text-center p-2 bg-gray-50 rounded-lg\">\n                              <p className={`text-lg font-bold ${progressData.trend > 0 ? 'text-green-600' : progressData.trend < 0 ? 'text-red-600' : 'text-gray-900'}`}>\n                                {formatTrend(progressData.trend || 0)}\n                              </p>\n                              <p className=\"text-xs text-gray-600\">Trend</p>\n                            </div>\n                            <div className=\"text-center p-2 bg-gray-50 rounded-lg\">\n                              <p className=\"text-lg font-bold text-gray-900\">{progressData.lastScore?.toFixed(0) || 0}%</p>\n                              <p className=\"text-xs text-gray-600\">Last Score</p>\n                            </div>\n                          </div>\n                        )}\n                      </>\n                    ) : (\n                      <div className=\"mb-3\">\n                        <div className=\"flex justify-between items-center mb-2\">\n                          <span className=\"text-xs font-medium text-gray-600\">Current Progress</span>\n                          <span className=\"text-xs font-semibold text-gray-800\">0%</span>\n                        </div>\n                        <Progress \n                          value={0} \n                          className=\"h-2 bg-gray-200\"\n                        />\n                        <p className=\"text-xs text-gray-500 mt-1\">No data points yet</p>\n                      </div>\n                    )}\n\n                    {/* Last Updated Info */}\n                    <div className=\"pt-3 border-t border-gray-100\">\n                      <div className=\"text-xs text-gray-600 flex items-center justify-center\">\n                        <Calendar className=\"h-3 w-3 mr-1\" />\n                        Last updated: {format(new Date(objective.updatedAt || objective.createdAt), \"MMM d\")}\n                      </div>\n                    </div>\n\n                  </div>\n                );\n              })}\n            </div>\n          )}\n          \n\n        </CardContent>\n      </Card>\n\n      {/* Add/Edit Modal */}\n      <Dialog open={isAddModalOpen} onOpenChange={handleClose}>\n        <DialogContent className=\"sm:max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingObjective ? \"Edit Objective\" : \"Add New Objective\"}\n            </DialogTitle>\n          </DialogHeader>\n          \n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Objective Description</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        rows={3}\n                        placeholder=\"e.g., Student will answer who/what questions about familiar stories with 80% accuracy\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"targetCriteria\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Target Criteria (Optional)</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"e.g., 80% accuracy over 4 trials\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"targetDate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Target Date (Optional)</FormLabel>\n                    <FormControl>\n                      <Input \n                        type=\"date\" \n                        {...field} \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex justify-end space-x-3 pt-4\">\n                <Button \n                  type=\"button\" \n                  variant=\"outline\"\n                  onClick={handleClose}\n                  disabled={createObjectiveMutation.isPending || updateObjectiveMutation.isPending}\n                >\n                  Cancel\n                </Button>\n                <Button \n                  type=\"submit\" \n                  disabled={createObjectiveMutation.isPending || updateObjectiveMutation.isPending}\n                >\n                  {(createObjectiveMutation.isPending || updateObjectiveMutation.isPending) && (\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                  )}\n                  {editingObjective ? \"Update Objective\" : \"Add Objective\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Objective Confirmation Dialog */}\n      <AlertDialog open={!!deletingObjectiveId} onOpenChange={() => setDeletingObjectiveId(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Objective</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this objective? This action cannot be undone and will permanently remove the objective and any associated data.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => {\n                if (deletingObjectiveId) {\n                  deleteObjectiveMutation.mutate(deletingObjectiveId);\n                  setDeletingObjectiveId(null);\n                }\n              }}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Delete Objective\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}","path":null,"size_bytes":19974,"size_tokens":null},"client/src/pages/admin.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Database, Users, Target, BarChart3, Trash2, Eye, RefreshCw, CheckCircle2, AlertTriangle, Search } from \"lucide-react\";\nimport AdminVerification from \"@/components/admin-verification\";\n\ninterface AdminStats {\n  totalUsers: number;\n  totalStudents: number;\n  totalGoals: number;\n  totalDataPoints: number;\n  recentActivity: Array<{\n    id: number;\n    type: string;\n    description: string;\n    timestamp: string;\n  }>;\n}\n\nexport default function AdminPage() {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [credentials, setCredentials] = useState({ username: \"\", password: \"\" });\n  const [verificationModal, setVerificationModal] = useState<{\n    type: \"user\" | \"student\" | \"goal\" | \"sample\";\n    data: any;\n    isOpen: boolean;\n  }>({ type: \"user\", data: null, isOpen: false });\n  const { toast } = useToast();\n\n  // Check if already authenticated\n  useEffect(() => {\n    const isAdminAuth = localStorage.getItem(\"admin_authenticated\") === \"true\";\n    setIsAuthenticated(isAdminAuth);\n  }, []);\n\n  const loginMutation = useMutation({\n    mutationFn: async (creds: { username: string; password: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/admin-login\", creds);\n      return await response.json();\n    },\n    onSuccess: (data) => {\n      if (data.success) {\n        localStorage.setItem(\"admin_authenticated\", \"true\");\n        setIsAuthenticated(true);\n        toast({\n          title: \"Success\",\n          description: \"Admin login successful\",\n        });\n      }\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Invalid admin credentials\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const { data: stats, refetch: refetchStats } = useQuery({\n    queryKey: [\"/api/admin/stats\"],\n    enabled: isAuthenticated,\n  });\n\n  const { data: users } = useQuery({\n    queryKey: [\"/api/admin/users\"],\n    enabled: isAuthenticated,\n  });\n\n  const { data: students } = useQuery({\n    queryKey: [\"/api/admin/students\"],\n    enabled: isAuthenticated,\n  });\n\n  // Verification query functions\n  const verifyUser = async (userId: string) => {\n    try {\n      const response = await apiRequest(\"GET\", `/api/admin/verify/user/${userId}`);\n      const result = await response.json();\n\n      setVerificationModal({ type: \"user\", data: result, isOpen: true });\n    } catch (error) {\n      console.error(\"Error verifying user:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to verify user data\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const verifyStudent = async (studentId: number) => {\n    try {\n      const response = await apiRequest(\"GET\", `/api/admin/verify/student/${studentId}`);\n      const result = await response.json();\n      setVerificationModal({ type: \"student\", data: result, isOpen: true });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to verify student data\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const verifyGoal = async (goalId: number) => {\n    try {\n      const response = await apiRequest(\"GET\", `/api/admin/verify/goal/${goalId}`);\n      const result = await response.json();\n      setVerificationModal({ type: \"goal\", data: result, isOpen: true });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to verify goal data\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getSampleData = async (userId: string) => {\n    try {\n      const response = await apiRequest(\"GET\", `/api/admin/sample-data/${userId}`);\n      const result = await response.json();\n      setVerificationModal({ type: \"sample\", data: result, isOpen: true });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to fetch sample data\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const { data: goals } = useQuery({\n    queryKey: [\"/api/admin/goals\"],\n    enabled: isAuthenticated,\n  });\n\n  const { data: schema } = useQuery({\n    queryKey: [\"/api/admin/schema\"],\n    enabled: isAuthenticated,\n  });\n\n  const [selectedTable, setSelectedTable] = useState<string | null>(null);\n  const { data: tableData } = useQuery({\n    queryKey: [`/api/admin/table/${selectedTable}`],\n    enabled: isAuthenticated && !!selectedTable,\n  });\n\n  const deleteUserMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      await apiRequest(\"DELETE\", `/api/admin/users/${userId}`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"User deleted successfully\",\n      });\n      refetchStats();\n    },\n  });\n\n  const handleLogin = (e: React.FormEvent) => {\n    e.preventDefault();\n    loginMutation.mutate(credentials);\n  };\n\n  const handleLogout = () => {\n    localStorage.removeItem(\"admin_authenticated\");\n    setIsAuthenticated(false);\n    setCredentials({ username: \"\", password: \"\" });\n  };\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-surface flex items-center justify-center\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center text-center\">\n              <Database className=\"h-6 w-6 mr-2\" />\n              Database Administrator Login\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleLogin} className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"username\">Username</Label>\n                <Input\n                  id=\"username\"\n                  type=\"text\"\n                  value={credentials.username}\n                  onChange={(e) => setCredentials({ ...credentials, username: e.target.value })}\n                  required\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"password\">Password</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  value={credentials.password}\n                  onChange={(e) => setCredentials({ ...credentials, password: e.target.value })}\n                  required\n                />\n              </div>\n              <Button type=\"submit\" className=\"w-full\" disabled={loginMutation.isPending}>\n                {loginMutation.isPending ? \"Logging in...\" : \"Login\"}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-surface\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b border-gray-200\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            <div className=\"flex items-center\">\n              <Database className=\"h-8 w-8 text-primary mr-3\" />\n              <h1 className=\"text-xl font-bold text-gray-900\">Database Administrator</h1>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"text-sm text-gray-600\">Admin: sandralindsey</div>\n              <Button \n                variant=\"ghost\"\n                onClick={handleLogout}\n                className=\"text-gray-400 hover:text-gray-600\"\n              >\n                Sign Out\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"mb-8\">\n          <h2 className=\"text-3xl font-bold text-gray-900\">System Overview</h2>\n          <p className=\"text-gray-600 mt-1\">Manage users, data, and system statistics</p>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"p-3 bg-blue-100 rounded-lg\">\n                  <Users className=\"h-6 w-6 text-primary\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-gray-600 text-sm\">Total Users</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats?.totalUsers || 0}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"p-3 bg-green-100 rounded-lg\">\n                  <Users className=\"h-6 w-6 text-secondary\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-gray-600 text-sm\">Total Students</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats?.totalStudents || 0}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"p-3 bg-purple-100 rounded-lg\">\n                  <Target className=\"h-6 w-6 text-accent\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-gray-600 text-sm\">Total Goals</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats?.totalGoals || 0}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"p-3 bg-yellow-100 rounded-lg\">\n                  <BarChart3 className=\"h-6 w-6 text-yellow-600\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-gray-600 text-sm\">Data Points</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats?.totalDataPoints || 0}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Management Tabs */}\n        <Tabs defaultValue=\"verification\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-5\">\n            <TabsTrigger value=\"verification\">Data Verification</TabsTrigger>\n            <TabsTrigger value=\"database\">Database Tables</TabsTrigger>\n            <TabsTrigger value=\"users\">Users Management</TabsTrigger>\n            <TabsTrigger value=\"students\">Students Data</TabsTrigger>\n            <TabsTrigger value=\"goals\">Goals & Progress</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"verification\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <CheckCircle2 className=\"h-5 w-5\" />\n                  Data Verification & Integrity Checking\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <AdminVerification\n                  onVerifyUser={verifyUser}\n                  onVerifyStudent={verifyStudent}\n                  onVerifyGoal={verifyGoal}\n                  onSampleData={getSampleData}\n                />\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"database\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              {/* Database Tables List */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Database Tables</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    {schema && Object.keys(schema).map((tableName) => (\n                      <Button\n                        key={tableName}\n                        variant={selectedTable === tableName ? \"default\" : \"outline\"}\n                        className=\"w-full justify-start\"\n                        onClick={() => setSelectedTable(tableName)}\n                      >\n                        <Database className=\"h-4 w-4 mr-2\" />\n                        {schema[tableName].tableName}\n                      </Button>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Table Details */}\n              {selectedTable && schema && (\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center justify-between\">\n                      Table: {schema[selectedTable].tableName}\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        onClick={() => window.location.href = '/'}\n                      >\n                        â† Back to Main\n                      </Button>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-4\">\n                      <div>\n                        <h4 className=\"font-semibold mb-2\">Fields:</h4>\n                        <Table>\n                          <TableHeader>\n                            <TableRow>\n                              <TableHead>Field Name</TableHead>\n                              <TableHead>Type</TableHead>\n                              <TableHead>Attributes</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                            {schema[selectedTable].fields.map((field: any) => (\n                              <TableRow key={field.name}>\n                                <TableCell className=\"font-mono\">{field.name}</TableCell>\n                                <TableCell>{field.type}</TableCell>\n                                <TableCell>\n                                  <div className=\"flex gap-1\">\n                                    {field.isPrimary && (\n                                      <span className=\"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded\">\n                                        PRIMARY\n                                      </span>\n                                    )}\n                                    {field.isForeign && (\n                                      <span className=\"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded\">\n                                        FOREIGN\n                                      </span>\n                                    )}\n                                    {field.isUnique && (\n                                      <span className=\"px-2 py-1 bg-green-100 text-green-800 text-xs rounded\">\n                                        UNIQUE\n                                      </span>\n                                    )}\n                                  </div>\n                                  {field.references && (\n                                    <div className=\"text-xs text-gray-500 mt-1\">\n                                      â†’ {field.references}\n                                    </div>\n                                  )}\n                                </TableCell>\n                              </TableRow>\n                            ))}\n                          </TableBody>\n                        </Table>\n                      </div>\n\n                      <div>\n                        <h4 className=\"font-semibold mb-2\">Table Data ({tableData?.length || 0} records):</h4>\n                        {tableData && tableData.length > 0 ? (\n                          <div className=\"border rounded-md overflow-x-auto\">\n                            <Table>\n                              <TableHeader>\n                                <TableRow>\n                                  {Object.keys(tableData[0]).map((key) => (\n                                    <TableHead key={key} className=\"whitespace-nowrap\">{key}</TableHead>\n                                  ))}\n                                </TableRow>\n                              </TableHeader>\n                              <TableBody>\n                                {tableData.map((row: any, index: number) => (\n                                  <TableRow key={index}>\n                                    {Object.values(row).map((value: any, colIndex: number) => (\n                                      <TableCell key={colIndex} className=\"max-w-xs truncate\">\n                                        {value === null ? (\n                                          <span className=\"text-gray-400 italic\">null</span>\n                                        ) : typeof value === 'object' ? (\n                                          <span className=\"text-blue-600 font-mono text-xs\">\n                                            {JSON.stringify(value)}\n                                          </span>\n                                        ) : typeof value === 'boolean' ? (\n                                          <span className={`px-2 py-1 rounded text-xs ${value ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>\n                                            {value.toString()}\n                                          </span>\n                                        ) : (\n                                          <span className=\"font-mono text-sm\">\n                                            {String(value)}\n                                          </span>\n                                        )}\n                                      </TableCell>\n                                    ))}\n                                  </TableRow>\n                                ))}\n                              </TableBody>\n                            </Table>\n                          </div>\n                        ) : tableData && tableData.length === 0 ? (\n                          <div className=\"text-center py-8 text-gray-500\">\n                            <Database className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                            <p>No data found in this table</p>\n                          </div>\n                        ) : (\n                          <div className=\"text-center py-8 text-gray-500\">\n                            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n                            <p>Loading table data...</p>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"users\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center justify-between\">\n                  User Management\n                  <Button onClick={() => refetchStats()} size=\"sm\" variant=\"outline\">\n                    <RefreshCw className=\"h-4 w-4 mr-2\" />\n                    Refresh\n                  </Button>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>User ID</TableHead>\n                      <TableHead>Email</TableHead>\n                      <TableHead>Name</TableHead>\n                      <TableHead>Created</TableHead>\n                      <TableHead>Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {users?.map((user: any) => (\n                      <TableRow key={user.id}>\n                        <TableCell className=\"font-mono text-sm\">{user.id}</TableCell>\n                        <TableCell>{user.email || \"No email\"}</TableCell>\n                        <TableCell>{`${user.firstName || \"\"} ${user.lastName || \"\"}`.trim() || \"No name\"}</TableCell>\n                        <TableCell>{new Date(user.createdAt).toLocaleDateString()}</TableCell>\n                        <TableCell>\n                          <div className=\"flex space-x-2\">\n                            <Button size=\"sm\" variant=\"outline\">\n                              <Eye className=\"h-4 w-4\" />\n                            </Button>\n                            <Button \n                              size=\"sm\" \n                              variant=\"destructive\"\n                              onClick={() => deleteUserMutation.mutate(user.id)}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"students\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Students Database</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Student ID</TableHead>\n                      <TableHead>Name</TableHead>\n                      <TableHead>Grade</TableHead>\n                      <TableHead>Teacher</TableHead>\n                      <TableHead>Goals</TableHead>\n                      <TableHead>Data Points</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {students?.map((student: any) => (\n                      <TableRow key={student.id}>\n                        <TableCell>{student.id}</TableCell>\n                        <TableCell>{student.name}</TableCell>\n                        <TableCell>{student.grade || \"Not specified\"}</TableCell>\n                        <TableCell>{student.teacherEmail || \"Unknown\"}</TableCell>\n                        <TableCell>{student.totalGoals || 0}</TableCell>\n                        <TableCell>{student.totalDataPoints || 0}</TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"goals\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Goals and Progress Data</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Goal ID</TableHead>\n                      <TableHead>Title</TableHead>\n                      <TableHead>Student</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>Progress</TableHead>\n                      <TableHead>Data Points</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {goals?.map((goal: any) => (\n                      <TableRow key={goal.id}>\n                        <TableCell>{goal.id}</TableCell>\n                        <TableCell>{goal.title}</TableCell>\n                        <TableCell>{goal.studentName}</TableCell>\n                        <TableCell>\n                          <span className={`px-2 py-1 rounded-full text-xs ${\n                            goal.status === 'active' ? 'bg-green-100 text-green-800' :\n                            goal.status === 'mastered' ? 'bg-blue-100 text-blue-800' :\n                            'bg-gray-100 text-gray-800'\n                          }`}>\n                            {goal.status}\n                          </span>\n                        </TableCell>\n                        <TableCell>{goal.currentProgress?.toFixed(1)}%</TableCell>\n                        <TableCell>{goal.dataPointsCount || 0}</TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n\n        {/* Verification Results Modals */}\n        <Dialog open={verificationModal.isOpen} onOpenChange={(open) => setVerificationModal(prev => ({ ...prev, isOpen: open }))}>\n          <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {verificationModal.type === \"user\" && \"User Data Verification\"}\n                {verificationModal.type === \"student\" && \"Student Data Verification\"} \n                {verificationModal.type === \"goal\" && \"Goal Data Verification\"}\n                {verificationModal.type === \"sample\" && \"Sample Data Review\"}\n              </DialogTitle>\n            </DialogHeader>\n\n            {verificationModal.type === \"user\" && verificationModal.data && (\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">User Information</h4>\n                    <p className=\"text-sm\">User ID: {verificationModal.data.userId}</p>\n                    <p className=\"text-sm\">Status: {verificationModal.data.userExists ? \"âœ… Active\" : \"âŒ Not Found\"}</p>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">Data Counts</h4>\n                    <p className=\"text-sm\">Students: {verificationModal.data.studentCount}</p>\n                    <p className=\"text-sm\">Goals: {verificationModal.data.goalCount}</p>\n                    <p className=\"text-sm\">Data Points: {verificationModal.data.dataPointCount}</p>\n                  </div>\n                </div>\n\n                {verificationModal.data.dataIntegrity && (\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">Data Integrity Check</h4>\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <Badge variant={verificationModal.data.dataIntegrity.orphanedGoals === 0 ? \"default\" : \"destructive\"}>\n                        Orphaned Goals: {verificationModal.data.dataIntegrity.orphanedGoals}\n                      </Badge>\n                      <Badge variant={verificationModal.data.dataIntegrity.orphanedDataPoints === 0 ? \"default\" : \"destructive\"}>\n                        Orphaned Data Points: {verificationModal.data.dataIntegrity.orphanedDataPoints}\n                      </Badge>\n                      <Badge variant={verificationModal.data.dataIntegrity.studentsWithoutGoals === 0 ? \"default\" : \"secondary\"}>\n                        Students w/o Goals: {verificationModal.data.dataIntegrity.studentsWithoutGoals}\n                      </Badge>\n                      <Badge variant={verificationModal.data.dataIntegrity.goalsWithoutDataPoints === 0 ? \"default\" : \"secondary\"}>\n                        Goals w/o Data: {verificationModal.data.dataIntegrity.goalsWithoutDataPoints}\n                      </Badge>\n                    </div>\n                  </div>\n                )}\n\n                {verificationModal.data.sampleStudents && verificationModal.data.sampleStudents.length > 0 && (\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">Sample Students</h4>\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>ID</TableHead>\n                          <TableHead>Name</TableHead>\n                          <TableHead>Grade</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {verificationModal.data.sampleStudents.map((student: any) => (\n                          <TableRow key={student.id}>\n                            <TableCell>{student.id}</TableCell>\n                            <TableCell>{student.name}</TableCell>\n                            <TableCell>{student.grade}</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {verificationModal.type === \"student\" && verificationModal.data && (\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">Student Information</h4>\n                    <p className=\"text-sm\">Student ID: {verificationModal.data.studentId}</p>\n                    <p className=\"text-sm\">Status: {verificationModal.data.studentExists ? \"âœ… Found\" : \"âŒ Not Found\"}</p>\n                    {verificationModal.data.student && (\n                      <>\n                        <p className=\"text-sm\">Name: {verificationModal.data.student.name}</p>\n                        <p className=\"text-sm\">Grade: {verificationModal.data.student.grade}</p>\n                      </>\n                    )}\n                  </div>\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">Data Summary</h4>\n                    <p className=\"text-sm\">Goals: {verificationModal.data.goalCount}</p>\n                    <p className=\"text-sm\">Data Points: {verificationModal.data.dataPointCount}</p>\n                  </div>\n                </div>\n\n                {verificationModal.data.goals && verificationModal.data.goals.length > 0 && (\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">Goals</h4>\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>ID</TableHead>\n                          <TableHead>Title</TableHead>\n                          <TableHead>Type</TableHead>\n                          <TableHead>Status</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {verificationModal.data.goals.map((goal: any) => (\n                          <TableRow key={goal.id}>\n                            <TableCell>{goal.id}</TableCell>\n                            <TableCell>{goal.title}</TableCell>\n                            <TableCell>{goal.dataCollectionType}</TableCell>\n                            <TableCell>{goal.status}</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {verificationModal.type === \"goal\" && verificationModal.data && (\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">Goal Information</h4>\n                    <p className=\"text-sm\">Goal ID: {verificationModal.data.goalId}</p>\n                    <p className=\"text-sm\">Status: {verificationModal.data.goalExists ? \"âœ… Found\" : \"âŒ Not Found\"}</p>\n                    {verificationModal.data.goal && (\n                      <>\n                        <p className=\"text-sm\">Title: {verificationModal.data.goal.title}</p>\n                        <p className=\"text-sm\">Type: {verificationModal.data.goal.dataCollectionType}</p>\n                        <p className=\"text-sm\">Status: {verificationModal.data.goal.status}</p>\n                      </>\n                    )}\n                  </div>\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">Student & Progress</h4>\n                    {verificationModal.data.student && (\n                      <p className=\"text-sm\">Student: {verificationModal.data.student.name}</p>\n                    )}\n                    <p className=\"text-sm\">Data Points: {verificationModal.data.dataPointCount}</p>\n                    {verificationModal.data.progressCalculation && (\n                      <p className=\"text-sm\">Current Progress: {verificationModal.data.progressCalculation.currentProgress}%</p>\n                    )}\n                  </div>\n                </div>\n\n                {verificationModal.data.dataPoints && verificationModal.data.dataPoints.length > 0 && (\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">Recent Data Points</h4>\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Date</TableHead>\n                          <TableHead>Value</TableHead>\n                          <TableHead>Progress</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {verificationModal.data.dataPoints.slice(0, 10).map((dp: any) => (\n                          <TableRow key={dp.id}>\n                            <TableCell>{new Date(dp.date).toLocaleDateString()}</TableCell>\n                            <TableCell>{dp.value}</TableCell>\n                            <TableCell>{dp.progress}%</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {verificationModal.type === \"sample\" && verificationModal.data && (\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">User Overview</h4>\n                    {verificationModal.data.user && (\n                      <>\n                        <p className=\"text-sm\">Name: {verificationModal.data.user.firstName} {verificationModal.data.user.lastName}</p>\n                        <p className=\"text-sm\">Email: {verificationModal.data.user.email}</p>\n                      </>\n                    )}\n                  </div>\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">Data Summary</h4>\n                    <p className=\"text-sm\">Students: {verificationModal.data.summary.totalStudents}</p>\n                    <p className=\"text-sm\">Goals: {verificationModal.data.summary.totalGoals}</p>\n                    <p className=\"text-sm\">Data Points: {verificationModal.data.summary.totalDataPoints}</p>\n                  </div>\n                </div>\n\n                <Tabs defaultValue=\"students\" className=\"w-full\">\n                  <TabsList>\n                    <TabsTrigger value=\"students\">Sample Students</TabsTrigger>\n                    <TabsTrigger value=\"goals\">Sample Goals</TabsTrigger>\n                    <TabsTrigger value=\"datapoints\">Sample Data Points</TabsTrigger>\n                  </TabsList>\n\n                  <TabsContent value=\"students\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>ID</TableHead>\n                          <TableHead>Name</TableHead>\n                          <TableHead>Grade</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {verificationModal.data.sampleStudents.map((student: any) => (\n                          <TableRow key={student.id}>\n                            <TableCell>{student.id}</TableCell>\n                            <TableCell>{student.name}</TableCell>\n                            <TableCell>{student.grade}</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </TabsContent>\n\n                  <TabsContent value=\"goals\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>ID</TableHead>\n                          <TableHead>Title</TableHead>\n                          <TableHead>Type</TableHead>\n                          <TableHead>Student</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {verificationModal.data.sampleGoals.map((goal: any) => (\n                          <TableRow key={goal.id}>\n                            <TableCell>{goal.id}</TableCell>\n                            <TableCell>{goal.title}</TableCell>\n                            <TableCell>{goal.dataCollectionType}</TableCell>\n                            <TableCell>{goal.studentId}</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </TabsContent>\n\n                  <TabsContent value=\"datapoints\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>ID</TableHead>\n                          <TableHead>Date</TableHead>\n                          <TableHead>Value</TableHead>\n                          <TableHead>Progress</TableHead>\n                          <TableHead>Goal</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {verificationModal.data.sampleDataPoints.map((dp: any) => (\n                          <TableRow key={dp.id}>\n                            <TableCell>{dp.id}</TableCell>\n                            <TableCell>{new Date(dp.date).toLocaleDateString()}</TableCell>\n                            <TableCell>{dp.value}</TableCell>\n                            <TableCell>{dp.progress}%</TableCell>\n                            <TableCell>{dp.goalId}</TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </TabsContent>\n                </Tabs>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":38960,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport cookieParser from \"cookie-parser\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic } from \"./vite\";\nimport { logger, logAppStart, logAppStop, logHttpRequest, logError } from \"./logger\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\napp.use(cookieParser());\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const reqPath = req.path;\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (reqPath.startsWith(\"/api\")) {\n      const userId = (req as any).user?.claims?.sub;\n      logHttpRequest(req.method, reqPath, res.statusCode, duration, userId);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    logError(\"Unhandled request error\", err, { status, path: _req.path, method: _req.method });\n    res.status(status).json({ message });\n  });\n\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    logAppStart(port);\n  });\n\n  const gracefulShutdown = (signal: string) => {\n    logAppStop(signal);\n    server.close(() => {\n      logger.info(\"Server closed\");\n      process.exit(0);\n    });\n    setTimeout(() => {\n      logger.error(\"Forced shutdown due to timeout\");\n      process.exit(1);\n    }, 10000);\n  };\n\n  process.on(\"SIGTERM\", () => gracefulShutdown(\"SIGTERM\"));\n  process.on(\"SIGINT\", () => gracefulShutdown(\"SIGINT\"));\n})();\n","path":null,"size_bytes":1826,"size_tokens":null},"client/src/components/admin-verification.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { AlertCircle, CheckCircle, Database, Search, User, Users, Target } from \"lucide-react\";\n\ninterface VerificationProps {\n  onVerifyUser: (userId: string) => void;\n  onVerifyStudent: (studentId: number) => void;\n  onVerifyGoal: (goalId: number) => void;\n  onSampleData: (userId: string) => void;\n}\n\nexport default function AdminVerification({ onVerifyUser, onVerifyStudent, onVerifyGoal, onSampleData }: VerificationProps) {\n  const [userIdInput, setUserIdInput] = useState(\"\");\n  const [studentIdInput, setStudentIdInput] = useState(\"\");\n  const [goalIdInput, setGoalIdInput] = useState(\"\");\n  const [selectedUserId, setSelectedUserId] = useState<string>(\"\");\n\n  const { data: users } = useQuery({\n    queryKey: [\"/api/admin/users\"],\n  });\n\n  const { data: userVerification, refetch: refetchUserVerification } = useQuery({\n    queryKey: [\"/api/admin/verify/user\", selectedUserId],\n    enabled: !!selectedUserId,\n  });\n\n  const handleVerifyUser = () => {\n    if (userIdInput.trim()) {\n      setSelectedUserId(userIdInput.trim());\n      onVerifyUser(userIdInput.trim());\n    }\n  };\n\n  const handleQuickUserSelect = (userId: string) => {\n    setUserIdInput(userId);\n    setSelectedUserId(userId);\n    onVerifyUser(userId);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid gap-6 md:grid-cols-2\">\n        {/* User Verification */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <User className=\"h-5 w-5\" />\n              User Data Verification\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"userId\">User ID</Label>\n              <div className=\"flex gap-2\">\n                <Input\n                  id=\"userId\"\n                  value={userIdInput}\n                  onChange={(e) => setUserIdInput(e.target.value)}\n                  placeholder=\"Enter user ID (e.g., 4201332)\"\n                />\n                <Button onClick={handleVerifyUser} disabled={!userIdInput.trim()}>\n                  <Search className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n\n            {/* Quick User Selection */}\n            {users && users.length > 0 && (\n              <div className=\"space-y-2\">\n                <Label>Quick Select User:</Label>\n                <div className=\"flex flex-wrap gap-2\">\n                  {users.slice(0, 6).map((user: any) => (\n                    <Button\n                      key={user.id}\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleQuickUserSelect(user.id)}\n                      className=\"text-xs\"\n                    >\n                      {user.firstName || user.id}\n                    </Button>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* User Verification Results */}\n            {userVerification && (\n              <div className=\"space-y-3 p-3 bg-gray-50 rounded-lg\">\n                <div className=\"flex items-center gap-2\">\n                  {userVerification.userExists ? (\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                  ) : (\n                    <AlertCircle className=\"h-4 w-4 text-red-600\" />\n                  )}\n                  <span className=\"font-medium\">\n                    User {userVerification.userId} {userVerification.userExists ? \"exists\" : \"not found\"}\n                  </span>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                  <div>\n                    <span className=\"font-medium\">Students:</span> {userVerification.studentCount}\n                  </div>\n                  <div>\n                    <span className=\"font-medium\">Goals:</span> {userVerification.goalCount}\n                  </div>\n                  <div>\n                    <span className=\"font-medium\">Data Points:</span> {userVerification.dataPointCount}\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <h4 className=\"font-medium text-sm\">Data Integrity:</h4>\n                  <div className=\"grid grid-cols-2 gap-2 text-xs\">\n                    <Badge variant={userVerification.dataIntegrity.orphanedGoals === 0 ? \"default\" : \"destructive\"}>\n                      Orphaned Goals: {userVerification.dataIntegrity.orphanedGoals}\n                    </Badge>\n                    <Badge variant={userVerification.dataIntegrity.orphanedDataPoints === 0 ? \"default\" : \"destructive\"}>\n                      Orphaned Data Points: {userVerification.dataIntegrity.orphanedDataPoints}\n                    </Badge>\n                    <Badge variant={userVerification.dataIntegrity.studentsWithoutGoals === 0 ? \"default\" : \"secondary\"}>\n                      Students w/o Goals: {userVerification.dataIntegrity.studentsWithoutGoals}\n                    </Badge>\n                    <Badge variant={userVerification.dataIntegrity.goalsWithoutDataPoints === 0 ? \"default\" : \"secondary\"}>\n                      Goals w/o Data: {userVerification.dataIntegrity.goalsWithoutDataPoints}\n                    </Badge>\n                  </div>\n                </div>\n\n                <Button\n                  onClick={() => onSampleData(userVerification.userId)}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"w-full\"\n                >\n                  <Database className=\"h-4 w-4 mr-2\" />\n                  View Sample Data\n                </Button>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Student & Goal Verification */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              Individual Record Verification\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"studentId\">Student ID</Label>\n              <div className=\"flex gap-2\">\n                <Input\n                  id=\"studentId\"\n                  value={studentIdInput}\n                  onChange={(e) => setStudentIdInput(e.target.value)}\n                  placeholder=\"Enter student ID\"\n                  type=\"number\"\n                />\n                <Button \n                  onClick={() => onVerifyStudent(parseInt(studentIdInput))} \n                  disabled={!studentIdInput.trim()}\n                >\n                  <Search className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"goalId\">Goal ID</Label>\n              <div className=\"flex gap-2\">\n                <Input\n                  id=\"goalId\"\n                  value={goalIdInput}\n                  onChange={(e) => setGoalIdInput(e.target.value)}\n                  placeholder=\"Enter goal ID\"\n                  type=\"number\"\n                />\n                <Button \n                  onClick={() => onVerifyGoal(parseInt(goalIdInput))} \n                  disabled={!goalIdInput.trim()}\n                >\n                  <Search className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"p-3 bg-blue-50 rounded-lg text-sm\">\n              <h4 className=\"font-medium mb-2\">Verification Options:</h4>\n              <ul className=\"space-y-1 text-xs\">\n                <li>â€¢ User verification shows data integrity and counts</li>\n                <li>â€¢ Student verification displays goals and progress</li>\n                <li>â€¢ Goal verification shows data points and calculations</li>\n                <li>â€¢ Sample data provides representative records</li>\n              </ul>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":8568,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":23567,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":2627,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"README.md":{"content":"# Special Education Data Collection Platform\n\nA comprehensive, production-ready web application for special education teachers to track student progress, manage IEP goals, and generate meaningful reports.\n\n## ðŸš€ Quick Start\n\nThe application can be started with a single command:\n\n### Option 1: Python Command\n```bash\npython main.py\n```\n\n### Option 2: NPM Commands\n```bash\nnpm install\nnpm run build\nnpm start\n```\n\n### Development Mode\n```bash\nnpm run dev\n```\n\n## ðŸ“‹ Production Deployment\n\nFor live website deployment, see:\n- **[DEPLOYMENT.md](DEPLOYMENT.md)** - Complete deployment guide\n- **[SECURITY.md](SECURITY.md)** - Security configuration\n- **[PRODUCTION_CHECKLIST.md](PRODUCTION_CHECKLIST.md)** - Pre-deployment verification\n\n## âœ¨ Features\n\n### Core Functionality\n- **Student Management**: Track multiple students with grade-level organization\n- **Goal Tracking**: Support for frequency, percentage, and duration data collection types\n- **Real-time Data Collection**: Live collection tabs with timers and counters\n- **Progress Visualization**: Multiple chart types (line, bar, pie) with dynamic switching\n- **Comprehensive Reporting**: PDF exports with charts and detailed progress summaries\n- **IEP Calendar**: Interactive calendar showing due dates and reporting periods\n- **Admin Tools**: Database verification and management capabilities\n\n### Production Features\n- **Security**: User authentication, data isolation, secure sessions\n- **Performance**: Optimized database queries, efficient caching\n- **Scalability**: PostgreSQL backend, horizontal scaling ready\n- **Reliability**: Error handling, data validation, backup systems\n- **Compliance**: FERPA-ready data protection, audit logging\n\n## ðŸ›  Technology Stack\n\n- **Frontend**: React 18, TypeScript, Tailwind CSS, Radix UI\n- **Backend**: Node.js, Express.js, TypeScript\n- **Database**: PostgreSQL with Drizzle ORM\n- **Authentication**: OpenID Connect (configurable)\n- **Charts**: Recharts with multiple visualization types\n- **PDF Generation**: jsPDF with chart integration\n\n## ðŸ“Š Data Collection Types\n\n1. **Frequency**: Count of behaviors or events\n2. **Percentage**: Success rate from trials\n3. **Duration**: Time-based measurements with built-in timers\n\n## ðŸ”’ Security\n\n- User data isolation by organization/teacher\n- Secure session management with PostgreSQL storage\n- Input validation and SQL injection prevention\n- HTTPS enforcement and security headers\n- Audit logging for administrative actions\n\n## ðŸ—„ Database\n\n- PostgreSQL with automatic schema management\n- Foreign key constraints for data integrity\n- Optimized indexes for performance\n- Automated backup support\n\n## ðŸ”§ Configuration\n\nCopy `.env.example` to `.env` and configure:\n```bash\nDATABASE_URL=postgresql://user:pass@host:port/database\nSESSION_SECRET=your_secure_32_character_secret\nNODE_ENV=production\n```\n\n## ðŸ“– Documentation\n\n- **[API Documentation](DEPLOYMENT.md#api-endpoints)** - Backend API reference\n- **[Security Guide](SECURITY.md)** - Security best practices\n- **[Deployment Guide](DEPLOYMENT.md)** - Production setup\n- **[Production Checklist](PRODUCTION_CHECKLIST.md)** - Pre-launch verification\n\n## ðŸš€ Ready for Production\n\nThis application is production-ready with:\n- âœ… Clean, optimized codebase\n- âœ… Comprehensive security measures\n- âœ… Complete documentation\n- âœ… Multiple deployment options\n- âœ… Professional reporting capabilities\n- âœ… Scalable architecture\n\nPerfect for educational institutions, therapy centers, and special education programs requiring robust data collection and progress monitoring.","path":null,"size_bytes":3580,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/student-info-card.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar, GraduationCap, Users, Edit } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport EditStudentModal from \"./edit-student-modal\";\n\ninterface StudentInfoCardProps {\n  student: {\n    id: number;\n    name: string;\n    grade?: string;\n    iepDueDate?: string;\n    relatedServices?: string;\n  };\n  onStudentUpdate?: () => void;\n}\n\nexport default function StudentInfoCard({ student, onStudentUpdate }: StudentInfoCardProps) {\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\n  const parseRelatedServices = (services: string | undefined): string[] => {\n    if (!services) return [];\n    try {\n      // Handle both JSON array and comma-separated string\n      if (services.startsWith('[')) {\n        return JSON.parse(services);\n      }\n      return services.split(',').map(s => s.trim()).filter(Boolean);\n    } catch {\n      return services.split(',').map(s => s.trim()).filter(Boolean);\n    }\n  };\n\n  const relatedServices = parseRelatedServices(student.relatedServices);\n\n  return (\n    <Card className=\"mb-6\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Users className=\"h-5 w-5\" />\n            Student Information\n          </div>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setIsEditModalOpen(true)}\n            className=\"gap-1\"\n          >\n            <Edit className=\"h-4 w-4\" />\n            Edit\n          </Button>\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {/* Grade Level */}\n          <div className=\"flex items-center gap-2\">\n            <GraduationCap className=\"h-4 w-4 text-muted-foreground\" />\n            <div>\n              <p className=\"text-sm font-medium\">Grade Level</p>\n              <p className=\"text-sm text-muted-foreground\">\n                {student.grade || \"Not specified\"}\n              </p>\n            </div>\n          </div>\n\n          {/* IEP Due Date */}\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n            <div>\n              <p className=\"text-sm font-medium\">IEP Due Date</p>\n              <p className=\"text-sm text-muted-foreground\">\n                {student.iepDueDate \n                  ? format(new Date(student.iepDueDate), \"MMM dd, yyyy\")\n                  : \"Not set\"\n                }\n              </p>\n            </div>\n          </div>\n\n          {/* Related Services */}\n          <div>\n            <p className=\"text-sm font-medium mb-2\">Related Services</p>\n            {relatedServices.length > 0 ? (\n              <div className=\"flex flex-wrap gap-1\">\n                {relatedServices.map((service, index) => (\n                  <Badge key={index} variant=\"secondary\" className=\"text-xs\">\n                    {service}\n                  </Badge>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground\">None specified</p>\n            )}\n          </div>\n        </div>\n      </CardContent>\n      \n      <EditStudentModal\n        student={student}\n        isOpen={isEditModalOpen}\n        onClose={() => setIsEditModalOpen(false)}\n        onSuccess={() => {\n          setIsEditModalOpen(false);\n          onStudentUpdate?.();\n        }}\n      />\n    </Card>\n  );\n}","path":null,"size_bytes":3682,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/target-criteria-input.tsx":{"content":"import React, { useState } from 'react';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { Badge } from '@/components/ui/badge';\nimport { HelpCircle, Lightbulb } from 'lucide-react';\n\ninterface TargetCriteriaInputProps {\n  value: string;\n  onChange: (value: string) => void;\n  dataCollectionType?: string;\n  placeholder?: string;\n}\n\nexport default function TargetCriteriaInput({ \n  value, \n  onChange, \n  dataCollectionType = 'percentage',\n  placeholder \n}: TargetCriteriaInputProps) {\n  const [showTemplates, setShowTemplates] = useState(false);\n\n  const getTemplates = () => {\n    switch (dataCollectionType) {\n      case 'percentage':\n        return [\n          '80% accuracy over 3 consecutive sessions',\n          '90% accuracy for 4 consecutive trials',\n          '85% accuracy across 5 sessions',\n          '75% accuracy over 3 consecutive days'\n        ];\n      case 'frequency':\n        return [\n          'Reduce frequency to under 2 per hour for 3 days',\n          'Increase frequency to 5 or more per session for 4 sessions',\n          'Maintain frequency under 1 per day for 5 consecutive days',\n          'Achieve 8 or more occurrences per session for 3 sessions'\n        ];\n      case 'duration':\n        return [\n          'Maintain attention for 10 minutes over 3 consecutive sessions',\n          'Complete task within 5 minutes for 4 consecutive trials',\n          'Engage for 15 minutes or longer across 3 sessions',\n          'Reduce completion time to under 3 minutes for 5 trials'\n        ];\n      default:\n        return [\n          '80% accuracy over 3 consecutive sessions',\n          '4 out of 5 sessions meeting criteria',\n          '90% accuracy for 3 consecutive trials'\n        ];\n    }\n  };\n\n  const handleTemplateSelect = (template: string) => {\n    onChange(template);\n    setShowTemplates(false);\n  };\n\n  const getHelpText = () => {\n    switch (dataCollectionType) {\n      case 'percentage':\n        return 'Define the percentage accuracy and how many consecutive sessions or trials are needed to demonstrate mastery.';\n      case 'frequency':\n        return 'Specify the target frequency (increase/decrease) and the duration needed to maintain that level.';\n      case 'duration':\n        return 'Set the target duration and how consistently it must be achieved for mastery.';\n      default:\n        return 'Define specific, measurable criteria that indicate when this goal/objective has been mastered.';\n    }\n  };\n\n  const examples = getTemplates();\n\n  return (\n    <div className=\"space-y-2\">\n      <div className=\"flex items-center gap-2\">\n        <Input\n          value={value}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder={placeholder || 'e.g., 80% accuracy over 3 consecutive trials'}\n          className=\"flex-1\"\n        />\n        \n        <Popover open={showTemplates} onOpenChange={setShowTemplates}>\n          <PopoverTrigger asChild>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"shrink-0\"\n            >\n              <Lightbulb className=\"h-4 w-4\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-80\" align=\"end\">\n            <div className=\"space-y-3\">\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium text-sm\">Common Templates</h4>\n                <p className=\"text-xs text-gray-600\">{getHelpText()}</p>\n              </div>\n              \n              <div className=\"space-y-2\">\n                {examples.map((template, index) => (\n                  <Button\n                    key={index}\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"w-full text-left justify-start h-auto p-2 whitespace-normal\"\n                    onClick={() => handleTemplateSelect(template)}\n                  >\n                    <div className=\"text-xs\">{template}</div>\n                  </Button>\n                ))}\n              </div>\n              \n              <div className=\"pt-2 border-t space-y-2\">\n                <h5 className=\"text-xs font-medium text-gray-700\">Tips for Writing Criteria:</h5>\n                <ul className=\"text-xs text-gray-600 space-y-1\">\n                  <li>â€¢ Be specific about the percentage or level needed</li>\n                  <li>â€¢ Include how many consecutive sessions/trials</li>\n                  <li>â€¢ Make it measurable and observable</li>\n                  <li>â€¢ Consider the student's current ability level</li>\n                </ul>\n              </div>\n            </div>\n          </PopoverContent>\n        </Popover>\n        \n        <Popover>\n          <PopoverTrigger asChild>\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"shrink-0 text-gray-400 hover:text-gray-600\"\n            >\n              <HelpCircle className=\"h-4 w-4\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-72\" align=\"end\">\n            <div className=\"space-y-2\">\n              <h4 className=\"font-medium text-sm\">What are Target Criteria?</h4>\n              <p className=\"text-xs text-gray-600\">\n                Target criteria define exactly when a goal or objective is considered \"mastered.\" \n                They should specify:\n              </p>\n              <ul className=\"text-xs text-gray-600 space-y-1\">\n                <li>â€¢ <strong>Performance level:</strong> What percentage, frequency, or duration</li>\n                <li>â€¢ <strong>Consistency:</strong> How many consecutive sessions or trials</li>\n                <li>â€¢ <strong>Context:</strong> Under what conditions or settings</li>\n              </ul>\n              <div className=\"mt-3 p-2 bg-blue-50 rounded text-xs\">\n                <strong>Example:</strong> \"80% accuracy over 3 consecutive sessions\" means the student must achieve 80% or higher performance for 3 sessions in a row to demonstrate mastery.\n              </div>\n            </div>\n          </PopoverContent>\n        </Popover>\n      </div>\n      \n      {value && (\n        <div className=\"flex items-center gap-1 text-xs text-gray-500\">\n          <Badge variant=\"outline\" className=\"text-xs\">\n            Mastery Alert Enabled\n          </Badge>\n          <span>The app will notify you when this criteria is met</span>\n        </div>\n      )}\n    </div>\n  );\n}","path":null,"size_bytes":6713,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/objective-chart.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { ChevronDown, LineChart as LineChartIcon, BarChart3, PieChart, Filter } from \"lucide-react\";\nimport {\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  BarChart,\n  Bar,\n  PieChart as RechartsPieChart,\n  Pie,\n  Cell,\n} from \"recharts\";\nimport { format } from \"date-fns\";\nimport { ReportingPeriod, filterDataPointsByPeriod } from \"@/lib/utils\";\nimport type { GoalProgressResponse, ObjectiveProgressResponse, DataPoint } from \"@shared/schema\";\n\ninterface ObjectiveChartProps {\n  objectiveId: number;\n  goalId: number;\n  selectedPeriod?: ReportingPeriod | null;\n}\n\ntype ChartType = 'line' | 'bar' | 'pie';\n\nexport default function ObjectiveChart({ objectiveId, goalId, selectedPeriod }: ObjectiveChartProps) {\n  const [selectedChartType, setSelectedChartType] = useState<ChartType>(() => {\n    const savedChartType = sessionStorage.getItem(`objectiveChartType_${objectiveId}`) as ChartType;\n    return savedChartType || 'line';\n  });\n\n  const [supportFilter, setSupportFilter] = useState<'all' | 'split'>(() => {\n    const savedSupportFilter = sessionStorage.getItem(`objectiveSupportFilter_${objectiveId}`) as 'all' | 'split';\n    return savedSupportFilter || 'all';\n  });\n\n  // Save chart type preference when it changes\n  useEffect(() => {\n    sessionStorage.setItem(`objectiveChartType_${objectiveId}`, selectedChartType);\n  }, [selectedChartType, objectiveId]);\n\n  // Helper function to check if support levels include \"independent\"\n  const hasIndependentSupport = (supportData: string): boolean => {\n    if (!supportData || supportData === 'Not specified') return true;\n    try {\n      const supportLevels = JSON.parse(supportData);\n      return Array.isArray(supportLevels) && supportLevels.includes('independent');\n    } catch {\n      return supportData === 'independent';\n    }\n  };\n\n  // Get goal data to access dataCollectionType\n  const { data: goalData, isLoading: goalLoading } = useQuery<GoalProgressResponse>({\n    queryKey: [`/api/goals/${goalId}`],\n  });\n\n  // Get objective data\n  const { data: objectiveData, isLoading: objectiveLoading } = useQuery<ObjectiveProgressResponse>({\n    queryKey: [`/api/objectives/${objectiveId}/progress`],\n  });\n\n  // Get data points for this objective\n  const { data: dataPointsList, isLoading: dataLoading } = useQuery<DataPoint[]>({\n    queryKey: [`/api/goals/${goalId}/data-points`],\n  });\n\n  if (objectiveLoading || dataLoading || goalLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <div className=\"animate-pulse\">\n            <div className=\"h-6 bg-gray-200 rounded w-3/4 mb-2\"></div>\n            <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"animate-pulse\">\n            <div className=\"h-48 bg-gray-200 rounded\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!objectiveData || !dataPointsList) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Objective Chart</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-center py-8\">\n            <p className=\"text-gray-600\">Unable to load objective data</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Extract objective and goal from responses\n  const objective = objectiveData.objective;\n  const goal = goalData?.goal;\n\n  // Filter data points for this specific objective\n  let objectiveDataPoints = Array.isArray(dataPointsList) \n    ? dataPointsList.filter((point) => point.objectiveId === objectiveId) \n    : [];\n\n  // Apply reporting period filtering if a specific period is selected\n  if (selectedPeriod) {\n    objectiveDataPoints = filterDataPointsByPeriod(objectiveDataPoints, selectedPeriod);\n  }\n\n  // Chart data type for proper typing\n  interface ChartDataPoint {\n    index: number;\n    date: string;\n    fullDate: Date | string;\n    progress: number;\n    originalValue: number;\n    support: string;\n    notes: string;\n  }\n\n  const chartData: ChartDataPoint[] = objectiveDataPoints\n    .map((point, index) => ({\n      index: index + 1,\n      date: format(new Date(point.date), \"MMM d\"),\n      fullDate: point.date,\n      progress: parseFloat(point.progressValue.toString()),\n      originalValue: parseFloat(point.progressValue.toString()),\n      support: point.levelOfSupport || 'Not specified',\n      notes: point.anecdotalInfo || '',\n    }))\n    .sort((a, b) => new Date(a.fullDate).getTime() - new Date(b.fullDate).getTime())\n    .slice(-10);\n\n  // Split data by support level for percentage goals when support filter is 'split'\n  const isPercentageGoal = goal?.dataCollectionType === 'percentage';\n  const independentData = supportFilter === 'split' && isPercentageGoal\n    ? chartData.filter(item => hasIndependentSupport(item.support))\n    : chartData;\n\n  const otherSupportData = supportFilter === 'split' && isPercentageGoal\n    ? chartData.filter(item => !hasIndependentSupport(item.support))\n    : [];\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'mastered':\n        return 'bg-green-100 text-green-800';\n      case 'active':\n        return 'bg-blue-100 text-blue-800';\n      case 'discontinued':\n        return 'bg-red-100 text-red-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getChartIcon = (chartType: ChartType) => {\n    switch (chartType) {\n      case 'line':\n        return <LineChartIcon className=\"h-4 w-4\" />;\n      case 'bar':\n        return <BarChart3 className=\"h-4 w-4\" />;\n      case 'pie':\n        return <PieChart className=\"h-4 w-4\" />;\n      default:\n        return <LineChartIcon className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getChartLabel = (chartType: ChartType) => {\n    switch (chartType) {\n      case 'line':\n        return 'Line Chart';\n      case 'bar':\n        return 'Bar Chart';\n      case 'pie':\n        return 'Pie Chart';\n      default:\n        return 'Line Chart';\n    }\n  };\n\n  const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042'];\n\n  // Helper function to render charts for split view - With Support\n  const renderWithSupportChart = () => {\n    switch (selectedChartType) {\n      case 'line':\n        return (\n          <LineChart data={otherSupportData}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n            <XAxis dataKey=\"date\" stroke=\"#666\" fontSize={11} />\n            <YAxis domain={[0, 100]} stroke=\"#666\" fontSize={11} tickFormatter={(value) => `${value}%`} />\n            <Tooltip formatter={(value: number) => [`${value}%`, 'Progress']} labelFormatter={(label) => `Date: ${label}`} />\n            <Line type=\"monotone\" dataKey=\"progress\" stroke=\"#A855F7\" strokeWidth={2} dot={{ fill: \"#A855F7\", r: 4 }} name=\"With Support\" />\n          </LineChart>\n        );\n      case 'bar':\n        return (\n          <BarChart data={otherSupportData}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n            <XAxis dataKey=\"date\" stroke=\"#666\" fontSize={11} />\n            <YAxis domain={[0, 100]} stroke=\"#666\" fontSize={11} tickFormatter={(value) => `${value}%`} />\n            <Tooltip formatter={(value: number) => [`${value}%`, 'Progress']} labelFormatter={(label) => `Date: ${label}`} />\n            <Bar dataKey=\"progress\" fill=\"#A855F7\" radius={[4, 4, 0, 0]} />\n          </BarChart>\n        );\n      case 'pie':\n        return (\n          <RechartsPieChart>\n            <Pie data={otherSupportData} cx=\"50%\" cy=\"50%\" outerRadius={80} fill=\"#A855F7\" dataKey=\"progress\" label={({ date, progress }) => `${date}: ${progress}%`} />\n            <Tooltip formatter={(value: number) => [`${value}%`, 'With Support']} />\n          </RechartsPieChart>\n        );\n    }\n  };\n\n  // Helper function to render charts for split view - Independent\n  const renderIndependentChart = () => {\n    switch (selectedChartType) {\n      case 'line':\n        return (\n          <LineChart data={independentData}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n            <XAxis dataKey=\"date\" stroke=\"#666\" fontSize={11} />\n            <YAxis domain={[0, 100]} stroke=\"#666\" fontSize={11} tickFormatter={(value) => `${value}%`} />\n            <Tooltip formatter={(value: number) => [`${value}%`, 'Progress']} labelFormatter={(label) => `Date: ${label}`} />\n            <Line type=\"monotone\" dataKey=\"progress\" stroke=\"#2563EB\" strokeWidth={2} dot={{ fill: \"#2563EB\", r: 4 }} name=\"Independent\" />\n          </LineChart>\n        );\n      case 'bar':\n        return (\n          <BarChart data={independentData}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n            <XAxis dataKey=\"date\" stroke=\"#666\" fontSize={11} />\n            <YAxis domain={[0, 100]} stroke=\"#666\" fontSize={11} tickFormatter={(value) => `${value}%`} />\n            <Tooltip formatter={(value: number) => [`${value}%`, 'Progress']} labelFormatter={(label) => `Date: ${label}`} />\n            <Bar dataKey=\"progress\" fill=\"#2563EB\" radius={[4, 4, 0, 0]} />\n          </BarChart>\n        );\n      case 'pie':\n        return (\n          <RechartsPieChart>\n            <Pie data={independentData} cx=\"50%\" cy=\"50%\" outerRadius={80} fill=\"#2563EB\" dataKey=\"progress\" label={({ date, progress }) => `${date}: ${progress}%`} />\n            <Tooltip formatter={(value: number) => [`${value}%`, 'Independent']} />\n          </RechartsPieChart>\n        );\n    }\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <CardTitle className=\"text-lg font-semibold text-gray-900\">\n                Objective Progress Chart\n              </CardTitle>\n              {selectedPeriod && (\n                <div className=\"flex items-center gap-1 bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs\">\n                  <Filter className=\"h-3 w-3\" />\n                  Period {selectedPeriod.periodNumber}\n                </div>\n              )}\n            </div>\n            <p className=\"text-gray-600 text-sm mb-2\">\n              {objective?.description || 'Loading...'}\n            </p>\n            {objective?.targetCriteria && (\n              <p className=\"text-sm text-blue-600 mb-2\">\n                <strong>Target:</strong> {objective.targetCriteria}\n              </p>\n            )}\n            <Badge className={getStatusColor(objective?.status || 'active')}>\n              {objective?.status === 'mastered' ? 'Mastered' : \n               objective?.status === 'active' ? 'Active' : \n               objective?.status === 'discontinued' ? 'Discontinued' : \n               objective?.status || 'Active'}\n            </Badge>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"sm\" className=\"flex items-center gap-2\">\n                  {getChartIcon(selectedChartType)}\n                  {getChartLabel(selectedChartType)}\n                  <ChevronDown className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem onClick={() => setSelectedChartType('line')}>\n                  <LineChartIcon className=\"h-4 w-4 mr-2\" />\n                  Line Chart\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setSelectedChartType('bar')}>\n                  <BarChart3 className=\"h-4 w-4 mr-2\" />\n                  Bar Chart\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setSelectedChartType('pie')}>\n                  <PieChart className=\"h-4 w-4 mr-2\" />\n                  Pie Chart\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n            \n            {/* Support Level Filter Toggle - Only for percentage goals */}\n            {isPercentageGoal && (\n              <Button\n                variant={supportFilter === 'split' ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => {\n                  const newFilter = supportFilter === 'all' ? 'split' : 'all';\n                  setSupportFilter(newFilter);\n                  sessionStorage.setItem(`objectiveSupportFilter_${objectiveId}`, newFilter);\n                }}\n              >\n                {supportFilter === 'all' ? 'Split by Support' : 'Show All Together'}\n              </Button>\n            )}\n          </div>\n\n        </div>\n      </CardHeader>\n\n      <CardContent>\n        {chartData.length === 0 ? (\n          <div className=\"text-center py-16\">\n            <p className=\"text-gray-600\">No data points available for this objective</p>\n            <p className=\"text-sm text-gray-500 mt-1\">Add some objective-specific data points to see the progress chart</p>\n          </div>\n        ) : (\n          <>\n            {/* Chart Container - Single or Dual based on support filter */}\n            {supportFilter === 'split' && isPercentageGoal ? (\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\">\n                {/* With Support Chart */}\n                <div className=\"bg-purple-50 p-4 rounded-lg border border-purple-200\">\n                  <h4 className=\"text-sm font-semibold text-purple-800 mb-3 text-center\">\n                    With Support-Data\n                  </h4>\n                  <div className=\"h-80\">\n                    {otherSupportData.length === 0 ? (\n                      <div className=\"flex items-center justify-center h-full text-gray-500 text-sm\">\n                        No with support data points\n                      </div>\n                    ) : (\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\n                        {renderWithSupportChart()}\n                      </ResponsiveContainer>\n                    )}\n                  </div>\n                </div>\n                \n                {/* Independent Support Chart */}\n                <div className=\"bg-blue-50 p-4 rounded-lg border border-blue-200\">\n                  <h4 className=\"text-sm font-semibold text-blue-800 mb-3 text-center\">\n                    Independent-Data\n                  </h4>\n                  <div className=\"h-80\">\n                    {independentData.length === 0 ? (\n                      <div className=\"flex items-center justify-center h-full text-gray-500 text-sm\">\n                        No independent data points\n                      </div>\n                    ) : (\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\n                        {renderIndependentChart()}\n                      </ResponsiveContainer>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ) : (\n              /* Single Chart Layout */\n              <div className=\"h-80 mb-4\">\n                {selectedChartType === 'line' && (\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <LineChart data={chartData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n                      <XAxis \n                        dataKey=\"date\" \n                        stroke=\"#666\"\n                        fontSize={12}\n                      />\n                      <YAxis \n                        stroke=\"#666\"\n                        fontSize={12}\n                        domain={[0, 100]}\n                        tickFormatter={(value) => `${value}%`}\n                      />\n                      <Tooltip\n                        formatter={(value: any, name: string) => [`${value}%`, 'Progress']}\n                        labelFormatter={(label) => `Date: ${label}`}\n                      />\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"progress\" \n                        stroke=\"#3b82f6\" \n                        strokeWidth={2}\n                        dot={{ fill: '#3b82f6', strokeWidth: 2, r: 4 }}\n                        activeDot={{ r: 6 }}\n                        name=\"Progress\"\n                      />\n                    </LineChart>\n                  </ResponsiveContainer>\n                )}\n\n                {selectedChartType === 'bar' && (\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <BarChart data={chartData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n                      <XAxis \n                        dataKey=\"date\" \n                        stroke=\"#666\"\n                        fontSize={12}\n                      />\n                      <YAxis \n                        stroke=\"#666\"\n                        fontSize={12}\n                        domain={[0, 100]}\n                        tickFormatter={(value) => `${value}%`}\n                      />\n                      <Tooltip\n                        formatter={(value: any) => [`${value}%`, 'Progress']}\n                        labelFormatter={(label) => `Date: ${label}`}\n                      />\n                      <Bar \n                        dataKey=\"progress\" \n                        fill=\"#3b82f6\" \n                        name=\"Progress\"\n                      />\n                    </BarChart>\n                  </ResponsiveContainer>\n                )}\n\n                {selectedChartType === 'pie' && chartData.length > 0 && (\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <RechartsPieChart>\n                      <Pie\n                        data={chartData}\n                        cx=\"50%\"\n                        cy=\"50%\"\n                        labelLine={false}\n                        label={({ date, progress }: any) => `${date}: ${progress}%`}\n                        outerRadius={80}\n                        fill=\"#8884d8\"\n                        dataKey=\"progress\"\n                      >\n                        {chartData.map((entry: any, index: number) => (\n                          <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                        ))}\n                      </Pie>\n                      <Tooltip formatter={(value: any) => [`${value}%`, 'Progress']} />\n                    </RechartsPieChart>\n                  </ResponsiveContainer>\n                )}\n              </div>\n            )}\n          </>\n        )}\n        \n        {/* Objective Statistics */}\n        {objectiveData?.currentProgress !== undefined && (\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4\">\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <p className=\"text-2xl font-bold text-gray-900\">{objectiveData?.dataPointsCount || 0}</p>\n              <p className=\"text-xs text-gray-600\">Data Points</p>\n            </div>\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <p className=\"text-2xl font-bold text-gray-900\">{objectiveData?.averageScore?.toFixed(0) || 0}%</p>\n              <p className=\"text-xs text-gray-600\">Average Score</p>\n            </div>\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <p className={`text-2xl font-bold ${(objectiveData?.trend || 0) > 0 ? 'text-green-600' : (objectiveData?.trend || 0) < 0 ? 'text-red-600' : 'text-gray-900'}`}>\n                {(objectiveData?.trend || 0) > 0 ? `+${objectiveData.trend.toFixed(1)}%` : (objectiveData?.trend || 0) < 0 ? `${objectiveData.trend.toFixed(1)}%` : '0%'}\n              </p>\n              <p className=\"text-xs text-gray-600\">Trend</p>\n            </div>\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <p className=\"text-2xl font-bold text-gray-900\">{objectiveData?.lastScore?.toFixed(0) || 0}%</p>\n              <p className=\"text-xs text-gray-600\">Last Score</p>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","path":null,"size_bytes":20477,"size_tokens":null},"DEPLOYMENT_SUMMARY.md":{"content":"# Production Deployment Summary\n\n## âœ… Application Status: READY FOR PRODUCTION\n\nYour Special Education Data Collection Platform has been successfully prepared for live deployment on your external website.\n\n## ðŸ§¹ Cleanup Completed\n\n### Development Files Removed\n- All debug cookie files (cookies.txt, debug_*.txt, etc.)\n- Test data generation scripts\n- Development screenshots and attachments\n- Debug logging statements from components\n\n### Production Files Added\n- `.env.example` - Environment configuration template\n- `DEPLOYMENT.md` - Complete deployment instructions\n- `SECURITY.md` - Security configuration guide\n- `PRODUCTION_CHECKLIST.md` - Pre-deployment verification\n- `.gitignore` - Production-ready git ignore rules\n- `main.py` - Python launcher for easy startup\n\n## ðŸš€ Deployment Options\n\n### Quick Start (Single Command)\n```bash\n# Option 1: Python launcher\npython main.py\n\n# Option 2: NPM commands\nnpm install && npm run build && npm start\n```\n\n### Production Deployment Methods\n1. **Direct Node.js** - Simple single-server setup\n2. **PM2 Process Manager** - Production process management with auto-restart\n3. **Nginx Reverse Proxy** - Full production web server with SSL\n4. **Docker** - Containerized deployment (instructions included)\n\n## ðŸ”’ Security Ready\n\n### Authentication Options\n- **OpenID Connect** - Fully configured and documented\n- **Custom Authentication** - Integration points identified\n- **Development Bypass** - For internal organizational use\n\n### Security Features\n- User data isolation by organization\n- Secure session management with PostgreSQL\n- Input validation and SQL injection prevention\n- HTTPS enforcement ready\n- Security headers configured\n- Rate limiting ready\n\n## ðŸ“Š Core Features Verified\n\n### Student Management\nâœ… Multi-student tracking with grade organization\nâœ… IEP due date management\nâœ… Related services tracking\n\n### Data Collection\nâœ… Three data types: Frequency, Percentage, Duration\nâœ… Real-time live collection with timers\nâœ… Group data collection capabilities\nâœ… Data point editing and correction\n\n### Progress Tracking\nâœ… Multiple chart types (Line, Bar, Pie)\nâœ… Goal-specific progress visualization\nâœ… Interactive scatterplots\nâœ… PDF report generation with charts\n\n### Administrative Tools\nâœ… Database verification system\nâœ… Caseload management\nâœ… User ownership controls\nâœ… Data integrity checking\n\n## ðŸ“‹ Pre-Deployment Checklist\n\n### Required Setup\n1. **Environment Configuration**\n   - Copy `.env.example` to `.env`\n   - Configure `DATABASE_URL` for your PostgreSQL\n   - Set secure `SESSION_SECRET` (32+ characters)\n   - Set `NODE_ENV=production`\n\n2. **Database Setup**\n   - Create PostgreSQL database\n   - Run `npm run db:push` to create schema\n   - Configure backup strategy\n\n3. **Web Server Configuration**\n   - Configure SSL certificates\n   - Set up reverse proxy (if using)\n   - Configure security headers\n   - Test HTTPS redirect\n\n### Domain Configuration\nUpdate these for your domain:\n- Environment variables for authentication\n- Nginx configuration files\n- SSL certificate domains\n- CORS settings if needed\n\n## ðŸŽ¯ Ready for Real-World Use\n\n### Professional Features\n- Clean, accessible user interface\n- Comprehensive error handling\n- Professional PDF reports\n- Audit logging for compliance\n- Data backup capabilities\n\n### Scalability\n- PostgreSQL backend for high performance\n- Optimized database queries\n- Session management ready for multiple users\n- Horizontal scaling supported\n\n### Compliance Ready\n- FERPA-compliant data protection\n- User data isolation\n- Audit trail capabilities\n- Secure data export\n\n## ðŸ“ž Support Documentation\n\nComplete documentation provided:\n- **README.md** - Overview and quick start\n- **DEPLOYMENT.md** - Step-by-step deployment guide\n- **SECURITY.md** - Security configuration details\n- **PRODUCTION_CHECKLIST.md** - Pre-launch verification\n\n## ðŸš€ Next Steps\n\n1. **Copy application files** to your production server\n2. **Follow DEPLOYMENT.md** for step-by-step setup\n3. **Configure environment** using .env.example\n4. **Run production build** with `npm run build && npm start`\n5. **Test all features** before going live\n\nYour application is now production-ready with enterprise-grade security, comprehensive features, and professional documentation. It's ready to handle real-world special education data collection and reporting needs.","path":null,"size_bytes":4371,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1858,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"server/storage.ts":{"content":"import {\n  users,\n  students,\n  goals,\n  objectives,\n  dataPoints,\n  reportingPeriods,\n  sessions,\n  type User,\n  type UpsertUser,\n  type Student,\n  type InsertStudent,\n  type Goal,\n  type InsertGoal,\n  type Objective,\n  type InsertObjective,\n  type DataPoint,\n  type InsertDataPoint,\n  type ReportingPeriod,\n  type InsertReportingPeriod,\n  type PaginationParams,\n  type PaginatedResponse,\n  type BatchCreateResult,\n  type BatchDeleteResult,\n  DEFAULT_PAGE_SIZE,\n  MAX_PAGE_SIZE,\n  DEFAULT_BATCH_SIZE,\n  insertDataPointSchema,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, sql, and, inArray, asc, isNull, count } from \"drizzle-orm\";\nimport { \n  withDatabaseErrorHandling, \n  DatabaseError, \n  DatabaseErrorType,\n  logDatabaseError,\n  logDatabaseWarning,\n  logDatabaseInfo \n} from \"./dbUtils\";\n\nexport interface IStorage {\n  // User operations (mandatory for Replit Auth)\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  \n  // Student operations\n  getStudentsByUserId(userId: string): Promise<Student[]>;\n  createStudent(student: InsertStudent): Promise<Student>;\n  getStudentById(id: number): Promise<Student | undefined>;\n  updateStudent(id: number, student: Partial<InsertStudent>): Promise<Student>;\n  deleteStudent(id: number): Promise<void>;\n  \n  // Goal operations\n  getGoalsByStudentId(studentId: number): Promise<Goal[]>;\n  createGoal(goal: InsertGoal): Promise<Goal>;\n  getGoalById(id: number): Promise<Goal | undefined>;\n  updateGoal(id: number, goal: Partial<InsertGoal>): Promise<Goal>;\n  deleteGoal(id: number): Promise<void>;\n  \n  // Data point operations\n  getDataPointsByGoalId(goalId: number): Promise<DataPoint[]>;\n  getDataPointsByObjectiveId(objectiveId: number): Promise<DataPoint[]>;\n  getDataPointsByStudentId(studentId: number): Promise<DataPoint[]>;\n  createDataPoint(dataPoint: InsertDataPoint): Promise<DataPoint>;\n  getDataPointById(id: number): Promise<DataPoint | undefined>;\n  updateDataPoint(id: number, dataPoint: Partial<InsertDataPoint>): Promise<DataPoint>;\n  deleteDataPoint(id: number): Promise<void>;\n  \n  // Analytics operations\n  getStudentSummary(studentId: number): Promise<{\n    totalGoals: number;\n    activeGoals: number;\n    completedGoals: number;\n    totalDataPoints: number;\n    lastDataPoint?: DataPoint;\n  }>;\n  getGoalProgress(goalId: number): Promise<{\n    goal: Goal;\n    dataPoints: DataPoint[];\n    currentProgress: number;\n    averageScore: number;\n    trend: number;\n    lastScore: number;\n  }>;\n  \n  getObjectiveProgress(objectiveId: number): Promise<{\n    objective: Objective;\n    dataPoints: DataPoint[];\n    currentProgress: number;\n    averageScore: number;\n    trend: number;\n    lastScore: number;\n    dataPointsCount: number;\n  }>;\n  \n  // Reporting periods operations\n  getReportingPeriodsByUserId(userId: string): Promise<ReportingPeriod[]>;\n  saveReportingPeriods(userId: string, periods: { periodNumber: number; startDate: string; endDate: string; }[], periodLength: string): Promise<void>;\n  deleteReportingPeriodsByUserId(userId: string): Promise<void>;\n  \n  // Admin operations\n  getAllUsers(): Promise<User[]>;\n  getAllStudents(): Promise<Student[]>;\n  getAllGoals(): Promise<Goal[]>;\n  getAllDataPoints(): Promise<DataPoint[]>;\n  deleteUser(userId: string): Promise<void>;\n  getDatabaseSchema(): Promise<any>;\n  getAllStudentsWithDetails(): Promise<any[]>;\n  getAllGoalsWithDetails(): Promise<any[]>;\n  getAllSessions(): Promise<any[]>;\n  getAllReportingPeriods(): Promise<any[]>;\n  getAllObjectives(): Promise<any[]>;\n  \n  // Paginated operations\n  getDataPointsByGoalIdPaginated(goalId: number, params: { page?: number; limit?: number }): Promise<{\n    data: DataPoint[];\n    total: number;\n    page: number;\n    limit: number;\n    totalPages: number;\n  }>;\n  getDataPointsByStudentIdPaginated(studentId: number, params: { page?: number; limit?: number }): Promise<{\n    data: DataPoint[];\n    total: number;\n    page: number;\n    limit: number;\n    totalPages: number;\n  }>;\n  \n  // Batch operations\n  createDataPointsBatch(dataPoints: InsertDataPoint[]): Promise<DataPoint[]>;\n  deleteDataPointsBatch(ids: number[]): Promise<{ deletedCount: number }>;\n  deleteDataPointsByGoalId(goalId: number): Promise<{ deletedCount: number }>;\n  \n  // Admin verification operations\n  verifyUserData(userId: string): Promise<{\n    userId: string;\n    userExists: boolean;\n    studentCount: number;\n    goalCount: number;\n    dataPointCount: number;\n    sampleStudents: any[];\n    dataIntegrity: {\n      orphanedGoals: number;\n      orphanedDataPoints: number;\n      studentsWithoutGoals: number;\n      goalsWithoutDataPoints: number;\n    };\n  }>;\n  verifyStudentData(studentId: number): Promise<{\n    studentId: number;\n    studentExists: boolean;\n    student?: Student;\n    goalCount: number;\n    dataPointCount: number;\n    goals: Goal[];\n    recentDataPoints: DataPoint[];\n    progressSummary: any;\n  }>;\n  verifyGoalData(goalId: number): Promise<{\n    goalId: number;\n    goalExists: boolean;\n    goal?: Goal;\n    student?: Student;\n    dataPointCount: number;\n    dataPoints: DataPoint[];\n    progressCalculation: any;\n  }>;\n  getSampleUserData(userId: string): Promise<{\n    user?: User;\n    sampleStudents: any[];\n    sampleGoals: any[];\n    sampleDataPoints: any[];\n    summary: any;\n  }>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User operations\n  async getUser(id: string): Promise<User | undefined> {\n    return withDatabaseErrorHandling(\"getUser\", async () => {\n      const [user] = await db.select().from(users).where(eq(users.id, id));\n      return user;\n    }, { context: { userId: id } });\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    return withDatabaseErrorHandling(\"upsertUser\", async () => {\n      const [user] = await db\n        .insert(users)\n        .values(userData)\n        .onConflictDoUpdate({\n          target: users.id,\n          set: {\n            ...userData,\n            updatedAt: new Date(),\n          },\n        })\n        .returning();\n      return user;\n    }, { context: { userId: userData.id } });\n  }\n\n  // Student operations\n  async getStudentsByUserId(userId: string): Promise<Student[]> {\n    return withDatabaseErrorHandling(\"getStudentsByUserId\", async () => {\n      const result = await db\n        .select()\n        .from(students)\n        .where(eq(students.userId, userId))\n        .orderBy(asc(students.name));\n      return result;\n    }, { context: { userId } });\n  }\n\n  async createStudent(student: InsertStudent): Promise<Student> {\n    return withDatabaseErrorHandling(\"createStudent\", async () => {\n      const [newStudent] = await db\n        .insert(students)\n        .values(student)\n        .returning();\n      return newStudent;\n    }, { context: { studentName: student.name } });\n  }\n\n  async getStudentById(id: number): Promise<Student | undefined> {\n    return withDatabaseErrorHandling(\"getStudentById\", async () => {\n      const [student] = await db\n        .select()\n        .from(students)\n        .where(eq(students.id, id));\n      return student;\n    }, { context: { studentId: id } });\n  }\n\n  async updateStudent(id: number, student: Partial<InsertStudent>): Promise<Student> {\n    return withDatabaseErrorHandling(\"updateStudent\", async () => {\n      const [updatedStudent] = await db\n        .update(students)\n        .set({ ...student, updatedAt: new Date() })\n        .where(eq(students.id, id))\n        .returning();\n      return updatedStudent;\n    }, { context: { studentId: id } });\n  }\n\n  async deleteStudent(id: number): Promise<void> {\n    return withDatabaseErrorHandling(\"deleteStudent\", async () => {\n      await db.delete(students).where(eq(students.id, id));\n    }, { context: { studentId: id } });\n  }\n\n  // Goal operations\n  async getGoalsByStudentId(studentId: number): Promise<Goal[]> {\n    return withDatabaseErrorHandling(\"getGoalsByStudentId\", async () => {\n      return await db\n        .select()\n        .from(goals)\n        .where(eq(goals.studentId, studentId))\n        .orderBy(desc(goals.createdAt));\n    }, { context: { studentId } });\n  }\n\n  async createGoal(goal: InsertGoal): Promise<Goal> {\n    return withDatabaseErrorHandling(\"createGoal\", async () => {\n      const [newGoal] = await db\n        .insert(goals)\n        .values(goal)\n        .returning();\n      return newGoal;\n    }, { context: { studentId: goal.studentId, title: goal.title } });\n  }\n\n  async getGoalById(id: number): Promise<Goal | undefined> {\n    return withDatabaseErrorHandling(\"getGoalById\", async () => {\n      const [goal] = await db\n        .select()\n        .from(goals)\n        .where(eq(goals.id, id));\n      return goal;\n    }, { context: { goalId: id } });\n  }\n\n  async updateGoal(id: number, goal: Partial<InsertGoal>): Promise<Goal> {\n    return withDatabaseErrorHandling(\"updateGoal\", async () => {\n      const [updatedGoal] = await db\n        .update(goals)\n        .set({ ...goal, updatedAt: new Date() })\n        .where(eq(goals.id, id))\n        .returning();\n      return updatedGoal;\n    }, { context: { goalId: id } });\n  }\n\n  async deleteGoal(id: number): Promise<void> {\n    return withDatabaseErrorHandling(\"deleteGoal\", async () => {\n      await db.transaction(async (tx) => {\n        await tx.delete(dataPoints).where(eq(dataPoints.goalId, id));\n        await tx.delete(objectives).where(eq(objectives.goalId, id));\n        await tx.delete(goals).where(eq(goals.id, id));\n      });\n    }, { context: { goalId: id } });\n  }\n\n  // Data point operations\n  async getDataPointsByGoalId(goalId: number): Promise<DataPoint[]> {\n    return withDatabaseErrorHandling(\"getDataPointsByGoalId\", async () => {\n      const rawDataPoints = await db\n        .select()\n        .from(dataPoints)\n        .where(and(eq(dataPoints.goalId, goalId), isNull(dataPoints.objectiveId)))\n        .orderBy(desc(dataPoints.date));\n      \n      return rawDataPoints.map(dp => ({\n        ...dp,\n        levelOfSupport: dp.levelOfSupport || null\n      }));\n    }, { context: { goalId } });\n  }\n\n  async getDataPointsByObjectiveId(objectiveId: number): Promise<DataPoint[]> {\n    return withDatabaseErrorHandling(\"getDataPointsByObjectiveId\", async () => {\n      const rawDataPoints = await db\n        .select()\n        .from(dataPoints)\n        .where(eq(dataPoints.objectiveId, objectiveId))\n        .orderBy(desc(dataPoints.date));\n      \n      return rawDataPoints.map(dp => ({\n        ...dp,\n        levelOfSupport: dp.levelOfSupport || null\n      }));\n    }, { context: { objectiveId } });\n  }\n\n  async createDataPoint(dataPoint: InsertDataPoint): Promise<DataPoint> {\n    return withDatabaseErrorHandling(\"createDataPoint\", async () => {\n      const [newDataPoint] = await db\n        .insert(dataPoints)\n        .values(dataPoint)\n        .returning();\n      return newDataPoint;\n    }, { context: { goalId: dataPoint.goalId, studentId: dataPoint.studentId } });\n  }\n\n  async getDataPointsByStudentId(studentId: number): Promise<DataPoint[]> {\n    return withDatabaseErrorHandling(\"getDataPointsByStudentId\", async () => {\n      return await db\n        .select()\n        .from(dataPoints)\n        .where(eq(dataPoints.studentId, studentId))\n        .orderBy(desc(dataPoints.date));\n    }, { context: { studentId } });\n  }\n\n  async getAllDataPointsForGoalWithObjectives(goalId: number): Promise<Array<DataPoint & { \n    objectiveDescription?: string | null;\n    isObjectiveSpecific: boolean;\n  }>> {\n    return withDatabaseErrorHandling(\"getAllDataPointsForGoalWithObjectives\", async () => {\n      const allGoalDataPoints = await db\n        .select()\n        .from(dataPoints)\n        .where(eq(dataPoints.goalId, goalId))\n        .orderBy(desc(dataPoints.date));\n\n      const goalObjectives = await db\n        .select()\n        .from(objectives)\n        .where(eq(objectives.goalId, goalId));\n\n      const objectiveMap = new Map(goalObjectives.map(obj => [obj.id, obj]));\n\n      return allGoalDataPoints.map(dp => {\n        const objective = dp.objectiveId ? objectiveMap.get(dp.objectiveId) : null;\n        return {\n          ...dp,\n          levelOfSupport: dp.levelOfSupport || null,\n          objectiveDescription: objective?.description || null,\n          isObjectiveSpecific: !!dp.objectiveId,\n        };\n      });\n    }, { context: { goalId } });\n  }\n\n  async getDataPointById(id: number): Promise<DataPoint | undefined> {\n    return withDatabaseErrorHandling(\"getDataPointById\", async () => {\n      const [dataPoint] = await db\n        .select()\n        .from(dataPoints)\n        .where(eq(dataPoints.id, id));\n      return dataPoint;\n    }, { context: { dataPointId: id } });\n  }\n\n  async updateDataPoint(id: number, dataPoint: Partial<InsertDataPoint>): Promise<DataPoint> {\n    return withDatabaseErrorHandling(\"updateDataPoint\", async () => {\n      const [updatedDataPoint] = await db\n        .update(dataPoints)\n        .set(dataPoint)\n        .where(eq(dataPoints.id, id))\n        .returning();\n      return updatedDataPoint;\n    }, { context: { dataPointId: id } });\n  }\n\n  async deleteDataPoint(id: number): Promise<void> {\n    return withDatabaseErrorHandling(\"deleteDataPoint\", async () => {\n      await db.delete(dataPoints).where(eq(dataPoints.id, id));\n    }, { context: { dataPointId: id } });\n  }\n\n  // Paginated data point operations\n  async getDataPointsByGoalIdPaginated(\n    goalId: number, \n    params: { page?: number; limit?: number }\n  ): Promise<{ data: DataPoint[]; total: number; page: number; limit: number; totalPages: number }> {\n    return withDatabaseErrorHandling(\"getDataPointsByGoalIdPaginated\", async () => {\n      const page = Math.max(1, params.page || 1);\n      const limit = Math.min(100, Math.max(1, params.limit || 50));\n      const offset = (page - 1) * limit;\n      \n      const [countResult] = await db\n        .select({ count: sql<number>`count(*)::int` })\n        .from(dataPoints)\n        .where(eq(dataPoints.goalId, goalId));\n      \n      const total = countResult?.count || 0;\n      const totalPages = Math.ceil(total / limit);\n      \n      const data = await db\n        .select()\n        .from(dataPoints)\n        .where(eq(dataPoints.goalId, goalId))\n        .orderBy(desc(dataPoints.date))\n        .limit(limit)\n        .offset(offset);\n      \n      return { data, total, page, limit, totalPages };\n    }, { context: { goalId, page: params.page, limit: params.limit } });\n  }\n\n  async getDataPointsByStudentIdPaginated(\n    studentId: number,\n    params: { page?: number; limit?: number }\n  ): Promise<{ data: DataPoint[]; total: number; page: number; limit: number; totalPages: number }> {\n    return withDatabaseErrorHandling(\"getDataPointsByStudentIdPaginated\", async () => {\n      const page = Math.max(1, params.page || 1);\n      const limit = Math.min(100, Math.max(1, params.limit || 50));\n      const offset = (page - 1) * limit;\n      \n      const [countResult] = await db\n        .select({ count: sql<number>`count(*)::int` })\n        .from(dataPoints)\n        .where(eq(dataPoints.studentId, studentId));\n      \n      const total = countResult?.count || 0;\n      const totalPages = Math.ceil(total / limit);\n      \n      const data = await db\n        .select()\n        .from(dataPoints)\n        .where(eq(dataPoints.studentId, studentId))\n        .orderBy(desc(dataPoints.date))\n        .limit(limit)\n        .offset(offset);\n      \n      return { data, total, page, limit, totalPages };\n    }, { context: { studentId, page: params.page, limit: params.limit } });\n  }\n\n  // Batch operations for data points\n  async createDataPointsBatch(dataPointsToCreate: InsertDataPoint[]): Promise<DataPoint[]> {\n    return withDatabaseErrorHandling(\"createDataPointsBatch\", async () => {\n      if (dataPointsToCreate.length === 0) {\n        return [];\n      }\n      \n      if (dataPointsToCreate.length > 100) {\n        throw new Error(\"Batch size cannot exceed 100 data points\");\n      }\n      \n      const createdDataPoints = await db\n        .insert(dataPoints)\n        .values(dataPointsToCreate)\n        .returning();\n      \n      return createdDataPoints;\n    }, { context: { batchSize: dataPointsToCreate.length } });\n  }\n\n  async deleteDataPointsBatch(ids: number[]): Promise<{ deletedCount: number }> {\n    return withDatabaseErrorHandling(\"deleteDataPointsBatch\", async () => {\n      if (ids.length === 0) {\n        return { deletedCount: 0 };\n      }\n      \n      if (ids.length > 100) {\n        throw new Error(\"Batch size cannot exceed 100 deletions\");\n      }\n      \n      const result = await db\n        .delete(dataPoints)\n        .where(inArray(dataPoints.id, ids))\n        .returning({ id: dataPoints.id });\n      \n      return { deletedCount: result.length };\n    }, { context: { batchSize: ids.length } });\n  }\n\n  async deleteDataPointsByGoalId(goalId: number): Promise<{ deletedCount: number }> {\n    return withDatabaseErrorHandling(\"deleteDataPointsByGoalId\", async () => {\n      const result = await db\n        .delete(dataPoints)\n        .where(eq(dataPoints.goalId, goalId))\n        .returning({ id: dataPoints.id });\n      \n      return { deletedCount: result.length };\n    }, { context: { goalId } });\n  }\n\n  // Clear data operations\n  async clearStudentData(studentId: number): Promise<void> {\n    return withDatabaseErrorHandling(\"clearStudentData\", async () => {\n      await db.transaction(async (tx) => {\n        await tx.delete(dataPoints).where(eq(dataPoints.studentId, studentId));\n        await tx.delete(objectives).where(eq(objectives.studentId, studentId));\n        await tx.delete(goals).where(eq(goals.studentId, studentId));\n      });\n    }, { context: { studentId } });\n  }\n\n  async removeStudentFromCaseload(studentId: number): Promise<void> {\n    return withDatabaseErrorHandling(\"removeStudentFromCaseload\", async () => {\n      await db.transaction(async (tx) => {\n        await tx.delete(dataPoints).where(eq(dataPoints.studentId, studentId));\n        await tx.delete(objectives).where(eq(objectives.studentId, studentId));\n        await tx.delete(goals).where(eq(goals.studentId, studentId));\n        await tx.delete(students).where(eq(students.id, studentId));\n      });\n    }, { context: { studentId } });\n  }\n\n  async clearAllUserData(userId: string): Promise<void> {\n    return withDatabaseErrorHandling(\"clearAllUserData\", async () => {\n      const userStudents = await db\n        .select({ id: students.id })\n        .from(students)\n        .where(eq(students.userId, userId));\n      \n      const studentIds = userStudents.map(s => s.id);\n      \n      await db.transaction(async (tx) => {\n        if (studentIds.length > 0) {\n          await tx.delete(dataPoints).where(inArray(dataPoints.studentId, studentIds));\n          await tx.delete(objectives).where(inArray(objectives.studentId, studentIds));\n          await tx.delete(goals).where(inArray(goals.studentId, studentIds));\n        }\n        await tx.delete(students).where(eq(students.userId, userId));\n        await tx.delete(reportingPeriods).where(eq(reportingPeriods.userId, userId));\n      });\n    }, { context: { userId } });\n  }\n\n  // Analytics operations\n  async getStudentSummary(studentId: number): Promise<{\n    totalGoals: number;\n    activeGoals: number;\n    completedGoals: number;\n    totalDataPoints: number;\n    lastDataPoint?: DataPoint;\n  }> {\n    return withDatabaseErrorHandling(\"getStudentSummary\", async () => {\n      const studentGoals = await db\n        .select()\n        .from(goals)\n        .where(eq(goals.studentId, studentId));\n\n      const totalGoals = studentGoals.length;\n      const activeGoals = studentGoals.filter(g => g.status === 'active').length;\n      const completedGoals = studentGoals.filter(g => g.status === 'mastered').length;\n\n      const goalIds = studentGoals.map(g => g.id);\n      \n      if (goalIds.length === 0) {\n        return {\n          totalGoals: 0,\n          activeGoals: 0,\n          completedGoals: 0,\n          totalDataPoints: 0,\n        };\n      }\n\n      const allDataPoints = await db\n        .select()\n        .from(dataPoints)\n        .where(inArray(dataPoints.goalId, goalIds))\n        .orderBy(desc(dataPoints.date));\n\n      const lastDataPoint = allDataPoints[0];\n\n      return {\n        totalGoals,\n        activeGoals,\n        completedGoals,\n        totalDataPoints: allDataPoints.length,\n        lastDataPoint,\n      };\n    }, { context: { studentId } });\n  }\n\n  async getGoalProgress(goalId: number): Promise<{\n    goal: Goal;\n    dataPoints: DataPoint[];\n    currentProgress: number;\n    averageScore: number;\n    trend: number;\n    lastScore: number;\n  }> {\n    const goal = await this.getGoalById(goalId);\n    if (!goal) {\n      throw new Error('Goal not found');\n    }\n\n    const dataPointsList = await this.getDataPointsByGoalId(goalId);\n    \n    if (dataPointsList.length === 0) {\n      return {\n        goal,\n        dataPoints: [],\n        currentProgress: 0,\n        averageScore: 0,\n        trend: 0,\n        lastScore: 0,\n      };\n    }\n\n    // Calculate progress based on data collection type\n    const scores = dataPointsList.map(dp => {\n      const value = parseFloat(dp.progressValue.toString());\n      \n      // Convert different formats to percentage for consistent display\n      switch (dp.progressFormat) {\n        case 'percentage':\n          return value; // Already in percentage format\n        case 'frequency':\n          // For frequency, calculate percentage based on numerator/denominator\n          if (dp.denominator && dp.denominator > 0) {\n            return (dp.numerator || 0) / dp.denominator * 100;\n          }\n          return value;\n        case 'duration':\n          // For duration, normalize to percentage (you may need to adjust this based on target criteria)\n          // For now, treat duration values as percentages if no specific target is defined\n          return value;\n        default:\n          return value;\n      }\n    });\n\n    const averageScore = scores.length > 0 ? scores.reduce((sum, score) => sum + score, 0) / scores.length : 0;\n    const lastScore = scores.length > 0 ? scores[0] : 0; // dataPoints are ordered by date desc\n    const currentProgress = lastScore;\n\n    // Calculate trend (compare last 3 vs previous 3 data points)\n    let trend = 0;\n    if (scores.length >= 6) {\n      const recent3 = scores.slice(0, 3);\n      const previous3 = scores.slice(3, 6);\n      const recentAvg = recent3.reduce((sum, score) => sum + score, 0) / 3;\n      const previousAvg = previous3.reduce((sum, score) => sum + score, 0) / 3;\n      trend = recentAvg - previousAvg;\n    }\n\n    return {\n      goal,\n      dataPoints: dataPointsList,\n      currentProgress,\n      averageScore,\n      trend,\n      lastScore,\n    };\n  }\n\n  async getObjectiveProgress(objectiveId: number): Promise<{\n    objective: Objective;\n    dataPoints: DataPoint[];\n    currentProgress: number;\n    averageScore: number;\n    trend: number;\n    lastScore: number;\n    dataPointsCount: number;\n  }> {\n    const objective = await this.getObjectiveById(objectiveId);\n    if (!objective) {\n      throw new Error('Objective not found');\n    }\n\n    const dataPointsList = await this.getDataPointsByObjectiveId(objectiveId);\n    \n    if (dataPointsList.length === 0) {\n      return {\n        objective,\n        dataPoints: [],\n        currentProgress: 0,\n        averageScore: 0,\n        trend: 0,\n        lastScore: 0,\n        dataPointsCount: 0,\n      };\n    }\n\n    // Calculate progress based on data collection type (inherited from goal)\n    const goal = await this.getGoalById(objective.goalId);\n    const scores = dataPointsList.map(dp => {\n      const value = parseFloat(dp.progressValue.toString());\n      \n      // Convert different formats to percentage for consistent display\n      switch (dp.progressFormat) {\n        case 'percentage':\n          return value; // Already in percentage format\n        case 'frequency':\n          // For frequency, calculate percentage based on numerator/denominator\n          if (dp.denominator && dp.denominator > 0) {\n            return (dp.numerator || 0) / dp.denominator * 100;\n          }\n          return value;\n        case 'duration':\n          // For duration, normalize to percentage (you may need to adjust this based on target criteria)\n          // For now, treat duration values as percentages if no specific target is defined\n          return value;\n        default:\n          return value;\n      }\n    });\n\n    const averageScore = scores.length > 0 ? scores.reduce((sum, score) => sum + score, 0) / scores.length : 0;\n    const lastScore = scores.length > 0 ? scores[0] : 0; // dataPoints are ordered by date desc\n    const currentProgress = lastScore;\n\n    // Calculate trend (compare last 3 vs previous 3 data points)\n    let trend = 0;\n    if (scores.length >= 6) {\n      const recent3 = scores.slice(0, 3);\n      const previous3 = scores.slice(3, 6);\n      const recentAvg = recent3.reduce((sum, score) => sum + score, 0) / 3;\n      const previousAvg = previous3.reduce((sum, score) => sum + score, 0) / 3;\n      trend = recentAvg - previousAvg;\n    }\n\n    return {\n      objective,\n      dataPoints: dataPointsList,\n      currentProgress,\n      averageScore,\n      trend,\n      lastScore,\n      dataPointsCount: dataPointsList.length,\n    };\n  }\n\n  // Admin methods for database management\n  async getAllUsers(): Promise<User[]> {\n    return withDatabaseErrorHandling(\"getAllUsers\", async () => {\n      return await db.select().from(users);\n    });\n  }\n\n  async getAllStudents(): Promise<Student[]> {\n    return withDatabaseErrorHandling(\"getAllStudents\", async () => {\n      return await db.select().from(students);\n    });\n  }\n\n  async getAllStudentsWithDetails(): Promise<any[]> {\n    return withDatabaseErrorHandling(\"getAllStudentsWithDetails\", async () => {\n      const [allStudents, allUsers, allGoals, allDataPoints] = await Promise.all([\n        db.select().from(students),\n        db.select().from(users),\n        db.select().from(goals),\n        db.select().from(dataPoints),\n      ]);\n\n      const userMap = new Map(allUsers.map(u => [u.id, u]));\n      const goalsByStudent = new Map<number, typeof allGoals>();\n      const dataPointsByGoal = new Map<number, typeof allDataPoints>();\n\n      for (const goal of allGoals) {\n        if (!goalsByStudent.has(goal.studentId)) {\n          goalsByStudent.set(goal.studentId, []);\n        }\n        goalsByStudent.get(goal.studentId)!.push(goal);\n      }\n\n      for (const dp of allDataPoints) {\n        if (!dataPointsByGoal.has(dp.goalId)) {\n          dataPointsByGoal.set(dp.goalId, []);\n        }\n        dataPointsByGoal.get(dp.goalId)!.push(dp);\n      }\n\n      return allStudents.map(student => {\n        const studentGoals = goalsByStudent.get(student.id) || [];\n        const user = userMap.get(student.userId);\n        \n        const totalGoals = studentGoals.length;\n        const activeGoals = studentGoals.filter(g => g.status === 'active').length;\n        const completedGoals = studentGoals.filter(g => g.status === 'mastered').length;\n        \n        let totalDataPoints = 0;\n        let lastDataPoint: typeof allDataPoints[0] | undefined;\n        \n        for (const goal of studentGoals) {\n          const goalDps = dataPointsByGoal.get(goal.id) || [];\n          totalDataPoints += goalDps.length;\n          for (const dp of goalDps) {\n            if (!lastDataPoint || new Date(dp.date) > new Date(lastDataPoint.date)) {\n              lastDataPoint = dp;\n            }\n          }\n        }\n\n        return {\n          ...student,\n          totalGoals,\n          activeGoals,\n          completedGoals,\n          totalDataPoints,\n          lastDataPoint,\n          teacherEmail: user?.email,\n        };\n      });\n    });\n  }\n\n  async getAllGoalsWithDetails(): Promise<any[]> {\n    return withDatabaseErrorHandling(\"getAllGoalsWithDetails\", async () => {\n      const [allGoals, allStudents, allDataPoints] = await Promise.all([\n        db.select().from(goals),\n        db.select().from(students),\n        db.select().from(dataPoints),\n      ]);\n\n      const studentMap = new Map(allStudents.map(s => [s.id, s]));\n      const dataPointsByGoal = new Map<number, typeof allDataPoints>();\n\n      for (const dp of allDataPoints) {\n        if (!dataPointsByGoal.has(dp.goalId)) {\n          dataPointsByGoal.set(dp.goalId, []);\n        }\n        dataPointsByGoal.get(dp.goalId)!.push(dp);\n      }\n\n      return allGoals.map(goal => {\n        const student = studentMap.get(goal.studentId);\n        const goalDataPoints = dataPointsByGoal.get(goal.id) || [];\n        \n        let currentProgress = 0;\n        if (goalDataPoints.length > 0) {\n          const sortedDps = goalDataPoints.sort((a, b) => \n            new Date(b.date).getTime() - new Date(a.date).getTime()\n          );\n          currentProgress = parseFloat(sortedDps[0].progressValue?.toString() || '0');\n        }\n\n        return {\n          ...goal,\n          studentName: student?.name,\n          currentProgress,\n          dataPointsCount: goalDataPoints.length,\n        };\n      });\n    });\n  }\n\n  async getAllGoals(): Promise<Goal[]> {\n    return withDatabaseErrorHandling(\"getAllGoals\", async () => {\n      return await db.select().from(goals);\n    });\n  }\n\n  async getAllDataPoints(): Promise<DataPoint[]> {\n    return withDatabaseErrorHandling(\"getAllDataPoints\", async () => {\n      return await db.select().from(dataPoints);\n    });\n  }\n\n  async getAllSessions(): Promise<any[]> {\n    return withDatabaseErrorHandling(\"getAllSessions\", async () => {\n      return await db.select().from(sessions);\n    });\n  }\n\n  async getAllReportingPeriods(): Promise<any[]> {\n    return withDatabaseErrorHandling(\"getAllReportingPeriods\", async () => {\n      return await db.select().from(reportingPeriods);\n    });\n  }\n\n  async getAllObjectives(): Promise<any[]> {\n    return withDatabaseErrorHandling(\"getAllObjectives\", async () => {\n      return await db.select().from(objectives);\n    });\n  }\n\n  async deleteUser(userId: string): Promise<void> {\n    return withDatabaseErrorHandling(\"deleteUser\", async () => {\n      const userStudents = await this.getStudentsByUserId(userId);\n      for (const student of userStudents) {\n        await this.deleteStudent(student.id);\n      }\n      await db.delete(users).where(eq(users.id, userId));\n    }, { context: { userId } });\n  }\n\n  async getDatabaseSchema(): Promise<any> {\n    // Return schema information for admin view\n    return {\n      users: {\n        tableName: \"users\",\n        fields: [\n          { name: \"id\", type: \"varchar\", isPrimary: true },\n          { name: \"email\", type: \"varchar\", isUnique: true },\n          { name: \"firstName\", type: \"varchar\" },\n          { name: \"lastName\", type: \"varchar\" },\n          { name: \"profileImageUrl\", type: \"varchar\" },\n          { name: \"createdAt\", type: \"timestamp\" },\n          { name: \"updatedAt\", type: \"timestamp\" }\n        ]\n      },\n      students: {\n        tableName: \"students\",\n        fields: [\n          { name: \"id\", type: \"serial\", isPrimary: true },\n          { name: \"userId\", type: \"varchar\", isForeign: true, references: \"users.id\" },\n          { name: \"name\", type: \"varchar\" },\n          { name: \"grade\", type: \"varchar\" },\n          { name: \"createdAt\", type: \"timestamp\" },\n          { name: \"updatedAt\", type: \"timestamp\" }\n        ]\n      },\n      goals: {\n        tableName: \"goals\",\n        fields: [\n          { name: \"id\", type: \"serial\", isPrimary: true },\n          { name: \"studentId\", type: \"integer\", isForeign: true, references: \"students.id\" },\n          { name: \"title\", type: \"varchar\" },\n          { name: \"description\", type: \"text\" },\n          { name: \"targetCriteria\", type: \"text\" },\n          { name: \"levelOfSupport\", type: \"varchar\" },\n          { name: \"status\", type: \"varchar\" },\n          { name: \"createdAt\", type: \"timestamp\" },\n          { name: \"updatedAt\", type: \"timestamp\" }\n        ]\n      },\n      data_points: {\n        tableName: \"data_points\",\n        fields: [\n          { name: \"id\", type: \"serial\", isPrimary: true },\n          { name: \"goalId\", type: \"integer\", isForeign: true, references: \"goals.id\" },\n          { name: \"value\", type: \"decimal\" },\n          { name: \"notes\", type: \"text\" },\n          { name: \"levelOfSupport\", type: \"text\" },\n          { name: \"durationUnit\", type: \"varchar\" },\n          { name: \"date\", type: \"timestamp\" },\n          { name: \"createdAt\", type: \"timestamp\" }\n        ]\n      },\n      reporting_periods: {\n        tableName: \"reporting_periods\",\n        fields: [\n          { name: \"id\", type: \"serial\", isPrimary: true },\n          { name: \"userId\", type: \"varchar\", isForeign: true, references: \"users.id\" },\n          { name: \"periodNumber\", type: \"integer\" },\n          { name: \"startDate\", type: \"varchar\" },\n          { name: \"endDate\", type: \"varchar\" },\n          { name: \"periodLength\", type: \"varchar\" },\n          { name: \"createdAt\", type: \"timestamp\" }\n        ]\n      },\n      objectives: {\n        tableName: \"objectives\",\n        fields: [\n          { name: \"id\", type: \"serial\", isPrimary: true },\n          { name: \"goalId\", type: \"integer\", isForeign: true, references: \"goals.id\" },\n          { name: \"title\", type: \"varchar\" },\n          { name: \"description\", type: \"text\" },\n          { name: \"targetCriteria\", type: \"text\" },\n          { name: \"status\", type: \"varchar\" },\n          { name: \"createdAt\", type: \"timestamp\" },\n          { name: \"updatedAt\", type: \"timestamp\" }\n        ]\n      },\n      sessions: {\n        tableName: \"sessions\",\n        fields: [\n          { name: \"sid\", type: \"varchar\", isPrimary: true },\n          { name: \"sess\", type: \"jsonb\" },\n          { name: \"expire\", type: \"timestamp\" }\n        ]\n      }\n    };\n  }\n\n  // Reporting periods operations\n  async getReportingPeriodsByUserId(userId: string): Promise<ReportingPeriod[]> {\n    return withDatabaseErrorHandling(\"getReportingPeriodsByUserId\", async () => {\n      const periods = await db\n        .select()\n        .from(reportingPeriods)\n        .where(eq(reportingPeriods.userId, userId))\n        .orderBy(asc(reportingPeriods.periodNumber));\n      \n      return periods;\n    }, { context: { userId } });\n  }\n\n  async saveReportingPeriods(\n    userId: string, \n    periods: { periodNumber: number; startDate: string; endDate: string; }[], \n    periodLength: string\n  ): Promise<void> {\n    return withDatabaseErrorHandling(\"saveReportingPeriods\", async () => {\n      await this.deleteReportingPeriodsByUserId(userId);\n      \n      if (periods.length > 0) {\n        const periodsToInsert = periods.map(period => ({\n          userId,\n          periodLength,\n          periodNumber: period.periodNumber,\n          startDate: period.startDate,\n          endDate: period.endDate,\n        }));\n        await db.insert(reportingPeriods).values(periodsToInsert);\n      }\n    }, { context: { userId, periodsCount: periods.length } });\n  }\n\n  async deleteReportingPeriodsByUserId(userId: string): Promise<void> {\n    return withDatabaseErrorHandling(\"deleteReportingPeriodsByUserId\", async () => {\n      await db.delete(reportingPeriods).where(eq(reportingPeriods.userId, userId));\n    }, { context: { userId } });\n  }\n\n  // Objectives operations\n  async getObjectivesByGoalId(goalId: number): Promise<Objective[]> {\n    return withDatabaseErrorHandling(\"getObjectivesByGoalId\", async () => {\n      return await db\n        .select()\n        .from(objectives)\n        .where(eq(objectives.goalId, goalId))\n        .orderBy(asc(objectives.id));\n    }, { context: { goalId } });\n  }\n\n  async createObjective(objective: InsertObjective): Promise<Objective> {\n    return withDatabaseErrorHandling(\"createObjective\", async () => {\n      const [newObjective] = await db\n        .insert(objectives)\n        .values(objective)\n        .returning();\n      return newObjective;\n    }, { context: { goalId: objective.goalId } });\n  }\n\n  async getObjectivesByStudentId(studentId: number): Promise<Objective[]> {\n    return withDatabaseErrorHandling(\"getObjectivesByStudentId\", async () => {\n      return await db\n        .select()\n        .from(objectives)\n        .where(eq(objectives.studentId, studentId))\n        .orderBy(asc(objectives.goalId), asc(objectives.id));\n    }, { context: { studentId } });\n  }\n\n  async updateObjective(id: number, objective: Partial<InsertObjective>): Promise<Objective> {\n    return withDatabaseErrorHandling(\"updateObjective\", async () => {\n      const [updatedObjective] = await db\n        .update(objectives)\n        .set({ ...objective, updatedAt: new Date() })\n        .where(eq(objectives.id, id))\n        .returning();\n      return updatedObjective;\n    }, { context: { objectiveId: id } });\n  }\n\n  async deleteObjective(id: number): Promise<void> {\n    return withDatabaseErrorHandling(\"deleteObjective\", async () => {\n      await db.delete(objectives).where(eq(objectives.id, id));\n    }, { context: { objectiveId: id } });\n  }\n\n  async getObjectiveById(id: number): Promise<Objective | undefined> {\n    return withDatabaseErrorHandling(\"getObjectiveById\", async () => {\n      const [objective] = await db\n        .select()\n        .from(objectives)\n        .where(eq(objectives.id, id));\n      return objective;\n    }, { context: { objectiveId: id } });\n  }\n\n  // Admin verification methods\n  async verifyUserData(userId: string) {\n    return withDatabaseErrorHandling(\"verifyUserData\", async () => {\n      const [user, userStudents] = await Promise.all([\n        this.getUser(userId),\n        db.select().from(students).where(eq(students.userId, userId))\n      ]);\n      \n      const combinedCounts = await db.execute(sql`\n        SELECT \n          (SELECT COUNT(g.id) FROM goals g JOIN students s ON g.student_id = s.id WHERE s.user_id = ${userId}) as goal_count,\n          (SELECT COUNT(dp.id) FROM data_points dp JOIN students s ON dp.student_id = s.id WHERE s.user_id = ${userId}) as data_point_count,\n          (SELECT COUNT(*) FROM goals g LEFT JOIN students s ON g.student_id = s.id WHERE s.id IS NULL) as orphaned_goals,\n          (SELECT COUNT(*) FROM data_points dp LEFT JOIN goals g ON dp.goal_id = g.id WHERE g.id IS NULL) as orphaned_data_points,\n          (SELECT COUNT(*) FROM students s LEFT JOIN goals g ON s.id = g.student_id WHERE s.user_id = ${userId} AND g.id IS NULL) as students_without_goals,\n          (SELECT COUNT(*) FROM goals g JOIN students s ON g.student_id = s.id LEFT JOIN data_points dp ON g.id = dp.goal_id WHERE s.user_id = ${userId} AND dp.id IS NULL) as goals_without_data_points\n      `);\n\n      const counts = combinedCounts.rows[0] || {};\n\n      return {\n        userId,\n        userExists: !!user,\n        studentCount: userStudents.length,\n        goalCount: Number(counts.goal_count || 0),\n        dataPointCount: Number(counts.data_point_count || 0),\n        sampleStudents: userStudents.slice(0, 5),\n        dataIntegrity: {\n          orphanedGoals: Number(counts.orphaned_goals || 0),\n          orphanedDataPoints: Number(counts.orphaned_data_points || 0),\n          studentsWithoutGoals: Number(counts.students_without_goals || 0),\n          goalsWithoutDataPoints: Number(counts.goals_without_data_points || 0),\n        }\n      };\n    }, { context: { userId } });\n  }\n\n  async verifyStudentData(studentId: number) {\n    return withDatabaseErrorHandling(\"verifyStudentData\", async () => {\n      const student = await this.getStudentById(studentId);\n      const studentGoals = student ? await this.getGoalsByStudentId(studentId) : [];\n      const studentDataPoints = student ? await this.getDataPointsByStudentId(studentId) : [];\n      const summary = student ? await this.getStudentSummary(studentId) : null;\n\n      return {\n        studentId,\n        studentExists: !!student,\n        student,\n        goalCount: studentGoals.length,\n        dataPointCount: studentDataPoints.length,\n        goals: studentGoals,\n        recentDataPoints: studentDataPoints.slice(0, 10),\n        progressSummary: summary\n      };\n    }, { context: { studentId } });\n  }\n\n  async verifyGoalData(goalId: number) {\n    return withDatabaseErrorHandling(\"verifyGoalData\", async () => {\n      const goal = await this.getGoalById(goalId);\n      const student = goal ? await this.getStudentById(goal.studentId) : undefined;\n      const goalDataPoints = goal ? await this.getDataPointsByGoalId(goalId) : [];\n      const progress = goal ? await this.getGoalProgress(goalId) : null;\n\n      return {\n        goalId,\n        goalExists: !!goal,\n        goal,\n        student,\n        dataPointCount: goalDataPoints.length,\n        dataPoints: goalDataPoints,\n        progressCalculation: progress\n      };\n    }, { context: { goalId } });\n  }\n\n  async getSampleUserData(userId: string) {\n    return withDatabaseErrorHandling(\"getSampleUserData\", async () => {\n      const user = await this.getUser(userId);\n      const studentsData = user ? await db.select().from(students).where(eq(students.userId, userId)).limit(5) : [];\n      \n      const goalsData = studentsData.length > 0 ? await db.select().from(goals)\n        .where(inArray(goals.studentId, studentsData.map((s: any) => s.id)))\n        .limit(10) : [];\n      \n      const dataPointsData = goalsData.length > 0 ? await db.select().from(dataPoints)\n        .where(inArray(dataPoints.goalId, goalsData.map((g: any) => g.id)))\n        .limit(20) : [];\n\n      const summary = {\n        totalStudents: studentsData.length,\n        totalGoals: goalsData.length,\n        totalDataPoints: dataPointsData.length,\n        dataTypes: goalsData.reduce((acc: any, g: any) => {\n          acc[g.dataCollectionType] = (acc[g.dataCollectionType] || 0) + 1;\n          return acc;\n        }, {})\n      };\n\n      return {\n        user,\n        sampleStudents: studentsData,\n        sampleGoals: goalsData,\n        sampleDataPoints: dataPointsData,\n        summary\n      };\n    }, { context: { userId } });\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":41859,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/pages/student-detail.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport React from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport type { students, goals, dataPoints } from \"@/../../shared/schema\";\n\ntype Student = typeof students.$inferSelect;\ntype Goal = typeof goals.$inferSelect;\ntype DataPoint = typeof dataPoints.$inferSelect;\nimport { ArrowLeft, Plus, Printer, ChartLine, Target, Edit, Table, BarChart3, RefreshCw, Timer, Zap, Trash2, UserX, FileText } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { GraduationCap } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport GoalProgressCard from \"@/components/goal-progress-card\";\nimport DataEntryForm from \"@/components/data-entry-form\";\nimport GoalChart from \"@/components/goal-chart\";\nimport AddGoalModal from \"@/components/add-goal-modal\";\nimport EditGoalModal from \"@/components/edit-goal-modal\";\nimport StudentInfoCard from \"@/components/student-info-card\";\nimport StudentScatterplot from \"@/components/student-scatterplot\";\nimport RawDataTable from \"@/components/raw-data-table\";\nimport LiveCollectionTools from \"@/components/live-collection-tools\";\nimport ObjectivesList from \"@/components/objectives-list\";\nimport ObjectiveChartsForGoal from \"@/components/objective-charts-for-goal\";\nimport { ClearDataModal } from \"@/components/clear-data-modal\";\nimport MasteryAlertPopup from \"@/components/mastery-alert-popup\";\n\nimport { format } from \"date-fns\";\nimport { PDFGenerator, type PDFStudentData, type PDFGoalData, type PDFDataPoint } from \"@/lib/pdf-generator\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { ReportingPeriod, ReportingData, getCurrentReportingPeriod } from \"@/lib/utils\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nexport default function StudentDetail() {\n  const params = useParams();\n  const [, navigate] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const [isAddGoalModalOpen, setIsAddGoalModalOpen] = useState(false);\n  const [isEditGoalModalOpen, setIsEditGoalModalOpen] = useState(false);\n  const [isClearStudentDataModalOpen, setIsClearStudentDataModalOpen] = useState(false);\n  const [isRemoveStudentModalOpen, setIsRemoveStudentModalOpen] = useState(false);\n  const [selectedGoalId, setSelectedGoalId] = useState<number | null>(null);\n  const [selectedObjectiveId, setSelectedObjectiveId] = useState<number | null>(null);\n  const [editingGoal, setEditingGoal] = useState<any>(null);\n  const [deletingGoalId, setDeletingGoalId] = useState<number | null>(null);\n  const [selectedReportingPeriod, setSelectedReportingPeriod] = useState<ReportingPeriod | null>(null);\n\n  const studentId = params.id ? parseInt(params.id) : null;\n  \n\n\n  const { data: student, isLoading: studentLoading, error: studentError, refetch: refetchStudent } = useQuery<Student>({\n    queryKey: [`/api/students/${studentId}`],\n    enabled: !!studentId,\n    staleTime: 0, // Always fetch fresh data\n    refetchOnMount: 'always',\n  });\n\n  const { data: goals = [], isLoading: goalsLoading, error: goalsError, refetch: refetchGoals } = useQuery<Goal[]>({\n    queryKey: [`/api/students/${studentId}/goals`],\n    enabled: !!studentId,\n    staleTime: 0, // Always fetch fresh data\n    refetchOnMount: 'always',\n  });\n\n  const { data: dataPoints = [], isLoading: dataPointsLoading, refetch: refetchDataPoints } = useQuery<DataPoint[]>({\n    queryKey: [`/api/goals/${selectedGoalId}/data-points`],\n    enabled: !!selectedGoalId,\n  });\n\n  // Query for ALL data points for PDF generation\n  const { data: allDataPoints = [], isLoading: allDataPointsLoading, refetch: refetchAllDataPoints } = useQuery<DataPoint[]>({\n    queryKey: [`/api/students/${studentId}/all-data-points`],\n    enabled: !!studentId,\n    staleTime: 0,\n    refetchOnMount: 'always',\n  });\n\n  // Query for objectives of the selected goal\n  const { data: objectives = [], isLoading: objectivesLoading, refetch: refetchObjectives } = useQuery({\n    queryKey: [`/api/goals/${selectedGoalId}/objectives`],\n    enabled: !!selectedGoalId,\n    staleTime: 0,\n    refetchOnMount: 'always',\n  });\n\n  // Query for reporting periods data\n  const { data: reportingData } = useQuery<ReportingData>({\n    queryKey: ['/api/reporting-periods'],\n  });\n\n  // Set default selected reporting period to current period when reporting data loads\n  useEffect(() => {\n    if (reportingData && !selectedReportingPeriod) {\n      const currentPeriod = getCurrentReportingPeriod(reportingData);\n      setSelectedReportingPeriod(currentPeriod);\n    }\n  }, [reportingData, selectedReportingPeriod]);\n  \n\n\n  // Force refresh all data when component mounts to prevent cache issues\n  React.useEffect(() => {\n    if (studentId) {\n      queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/goals`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/all-data-points`] });\n    }\n  }, [studentId]);\n\n  // Mutation to delete goal\n  const deleteGoalMutation = useMutation({\n    mutationFn: (goalId: number) => apiRequest('DELETE', `/api/goals/${goalId}`),\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Goal deleted successfully!\",\n      });\n      queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/goals`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/all-data-points`] });\n      setDeletingGoalId(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete goal. Please try again.\",\n        variant: \"destructive\",\n      });\n      setDeletingGoalId(null);\n    },\n  });\n\n  // No auth handling needed in development mode\n\n  if (studentLoading) {\n    return (\n      <div className=\"min-h-screen bg-surface\">\n        <div className=\"flex items-center justify-center min-h-screen\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  if (studentError) {\n    return (\n      <div className=\"min-h-screen bg-surface flex items-center justify-center\">\n        <Card className=\"p-8 text-center\">\n          <CardContent>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Error Loading Student</h2>\n            <p className=\"text-gray-600 mb-4\">There was an error loading the student data: {studentError.message}</p>\n            <Button onClick={() => navigate(\"/\")} variant=\"outline\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Students\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!student) {\n    return (\n      <div className=\"min-h-screen bg-surface flex items-center justify-center\">\n        <Card className=\"p-8 text-center\">\n          <CardContent>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Student Not Found</h2>\n            <p className=\"text-gray-600 mb-4\">The student you're looking for doesn't exist.</p>\n            <Button onClick={() => navigate(\"/\")} variant=\"outline\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Students\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n\n\n  const lastUpdateText = (student as any)?.lastDataPoint \n    ? format(new Date((student as any).lastDataPoint.date), \"MMM d, yyyy\")\n    : \"No data yet\";\n\n  // PDF Generation Function\n  const generatePDF = async () => {\n    try {\n      \n      // Ensure we have all the data needed\n      if (!student || !goals || !allDataPoints || \n          goals.length === 0 || allDataPoints.length === 0 ||\n          !student.name || !student.id) {\n\n        toast({\n          title: \"Error\",\n          description: \"Unable to generate PDF. Missing or invalid student data.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Transform student data for PDF\n      const pdfStudent: PDFStudentData = {\n        id: student.id,\n        name: student.name,\n        grade: student.grade || \"\",\n        iepDueDate: student.iepDueDate?.toISOString().split('T')[0] || \"\",\n        relatedServices: student.relatedServices || \"\",\n        totalGoals: (student as any).totalGoals || goals.length,\n        activeGoals: (student as any).activeGoals || goals.filter(g => g.status === 'active').length,\n        completedGoals: (student as any).completedGoals || goals.filter(g => g.status === 'completed').length,\n        totalDataPoints: (student as any).totalDataPoints || allDataPoints.length,\n      };\n\n      // Transform goals data for PDF\n      const pdfGoals: PDFGoalData[] = goals.map(goal => ({\n        id: goal.id,\n        title: goal.title,\n        description: goal.description,\n        targetCriteria: goal.targetCriteria || \"\",\n        dataCollectionType: goal.dataCollectionType,\n        status: goal.status,\n        currentProgress: (goal as any).currentProgress || 0,\n        dataPointsCount: allDataPoints.filter(dp => dp.goalId === goal.id).length,\n        lastDataDate: allDataPoints.filter(dp => dp.goalId === goal.id).sort((a, b) => \n          new Date(b.date).getTime() - new Date(a.date).getTime()\n        )[0]?.date || null,\n      }));\n\n      // Transform data points for PDF\n      const pdfDataPoints: PDFDataPoint[] = allDataPoints.map(dp => {\n        const goal = goals.find(g => g.id === dp.goalId);\n        return {\n          id: dp.id,\n          date: dp.date.toISOString().split('T')[0],\n          goalTitle: goal?.title || 'Unknown Goal',\n          progressValue: dp.progressValue.toString(),\n          progressFormat: dp.progressFormat,\n          levelOfSupport: dp.levelOfSupport || '[]',\n          anecdotalInfo: dp.anecdotalInfo || '',\n          createdAt: dp.createdAt?.toISOString().split('T')[0] || \"\",\n        };\n      }).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n\n      // Generate PDF\n      console.log('Creating PDF generator...');\n      const pdfGenerator = new PDFGenerator();\n      console.log('Calling generateStudentReport...');\n      pdfGenerator.generateStudentReport(pdfStudent, pdfGoals, pdfDataPoints);\n      console.log('PDF generation completed successfully');\n\n      toast({\n        title: \"Success\",\n        description: \"PDF report has been generated and downloaded.\",\n      });\n    } catch (error) {\n      console.error('PDF generation error:', error);\n      console.error('Error message:', (error as any)?.message);\n      console.error('Error stack:', (error as any)?.stack);\n      toast({\n        title: \"Error\",\n        description: `Failed to generate PDF report: ${(error as any)?.message || 'Unknown error'}`,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const generateChartsPDF = async () => {\n    try {\n      if (!student || !goals || goals.length === 0) {\n        toast({\n          title: \"No Data\",\n          description: \"No student or goals data available to generate charts PDF.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Check if we're on the Reports tab (where charts are visible)\n      const isOnReportsTab = activeTab === 'reports';\n      const visibleCharts = document.querySelectorAll('[data-goal-id]');\n      \n      if (!isOnReportsTab || visibleCharts.length === 0) {\n        toast({\n          title: \"Charts Not Visible\",\n          description: \"Please navigate to the Reports tab first, then click Print Charts to capture the visual charts.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      console.log('Student data:', student);\n      console.log('Goals data:', goals);\n      console.log(`Found ${visibleCharts.length} visible charts`);\n\n      const pdfStudent: PDFStudentData = {\n        id: (student as any).id,\n        name: (student as any).name,\n        grade: (student as any).grade || 'Not specified',\n        iepDueDate: (student as any).iepDueDate,\n        relatedServices: (student as any).relatedServices || 'None specified',\n        totalGoals: (student as any).totalGoals || 0,\n        activeGoals: (student as any).activeGoals || 0,\n        completedGoals: (student as any).completedGoals || 0,\n        totalDataPoints: (student as any).totalDataPoints || 0\n      };\n\n      const pdfGoals: PDFGoalData[] = (goals || []).map((goal: any) => ({\n        id: goal.id,\n        title: goal.title,\n        description: goal.description,\n        targetCriteria: goal.targetCriteria,\n        dataCollectionType: goal.dataCollectionType,\n        status: goal.status,\n        currentProgress: goal.currentProgress || 0,\n        dataPointsCount: goal.dataPointsCount || 0,\n        lastDataDate: null // Not needed for charts PDF\n      }));\n\n      console.log('Creating PDF generator...');\n      const pdfGenerator = new PDFGenerator();\n      console.log('Calling generateChartsReport...');\n      await pdfGenerator.generateChartsReport(pdfStudent, pdfGoals);\n      console.log('Charts PDF generation completed successfully');\n\n      toast({\n        title: \"Success\",\n        description: \"Charts PDF has been generated and downloaded.\",\n      });\n    } catch (error) {\n      console.error('Charts PDF generation error:', error);\n      console.error('Error message:', (error as any)?.message);\n      console.error('Error stack:', (error as any)?.stack);\n      toast({\n        title: \"Error\",\n        description: `Failed to generate charts PDF: ${(error as any)?.message || 'Unknown error'}`,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Navigation confirmed working - proceeding with full interface\n\n  return (\n    <div className=\"min-h-screen bg-surface\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b border-gray-200\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            <div className=\"flex items-center\">\n              <GraduationCap className=\"h-8 w-8 text-primary mr-3\" />\n              <h1 className=\"text-xl font-bold text-gray-900\">Special Education Data Collection</h1>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <Button\n                onClick={async () => {\n                  console.log(\"ðŸ”„ Manual refresh triggered\");\n                  \n                  // Clear all cache and force fresh fetch\n                  queryClient.clear();\n                  \n                  if (studentId) {\n                    // Force immediate fresh fetch of all data\n                    await Promise.all([\n                      refetchStudent(),\n                      refetchGoals(),\n                      queryClient.refetchQueries({ queryKey: [`/api/students/${studentId}/all-data-points`] }),\n                    ]);\n                  }\n                  \n                  toast({\n                    title: \"Data Refreshed\",\n                    description: \"All student data has been refreshed from the database.\",\n                  });\n                  \n                  console.log(\"âœ… Manual refresh completed\");\n                }}\n                variant=\"outline\"\n                size=\"sm\"\n              >\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\n                Refresh Data\n              </Button>\n              <div className=\"text-sm text-gray-600\">{(user as any)?.email || 'Development Mode'}</div>\n              <Button \n                variant=\"ghost\"\n                onClick={() => window.location.href = '/api/logout'}\n                className=\"text-gray-400 hover:text-gray-600\"\n              >\n                Sign Out\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Student Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center space-x-4\">\n            <Button\n              variant=\"ghost\"\n              onClick={() => navigate(\"/\")}\n              className=\"p-2\"\n            >\n              <ArrowLeft className=\"h-6 w-6\" />\n            </Button>\n            <div>\n              <h2 className=\"text-3xl font-bold text-gray-900\">{(student as any)?.name}</h2>\n              <p className=\"text-gray-600\">\n                {(student as any)?.grade ? `Grade ${(student as any).grade} â€¢ ` : \"\"}IEP Goals Dashboard\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center space-x-3\">\n            <Button \n              variant=\"outline\"\n              onClick={() => {\n                console.log(`[REFRESH] Manually refreshing all data for Student ${studentId}`);\n                queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}`] });\n                queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/goals`] });\n                queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/all-data-points`] });\n                toast({\n                  title: \"Data Refreshed\",\n                  description: \"All student data has been refreshed from the database.\",\n                });\n              }}\n            >\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Refresh Data\n            </Button>\n\n            {activeTab === 'reports' && (\n              <Button \n                variant=\"outline\" \n                onClick={generateChartsPDF}\n                className=\"bg-blue-50 border-blue-300\"\n              >\n                <ChartLine className=\"h-4 w-4 mr-2\" />\n                Print Charts\n                <span className=\"ml-1 text-xs text-blue-600\">âœ“</span>\n              </Button>\n            )}\n            <Button \n              variant=\"outline\" \n              onClick={() => setIsClearStudentDataModalOpen(true)}\n              className=\"border-red-300 text-red-600 hover:bg-red-50\"\n            >\n              <Trash2 className=\"h-4 w-4 mr-2\" />\n              Clear Student Data\n            </Button>\n            <Button \n              variant=\"outline\" \n              onClick={() => setIsRemoveStudentModalOpen(true)}\n              className=\"border-red-300 text-red-600 hover:bg-red-50\"\n            >\n              <UserX className=\"h-4 w-4 mr-2\" />\n              Remove from Caseload\n            </Button>\n          </div>\n        </div>\n\n        {/* Navigation Tabs */}\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-6 bg-white shadow-sm border rounded-lg\">\n            <TabsTrigger \n              value=\"overview\" \n              className=\"flex items-center data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700 data-[state=active]:font-semibold data-[state=active]:border-blue-300 transition-all duration-200\"\n            >\n              Overview\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"goals\" \n              className=\"flex items-center data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700 data-[state=active]:font-semibold data-[state=active]:border-blue-300 transition-all duration-200\"\n            >\n              <Target className=\"h-4 w-4 mr-2\" />\n              Goals & Progress\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"live-collection\" \n              className=\"flex items-center data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700 data-[state=active]:font-semibold data-[state=active]:border-blue-300 transition-all duration-200\"\n            >\n              <Zap className=\"h-4 w-4 mr-2\" />\n              Live Collection\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"data-entry\" \n              className=\"flex items-center data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700 data-[state=active]:font-semibold data-[state=active]:border-blue-300 transition-all duration-200\"\n            >\n              <Edit className=\"h-4 w-4 mr-2\" />\n              Data Entry\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"reports\" \n              className=\"flex items-center data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700 data-[state=active]:font-semibold data-[state=active]:border-blue-300 transition-all duration-200\"\n            >\n              <ChartLine className=\"h-4 w-4 mr-2\" />\n              Reports\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"raw-data\" \n              className=\"flex items-center data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700 data-[state=active]:font-semibold data-[state=active]:border-blue-300 transition-all duration-200\"\n            >\n              <Table className=\"h-4 w-4 mr-2\" />\n              Raw Data\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Overview Tab */}\n          <TabsContent value=\"overview\" className=\"space-y-6\">\n            {/* Student Information Card */}\n            {student && (\n              <StudentInfoCard \n                student={student as any} \n                onStudentUpdate={() => {\n                  // Refresh student data when updated\n                  queryClient.invalidateQueries({ queryKey: [\"/api/students\", studentId] });\n                  queryClient.invalidateQueries({ queryKey: [\"/api/students\"] });\n                }}\n              />\n            )}\n            \n            <div className=\"max-w-md mx-auto\">\n              {/* Student Summary Stats */}\n              <Card className=\"bg-gradient-to-r from-blue-50 to-blue-100\">\n                <CardContent className=\"p-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Student Summary</h3>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Active Goals</span>\n                      <span className=\"font-semibold text-gray-900\">{(student as any)?.activeGoals || 0}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Completed Goals</span>\n                      <span className=\"font-semibold text-gray-900\">{(student as any)?.completedGoals || 0}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Total Data Points</span>\n                      <span className=\"font-semibold text-gray-900\">{(student as any)?.totalDataPoints || 0}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Last Assessment</span>\n                      <span className=\"font-semibold text-gray-900\">{lastUpdateText}</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          {/* Goals & Progress Tab */}\n          <TabsContent value=\"goals\" className=\"space-y-6\">\n            {goalsLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n              </div>\n            ) : !goals || goals.length === 0 ? (\n              <Card className=\"p-12 text-center\">\n                <CardContent>\n                  <Target className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n                  <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">No Goals Yet</h3>\n                  <p className=\"text-gray-600 mb-6\">\n                    Add the first IEP goal for {student.name} to start tracking progress.\n                  </p>\n                  <Button onClick={() => setIsAddGoalModalOpen(true)}>\n                    <Plus className=\"h-5 w-5 mr-2\" />\n                    Add First Goal\n                  </Button>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"space-y-6\">\n                {goals.map((goal) => (\n                  <div key={goal.id} className=\"space-y-4\">\n                    <GoalProgressCard \n                      goal={{\n                        ...goal,\n                        targetCriteria: goal.targetCriteria,\n                        currentProgress: (goal as any).currentProgress || 0,\n                        averageScore: (goal as any).averageScore || 0,\n                        trend: (goal as any).trend || 'stable',\n                        lastScore: (goal as any).lastScore || 0,\n                        dataPointsCount: (goal as any).dataPointsCount || 0,\n                      }}\n                      studentId={studentId!}\n                      onEditGoal={() => {\n                        setEditingGoal(goal);\n                        setIsEditGoalModalOpen(true);\n                      }}\n                      onDeleteGoal={() => {\n                        setDeletingGoalId(goal.id);\n                      }}\n                    />\n                    <ObjectivesList goalId={goal.id} studentId={studentId!} />\n                  </div>\n                ))}\n                \n                {/* Add New Goal Button */}\n                <Card className=\"border-2 border-dashed border-gray-300 hover:border-gray-400 transition-colors cursor-pointer\">\n                  <CardContent \n                    className=\"p-8 text-center\"\n                    onClick={() => setIsAddGoalModalOpen(true)}\n                  >\n                    <div className=\"p-4 bg-gray-100 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center\">\n                      <Plus className=\"h-6 w-6 text-gray-600\" />\n                    </div>\n                    <h4 className=\"text-lg font-medium text-gray-900 mb-2\">Add New Goal</h4>\n                    <p className=\"text-gray-600\">Create a new IEP goal for this student</p>\n                  </CardContent>\n                </Card>\n              </div>\n            )}\n          </TabsContent>\n\n          {/* Live Collection Tab */}\n          <TabsContent value=\"live-collection\" className=\"space-y-6\">\n            {!goals || goals.length === 0 ? (\n              <Card className=\"p-12 text-center\">\n                <CardContent>\n                  <Timer className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n                  <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">No Goals for Live Collection</h3>\n                  <p className=\"text-gray-600 mb-6\">\n                    Add some goals first to use real-time data collection tools.\n                  </p>\n                  <Button onClick={() => setActiveTab(\"goals\")}>\n                    <Target className=\"h-5 w-5 mr-2\" />\n                    Go to Goals\n                  </Button>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"space-y-6\">\n                <div className=\"text-center mb-8\">\n                  <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">Real-Time Data Collection</h3>\n                  <p className=\"text-gray-600\">Quick tools for collecting data during observations</p>\n                </div>\n                \n                {/* Goal Selection for Live Collection */}\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <h4 className=\"text-lg font-semibold text-gray-900 mb-4\">Select Goal for Live Collection</h4>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                      {goals.map((goal) => (\n                        <Button\n                          key={goal.id}\n                          variant={selectedGoalId === goal.id ? \"default\" : \"outline\"}\n                          className=\"h-auto p-4 text-left flex flex-col items-start w-full\"\n                          onClick={() => {\n                            setSelectedGoalId(goal.id);\n                            setSelectedObjectiveId(null); // Reset objective selection when goal changes\n                          }}\n                        >\n                          <div className=\"font-semibold mb-2 w-full\">{goal.title}</div>\n                          <div className=\"text-sm opacity-80 text-left leading-relaxed w-full break-words whitespace-normal\">\n                            {goal.description}\n                          </div>\n                        </Button>\n                      ))}\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Objective Selection for Live Collection */}\n                {selectedGoalId && objectives.length > 0 && (\n                  <Card>\n                    <CardContent className=\"p-6\">\n                      <h4 className=\"text-lg font-semibold text-gray-900 mb-4\">\n                        Select Objective (Optional)\n                      </h4>\n                      <p className=\"text-sm text-gray-600 mb-4\">\n                        Choose a specific objective or collect general goal data\n                      </p>\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                        <Button\n                          variant={selectedObjectiveId === null ? \"default\" : \"outline\"}\n                          className=\"h-auto p-4 text-left flex flex-col items-start w-full hover:bg-blue-600 hover:text-white group\"\n                          onClick={() => setSelectedObjectiveId(null)}\n                        >\n                          <div className={`font-semibold mb-1 w-full transition-colors ${\n                            selectedObjectiveId === null \n                              ? 'text-white' \n                              : 'text-blue-600 group-hover:text-white'\n                          }`}>\n                            General Goal Data\n                          </div>\n                          <div className={`text-xs w-full transition-colors ${\n                            selectedObjectiveId === null \n                              ? 'text-white/80' \n                              : 'text-gray-600 group-hover:text-white/80'\n                          }`}>\n                            Collect data for the goal overall\n                          </div>\n                        </Button>\n                        {objectives.map((objective: any) => (\n                          <Button\n                            key={objective.id}\n                            variant={selectedObjectiveId === objective.id ? \"default\" : \"outline\"}\n                            className=\"h-auto p-4 text-left flex flex-col items-start w-full hover:bg-blue-600 hover:text-white group\"\n                            onClick={() => setSelectedObjectiveId(objective.id)}\n                          >\n                            <div className={`font-semibold mb-1 w-full transition-colors ${\n                              selectedObjectiveId === objective.id \n                                ? 'text-white' \n                                : 'text-green-600 group-hover:text-white'\n                            }`}>\n                              Objective\n                            </div>\n                            <div className={`text-xs text-left leading-relaxed w-full break-words whitespace-normal transition-colors ${\n                              selectedObjectiveId === objective.id \n                                ? 'text-white/80' \n                                : 'text-gray-600 group-hover:text-white/80'\n                            }`}>\n                              {objective.description || 'No description provided'}\n                            </div>\n                          </Button>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* Live Collection Tools */}\n                {selectedGoalId && (\n                  <LiveCollectionTools \n                    goalId={selectedGoalId}\n                    objectiveId={selectedObjectiveId}\n                    studentId={studentId!}\n                    goals={goals}\n                    objectives={objectives}\n                    onDataCollected={() => {\n                      refetchStudent();\n                      refetchGoals();\n                      refetchObjectives();\n                      refetchAllDataPoints();\n                    }}\n                  />\n                )}\n              </div>\n            )}\n          </TabsContent>\n\n          {/* Data Entry Tab */}\n          <TabsContent value=\"data-entry\">\n            <Card>\n              <CardContent className=\"p-6\">\n                <DataEntryForm \n                  studentId={studentId || 0} \n                  goals={(goals || []).map(goal => ({\n                    ...goal,\n                    studentId: goal.studentId || studentId || 0,\n                    levelOfSupport: goal.levelOfSupport || undefined\n                  }))}\n                  selectedGoalId={selectedGoalId || undefined}\n                  onSuccess={() => {\n                    refetchStudent();\n                    refetchGoals();\n                    refetchDataPoints();\n                  }}\n                />\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Reports Tab */}\n          <TabsContent value=\"reports\" className=\"space-y-6\">\n            {!goals || goals.length === 0 ? (\n              <Card className=\"p-12 text-center\">\n                <CardContent>\n                  <ChartLine className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n                  <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">No Goals to Report</h3>\n                  <p className=\"text-gray-600 mb-6\">\n                    Add some goals first to view progress reports and charts.\n                  </p>\n                  <Button onClick={() => setActiveTab(\"goals\")}>\n                    <Target className=\"h-5 w-5 mr-2\" />\n                    Go to Goals\n                  </Button>\n                </CardContent>\n              </Card>\n            ) : selectedGoalId ? (\n              <>\n                {/* Back button to return to all charts */}\n                <div className=\"mb-4\">\n                  <Button \n                    variant=\"outline\" \n                    onClick={() => setSelectedGoalId(null)}\n                    className=\"mb-4\"\n                  >\n                    <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                    Back to All Charts\n                  </Button>\n                </div>\n                {/* Individual Goal Chart with Type Selection */}\n                <GoalChart goalId={selectedGoalId} selectedPeriod={selectedReportingPeriod} />\n              </>\n            ) : (\n              <div className=\"space-y-8\">\n                {/* Reporting Period Selector and Session Notes Button */}\n                <div className=\"flex justify-between items-center mb-6\">\n                  <div className=\"flex items-center gap-4\">\n                    <label className=\"text-sm font-medium text-gray-700\">\n                      Reporting Period:\n                    </label>\n                    <Select\n                      value={selectedReportingPeriod?.periodNumber?.toString() || \"\"}\n                      onValueChange={(value) => {\n                        if (value === \"all\") {\n                          setSelectedReportingPeriod(null);\n                        } else {\n                          const period = reportingData?.periods.find(p => p.periodNumber.toString() === value);\n                          setSelectedReportingPeriod(period || null);\n                        }\n                      }}\n                    >\n                      <SelectTrigger className=\"w-60\">\n                        <SelectValue placeholder=\"Select reporting period\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Periods</SelectItem>\n                        {reportingData?.periods.map((period) => (\n                          <SelectItem key={period.periodNumber} value={period.periodNumber.toString()}>\n                            Period {period.periodNumber} ({format(new Date(period.startDate), 'MMM d')} - {format(new Date(period.endDate), 'MMM d, yyyy')})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <Button \n                    variant=\"outline\" \n                    onClick={() => setActiveTab(\"raw-data\")}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <FileText className=\"h-4 w-4\" />\n                    View Session Notes\n                  </Button>\n                </div>\n                \n                {goals.map((goal) => (\n                  <div key={goal.id} className=\"space-y-6\">\n                    {/* Goal Chart */}\n                    <StudentScatterplot \n                      studentId={studentId || 0} \n                      goalId={goal.id}\n                      selectedPeriod={selectedReportingPeriod}\n                    />\n                    \n                    {/* Objectives Charts for this Goal */}\n                    <ObjectiveChartsForGoal goalId={goal.id} selectedPeriod={selectedReportingPeriod} />\n                  </div>\n                ))}\n              </div>\n            )}\n          </TabsContent>\n\n          {/* Raw Data Tab */}\n          <TabsContent value=\"raw-data\">\n            <RawDataTable studentId={studentId!} student={student} />\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      {/* Mastery Alert Popup */}\n      {studentId && (\n        <MasteryAlertPopup \n          studentId={studentId} \n          studentName={student?.name}\n        />\n      )}\n\n      {/* Add Goal Modal */}\n      <AddGoalModal\n        studentId={studentId!}\n        isOpen={isAddGoalModalOpen}\n        onClose={() => setIsAddGoalModalOpen(false)}\n        onSuccess={() => {\n          refetchGoals();\n          setIsAddGoalModalOpen(false);\n        }}\n      />\n\n      {/* Edit Goal Modal */}\n      {editingGoal && (\n        <EditGoalModal\n          goal={editingGoal}\n          isOpen={isEditGoalModalOpen}\n          onClose={() => {\n            setIsEditGoalModalOpen(false);\n            setEditingGoal(null);\n          }}\n          onSuccess={() => {\n            refetchGoals();\n            setIsEditGoalModalOpen(false);\n            setEditingGoal(null);\n          }}\n        />\n      )}\n\n      {/* Clear Student Data Modal */}\n      <ClearDataModal\n        isOpen={isClearStudentDataModalOpen}\n        onClose={() => setIsClearStudentDataModalOpen(false)}\n        type=\"student\"\n        studentId={studentId}\n        studentName={student?.name}\n      />\n\n      {/* Remove Student Modal */}\n      <ClearDataModal\n        isOpen={isRemoveStudentModalOpen}\n        onClose={() => setIsRemoveStudentModalOpen(false)}\n        type=\"remove\"\n        studentId={studentId}\n        studentName={student?.name}\n      />\n\n      {/* Delete Goal Confirmation Dialog */}\n      <AlertDialog open={!!deletingGoalId} onOpenChange={() => setDeletingGoalId(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"text-red-600 flex items-center\">\n              <Trash2 className=\"h-5 w-5 mr-2\" />\n              Delete Goal\n            </AlertDialogTitle>\n            <AlertDialogDescription className=\"space-y-3\">\n              {(() => {\n                if (!deletingGoalId) return null;\n                \n                const goalToDelete = goals?.find(g => g.id === deletingGoalId);\n                const objectivesForGoal = objectives?.filter(obj => obj.goalId === deletingGoalId) || [];\n                const dataPointsForGoal = allDataPoints?.filter(dp => dp.goalId === deletingGoalId) || [];\n                \n                return (\n                  <>\n                    <div className=\"font-semibold text-gray-900\">\n                      You are about to permanently delete the goal:\n                    </div>\n                    <div className=\"bg-gray-50 p-3 rounded-md border-l-4 border-red-400\">\n                      <div className=\"font-medium text-gray-900\">\"{goalToDelete?.title || 'Unknown Goal'}\"</div>\n                      {goalToDelete?.description && (\n                        <div className=\"text-sm text-gray-600 mt-1\">{goalToDelete.description}</div>\n                      )}\n                    </div>\n                    \n                    <div className=\"bg-red-50 p-4 rounded-md border border-red-200\">\n                      <div className=\"text-red-800 font-medium mb-2\">âš ï¸ This will permanently delete:</div>\n                      <ul className=\"text-red-700 text-sm space-y-1 list-disc list-inside\">\n                        <li>\n                          <strong>{objectivesForGoal.length}</strong> objective{objectivesForGoal.length !== 1 ? 's' : ''} \n                          {objectivesForGoal.length > 0 && ' associated with this goal'}\n                        </li>\n                        <li>\n                          <strong>{dataPointsForGoal.length}</strong> data point{dataPointsForGoal.length !== 1 ? 's' : ''} \n                          {dataPointsForGoal.length > 0 && ' containing student progress data'}\n                        </li>\n                        <li>All progress tracking and historical data</li>\n                        <li>Any mastery records for this goal</li>\n                      </ul>\n                    </div>\n                    \n                    <div className=\"text-sm text-gray-600\">\n                      <strong>This action cannot be undone.</strong> Consider exporting reports before deleting if you need to keep records.\n                    </div>\n                  </>\n                );\n              })()}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingGoalId && deleteGoalMutation.mutate(deletingGoalId)}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Yes, Delete Goal\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":43252,"size_tokens":null},"shared/schema.ts":{"content":"import {\n  pgTable,\n  text,\n  varchar,\n  timestamp,\n  jsonb,\n  index,\n  serial,\n  integer,\n  decimal,\n  boolean,\n  date,\n} from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table (mandatory for Replit Auth)\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// User storage table (mandatory for Replit Auth)\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().notNull(),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Students table\nexport const students = pgTable(\"students\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  name: varchar(\"name\").notNull(),\n  grade: varchar(\"grade\"),\n  iepDueDate: timestamp(\"iep_due_date\"),\n  relatedServices: text(\"related_services\"), // JSON string of services like \"Speech Therapy, Occupational Therapy\"\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_students_user_id\").on(table.userId),\n]);\n\n// Goals table\nexport const goals = pgTable(\"goals\", {\n  id: serial(\"id\").primaryKey(),\n  studentId: integer(\"student_id\").notNull().references(() => students.id),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  targetCriteria: text(\"target_criteria\"), // e.g., \"80% accuracy over 3 consecutive trials\"\n  levelOfSupport: text(\"level_of_support\"), // independent, verbal-prompt, etc.\n  dataCollectionType: varchar(\"data_collection_type\").notNull().default(\"percentage\"), // frequency, percentage, duration\n  frequencyDirection: varchar(\"frequency_direction\"), // \"increase\" or \"decrease\" for frequency goals\n  status: varchar(\"status\").notNull().default(\"active\"), // active, mastered, discontinued\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_goals_student_id\").on(table.studentId),\n]);\n\n// Objectives table\nexport const objectives = pgTable(\"objectives\", {\n  id: serial(\"id\").primaryKey(),\n  goalId: integer(\"goal_id\").notNull().references(() => goals.id),\n  studentId: integer(\"student_id\").notNull().references(() => students.id),\n  title: varchar(\"title\"), // Made optional since we're removing it from UI\n  description: text(\"description\").notNull(),\n  targetCriteria: text(\"target_criteria\"),\n  targetDate: timestamp(\"target_date\"),\n  status: varchar(\"status\").notNull().default(\"active\"), // active, mastered, discontinued\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_objectives_goal_id\").on(table.goalId),\n  index(\"idx_objectives_student_id\").on(table.studentId),\n]);\n\n// Data points table\nexport const dataPoints = pgTable(\"data_points\", {\n  id: serial(\"id\").primaryKey(),\n  goalId: integer(\"goal_id\").notNull().references(() => goals.id),\n  objectiveId: integer(\"objective_id\").references(() => objectives.id), // optional - can be for goal or specific objective\n  studentId: integer(\"student_id\").notNull().references(() => students.id),\n  date: timestamp(\"date\").notNull(),\n  progressValue: decimal(\"progress_value\", { precision: 5, scale: 2 }).notNull(), // percentage or score\n  progressFormat: varchar(\"progress_format\").notNull().default(\"percentage\"), // percentage or fraction\n  numerator: integer(\"numerator\"), // for fraction format (e.g., 8 in 8/10)\n  denominator: integer(\"denominator\"), // for fraction format (e.g., 10 in 8/10)\n  // noResponseCount: integer(\"no_response_count\"), // count of no response trials for accuracy data (pending migration)\n  durationUnit: varchar(\"duration_unit\"), // seconds, minutes for duration data collection\n  levelOfSupport: text(\"level_of_support\"), // support levels as JSON array string or single value\n  setting: text(\"setting\"), // settings as JSON array string or single value (general-education, special-education, etc.)\n  anecdotalInfo: text(\"anecdotal_info\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_data_points_goal_id\").on(table.goalId),\n  index(\"idx_data_points_objective_id\").on(table.objectiveId),\n  index(\"idx_data_points_student_id\").on(table.studentId),\n  index(\"idx_data_points_date\").on(table.date),\n]);\n\n// Relations\nexport const usersRelations = relations(users, ({ many }) => ({\n  students: many(students),\n}));\n\nexport const studentsRelations = relations(students, ({ one, many }) => ({\n  user: one(users, {\n    fields: [students.userId],\n    references: [users.id],\n  }),\n  goals: many(goals),\n  objectives: many(objectives),\n  dataPoints: many(dataPoints),\n}));\n\nexport const goalsRelations = relations(goals, ({ one, many }) => ({\n  student: one(students, {\n    fields: [goals.studentId],\n    references: [students.id],\n  }),\n  objectives: many(objectives),\n  dataPoints: many(dataPoints),\n}));\n\nexport const objectivesRelations = relations(objectives, ({ one, many }) => ({\n  goal: one(goals, {\n    fields: [objectives.goalId],\n    references: [goals.id],\n  }),\n  student: one(students, {\n    fields: [objectives.studentId],\n    references: [students.id],\n  }),\n  dataPoints: many(dataPoints),\n}));\n\nexport const dataPointsRelations = relations(dataPoints, ({ one }) => ({\n  goal: one(goals, {\n    fields: [dataPoints.goalId],\n    references: [goals.id],\n  }),\n  objective: one(objectives, {\n    fields: [dataPoints.objectiveId],\n    references: [objectives.id],\n  }),\n  student: one(students, {\n    fields: [dataPoints.studentId],\n    references: [students.id],\n  }),\n}));\n\n// Validation enums for strict type checking\nexport const DATA_COLLECTION_TYPES = [\"percentage\", \"frequency\", \"duration\"] as const;\nexport const PROGRESS_FORMATS = [\"percentage\", \"fraction\", \"frequency\", \"duration\"] as const;\nexport const GOAL_STATUSES = [\"active\", \"mastered\", \"discontinued\"] as const;\nexport const FREQUENCY_DIRECTIONS = [\"increase\", \"decrease\"] as const;\nexport const DURATION_UNITS = [\"seconds\", \"minutes\"] as const;\n\nexport type DataCollectionType = typeof DATA_COLLECTION_TYPES[number];\nexport type ProgressFormat = typeof PROGRESS_FORMATS[number];\nexport type GoalStatus = typeof GOAL_STATUSES[number];\nexport type FrequencyDirection = typeof FREQUENCY_DIRECTIONS[number];\nexport type DurationUnit = typeof DURATION_UNITS[number];\n\n// Insert schemas with strict validation\nexport const insertStudentSchema = createInsertSchema(students).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  name: z.string().min(1, \"Student name is required\").max(100, \"Name must be 100 characters or less\"),\n  grade: z.string().max(20, \"Grade must be 20 characters or less\").optional(),\n  iepDueDate: z.union([z.string(), z.date(), z.undefined()]).optional().transform((val) => {\n    if (!val || val === '') return undefined;\n    if (typeof val === 'string') {\n      const parsed = new Date(val);\n      if (isNaN(parsed.getTime())) {\n        throw new Error(\"Invalid date format for IEP due date\");\n      }\n      return parsed;\n    }\n    return val;\n  }),\n  relatedServices: z.string().max(500, \"Related services must be 500 characters or less\").optional(),\n});\n\nexport const insertGoalSchema = createInsertSchema(goals).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  title: z.string().min(1, \"Goal title is required\").max(200, \"Title must be 200 characters or less\"),\n  description: z.string().min(1, \"Goal description is required\").max(2000, \"Description must be 2000 characters or less\"),\n  targetCriteria: z.string().max(500, \"Target criteria must be 500 characters or less\").optional().nullable(),\n  levelOfSupport: z.string().max(500, \"Level of support must be 500 characters or less\").optional().nullable(),\n  dataCollectionType: z.enum(DATA_COLLECTION_TYPES, {\n    errorMap: () => ({ message: \"Data collection type must be percentage, frequency, or duration\" })\n  }).default(\"percentage\"),\n  frequencyDirection: z.preprocess(\n    (val) => (val === '' || val === undefined ? null : val),\n    z.enum(FREQUENCY_DIRECTIONS, {\n      errorMap: () => ({ message: \"Frequency direction must be increase or decrease\" })\n    }).optional().nullable()\n  ),\n  status: z.enum(GOAL_STATUSES, {\n    errorMap: () => ({ message: \"Status must be active, mastered, or discontinued\" })\n  }).default(\"active\"),\n});\n\nexport const insertObjectiveSchema = createInsertSchema(objectives).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  title: z.string().max(200, \"Title must be 200 characters or less\").optional().nullable(),\n  description: z.string().min(1, \"Objective description is required\").max(2000, \"Description must be 2000 characters or less\"),\n  targetCriteria: z.string().max(500, \"Target criteria must be 500 characters or less\").optional().nullable(),\n  targetDate: z.union([z.string(), z.date(), z.undefined()]).optional().transform((val) => {\n    if (!val || val === '') return undefined;\n    if (typeof val === 'string') {\n      const parsed = new Date(val);\n      if (isNaN(parsed.getTime())) {\n        throw new Error(\"Invalid date format for target date\");\n      }\n      return parsed;\n    }\n    return val;\n  }),\n  status: z.enum(GOAL_STATUSES, {\n    errorMap: () => ({ message: \"Status must be active, mastered, or discontinued\" })\n  }).default(\"active\"),\n});\n\nexport const insertDataPointSchema = createInsertSchema(dataPoints).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  objectiveId: z.number().int().positive().optional().nullable(),\n  progressValue: z.number()\n    .min(-999, \"Value must be greater than -999\")\n    .max(999, \"Value must be less than 999\")\n    .transform((num) => num.toString()),\n  progressFormat: z.enum(PROGRESS_FORMATS, {\n    errorMap: () => ({ message: \"Progress format must be percentage, fraction, frequency, or duration\" })\n  }).default(\"percentage\"),\n  numerator: z.number().int().min(0, \"Numerator must be non-negative\").max(9999, \"Numerator must be less than 10000\").optional().nullable(),\n  denominator: z.number().int().min(1, \"Denominator must be at least 1\").max(9999, \"Denominator must be less than 10000\").optional().nullable(),\n  durationUnit: z.enum(DURATION_UNITS, {\n    errorMap: () => ({ message: \"Duration unit must be seconds or minutes\" })\n  }).optional().nullable(),\n  levelOfSupport: z.string().max(500, \"Level of support must be 500 characters or less\").optional().nullable(),\n  setting: z.string().max(500, \"Setting must be 500 characters or less\").optional().nullable(),\n  anecdotalInfo: z.string().max(2000, \"Anecdotal info must be 2000 characters or less\").optional().nullable(),\n  date: z.union([\n    z.date(),\n    z.string().transform((str) => {\n      if (str.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n        const parsed = new Date(str + 'T12:00:00.000Z');\n        if (isNaN(parsed.getTime())) {\n          throw new Error(\"Invalid date format\");\n        }\n        return parsed;\n      }\n      const parsed = new Date(str);\n      if (isNaN(parsed.getTime())) {\n        throw new Error(\"Invalid date format\");\n      }\n      return parsed;\n    })\n  ]),\n});\n\n// Reporting period validation schema\nexport const insertReportingPeriodSchema = z.object({\n  userId: z.string().min(1, \"User ID is required\"),\n  periodLength: z.enum([\"4.5-weeks\", \"3-weeks\"], {\n    errorMap: () => ({ message: \"Period length must be '4.5-weeks' or '3-weeks'\" })\n  }),\n  periodNumber: z.number().int().min(1, \"Period number must be at least 1\").max(20, \"Period number must be 20 or less\"),\n  startDate: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Start date must be in YYYY-MM-DD format\"),\n  endDate: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"End date must be in YYYY-MM-DD format\"),\n}).refine((data) => {\n  const start = new Date(data.startDate);\n  const end = new Date(data.endDate);\n  return end >= start;\n}, {\n  message: \"End date must be on or after start date\",\n  path: [\"endDate\"],\n});\n\n// Schema for bulk reporting periods submission\nexport const reportingPeriodsSubmitSchema = z.object({\n  periods: z.array(z.object({\n    periodNumber: z.number().int().min(1).max(20),\n    startDate: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\"),\n    endDate: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\"),\n  })).min(1, \"At least one period is required\").max(20, \"Maximum 20 periods allowed\"),\n  periodLength: z.enum([\"4.5-weeks\", \"3-weeks\"], {\n    errorMap: () => ({ message: \"Period length must be '4.5-weeks' or '3-weeks'\" })\n  }),\n});\n\n// Types\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\n\n// Reporting periods table for persistent storage\nexport const reportingPeriods = pgTable(\"reporting_periods\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  periodLength: varchar(\"period_length\").notNull(), // \"4.5weeks\" or \"3weeks\"\n  periodNumber: integer(\"period_number\").notNull(),\n  startDate: date(\"start_date\").notNull(),\n  endDate: date(\"end_date\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_reporting_periods_user_id\").on(table.userId),\n]);\n\nexport type ReportingPeriod = typeof reportingPeriods.$inferSelect;\nexport type InsertReportingPeriod = typeof reportingPeriods.$inferInsert;\nexport type InsertStudent = z.infer<typeof insertStudentSchema>;\nexport type Student = typeof students.$inferSelect;\nexport type InsertGoal = z.infer<typeof insertGoalSchema>;\nexport type Goal = typeof goals.$inferSelect;\nexport type InsertObjective = z.infer<typeof insertObjectiveSchema>;\nexport type Objective = typeof objectives.$inferSelect;\nexport type InsertDataPoint = z.infer<typeof insertDataPointSchema>;\nexport type DataPoint = typeof dataPoints.$inferSelect;\n\n// API Response Types\nexport interface GoalProgressResponse {\n  goal: Goal;\n  dataPoints: DataPoint[];\n  currentProgress: number;\n  averageScore: number;\n  trend: number;\n  lastScore: number;\n}\n\nexport interface ObjectiveProgressResponse {\n  objective: Objective;\n  dataPoints: DataPoint[];\n  currentProgress: number;\n  averageScore: number;\n  trend: number;\n  lastScore: number;\n  dataPointsCount: number;\n}\n\nexport interface GoalWithProgress extends Goal {\n  currentProgress: number;\n  averageScore: number;\n  trend: number;\n  lastScore: number;\n  dataPointsCount: number;\n}\n\n// Pagination Types\nexport interface PaginationParams {\n  page?: number;\n  limit?: number;\n  sortBy?: string;\n  sortOrder?: 'asc' | 'desc';\n}\n\nexport interface PaginatedResponse<T> {\n  data: T[];\n  pagination: {\n    page: number;\n    limit: number;\n    total: number;\n    totalPages: number;\n    hasMore: boolean;\n  };\n}\n\n// Default pagination constants\nexport const DEFAULT_PAGE_SIZE = 50;\nexport const MAX_PAGE_SIZE = 200;\nexport const DEFAULT_BATCH_SIZE = 100;\nexport const MAX_BATCH_SIZE = 500;\n\n// Pagination validation schema\nexport const paginationSchema = z.object({\n  page: z.coerce.number().int().min(1).default(1),\n  limit: z.coerce.number().int().min(1).max(MAX_PAGE_SIZE).default(DEFAULT_PAGE_SIZE),\n  sortBy: z.string().optional(),\n  sortOrder: z.enum(['asc', 'desc']).default('desc'),\n});\n\n// Batch operation types\nexport interface BatchCreateResult<T> {\n  success: T[];\n  failed: Array<{ index: number; error: string; data: unknown }>;\n  totalProcessed: number;\n  successCount: number;\n  failureCount: number;\n}\n\nexport interface BatchDeleteResult {\n  deletedCount: number;\n  failedIds: number[];\n}\n\n// Batch data point creation schema\nexport const batchInsertDataPointSchema = z.object({\n  dataPoints: z.array(insertDataPointSchema).min(1).max(MAX_BATCH_SIZE),\n});\n\nexport type BatchInsertDataPoint = z.infer<typeof batchInsertDataPointSchema>;\n","path":null,"size_bytes":16178,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/student-overview-card.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { GraduationCap, ArrowRight, Clock } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { format } from \"date-fns\";\n\ninterface Student {\n  id: number;\n  name: string;\n  grade?: string;\n  totalGoals: number;\n  activeGoals: number;\n  completedGoals: number;\n  totalDataPoints: number;\n  lastDataPoint?: {\n    date: string;\n    progressValue: string;\n  };\n}\n\ninterface StudentOverviewCardProps {\n  student: Student;\n}\n\nexport default function StudentOverviewCard({ student }: StudentOverviewCardProps) {\n  const [, navigate] = useLocation();\n\n  const lastUpdatedText = student.lastDataPoint \n    ? format(new Date(student.lastDataPoint.date), \"MMM d\")\n    : \"No data\";\n\n  const recentActivityText = student.lastDataPoint \n    ? format(new Date(student.lastDataPoint.date), \"h:mm a\")\n    : \"No activity\";\n\n  return (\n    <Card className=\"hover:shadow-md transition-shadow cursor-pointer group\">\n      <CardContent \n        className=\"p-6\"\n        onClick={() => navigate(`/students/${student.id}`)}\n      >\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className=\"text-xl font-semibold text-gray-900 group-hover:text-primary transition-colors\">\n            {student.name}\n          </h3>\n          <div className=\"p-2 bg-blue-100 rounded-lg\">\n            <GraduationCap className=\"h-5 w-5 text-primary\" />\n          </div>\n        </div>\n        \n        {/* Student Stats */}\n        <div className=\"space-y-3 mb-4\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-gray-600 text-sm\">Active Goals</span>\n            <span className=\"font-medium text-gray-900\">{student.activeGoals || 0}</span>\n          </div>\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-gray-600 text-sm\">Total Data Points</span>\n            <span className=\"font-medium text-gray-900\">{student.totalDataPoints || 0}</span>\n          </div>\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-gray-600 text-sm\">Last Updated</span>\n            <span className=\"font-medium text-gray-900\">{lastUpdatedText}</span>\n          </div>\n        </div>\n\n        {/* Recent Activity Indicator */}\n        <div className=\"flex items-center justify-between pt-4 border-t border-gray-100\">\n          <div className=\"flex items-center text-sm text-gray-600\">\n            <Clock className=\"h-4 w-4 text-gray-400 mr-1\" />\n            <span>{recentActivityText}</span>\n          </div>\n          <Button \n            variant=\"ghost\" \n            size=\"sm\"\n            className=\"text-primary hover:text-blue-700 font-medium p-0\"\n            onClick={(e) => {\n              e.stopPropagation();\n              navigate(`/students/${student.id}`);\n            }}\n          >\n            View Details <ArrowRight className=\"h-4 w-4 ml-1\" />\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":3065,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nif (!process.env.REPLIT_DOMAINS) {\n  throw new Error(\"Environment variable REPLIT_DOMAINS not provided\");\n}\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: true, // Force session save for admin login\n    saveUninitialized: true, // Allow empty sessions to be saved\n    cookie: {\n      httpOnly: true,\n      secure: false, // Development mode - disable for local testing\n      maxAge: sessionTtl,\n      sameSite: 'lax'\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    try {\n      console.log(\"Authentication verify callback triggered\");\n      console.log(\"User claims:\", tokens.claims());\n      \n      const user = {};\n      updateUserSession(user, tokens);\n      await upsertUser(tokens.claims());\n      console.log(\"User session created and stored successfully\");\n      verified(null, user);\n    } catch (error) {\n      console.error(\"Error in verify callback:\", error);\n      verified(error, null);\n    }\n  };\n\n  for (const domain of process.env\n    .REPLIT_DOMAINS!.split(\",\")) {\n    console.log(\"Setting up auth strategy for domain:\", domain);\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify,\n    );\n    passport.use(strategy);\n    console.log(\"Strategy registered:\", `replitauth:${domain}`);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", async (req, res, next) => {\n    console.log(\"Login attempt for hostname:\", req.hostname);\n    console.log(\"Available strategies:\", Object.keys((passport as any)._strategies || {}));\n    console.log(\"REPL_ID being used:\", process.env.REPL_ID);\n    console.log(\"Expected callback URL:\", `https://${req.hostname}/api/callback`);\n    \n    const currentConfig = await getOidcConfig();\n    console.log(\"Current OIDC config client_id:\", currentConfig.client_id);\n    \n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    console.log(\"Auth callback received for hostname:\", req.hostname);\n    console.log(\"Callback query params:\", req.query);\n    console.log(\"Session ID:\", req.sessionID);\n    console.log(\"Available auth strategies:\", Object.keys((passport as any)._strategies || {}));\n    \n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  // Check for admin cookie session as fallback\n  if (!req.isAuthenticated() && req.cookies?.admin_session) {\n    try {\n      const adminData = JSON.parse(req.cookies.admin_session);\n      if (adminData.expires_at && adminData.expires_at > Math.floor(Date.now() / 1000)) {\n        console.log(\"Using admin cookie session for user:\", adminData.claims.sub);\n        req.user = adminData;\n        return next();\n      }\n    } catch (error) {\n      console.log(\"Invalid admin cookie:\", error);\n    }\n  }\n\n  console.log(\"Auth check - isAuthenticated:\", req.isAuthenticated());\n  console.log(\"Auth check - user exists:\", !!user);\n  console.log(\"Auth check - user expires_at:\", user?.expires_at);\n\n  if (!req.isAuthenticated() || !user || !user.expires_at) {\n    console.log(\"Auth failed - returning 401\");\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":6276,"size_tokens":null},"main.py":{"content":"#!/usr/bin/env python3\n\"\"\"\nPython launcher for Special Education Data Collection App\nThis script starts the Node.js application for easy Python-style execution.\n\"\"\"\n\nimport subprocess\nimport sys\nimport os\n\ndef main():\n    \"\"\"Start the Special Education Data Collection App\"\"\"\n    print(\"ðŸŽ“ Starting Special Education Data Collection App...\")\n    print(\"=\" * 50)\n    \n    try:\n        # Check if Node.js is available\n        subprocess.run([\"node\", \"--version\"], check=True, capture_output=True)\n        print(\"âœ“ Node.js detected\")\n        \n        # Check if npm is available  \n        subprocess.run([\"npm\", \"--version\"], check=True, capture_output=True)\n        print(\"âœ“ npm detected\")\n        \n        # Install dependencies if node_modules doesn't exist\n        if not os.path.exists(\"node_modules\"):\n            print(\"ðŸ“¦ Installing dependencies...\")\n            subprocess.run([\"npm\", \"install\"], check=True)\n            print(\"âœ“ Dependencies installed\")\n        \n        print(\"ðŸš€ Starting application...\")\n        print(\"=\" * 50)\n        \n        # Start the application using npm start for development\n        result = subprocess.run([\"npm\", \"run\", \"dev\"], check=False)\n        return result.returncode\n        \n    except subprocess.CalledProcessError as e:\n        print(f\"âŒ Error: {e}\")\n        print(\"Please ensure Node.js and npm are installed on your system.\")\n        return 1\n    except KeyboardInterrupt:\n        print(\"\\nðŸ‘‹ Application stopped by user.\")\n        return 0\n    except Exception as e:\n        print(f\"âŒ Unexpected error: {e}\")\n        return 1\n\nif __name__ == \"__main__\":\n    sys.exit(main())","path":null,"size_bytes":1643,"size_tokens":null},"client/src/pages/group-collection.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\n\nimport { Users, Play, Square, Save, Plus, Minus, Check, X, RotateCcw } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Link } from \"wouter\";\n\ninterface Student {\n  id: number;\n  name: string;\n  grade: string;\n}\n\ninterface Goal {\n  id: number;\n  studentId: number;\n  title: string;\n  dataType: 'frequency' | 'duration' | 'percentage';\n}\n\ninterface StudentGoalData {\n  studentId: number;\n  studentName: string;\n  goalId: number;\n  goalTitle: string;\n  dataType: 'frequency' | 'duration' | 'percentage';\n  // Frequency data\n  frequencyCount: number;\n  // Duration data\n  durationMinutes: number;\n  durationSeconds: number;\n  durationTimer: number;\n  isTimerRunning: boolean;\n  // Percentage data\n  correctTrials: number;\n  totalTrials: number;\n}\n\nexport default function GroupCollection() {\n  const { toast } = useToast();\n  const [selectedStudents, setSelectedStudents] = useState<number[]>([]);\n  const [selectedGoals, setSelectedGoals] = useState<{[studentId: number]: number}>({});\n  const [isSessionActive, setIsSessionActive] = useState(false);\n  const [sessionStartTime, setSessionStartTime] = useState<Date | null>(null);\n  const [studentData, setStudentData] = useState<StudentGoalData[]>([]);\n  const [timerIntervals, setTimerIntervals] = useState<{[key: string]: NodeJS.Timeout}>({});\n\n  // Fetch all students\n  const { data: students = [] } = useQuery<Student[]>({\n    queryKey: [\"/api/students\"],\n  });\n\n  // Fetch goals for selected students\n  const { data: allGoals = [] } = useQuery<Goal[]>({\n    queryKey: [\"/api/goals/multi-student\", selectedStudents],\n    enabled: selectedStudents.length > 0,\n    queryFn: async () => {\n      const goalPromises = selectedStudents.map(studentId =>\n        fetch(`/api/students/${studentId}/goals`).then(res => res.json())\n      );\n      const goalArrays = await Promise.all(goalPromises);\n      return goalArrays.flat();\n    }\n  });\n\n  const handleStudentToggle = (studentId: number) => {\n    setSelectedStudents(prev => {\n      const newSelected = prev.includes(studentId) \n        ? prev.filter(id => id !== studentId)\n        : [...prev, studentId];\n      \n      // Clear goal selection if student is deselected\n      if (!newSelected.includes(studentId)) {\n        setSelectedGoals(prev => {\n          const updated = { ...prev };\n          delete updated[studentId];\n          return updated;\n        });\n      }\n      \n      return newSelected;\n    });\n  };\n\n  const handleGoalSelection = (studentId: number, goalId: number) => {\n    setSelectedGoals(prev => ({\n      ...prev,\n      [studentId]: goalId\n    }));\n  };\n\n  const startSession = () => {\n    if (Object.keys(selectedGoals).length === 0) {\n      toast({\n        title: \"No Goals Selected\",\n        description: \"Please select at least one goal to start collecting data.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsSessionActive(true);\n    setSessionStartTime(new Date());\n    \n    // Initialize student data\n    const initialData: StudentGoalData[] = Object.entries(selectedGoals).map(([studentIdStr, goalId]) => {\n      const studentId = parseInt(studentIdStr);\n      const student = students.find(s => s.id === studentId);\n      const goal = allGoals.find(g => g.id === goalId);\n      \n      return {\n        studentId,\n        studentName: student?.name || 'Unknown',\n        goalId,\n        goalTitle: goal?.title || 'Unknown',\n        dataType: goal?.dataType || 'frequency',\n        frequencyCount: 0,\n        durationMinutes: 0,\n        durationSeconds: 0,\n        durationTimer: 0,\n        isTimerRunning: false,\n        correctTrials: 0,\n        totalTrials: 0\n      };\n    });\n    \n    setStudentData(initialData);\n    toast({\n      title: \"Session Started\",\n      description: \"Group data collection session is now active\",\n    });\n  };\n\n  const stopSession = () => {\n    setIsSessionActive(false);\n    setSessionStartTime(null);\n    \n    // Clear all running timers\n    Object.values(timerIntervals).forEach(interval => clearInterval(interval));\n    setTimerIntervals({});\n    \n    // Stop all duration timers\n    setStudentData(prev => prev.map(data => ({\n      ...data,\n      isTimerRunning: false\n    })));\n    \n    toast({\n      title: \"Session Stopped\",\n      description: \"Group data collection session has ended\",\n    });\n  };\n\n  const updateStudentData = (studentId: number, goalId: number, updates: Partial<StudentGoalData>) => {\n    setStudentData(prev => prev.map(data => \n      data.studentId === studentId && data.goalId === goalId \n        ? { ...data, ...updates }\n        : data\n    ));\n  };\n\n  const incrementFrequency = (studentId: number, goalId: number) => {\n    updateStudentData(studentId, goalId, {\n      frequencyCount: studentData.find(d => d.studentId === studentId && d.goalId === goalId)?.frequencyCount + 1 || 1\n    });\n  };\n\n  const decrementFrequency = (studentId: number, goalId: number) => {\n    const current = studentData.find(d => d.studentId === studentId && d.goalId === goalId)?.frequencyCount || 0;\n    if (current > 0) {\n      updateStudentData(studentId, goalId, { frequencyCount: current - 1 });\n    }\n  };\n\n  const startDurationTimer = (studentId: number, goalId: number) => {\n    const key = `${studentId}-${goalId}`;\n    updateStudentData(studentId, goalId, { isTimerRunning: true });\n    \n    const interval = setInterval(() => {\n      setStudentData(prev => prev.map(data => \n        data.studentId === studentId && data.goalId === goalId \n          ? { ...data, durationTimer: data.durationTimer + 1 }\n          : data\n      ));\n    }, 1000);\n    \n    setTimerIntervals(prev => ({ ...prev, [key]: interval }));\n  };\n\n  const stopDurationTimer = (studentId: number, goalId: number) => {\n    const key = `${studentId}-${goalId}`;\n    const interval = timerIntervals[key];\n    \n    if (interval) {\n      clearInterval(interval);\n      setTimerIntervals(prev => {\n        const updated = { ...prev };\n        delete updated[key];\n        return updated;\n      });\n    }\n    \n    const currentData = studentData.find(d => d.studentId === studentId && d.goalId === goalId);\n    if (currentData) {\n      const totalSeconds = currentData.durationTimer;\n      const minutes = Math.floor(totalSeconds / 60);\n      const seconds = totalSeconds % 60;\n      \n      updateStudentData(studentId, goalId, {\n        isTimerRunning: false,\n        durationMinutes: minutes,\n        durationSeconds: seconds\n      });\n    }\n  };\n\n  const resetDurationTimer = (studentId: number, goalId: number) => {\n    const key = `${studentId}-${goalId}`;\n    const interval = timerIntervals[key];\n    \n    if (interval) {\n      clearInterval(interval);\n      setTimerIntervals(prev => {\n        const updated = { ...prev };\n        delete updated[key];\n        return updated;\n      });\n    }\n    \n    updateStudentData(studentId, goalId, {\n      durationTimer: 0,\n      durationMinutes: 0,\n      durationSeconds: 0,\n      isTimerRunning: false\n    });\n  };\n\n  const addTrial = (studentId: number, goalId: number, isCorrect: boolean) => {\n    const currentData = studentData.find(d => d.studentId === studentId && d.goalId === goalId);\n    if (currentData) {\n      updateStudentData(studentId, goalId, {\n        totalTrials: currentData.totalTrials + 1,\n        correctTrials: isCorrect ? currentData.correctTrials + 1 : currentData.correctTrials\n      });\n    }\n  };\n\n  const removeTrial = (studentId: number, goalId: number) => {\n    const currentData = studentData.find(d => d.studentId === studentId && d.goalId === goalId);\n    if (currentData && currentData.totalTrials > 0) {\n      // Remove from correct if last trial was correct\n      const wasLastCorrect = currentData.correctTrials / currentData.totalTrials === Math.ceil(currentData.correctTrials / currentData.totalTrials);\n      updateStudentData(studentId, goalId, {\n        totalTrials: currentData.totalTrials - 1,\n        correctTrials: wasLastCorrect ? Math.max(0, currentData.correctTrials - 1) : currentData.correctTrials\n      });\n    }\n  };\n\n  const saveAllData = async () => {\n    try {\n      const savePromises = studentData.map(async (data) => {\n        let progressValue: string;\n        let progressFormat: string;\n        let numerator: number | null = null;\n        let denominator: number | null = null;\n        let durationUnit: string | null = null;\n\n        if (data.dataType === 'frequency') {\n          progressValue = data.frequencyCount.toString();\n          progressFormat = 'frequency';\n        } else if (data.dataType === 'duration') {\n          const totalSeconds = data.durationMinutes * 60 + data.durationSeconds;\n          progressValue = (totalSeconds / 60).toFixed(2);\n          progressFormat = 'duration';\n          durationUnit = 'minutes';\n        } else { // percentage\n          if (data.totalTrials === 0) return null; // Skip if no trials\n          const percentage = (data.correctTrials / data.totalTrials) * 100;\n          progressValue = percentage.toFixed(2);\n          progressFormat = 'percentage';\n          numerator = data.correctTrials;\n          denominator = data.totalTrials;\n        }\n\n        const payload = {\n          goalId: data.goalId,\n          date: new Date().toISOString().split('T')[0],\n          progressFormat,\n          progressValue,\n          numerator,\n          denominator,\n          durationUnit,\n          levelOfSupport: [],\n          anecdotalInfo: `Group collection session: ${sessionStartTime ? new Date().toISOString().split('T')[1].slice(0, 5) : 'Unknown time'}`\n        };\n\n        return apiRequest(\"POST\", `/api/goals/${data.goalId}/data-points`, payload);\n      });\n\n      await Promise.all(savePromises.filter(p => p !== null));\n      \n      toast({\n        title: \"Data Saved Successfully\",\n        description: `Saved data for ${studentData.length} students`,\n      });\n\n      // Reset session\n      stopSession();\n      setStudentData([]);\n      setSelectedGoals({});\n      setSelectedStudents([]);\n\n    } catch (error) {\n      console.error(\"Error saving group data:\", error);\n      toast({\n        title: \"Error Saving Data\",\n        description: \"There was an error saving the group data\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const formatDurationDisplay = (totalSeconds: number) => {\n    const minutes = Math.floor(totalSeconds / 60);\n    const seconds = totalSeconds % 60;\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-4\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-6\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900 flex items-center\">\n              <Users className=\"h-8 w-8 mr-3 text-blue-600\" />\n              Group Data Collection\n            </h1>\n            <p className=\"text-gray-600 mt-1\">Collect data for multiple students simultaneously</p>\n          </div>\n          <Link href=\"/\">\n            <Button variant=\"outline\">\n              Back to Dashboard\n            </Button>\n          </Link>\n        </div>\n\n        {!isSessionActive ? (\n          /* Setup Phase */\n          <div className=\"space-y-6\">\n            {/* Student Selection */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Select Students</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {students.map((student) => (\n                    <div key={student.id} className=\"flex items-center space-x-3 p-3 rounded-lg border\">\n                      <Checkbox\n                        checked={selectedStudents.includes(student.id)}\n                        onCheckedChange={() => handleStudentToggle(student.id)}\n                      />\n                      <div>\n                        <div className=\"font-medium\">{student.name}</div>\n                        <div className=\"text-sm text-gray-500\">{student.grade}</div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Goal Selection */}\n            {selectedStudents.length > 0 && (\n              <Card>\n                <CardHeader>\n                  <CardTitle>Select Goals for Each Student</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-6\">\n                    {selectedStudents.map((studentId) => {\n                      const student = students.find(s => s.id === studentId);\n                      const studentGoals = allGoals.filter(g => g.studentId === studentId);\n                      \n                      return (\n                        <div key={studentId} className=\"p-4 border rounded-lg\">\n                          <h3 className=\"font-medium mb-3\">{student?.name}</h3>\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                            {studentGoals.map((goal) => (\n                              <div key={goal.id} className=\"flex items-center space-x-3\">\n                                <Checkbox\n                                  checked={selectedGoals[studentId] === goal.id}\n                                  onCheckedChange={(checked) => {\n                                    if (checked) {\n                                      handleGoalSelection(studentId, goal.id);\n                                    } else {\n                                      setSelectedGoals(prev => {\n                                        const updated = { ...prev };\n                                        delete updated[studentId];\n                                        return updated;\n                                      });\n                                    }\n                                  }}\n                                />\n                                <div className=\"flex-1\">\n                                  <div className=\"font-medium\">{goal.title}</div>\n                                  <Badge variant=\"secondary\" className=\"text-xs\">\n                                    {goal.dataType}\n                                  </Badge>\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Start Session */}\n            {Object.keys(selectedGoals).length > 0 && (\n              <div className=\"text-center\">\n                <Button onClick={startSession} size=\"lg\" className=\"bg-green-600 hover:bg-green-700\">\n                  <Play className=\"h-5 w-5 mr-2\" />\n                  Start Group Session\n                </Button>\n              </div>\n            )}\n          </div>\n        ) : (\n          /* Active Session */\n          <div className=\"space-y-6\">\n            {/* Session Header */}\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center space-x-4\">\n                    <div className=\"h-3 w-3 bg-green-500 rounded-full animate-pulse\"></div>\n                    <span className=\"font-medium\">Session Active</span>\n                    <span className=\"text-sm text-gray-500\">\n                      Started: {sessionStartTime?.toLocaleTimeString()}\n                    </span>\n                  </div>\n                  <div className=\"space-x-2\">\n                    <Button onClick={saveAllData} className=\"bg-blue-600 hover:bg-blue-700\">\n                      <Save className=\"h-4 w-4 mr-2\" />\n                      Save All Data\n                    </Button>\n                    <Button onClick={stopSession} variant=\"destructive\">\n                      <Square className=\"h-4 w-4 mr-2\" />\n                      Stop Session\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Student Data Collection Cards */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6\">\n              {studentData.map((data) => (\n                <Card key={`${data.studentId}-${data.goalId}`} className=\"h-fit\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-lg\">{data.studentName}</CardTitle>\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-600\">{data.goalTitle}</span>\n                      <Badge variant=\"secondary\">{data.dataType}</Badge>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    {data.dataType === 'frequency' && (\n                      <div className=\"space-y-4\">\n                        <div className=\"text-center\">\n                          <div className=\"text-4xl font-bold text-blue-600\">{data.frequencyCount}</div>\n                          <div className=\"text-sm text-gray-500\">occurrences</div>\n                        </div>\n                        <div className=\"flex justify-center space-x-2\">\n                          <Button\n                            onClick={() => incrementFrequency(data.studentId, data.goalId)}\n                            size=\"sm\"\n                            className=\"bg-green-600 hover:bg-green-700\"\n                          >\n                            <Plus className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            onClick={() => decrementFrequency(data.studentId, data.goalId)}\n                            size=\"sm\"\n                            variant=\"outline\"\n                            disabled={data.frequencyCount === 0}\n                          >\n                            <Minus className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    )}\n\n                    {data.dataType === 'duration' && (\n                      <div className=\"space-y-4\">\n                        <div className=\"text-center\">\n                          <div className=\"text-4xl font-bold text-green-600\">\n                            {formatDurationDisplay(data.durationTimer)}\n                          </div>\n                          <div className=\"text-sm text-gray-500\">\n                            Final: {data.durationMinutes}m {data.durationSeconds}s\n                          </div>\n                        </div>\n                        <div className=\"flex justify-center space-x-2\">\n                          {!data.isTimerRunning ? (\n                            <Button\n                              onClick={() => startDurationTimer(data.studentId, data.goalId)}\n                              size=\"sm\"\n                              className=\"bg-green-600 hover:bg-green-700\"\n                            >\n                              <Play className=\"h-4 w-4\" />\n                            </Button>\n                          ) : (\n                            <Button\n                              onClick={() => stopDurationTimer(data.studentId, data.goalId)}\n                              size=\"sm\"\n                              variant=\"destructive\"\n                            >\n                              <Square className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                          <Button\n                            onClick={() => resetDurationTimer(data.studentId, data.goalId)}\n                            size=\"sm\"\n                            variant=\"outline\"\n                          >\n                            <RotateCcw className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    )}\n\n                    {data.dataType === 'percentage' && (\n                      <div className=\"space-y-4\">\n                        <div className=\"text-center\">\n                          <div className=\"text-4xl font-bold text-purple-600\">\n                            {data.totalTrials > 0 ? Math.round((data.correctTrials / data.totalTrials) * 100) : 0}%\n                          </div>\n                          <div className=\"text-sm text-gray-500\">\n                            {data.correctTrials} / {data.totalTrials} correct\n                          </div>\n                        </div>\n                        <div className=\"flex justify-center space-x-2\">\n                          <Button\n                            onClick={() => addTrial(data.studentId, data.goalId, true)}\n                            size=\"sm\"\n                            className=\"bg-green-600 hover:bg-green-700\"\n                          >\n                            <Check className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            onClick={() => addTrial(data.studentId, data.goalId, false)}\n                            size=\"sm\"\n                            className=\"bg-red-600 hover:bg-red-700\"\n                          >\n                            <X className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            onClick={() => removeTrial(data.studentId, data.goalId)}\n                            size=\"sm\"\n                            variant=\"outline\"\n                            disabled={data.totalTrials === 0}\n                          >\n                            <Minus className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":22417,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/lib/masteryDetection.ts":{"content":"import moment from 'moment';\n\ninterface DataPoint {\n  id: number;\n  goalId: number;\n  objectiveId?: number | null;\n  progressValue: string;\n  date: string;\n  progressFormat: string;\n  numerator?: number;\n  denominator?: number;\n}\n\ninterface Goal {\n  id: number;\n  title: string;\n  targetCriteria?: string;\n  dataCollectionType: string;\n  status: string;\n}\n\ninterface Objective {\n  id: number;\n  description: string;\n  targetCriteria?: string;\n  status: string;\n}\n\nexport interface MasteryAlert {\n  id: string;\n  type: 'goal' | 'objective';\n  itemId: number;\n  title: string;\n  description: string;\n  targetCriteria: string;\n  masteryDate: string;\n  dataPointsUsed: number[];\n  studentId: number;\n}\n\n/**\n * Parse target criteria string and extract mastery requirements\n * \n * Supported formats:\n * - \"80% accuracy over 3 consecutive sessions\" -> ALL 3 recent sessions must be >= 80%\n * - \"90% for 5 consecutive trials\" -> ALL 5 recent trials must be >= 90%\n * - \"80% accuracy in 4/5 trials\" -> 4 out of last 5 trials must be >= 80%\n * - \"4 out of 5 sessions at 85%\" -> 4 out of last 5 sessions must be >= 85%\n * - \"80% in 4 out of 5 trials\" -> 4 out of last 5 trials must be >= 80%\n * - \"Reduce frequency to under 2 per hour for 3 days\" -> frequency reduction goal\n * \n * Key distinction:\n * - \"X/Y trials\" or \"X out of Y\" = X successes required out of Y total trials\n * - \"X consecutive\" = ALL X trials must meet threshold (no failures allowed)\n */\nexport function parseTargetCriteria(criteria: string): {\n  threshold: number;\n  consecutiveCount: number;\n  isFrequencyReduction?: boolean;\n  totalCount?: number | null;\n} | null {\n  if (!criteria) return null;\n\n  const criteriaLower = criteria.toLowerCase();\n  \n  // Extract percentage threshold\n  const percentMatch = criteriaLower.match(/(\\d+)%/);\n  const threshold = percentMatch ? parseInt(percentMatch[1]) : null;\n  \n  // Extract trial counts - handle various patterns\n  // Pattern 1: \"X/Y\" notation (e.g., \"4/5 trials\", \"3/4 sessions\")\n  const slashMatch = criteriaLower.match(/(\\d+)\\s*\\/\\s*(\\d+)\\s*(?:trial|session|attempt|opportunit)/i);\n  \n  // Pattern 2: \"X out of Y\" notation (e.g., \"4 out of 5 trials\")\n  const outOfMatch = criteriaLower.match(/(\\d+)\\s*out\\s*of\\s*(\\d+)/);\n  \n  // Pattern 3: Consecutive pattern (e.g., \"3 consecutive sessions\", \"over 4 sessions\")\n  const consecutiveMatch = criteriaLower.match(/(\\d+)\\s*consecutive|over\\s*(\\d+)|for\\s*(\\d+)/);\n  \n  let consecutiveCount: number;\n  let totalCount: number | null = null;\n  \n  if (slashMatch) {\n    // Handle \"X/Y\" pattern (e.g., \"4/5 trials\")\n    consecutiveCount = parseInt(slashMatch[1]);\n    totalCount = parseInt(slashMatch[2]);\n  } else if (outOfMatch) {\n    // Handle \"X out of Y\" pattern\n    consecutiveCount = parseInt(outOfMatch[1]);\n    totalCount = parseInt(outOfMatch[2]);\n  } else if (consecutiveMatch) {\n    // Handle consecutive pattern - ALL trials must meet threshold\n    consecutiveCount = parseInt(consecutiveMatch[1] || consecutiveMatch[2] || consecutiveMatch[3]);\n    // For consecutive, totalCount stays null - meaning ALL consecutiveCount trials must succeed\n  } else {\n    consecutiveCount = 3; // Default to 3\n  }\n  \n  // Check for frequency reduction goals\n  const isFrequencyReduction = criteriaLower.includes('reduce') || \n                               criteriaLower.includes('decrease') || \n                               criteriaLower.includes('under') ||\n                               criteriaLower.includes('less than');\n\n  if (threshold === null) return null;\n\n  return {\n    threshold,\n    consecutiveCount,\n    isFrequencyReduction,\n    totalCount\n  };\n}\n\n/**\n * Check if data points meet mastery criteria using a sliding window approach.\n * \n * For \"X out of Y\" criteria (e.g., \"4/5 trials\"):\n * - Scans through ALL data points looking for ANY window of Y trials\n *   where at least X meet the threshold\n * - Returns the FIRST (earliest) window where mastery was achieved\n * \n * For \"consecutive\" criteria (e.g., \"3 consecutive sessions\"):\n * - Looks for ANY window where ALL trials meet the threshold\n */\nexport function checkMastery(\n  dataPoints: DataPoint[],\n  targetCriteria: string,\n  dataCollectionType: string = 'percentage'\n): { isMastered: boolean; masteryDate?: string; dataPointsUsed?: number[] } {\n  const criteria = parseTargetCriteria(targetCriteria);\n  if (!criteria || dataPoints.length === 0) {\n    return { isMastered: false };\n  }\n\n  // Sort data points by date (oldest first for sliding window)\n  const sortedPoints = [...dataPoints].sort((a, b) => \n    moment(a.date).valueOf() - moment(b.date).valueOf()\n  );\n\n  const { threshold, consecutiveCount, isFrequencyReduction, totalCount } = criteria;\n\n  // Handle \"X out of Y\" pattern with sliding window\n  if (totalCount && totalCount > 0) {\n    // Need at least totalCount data points to evaluate\n    if (sortedPoints.length < totalCount) {\n      return { isMastered: false };\n    }\n\n    // Sliding window: check every possible window of size totalCount\n    for (let i = 0; i <= sortedPoints.length - totalCount; i++) {\n      const windowPoints = sortedPoints.slice(i, i + totalCount);\n      \n      // For frequency reduction goals\n      if (dataCollectionType === 'frequency' && isFrequencyReduction) {\n        const belowThresholdCount = windowPoints.filter(point => {\n          const value = parseFloat(point.progressValue);\n          return value <= threshold;\n        }).length;\n\n        if (belowThresholdCount >= consecutiveCount) {\n          // Found a window where mastery is achieved\n          // The mastery date is the last point in this window (when mastery was confirmed)\n          return {\n            isMastered: true,\n            masteryDate: windowPoints[windowPoints.length - 1].date,\n            dataPointsUsed: windowPoints.map(p => p.id)\n          };\n        }\n      }\n      // For percentage/accuracy goals\n      else {\n        const aboveThresholdCount = windowPoints.filter(point => {\n          const value = parseFloat(point.progressValue);\n          return value >= threshold;\n        }).length;\n\n        if (aboveThresholdCount >= consecutiveCount) {\n          // Found a window where mastery is achieved\n          return {\n            isMastered: true,\n            masteryDate: windowPoints[windowPoints.length - 1].date,\n            dataPointsUsed: windowPoints.map(p => p.id)\n          };\n        }\n      }\n    }\n  }\n  // Handle consecutive pattern with sliding window\n  else {\n    // Need at least consecutiveCount data points to evaluate\n    if (sortedPoints.length < consecutiveCount) {\n      return { isMastered: false };\n    }\n\n    // Sliding window: check every possible window of size consecutiveCount\n    for (let i = 0; i <= sortedPoints.length - consecutiveCount; i++) {\n      const windowPoints = sortedPoints.slice(i, i + consecutiveCount);\n      \n      // For frequency reduction goals\n      if (dataCollectionType === 'frequency' && isFrequencyReduction) {\n        const allBelowThreshold = windowPoints.every(point => \n          parseFloat(point.progressValue) <= threshold\n        );\n\n        if (allBelowThreshold) {\n          return {\n            isMastered: true,\n            masteryDate: windowPoints[windowPoints.length - 1].date,\n            dataPointsUsed: windowPoints.map(p => p.id)\n          };\n        }\n      }\n      // For percentage/accuracy goals\n      else {\n        const allMeetThreshold = windowPoints.every(point => {\n          const value = parseFloat(point.progressValue);\n          return value >= threshold;\n        });\n\n        if (allMeetThreshold) {\n          return {\n            isMastered: true,\n            masteryDate: windowPoints[windowPoints.length - 1].date,\n            dataPointsUsed: windowPoints.map(p => p.id)\n          };\n        }\n      }\n    }\n  }\n\n  return { isMastered: false };\n}\n\n/**\n * Helper function to check if an objective has achieved mastery\n */\nfunction checkObjectiveMastery(\n  objective: Objective,\n  allDataPoints: DataPoint[],\n  dataCollectionType: string\n): { isMastered: boolean; masteryDate?: string; dataPointsUsed?: number[] } {\n  if (!objective.targetCriteria) {\n    return { isMastered: false };\n  }\n\n  const objectiveDataPoints = allDataPoints.filter(dp => \n    dp.objectiveId === objective.id && dp.id && dp.progressValue && !isNaN(parseFloat(dp.progressValue))\n  );\n\n  if (objectiveDataPoints.length === 0) {\n    return { isMastered: false };\n  }\n\n  return checkMastery(objectiveDataPoints, objective.targetCriteria, dataCollectionType);\n}\n\n/**\n * Check all goals and objectives for mastery\n * \n * IMPORTANT: Goals with objectives only show mastery when ALL objectives are mastered.\n * Goals without objectives use the goal-level data point evaluation.\n */\nexport function detectMastery(\n  goals: Goal[],\n  objectives: { [goalId: number]: Objective[] },\n  allDataPoints: DataPoint[],\n  studentId: number\n): MasteryAlert[] {\n  const alerts: MasteryAlert[] = [];\n\n  // First, check objectives for mastery and track which ones are mastered\n  const objectiveMasteryStatus: { [objectiveId: number]: boolean } = {};\n  const objectiveAlerts: MasteryAlert[] = [];\n\n  Object.entries(objectives).forEach(([goalId, goalObjectives]) => {\n    const goal = goals.find(g => g.id === parseInt(goalId));\n    if (!goal || !Array.isArray(goalObjectives)) return;\n\n    goalObjectives.forEach(objective => {\n      // Check if objective is already marked as mastered in status\n      if (objective.status === 'mastered') {\n        objectiveMasteryStatus[objective.id] = true;\n        return;\n      }\n\n      if (!objective.targetCriteria) {\n        objectiveMasteryStatus[objective.id] = false;\n        return;\n      }\n\n      const masteryResult = checkObjectiveMastery(objective, allDataPoints, goal.dataCollectionType);\n      objectiveMasteryStatus[objective.id] = masteryResult.isMastered;\n      \n      if (masteryResult.isMastered) {\n        console.log('ðŸŽ¯ MASTERY ALERT: Objective achieved mastery!', {\n          objectiveId: objective.id,\n          goalTitle: goal.title,\n          criteria: objective.targetCriteria\n        });\n        \n        objectiveAlerts.push({\n          id: `objective-${objective.id}`,\n          type: 'objective',\n          itemId: objective.id,\n          title: `${goal.title} - Objective`,\n          description: objective.description,\n          targetCriteria: objective.targetCriteria,\n          masteryDate: masteryResult.masteryDate!,\n          dataPointsUsed: masteryResult.dataPointsUsed!,\n          studentId\n        });\n      }\n    });\n  });\n\n  // Add all objective alerts\n  alerts.push(...objectiveAlerts);\n\n  // Check goals for mastery\n  goals.forEach(goal => {\n    if (goal.status === 'mastered' || !goal.targetCriteria) {\n      return;\n    }\n\n    const goalObjectives = objectives[goal.id] || [];\n    const hasObjectives = goalObjectives.length > 0;\n\n    if (hasObjectives) {\n      // Goal has objectives - only show mastery if ALL objectives are mastered\n      const objectivesWithCriteria = goalObjectives.filter(obj => obj.targetCriteria);\n      \n      if (objectivesWithCriteria.length === 0) {\n        // Goal has objectives but none have target criteria - fall back to goal-level evaluation\n        const goalDataPoints = allDataPoints.filter(dp => \n          dp.goalId === goal.id && dp.id && dp.progressValue && !isNaN(parseFloat(dp.progressValue))\n        );\n\n        if (goalDataPoints.length === 0) return;\n\n        const masteryResult = checkMastery(goalDataPoints, goal.targetCriteria, goal.dataCollectionType);\n        \n        if (masteryResult.isMastered) {\n          alerts.push({\n            id: `goal-${goal.id}`,\n            type: 'goal',\n            itemId: goal.id,\n            title: goal.title,\n            description: `Goal \"${goal.title}\" has met mastery criteria`,\n            targetCriteria: goal.targetCriteria,\n            masteryDate: masteryResult.masteryDate!,\n            dataPointsUsed: masteryResult.dataPointsUsed!,\n            studentId\n          });\n        }\n      } else {\n        // Check if ALL objectives with criteria are mastered\n        const allObjectivesMastered = objectivesWithCriteria.every(obj => {\n          // Check if already mastered in status OR detected as mastered in this run\n          return obj.status === 'mastered' || objectiveMasteryStatus[obj.id] === true;\n        });\n\n        if (allObjectivesMastered) {\n          // Find the most recent mastery date among all objectives\n          const objectiveMasteryDates = objectiveAlerts\n            .filter(alert => goalObjectives.some(obj => obj.id === alert.itemId))\n            .map(alert => alert.masteryDate);\n          \n          // Also check for already-mastered objectives\n          const alreadyMasteredObjectives = objectivesWithCriteria.filter(obj => obj.status === 'mastered');\n          \n          const latestMasteryDate = objectiveMasteryDates.length > 0 \n            ? objectiveMasteryDates.sort((a, b) => moment(b).valueOf() - moment(a).valueOf())[0]\n            : moment().format('YYYY-MM-DD');\n\n          // Collect all data point IDs used for objective mastery\n          const allDataPointsUsed = objectiveAlerts\n            .filter(alert => goalObjectives.some(obj => obj.id === alert.itemId))\n            .flatMap(alert => alert.dataPointsUsed);\n\n          console.log('ðŸŽ¯ GOAL MASTERY: All objectives mastered for goal!', {\n            goalId: goal.id,\n            goalTitle: goal.title,\n            objectiveCount: objectivesWithCriteria.length,\n            masteredCount: objectivesWithCriteria.filter(obj => \n              obj.status === 'mastered' || objectiveMasteryStatus[obj.id] === true\n            ).length\n          });\n\n          alerts.push({\n            id: `goal-${goal.id}`,\n            type: 'goal',\n            itemId: goal.id,\n            title: goal.title,\n            description: `Goal \"${goal.title}\" is complete - all ${objectivesWithCriteria.length} objectives have been mastered`,\n            targetCriteria: goal.targetCriteria,\n            masteryDate: latestMasteryDate,\n            dataPointsUsed: allDataPointsUsed,\n            studentId\n          });\n        }\n      }\n    } else {\n      // Goal has NO objectives - use goal-level data point evaluation (original behavior)\n      const goalDataPoints = allDataPoints.filter(dp => \n        dp.goalId === goal.id && dp.id && dp.progressValue && !isNaN(parseFloat(dp.progressValue))\n      );\n\n      if (goalDataPoints.length === 0) return;\n\n      const masteryResult = checkMastery(goalDataPoints, goal.targetCriteria, goal.dataCollectionType);\n      \n      if (masteryResult.isMastered) {\n        alerts.push({\n          id: `goal-${goal.id}`,\n          type: 'goal',\n          itemId: goal.id,\n          title: goal.title,\n          description: `Goal \"${goal.title}\" has met mastery criteria`,\n          targetCriteria: goal.targetCriteria,\n          masteryDate: masteryResult.masteryDate!,\n          dataPointsUsed: masteryResult.dataPointsUsed!,\n          studentId\n        });\n      }\n    }\n  });\n\n  console.log('ðŸŽ¯ MASTERY ALERTS GENERATED:', alerts.length, alerts);\n  return alerts;\n}","path":null,"size_bytes":15087,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"DEPLOYMENT.md":{"content":"# Deployment Guide - Special Education Data Platform\n\n## Prerequisites\n\n### System Requirements\n- Node.js 18+ \n- PostgreSQL 12+\n- npm or yarn package manager\n- SSL certificate for HTTPS (required for production)\n\n### Required Environment Variables\nCopy `.env.example` to `.env` and configure:\n\n```bash\n# Database\nDATABASE_URL=postgresql://username:password@hostname:port/database_name\n\n# Session Security\nSESSION_SECRET=generate_a_secure_32_character_random_string\n\n# Application\nNODE_ENV=production\nPORT=5000\n```\n\n## Deployment Steps\n\n### 1. Prepare the Server\n```bash\n# Clone/copy the application files\ngit clone <your-repository>\ncd special-education-platform\n\n# Install dependencies\nnpm install\n\n# Build the application\nnpm run build\n```\n\n### 2. Database Setup\n```bash\n# Create PostgreSQL database\ncreatedb special_education_platform\n\n# Set up database schema\nnpm run db:push\n```\n\n### 3. Configure Web Server\n\n#### Option A: Direct Node.js (Development/Testing)\n```bash\nnpm start\n```\n\n#### Option B: Production with PM2\n```bash\n# Install PM2 globally\nnpm install -g pm2\n\n# Start application\npm2 start dist/index.js --name \"special-education-platform\"\n\n# Save PM2 configuration\npm2 save\npm2 startup\n```\n\n#### Option C: Production with Nginx Reverse Proxy\nCreate `/etc/nginx/sites-available/special-education-platform`:\n\n```nginx\nserver {\n    listen 80;\n    server_name your-domain.com www.your-domain.com;\n    \n    # Redirect HTTP to HTTPS\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name your-domain.com www.your-domain.com;\n    \n    # SSL Configuration\n    ssl_certificate /path/to/your/certificate.crt;\n    ssl_certificate_key /path/to/your/private.key;\n    \n    # Security headers\n    add_header X-Frame-Options DENY;\n    add_header X-Content-Type-Options nosniff;\n    add_header X-XSS-Protection \"1; mode=block\";\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n    \n    # Proxy to Node.js application\n    location / {\n        proxy_pass http://localhost:5000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n        proxy_read_timeout 86400;\n    }\n    \n    # WebSocket support for live features\n    location /ws {\n        proxy_pass http://localhost:5000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n    \n    # Static file optimization\n    location ~* \\.(js|css|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot)$ {\n        expires 1y;\n        add_header Cache-Control \"public, immutable\";\n    }\n}\n```\n\nEnable the site:\n```bash\nsudo ln -s /etc/nginx/sites-available/special-education-platform /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl reload nginx\n```\n\n### 4. SSL Certificate (Let's Encrypt)\n```bash\n# Install Certbot\nsudo apt install certbot python3-certbot-nginx\n\n# Obtain certificate\nsudo certbot --nginx -d your-domain.com -d www.your-domain.com\n```\n\n## Production Security Checklist\n\n### Database Security\n- [ ] Use strong database passwords\n- [ ] Enable SSL connections to database\n- [ ] Restrict database access to application server only\n- [ ] Regular database backups configured\n\n### Application Security\n- [ ] Strong SESSION_SECRET (32+ random characters)\n- [ ] HTTPS enabled with valid SSL certificate\n- [ ] Environment variables secured\n- [ ] Regular security updates\n- [ ] File upload restrictions implemented\n- [ ] Rate limiting configured\n\n### Server Security\n- [ ] Firewall configured (only ports 22, 80, 443 open)\n- [ ] SSH key authentication (disable password auth)\n- [ ] Regular system updates\n- [ ] Log monitoring configured\n- [ ] Backup strategy implemented\n\n## Authentication Setup\n\n### Option A: Disable Authentication (Internal Use)\nFor internal organizational use, authentication can be disabled by modifying `server/routes.ts`:\n\n```javascript\n// Comment out authentication middleware\n// app.use(isAuthenticated);\n\n// Use hardcoded user ID for all operations\nconst HARDCODED_USER_ID = \"your_organization_id\";\n```\n\n### Option B: Custom Authentication\nImplement your own authentication system by replacing the OpenID Connect setup in `server/replitAuth.ts`.\n\n### Option C: OpenID Connect Provider\nConfigure with your own OpenID Connect provider by updating environment variables.\n\n## Monitoring and Maintenance\n\n### Log Management\n- Application logs: Check PM2 logs with `pm2 logs`\n- Nginx logs: `/var/log/nginx/`\n- Database logs: PostgreSQL log directory\n\n### Database Maintenance\n```bash\n# Create database backups\npg_dump special_education_platform > backup_$(date +%Y%m%d).sql\n\n# Monitor database size and performance\n# Set up automated cleanup of old session data\n```\n\n### Application Updates\n```bash\n# Pull latest changes\ngit pull origin main\n\n# Install new dependencies\nnpm install\n\n# Rebuild application\nnpm run build\n\n# Restart application\npm2 restart special-education-platform\n```\n\n## Troubleshooting\n\n### Common Issues\n1. **Database Connection Issues**: Verify DATABASE_URL and PostgreSQL service status\n2. **Session Issues**: Check SESSION_SECRET configuration and PostgreSQL sessions table\n3. **File Permissions**: Ensure application has write permissions for uploads\n4. **SSL Certificate Issues**: Verify certificate validity and nginx configuration\n\n### Support\n- Check application logs: `pm2 logs special-education-platform`\n- Database status: `systemctl status postgresql`\n- Web server status: `systemctl status nginx`\n\n## Performance Optimization\n\n### Database Optimization\n- Regular VACUUM and ANALYZE operations\n- Index optimization for frequent queries\n- Connection pooling configuration\n\n### Application Optimization\n- Enable gzip compression in nginx\n- Configure proper caching headers\n- Monitor memory usage and optimize as needed\n- Use CDN for static assets if needed\n\n## Backup Strategy\n\n### Automated Backups\n```bash\n# Create backup script\n#!/bin/bash\nDATE=$(date +%Y%m%d_%H%M%S)\npg_dump special_education_platform > /backups/db_backup_$DATE.sql\nfind /backups -name \"db_backup_*.sql\" -mtime +30 -delete\n\n# Add to crontab for daily backups\n0 2 * * * /path/to/backup_script.sh\n```","path":null,"size_bytes":6660,"size_tokens":null},"client/src/components/monthly-reminder-popup.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { AlertDialog, AlertDialogAction, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { Calendar, Clock, GraduationCap, AlertCircle } from \"lucide-react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport moment from 'moment';\n\ninterface Student {\n  id: number;\n  name: string;\n  iepDueDate: string | null;\n  grade?: string;\n}\n\ninterface ReportingPeriod {\n  periodNumber: number;\n  startDate: string;\n  endDate: string;\n}\n\ninterface ReportingPeriodsData {\n  periodLength: string;\n  periods: ReportingPeriod[];\n  savedAt: string;\n}\n\ninterface ReminderEvent {\n  id: string;\n  title: string;\n  date: Date;\n  type: 'iep-due' | 'period-start' | 'period-end';\n  studentName?: string;\n  periodNumber?: number;\n  daysUntil: number;\n}\n\nexport default function MonthlyReminderPopup() {\n  const [showReminder, setShowReminder] = useState(false);\n  const [upcomingEvents, setUpcomingEvents] = useState<ReminderEvent[]>([]);\n\n  const { data: students } = useQuery({\n    queryKey: [\"/api/students\"],\n  });\n\n  const { data: reportingPeriodsFromDB } = useQuery({\n    queryKey: [\"/api/reporting-periods\"],\n  });\n\n  useEffect(() => {\n    checkForUpcomingEvents();\n  }, [students, reportingPeriodsFromDB]);\n\n  const checkForUpcomingEvents = () => {\n    // Use UTC to avoid timezone issues\n    const currentDate = moment.utc();\n    const currentMonth = currentDate.format('YYYY-MM');\n    const lastShownMonth = localStorage.getItem('lastReminderMonth');\n    const sessionShown = sessionStorage.getItem('reminderShownThisSession');\n    \n    // Don't show if already shown in this session\n    if (sessionShown === 'true') {\n      return;\n    }\n    \n    // Only show reminder once per month or if it's a new month\n    if (lastShownMonth === currentMonth) {\n      return;\n    }\n\n    const events: ReminderEvent[] = [];\n    const startOfMonth = moment.utc().startOf('month');\n    const endOfMonth = moment.utc().endOf('month');\n\n    // Check for IEP due dates in current month\n    if (students && Array.isArray(students)) {\n      students.forEach((student: Student) => {\n        if (student.iepDueDate) {\n          const dueDate = moment.utc(student.iepDueDate);\n          if (dueDate.isBetween(startOfMonth, endOfMonth, 'day', '[]')) {\n            const daysUntil = dueDate.diff(currentDate, 'days');\n            if (daysUntil >= 0) { // Only show future or today's events\n              events.push({\n                id: `iep-${student.id}`,\n                title: `IEP Due - ${student.name}`,\n                date: dueDate.toDate(),\n                type: 'iep-due',\n                studentName: student.name,\n                daysUntil\n              });\n            }\n          }\n        }\n      });\n    }\n\n    // Check for reporting period events in current month\n    let reportingData: ReportingPeriodsData | null = null;\n    \n    if (reportingPeriodsFromDB && \n        typeof reportingPeriodsFromDB === 'object' && \n        'periods' in reportingPeriodsFromDB &&\n        Array.isArray((reportingPeriodsFromDB as any).periods) &&\n        (reportingPeriodsFromDB as any).periods.length > 0) {\n      reportingData = reportingPeriodsFromDB as ReportingPeriodsData;\n    } else {\n      // Fallback to localStorage if database doesn't have data\n      const savedData = localStorage.getItem('reportingPeriods');\n      if (savedData) {\n        try {\n          const parsedData = JSON.parse(savedData);\n          if (parsedData && Array.isArray(parsedData.periods)) {\n            reportingData = parsedData as ReportingPeriodsData;\n          }\n        } catch (e) {\n          console.error('Error parsing reporting periods from localStorage:', e);\n        }\n      }\n    }\n\n    if (reportingData && reportingData.periods && Array.isArray(reportingData.periods)) {\n      reportingData.periods.forEach((period: ReportingPeriod) => {\n        const startDate = moment.utc(period.startDate);\n        const endDate = moment.utc(period.endDate);\n\n        // Check if period start is in current month\n        if (startDate.isBetween(startOfMonth, endOfMonth, 'day', '[]')) {\n          const daysUntil = startDate.diff(currentDate, 'days');\n          if (daysUntil >= 0) {\n            events.push({\n              id: `period-start-${period.periodNumber}`,\n              title: `Reporting Period ${period.periodNumber} Begins`,\n              date: startDate.toDate(),\n              type: 'period-start',\n              periodNumber: period.periodNumber,\n              daysUntil\n            });\n          }\n        }\n\n        // Check if period end is in current month\n        if (endDate.isBetween(startOfMonth, endOfMonth, 'day', '[]')) {\n          const daysUntil = endDate.diff(currentDate, 'days');\n          if (daysUntil >= 0) {\n            events.push({\n              id: `period-end-${period.periodNumber}`,\n              title: `Reporting Period ${period.periodNumber} Ends`,\n              date: endDate.toDate(),\n              type: 'period-end',\n              periodNumber: period.periodNumber,\n              daysUntil\n            });\n          }\n        }\n      });\n    }\n\n    // Sort events by date\n    events.sort((a, b) => a.date.getTime() - b.date.getTime());\n\n    if (events.length > 0) {\n      setUpcomingEvents(events);\n      setShowReminder(true);\n      // Mark as shown for this session\n      sessionStorage.setItem('reminderShownThisSession', 'true');\n    }\n  };\n\n  const handleDismiss = () => {\n    setShowReminder(false);\n    // Mark this month as shown\n    const currentMonth = moment().format('YYYY-MM');\n    localStorage.setItem('lastReminderMonth', currentMonth);\n  };\n\n  const getEventIcon = (type: string) => {\n    switch (type) {\n      case 'iep-due':\n        return <GraduationCap className=\"h-4 w-4\" />;\n      case 'period-start':\n        return <Calendar className=\"h-4 w-4\" />;\n      case 'period-end':\n        return <Clock className=\"h-4 w-4\" />;\n      default:\n        return <AlertCircle className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getEventColor = (type: string) => {\n    switch (type) {\n      case 'iep-due':\n        return 'bg-red-100 text-red-800 border-red-200';\n      case 'period-start':\n        return 'bg-blue-100 text-blue-800 border-blue-200';\n      case 'period-end':\n        return 'bg-orange-100 text-orange-800 border-orange-200';\n      default:\n        return 'bg-gray-100 text-gray-800 border-gray-200';\n    }\n  };\n\n  const formatDaysUntil = (days: number) => {\n    if (days === 0) return 'Today';\n    if (days === 1) return 'Tomorrow';\n    return `${days} days`;\n  };\n\n  return (\n    <AlertDialog open={showReminder} onOpenChange={setShowReminder}>\n      <AlertDialogContent className=\"max-w-md\">\n        <AlertDialogHeader>\n          <AlertDialogTitle className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5 text-primary\" />\n            Monthly Reminders\n          </AlertDialogTitle>\n          <AlertDialogDescription>\n            You have {upcomingEvents.length} upcoming event{upcomingEvents.length !== 1 ? 's' : ''} this month:\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n\n        <div className=\"space-y-3 max-h-64 overflow-y-auto\">\n          {upcomingEvents.map((event) => (\n            <Card key={event.id} className=\"border border-gray-200\">\n              <CardContent className=\"p-3\">\n                <div className=\"flex items-start justify-between gap-3\">\n                  <div className=\"flex items-start gap-2 flex-1\">\n                    <div className={`p-1 rounded-full ${getEventColor(event.type)}`}>\n                      {getEventIcon(event.type)}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium text-gray-900 truncate\">\n                        {event.title}\n                      </p>\n                      <p className=\"text-xs text-gray-500 mt-1\">\n                        {moment(event.date).format('MMM D, YYYY')}\n                      </p>\n                      {event.studentName && (\n                        <p className=\"text-xs text-gray-600 mt-1\">\n                          Student: {event.studentName}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                  <Badge \n                    variant=\"outline\" \n                    className={`text-xs whitespace-nowrap ${\n                      event.daysUntil <= 7 ? 'border-red-300 text-red-700' : 'border-gray-300 text-gray-700'\n                    }`}\n                  >\n                    {formatDaysUntil(event.daysUntil)}\n                  </Badge>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        <AlertDialogFooter>\n          <AlertDialogAction onClick={handleDismiss}>\n            Got it, thanks!\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}","path":null,"size_bytes":9127,"size_tokens":null},"client/src/hooks/use-mastery-review.ts":{"content":"import { useState, useEffect } from 'react';\n\ninterface ReviewItem {\n  id: string;\n  type: 'goal' | 'objective';\n  itemId: number;\n  title: string;\n  targetCriteria: string;\n  masteryDate: string;\n}\n\nexport function useMasteryReview(studentId: number) {\n  const [reviewItems, setReviewItems] = useState<ReviewItem[]>([]);\n\n  useEffect(() => {\n    const reviewKey = `masteryAlerts_needsReview_${studentId}`;\n    const stored = localStorage.getItem(reviewKey);\n    if (stored) {\n      setReviewItems(JSON.parse(stored));\n    }\n  }, [studentId]);\n\n  const markAsReviewed = (itemId: number, type: 'goal' | 'objective') => {\n    const reviewKey = `masteryAlerts_needsReview_${studentId}`;\n    const filtered = reviewItems.filter(item => \n      !(item.itemId === itemId && item.type === type)\n    );\n    setReviewItems(filtered);\n    localStorage.setItem(reviewKey, JSON.stringify(filtered));\n  };\n\n  const needsReview = (itemId: number, type: 'goal' | 'objective') => {\n    return reviewItems.some(item => \n      item.itemId === itemId && item.type === type\n    );\n  };\n\n  const getReviewItem = (itemId: number, type: 'goal' | 'objective') => {\n    return reviewItems.find(item => \n      item.itemId === itemId && item.type === type\n    );\n  };\n\n  return {\n    reviewItems,\n    markAsReviewed,\n    needsReview,\n    getReviewItem\n  };\n}","path":null,"size_bytes":1330,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":1901,"size_tokens":null},"client/src/components/add-student-modal.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { z } from \"zod\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { Check, X } from \"lucide-react\";\n\nconst RELATED_SERVICES_OPTIONS = [\n  \"None\",\n  \"Speech-Language Therapy\",\n  \"Physical Therapy\", \n  \"Occupational Therapy\",\n  \"Nursing\",\n  \"Hearing\",\n  \"Vision\"\n];\n\nconst addStudentSchema = z.object({\n  name: z.string().min(1, \"Student name is required\"),\n  grade: z.string().optional(),\n  iepDueDate: z.string().optional(),\n  relatedServices: z.array(z.string()).optional(),\n});\n\ntype AddStudentFormData = z.infer<typeof addStudentSchema>;\n\ninterface AddStudentModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess?: () => void;\n}\n\nexport default function AddStudentModal({ isOpen, onClose, onSuccess }: AddStudentModalProps) {\n  const { toast } = useToast();\n  const [selectedServices, setSelectedServices] = useState<string[]>([]);\n\n  const form = useForm<AddStudentFormData>({\n    resolver: zodResolver(addStudentSchema),\n    defaultValues: {\n      name: \"\",\n      grade: \"\",\n      iepDueDate: \"\",\n      relatedServices: [],\n    },\n  });\n\n  const addStudentMutation = useMutation({\n    mutationFn: async (data: AddStudentFormData) => {\n      // Convert array of services to comma-separated string for backend\n      const formattedData = {\n        ...data,\n        relatedServices: data.relatedServices?.join(\", \") || \"\",\n      };\n      console.log(\"Frontend: Sending student data:\", formattedData);\n      await apiRequest(\"POST\", \"/api/students\", formattedData);\n    },\n    onSuccess: () => {\n      // Invalidate the students cache to refresh the dashboard\n      queryClient.invalidateQueries({ queryKey: [\"/api/students\"] });\n      \n      toast({\n        title: \"Success\",\n        description: \"Student added successfully!\",\n      });\n      form.reset();\n      setSelectedServices([]);\n      onSuccess?.();\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      \n      toast({\n        title: \"Error\",\n        description: \"Failed to add student. Please try again.\",\n        variant: \"destructive\",\n      });\n      console.error(\"Error adding student:\", error);\n    },\n  });\n\n  const onSubmit = (data: AddStudentFormData) => {\n    addStudentMutation.mutate(data);\n  };\n\n  const handleClose = () => {\n    form.reset();\n    setSelectedServices([]);\n    onClose();\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Add New Student</DialogTitle>\n        </DialogHeader>\n        \n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Student Name</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Enter student name\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"grade\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Grade Level</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select grade...\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"PreK\">Pre-K</SelectItem>\n                      <SelectItem value=\"K\">Kindergarten</SelectItem>\n                      <SelectItem value=\"1\">1st Grade</SelectItem>\n                      <SelectItem value=\"2\">2nd Grade</SelectItem>\n                      <SelectItem value=\"3\">3rd Grade</SelectItem>\n                      <SelectItem value=\"4\">4th Grade</SelectItem>\n                      <SelectItem value=\"5\">5th Grade</SelectItem>\n                      <SelectItem value=\"6\">6th Grade</SelectItem>\n                      <SelectItem value=\"7\">7th Grade</SelectItem>\n                      <SelectItem value=\"8\">8th Grade</SelectItem>\n                      <SelectItem value=\"9\">9th Grade</SelectItem>\n                      <SelectItem value=\"10\">10th Grade</SelectItem>\n                      <SelectItem value=\"11\">11th Grade</SelectItem>\n                      <SelectItem value=\"12\">12th Grade</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"iepDueDate\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>IEP Due Date</FormLabel>\n                  <FormControl>\n                    <Input type=\"date\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"relatedServices\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Related Services</FormLabel>\n                  <div className=\"space-y-2 mt-2\">\n                    {RELATED_SERVICES_OPTIONS.map((service) => (\n                      <div key={service} className=\"flex items-center space-x-2\">\n                        <Checkbox\n                          id={service}\n                          checked={field.value?.includes(service) || false}\n                          onCheckedChange={(checked) => {\n                            const currentServices = field.value || [];\n                            let updatedServices;\n                            \n                            if (service === \"None\") {\n                              // If \"None\" is selected, clear all other services\n                              updatedServices = checked ? [\"None\"] : [];\n                            } else {\n                              // If any other service is selected, remove \"None\" and add/remove the service\n                              if (checked) {\n                                updatedServices = [...currentServices.filter(s => s !== \"None\"), service];\n                              } else {\n                                updatedServices = currentServices.filter(s => s !== service);\n                              }\n                            }\n                            \n                            field.onChange(updatedServices);\n                            setSelectedServices(updatedServices);\n                          }}\n                        />\n                        <label \n                          htmlFor={service} \n                          className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                        >\n                          {service}\n                        </label>\n                      </div>\n                    ))}\n                  </div>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex justify-end space-x-3 pt-4\">\n              <Button \n                type=\"button\" \n                variant=\"outline\"\n                onClick={handleClose}\n                disabled={addStudentMutation.isPending}\n              >\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={addStudentMutation.isPending}\n              >\n                {addStudentMutation.isPending && (\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                )}\n                Add Student\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":9093,"size_tokens":null},"client/src/components/raw-data-table.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { Search, Filter, Calendar, Target, TrendingUp, Edit, Printer } from 'lucide-react';\nimport { format } from 'date-fns';\nimport EditDataPointModal from './edit-data-point-modal';\nimport { PDFGenerator, type PDFStudentData, type PDFDataPoint } from '@/lib/pdf-generator';\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface RawDataTableProps {\n  studentId: number;\n  student?: any; // Student data for PDF generation\n}\n\ninterface DataPoint {\n  id: number;\n  goalId: number;\n  goalTitle: string;\n  objectiveId?: number;\n  objectiveDescription?: string;\n  isObjectiveSpecific?: boolean;\n  dataType?: string;\n  date: string;\n  progressValue: string;\n  progressFormat: 'percentage' | 'frequency' | 'duration';\n  numerator?: number;\n  denominator?: number;\n  durationUnit?: string;\n  levelOfSupport?: string;\n  anecdotalInfo?: string;\n  createdAt: string;\n}\n\nexport default function RawDataTable({ studentId, student }: RawDataTableProps) {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedGoal, setSelectedGoal] = useState<string>('all');\n  const [sortBy, setSortBy] = useState<string>('date-desc');\n  const [editingDataPoint, setEditingDataPoint] = useState<DataPoint | null>(null);\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  // Fetch all data points for this student\n  const { data: rawData, isLoading, error } = useQuery<DataPoint[]>({\n    queryKey: [`/api/students/${studentId}/all-data-points`],\n    enabled: !!studentId,\n    staleTime: 0, // Always fetch fresh data\n    refetchOnMount: 'always',\n  });\n\n  // Fetch goals for filter dropdown\n  const { data: goals } = useQuery({\n    queryKey: [`/api/students/${studentId}/goals`],\n    enabled: !!studentId,\n    staleTime: 0, // Always fetch fresh data\n    refetchOnMount: 'always',\n  });\n\n  // PDF Generation Function\n  const generateRawDataPDF = async () => {\n    try {\n      if (!student || !rawData || (Array.isArray(rawData) && rawData.length === 0)) {\n        toast({\n          title: \"No Data\",\n          description: \"No student or data points available to generate PDF.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      console.log('Generating raw data PDF for student:', student.name);\n      console.log('Data points count:', rawData.length);\n\n      // Transform student data for PDF\n      const pdfStudent: PDFStudentData = {\n        id: student.id,\n        name: student.name,\n        grade: student.grade || 'Not specified',\n        iepDueDate: student.iepDueDate,\n        relatedServices: student.relatedServices || 'None specified',\n        totalGoals: student.totalGoals || 0,\n        activeGoals: student.activeGoals || 0,\n        completedGoals: student.completedGoals || 0,\n        totalDataPoints: student.totalDataPoints || rawData.length\n      };\n\n      // Transform data points for PDF\n      const pdfDataPoints: PDFDataPoint[] = rawData.map((point: DataPoint) => ({\n        id: point.id,\n        date: point.date,\n        goalTitle: point.goalTitle,\n        progressValue: point.progressValue,\n        progressFormat: point.progressFormat,\n        levelOfSupport: point.levelOfSupport || '[]',\n        anecdotalInfo: point.anecdotalInfo || '',\n        createdAt: point.createdAt\n      }));\n\n      console.log('Creating PDF generator...');\n      const pdfGenerator = new PDFGenerator();\n      console.log('Calling generateRawDataReport...');\n      await pdfGenerator.generateRawDataReport(pdfStudent, pdfDataPoints);\n      console.log('Raw data PDF generation completed successfully');\n\n      toast({\n        title: \"Success\",\n        description: \"Raw data PDF has been generated and downloaded.\",\n      });\n    } catch (error) {\n      console.error('Raw data PDF generation error:', error);\n      toast({\n        title: \"Error\",\n        description: `Failed to generate raw data PDF: ${error?.message || 'Unknown error'}`,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-center py-8\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (error) {\n    return (\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"text-center py-8\">\n            <p className=\"text-red-600\">Error loading raw data: {error.message}</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!rawData || (Array.isArray(rawData) && rawData.length === 0)) {\n    return (\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"text-center py-8\">\n            <Table className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n            <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">No Data Points</h3>\n            <p className=\"text-gray-600\">\n              No data points have been recorded for this student yet.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Ensure rawData is an array and filter data\n  const dataPoints = Array.isArray(rawData) ? rawData : [];\n  let filteredData = dataPoints.filter((item: DataPoint) => {\n    const matchesSearch = !searchTerm || \n      item.goalTitle.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      (item.anecdotalInfo && item.anecdotalInfo.toLowerCase().includes(searchTerm.toLowerCase()));\n    \n    const matchesGoal = selectedGoal === 'all' || item.goalId.toString() === selectedGoal;\n    \n    return matchesSearch && matchesGoal;\n  });\n\n  // Sort data\n  filteredData = filteredData.sort((a: DataPoint, b: DataPoint) => {\n    switch (sortBy) {\n      case 'date-desc':\n        return new Date(b.date).getTime() - new Date(a.date).getTime();\n      case 'date-asc':\n        return new Date(a.date).getTime() - new Date(b.date).getTime();\n      case 'goal':\n        return a.goalTitle.localeCompare(b.goalTitle);\n      case 'progress-desc':\n        return parseFloat(b.progressValue) - parseFloat(a.progressValue);\n      case 'progress-asc':\n        return parseFloat(a.progressValue) - parseFloat(b.progressValue);\n      default:\n        return 0;\n    }\n  });\n\n  const formatProgressDisplay = (item: DataPoint) => {\n    switch (item.progressFormat) {\n      case 'percentage':\n        if (item.numerator !== null && item.denominator !== null) {\n          return `${item.numerator}/${item.denominator} (${item.progressValue}%)`;\n        }\n        return `${item.progressValue}%`;\n      case 'frequency':\n        return `${item.progressValue} occurrences`;\n      case 'duration':\n        return `${item.progressValue} ${item.durationUnit || 'seconds'}`;\n      default:\n        return item.progressValue;\n    }\n  };\n\n  const formatLevelOfSupport = (levelOfSupport: string | null) => {\n    if (!levelOfSupport) return 'None';\n    \n    try {\n      const parsed = JSON.parse(levelOfSupport);\n      if (Array.isArray(parsed)) {\n        return parsed.map(level => {\n          switch (level) {\n            case 'independent': return 'Independent';\n            case 'verbal-prompt': return 'Verbal Prompt';\n            case 'visual-prompt': return 'Visual Prompt';\n            case 'physical-prompt': return 'Physical Prompt';\n            case 'full-assistance': return 'Full Assistance';\n            default: return level;\n          }\n        }).join(', ');\n      }\n      return levelOfSupport;\n    } catch {\n      return levelOfSupport;\n    }\n  };\n\n\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Table className=\"h-5 w-5\" />\n            <span className=\"whitespace-nowrap\">Raw Data Table</span>\n          </div>\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            onClick={generateRawDataPDF}\n            className=\"gap-2\"\n            disabled={!student || !rawData || rawData.length === 0}\n          >\n            <Printer className=\"h-4 w-4\" />\n            Print PDF\n          </Button>\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {/* Filters and Search */}\n        <div className=\"flex flex-col sm:flex-row gap-3\">\n          <div className=\"flex-1\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n              <Input\n                placeholder=\"Search by goal or notes...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n          </div>\n          \n          <Select value={selectedGoal} onValueChange={setSelectedGoal}>\n            <SelectTrigger className=\"w-48\">\n              <div className=\"flex items-center gap-2\">\n                <Filter className=\"h-4 w-4\" />\n                <SelectValue placeholder=\"Filter by goal\" />\n              </div>\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Goals</SelectItem>\n              {goals?.map((goal: any) => (\n                <SelectItem key={goal.id} value={goal.id.toString()}>\n                  {goal.title}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n\n          <Select value={sortBy} onValueChange={setSortBy}>\n            <SelectTrigger className=\"w-48\">\n              <SelectValue placeholder=\"Sort by\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"date-desc\">Date (Newest First)</SelectItem>\n              <SelectItem value=\"date-asc\">Date (Oldest First)</SelectItem>\n              <SelectItem value=\"goal\">Goal Name</SelectItem>\n              <SelectItem value=\"progress-desc\">Progress (High to Low)</SelectItem>\n              <SelectItem value=\"progress-asc\">Progress (Low to High)</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Summary Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg\">\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-blue-600\">{filteredData.length}</div>\n            <div className=\"text-sm text-gray-600 flex items-center justify-center gap-1\">\n              <Calendar className=\"h-4 w-4\" />\n              Total Data Points\n            </div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-green-600\">\n              {goals?.filter((goal: any) => filteredData.some((item: DataPoint) => item.goalId === goal.id)).length || 0}\n            </div>\n            <div className=\"text-sm text-gray-600 flex items-center justify-center gap-1\">\n              <Target className=\"h-4 w-4\" />\n              Goals with Data\n            </div>\n          </div>\n        </div>\n\n        {/* Data Table */}\n        <div className=\"rounded-md border\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Date</TableHead>\n                <TableHead>Goal / Objective</TableHead>\n                <TableHead>Progress</TableHead>\n                <TableHead>Level of Support</TableHead>\n                <TableHead>Notes</TableHead>\n                <TableHead>Recorded</TableHead>\n                <TableHead>Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredData.map((item: DataPoint) => (\n                <TableRow key={item.id}>\n                  <TableCell className=\"font-medium\">\n                    {format(new Date(item.date), 'MMM dd, yyyy')}\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"space-y-1\">\n                      <Badge variant=\"outline\">{item.goalTitle}</Badge>\n                      {item.isObjectiveSpecific && item.objectiveDescription && (\n                        <div className=\"text-xs text-blue-600 font-medium\">\n                          ðŸ“‹ {item.objectiveDescription}\n                        </div>\n                      )}\n                      <div className=\"text-xs text-gray-500\">\n                        {item.dataType || (item.isObjectiveSpecific ? 'Objective' : 'General Goal')}\n                      </div>\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"font-medium\">\n                      {formatProgressDisplay(item)}\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"text-sm\">\n                      {formatLevelOfSupport(item.levelOfSupport || '')}\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <div className=\"text-sm text-gray-600 max-w-xs truncate\">\n                      {item.anecdotalInfo || 'â€”'}\n                    </div>\n                  </TableCell>\n                  <TableCell className=\"text-sm text-gray-500\">\n                    {format(new Date(item.createdAt), 'MMM dd, h:mm a')}\n                  </TableCell>\n                  <TableCell>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setEditingDataPoint(item);\n                        setIsEditModalOpen(true);\n                      }}\n                      className=\"h-8 w-8 p-0\"\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </div>\n\n        {filteredData.length === 0 && (\n          <div className=\"text-center py-8\">\n            <p className=\"text-gray-600\">No data points match your current filters.</p>\n          </div>\n        )}\n      </CardContent>\n\n      {/* Edit Data Point Modal */}\n      {editingDataPoint && (\n        <EditDataPointModal\n          dataPoint={editingDataPoint}\n          isOpen={isEditModalOpen}\n          onClose={() => {\n            setIsEditModalOpen(false);\n            setEditingDataPoint(null);\n          }}\n          onSuccess={() => {\n            // Refresh the data after successful update\n            queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/all-data-points`] });\n            queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/goals`] });\n            queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}`] });\n            setIsEditModalOpen(false);\n            setEditingDataPoint(null);\n          }}\n        />\n      )}\n    </Card>\n  );\n}","path":null,"size_bytes":15419,"size_tokens":null},"client/src/components/student-scatterplot.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { ScatterChart, Scatter, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend, Line, ComposedChart, LineChart, BarChart, Bar, PieChart as RechartsPieChart, Pie, Cell } from \"recharts\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { TrendingUp, Calendar, ChevronDown, LineChart as LineChartIcon, BarChart3, PieChart, Filter } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { filterDataPointsByPeriod, ReportingPeriod } from \"@/lib/utils\";\n\ninterface StudentScatterplotProps {\n  studentId: number;\n  goalId?: number; // Optional: if provided, show only this goal's data\n  selectedPeriod?: ReportingPeriod | null; // Optional: if provided, filter data by specific reporting period\n}\n\ninterface DataPoint {\n  id: number;\n  goalId: number;\n  date: string;\n  progressValue: string;\n  progressFormat: string;\n  goalTitle?: string;\n  goalColor?: string;\n}\n\ninterface Goal {\n  id: number;\n  title: string;\n  dataCollectionType: string;\n  frequencyDirection?: string;\n}\n\n// Color palette for different goals\nconst GOAL_COLORS = [\n  \"#3b82f6\", // blue\n  \"#10b981\", // emerald\n  \"#f59e0b\", // amber\n  \"#ef4444\", // red\n  \"#8b5cf6\", // violet\n  \"#06b6d4\", // cyan\n  \"#84cc16\", // lime\n  \"#f97316\", // orange\n];\n\ntype ChartType = 'line' | 'bar' | 'pie';\n\nexport default function StudentScatterplot({ studentId, goalId, selectedPeriod }: StudentScatterplotProps) {\n  const [showTrendLine, setShowTrendLine] = useState(() => {\n    // Get trend line preference from sessionStorage\n    const savedTrendPref = sessionStorage.getItem(`scatterTrend_${studentId}_${goalId || 'all'}`);\n    return savedTrendPref ? savedTrendPref === 'true' : true; // Default to true\n  });\n\n  const [selectedChartType, setSelectedChartType] = useState<ChartType>(() => {\n    const savedChartType = sessionStorage.getItem(`goalChartType_${goalId || 'all'}_${studentId}`) as ChartType;\n    // If saved type is scatter, default to line instead since scatter is removed\n    return (savedChartType && savedChartType !== 'scatter') ? savedChartType : 'line';\n  });\n\n  const [supportFilter, setSupportFilter] = useState<'all' | 'split'>(() => {\n    const savedSupportFilter = sessionStorage.getItem(`supportFilter_${goalId || 'all'}_${studentId}`) as 'all' | 'split';\n    return savedSupportFilter || 'all';\n  });\n\n\n  // Save chart type preference when it changes\n  const handleChartTypeChange = (chartType: ChartType) => {\n    setSelectedChartType(chartType);\n    sessionStorage.setItem(`goalChartType_${goalId || 'all'}_${studentId}`, chartType);\n  };\n\n  const getChartIcon = (chartType: ChartType) => {\n    switch (chartType) {\n      case 'line':\n        return <LineChartIcon className=\"h-4 w-4\" />;\n      case 'bar':\n        return <BarChart3 className=\"h-4 w-4\" />;\n      case 'pie':\n        return <PieChart className=\"h-4 w-4\" />;\n      default:\n        return <LineChartIcon className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getChartLabel = (chartType: ChartType) => {\n    switch (chartType) {\n      case 'line':\n        return 'Line Chart';\n      case 'bar':\n        return 'Bar Chart';\n      case 'pie':\n        return 'Pie Chart';\n      default:\n        return 'Line Chart';\n    }\n  };\n  const { data: goals = [], isLoading: goalsLoading } = useQuery({\n    queryKey: [`/api/students/${studentId}/goals`],\n    enabled: !!studentId,\n  });\n\n  const { data: allDataPoints = [], isLoading: dataLoading } = useQuery({\n    queryKey: [`/api/students/${studentId}/all-data-points`],\n    enabled: !!studentId,\n  });\n\n\n  // Debug logging for data persistence issues\n  console.log(`[SCATTERPLOT DEBUG] Student ${studentId}, Goals: ${goals?.length || 0}, DataPoints: ${allDataPoints?.length || 0}`);\n  if (allDataPoints && allDataPoints.length > 0) {\n    console.log(`[SCATTERPLOT DEBUG] Data points retrieved:`, allDataPoints.map(dp => ({ id: dp.id, goalId: dp.goalId, date: dp.date, value: dp.progressValue })));\n  }\n\n  if (goalsLoading || dataLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <TrendingUp className=\"h-5 w-5\" />\n            Progress Scatterplot\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-80 flex items-center justify-center\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Create a map of goals for easy lookup\n  const goalsMap = new Map(goals.map((goal: Goal, index: number) => [\n    goal.id, \n    { \n      ...goal, \n      color: GOAL_COLORS[index % GOAL_COLORS.length] \n    }\n  ]));\n\n  // Filter data points by goal if goalId is provided\n  let filteredDataPoints = goalId \n    ? allDataPoints?.filter((dp: DataPoint) => dp.goalId === goalId) || []\n    : allDataPoints || [];\n\n  // Apply reporting period filtering if a specific period is selected\n  if (selectedPeriod) {\n    filteredDataPoints = filterDataPointsByPeriod(filteredDataPoints, selectedPeriod);\n  }\n\n  // Process data points for scatterplot\n  const scatterData = filteredDataPoints\n    .filter((dp: DataPoint) => dp.progressValue !== null && dp.progressValue !== undefined && dp.date)\n    .map((dp: DataPoint) => {\n      const goal = goalsMap.get(dp.goalId);\n      const dateObj = new Date(dp.date);\n      \n      // For frequency and duration goals, use the original value instead of progress value\n      let displayValue = 0;\n      let yAxisLabel = \"Progress (%)\";\n      let originalValue = dp.progressValue;\n      \n      // Query the allDataPoints to get the actual 'value' field for frequency/duration\n      const fullDataPoint = allDataPoints?.find((fullDp: any) => \n        fullDp.id === dp.id || \n        (fullDp.goalId === dp.goalId && fullDp.date === dp.date)\n      );\n      \n      if (dp.progressFormat === 'percentage') {\n        displayValue = parseFloat(dp.progressValue);\n        yAxisLabel = \"Progress (%)\";\n      } else if (dp.progressFormat === 'frequency') {\n        // Use the original frequency value, not the progress percentage\n        displayValue = fullDataPoint?.value ? parseFloat(fullDataPoint.value) : parseFloat(dp.progressValue);\n        originalValue = displayValue.toString();\n        yAxisLabel = \"Frequency (count)\";\n      } else if (dp.progressFormat === 'duration') {\n        // Use the original duration value, not the progress percentage\n        displayValue = fullDataPoint?.value ? parseFloat(fullDataPoint.value) : parseFloat(dp.progressValue);\n        originalValue = displayValue.toString();\n        yAxisLabel = \"Duration (mm:ss)\";\n      }\n\n      return {\n        x: dateObj.getTime(), // Use timestamp for x-axis\n        y: displayValue,\n        goalId: dp.goalId,\n        goalTitle: goal?.title || `Goal ${dp.goalId}`,\n        date: dp.date,\n        originalValue: originalValue,\n        format: dp.progressFormat,\n        color: goal?.color || GOAL_COLORS[0],\n        yAxisLabel: yAxisLabel,\n        durationUnit: fullDataPoint?.durationUnit || dp.durationUnit,\n        goal: goal, // Include goal info for frequency direction\n        levelOfSupport: fullDataPoint?.levelOfSupport || dp.levelOfSupport || '[]',\n      };\n    })\n    .sort((a, b) => a.x - b.x);\n\n  // Get the current goal information for title\n  const currentGoal = goalId ? goals?.find(g => g.id === goalId) : null;\n  const chartTitle = goalId && currentGoal \n    ? `${currentGoal.title} Progress Chart`\n    : \"Progress Scatterplot\";\n  \n  // Reset support filter when switching to non-percentage goals\n  useEffect(() => {\n    if (goalId && currentGoal && currentGoal.dataCollectionType !== 'percentage' && supportFilter === 'split') {\n      setSupportFilter('all');\n      sessionStorage.setItem(`supportFilter_${goalId}_${studentId}`, 'all');\n    }\n  }, [goalId, currentGoal, supportFilter, studentId]);\n  \n  const yAxisLabel = scatterData.length > 0 ? scatterData[0].yAxisLabel : \"Progress\";\n\n  // Helper function to calculate evenly spaced ticks\n  const calculateEvenTicks = (min: number, max: number, idealCount: number = 5): number[] => {\n    if (min === max) return [min];\n    \n    const range = max - min;\n    const step = Math.ceil(range / (idealCount - 1));\n    const ticks = [];\n    \n    for (let i = 0; i < idealCount; i++) {\n      const tick = min + (i * step);\n      if (tick <= max) ticks.push(tick);\n    }\n    \n    // Ensure max value is included\n    if (ticks[ticks.length - 1] !== max) {\n      ticks.push(max);\n    }\n    \n    return ticks;\n  };\n\n  // Calculate Y-axis configuration based on data type and frequency direction\n  let yAxisConfig = {\n    domain: [0, 100] as [number, number],\n    ticks: [0, 25, 50, 75, 100] as number[],\n    tickFormatter: (value: number) => value.toString(),\n    allowDecimals: true,\n    reversed: false\n  };\n\n  if (scatterData.length > 0) {\n    const firstDataPoint = scatterData[0];\n    const goal = firstDataPoint.goal;\n    \n    if (firstDataPoint.format === 'frequency') {\n      const frequencyValues = scatterData.map((d: any) => d.y);\n      const minValue = Math.min(...frequencyValues, 0);\n      const maxValue = Math.max(...frequencyValues, 1);\n      const padding = Math.ceil((maxValue - minValue) * 0.1) || 1;\n      const domainMin = Math.max(0, minValue - padding);\n      const domainMax = maxValue + padding;\n      \n      yAxisConfig = {\n        domain: [domainMin, domainMax] as [number, number],\n        ticks: calculateEvenTicks(domainMin, domainMax, 5),\n        tickFormatter: (value: number) => Math.round(value).toString(),\n        allowDecimals: false,\n        reversed: goal?.frequencyDirection === 'decrease'\n      };\n    } else if (firstDataPoint.format === 'duration') {\n      const durationValues = scatterData.map((d: any) => d.y);\n      const minValue = Math.min(...durationValues, 0);\n      const maxValue = Math.max(...durationValues, 1);\n      const padding = Math.ceil((maxValue - minValue) * 0.1) || 1;\n      const domainMin = Math.max(0, minValue - padding);\n      const domainMax = maxValue + padding;\n      \n      yAxisConfig = {\n        domain: [domainMin, domainMax] as [number, number],\n        ticks: calculateEvenTicks(domainMin, domainMax, 5),\n        tickFormatter: (value: number) => {\n          // Value is in minutes (e.g., 1.10 = 1 minute 10 seconds)\n          const totalMinutes = Math.floor(value);\n          const seconds = Math.round((value - totalMinutes) * 100); // Convert decimal to seconds\n          if (value === 0) {\n            return \"0:00\";\n          }\n          return `${totalMinutes}:${seconds.toString().padStart(2, '0')}`;\n        },\n        allowDecimals: false,\n        reversed: false\n      };\n    } else {\n      // Percentage type - use default 0-100 with even ticks\n      yAxisConfig = {\n        domain: [0, 100] as [number, number],\n        ticks: [0, 20, 40, 60, 80, 100],\n        tickFormatter: (value: number) => `${value}%`,\n        allowDecimals: true,\n        reversed: false\n      };\n    }\n  }\n\n  // Helper function to check if support level includes 'independent'\n  const isIndependentSupport = (levelOfSupport: string): boolean => {\n    try {\n      const supportArray = JSON.parse(levelOfSupport || '[]');\n      if (Array.isArray(supportArray)) {\n        return supportArray.length === 0 || supportArray.some(level => \n          level.toLowerCase().includes('independent')\n        );\n      }\n      return false;\n    } catch {\n      return false;\n    }\n  };\n\n  // Filter data based on support level for split mode\n  const independentData = supportFilter === 'split' \n    ? scatterData.filter(point => isIndependentSupport(point.levelOfSupport))\n    : scatterData;\n    \n  const otherSupportData = supportFilter === 'split'\n    ? scatterData.filter(point => !isIndependentSupport(point.levelOfSupport))\n    : [];\n\n  const hasData = scatterData.length > 0;\n  \n  // Determine if we should show percentage units\n  const isPercentageFormat = scatterData.length > 0 && scatterData[0].format === 'percentage';\n\n  // Prepare data for different chart types\n  const prepareChartData = (data: any[]) => data.map((point: any) => ({\n    date: new Date(point.x).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),\n    progress: point.y,\n    originalValue: point.originalValue,\n    goalTitle: point.goalTitle,\n    color: point.color,\n  }));\n\n  const lineBarData = prepareChartData(scatterData);\n  const independentLineBarData = prepareChartData(independentData);\n  const otherSupportLineBarData = prepareChartData(otherSupportData);\n\n  const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042'];\n\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      const data = payload[0].payload;\n      const date = new Date(data.x);\n      \n      return (\n        <div className=\"bg-white p-3 border rounded-lg shadow-lg\">\n          <p className=\"font-semibold\">{data.goalTitle}</p>\n          <p className=\"text-sm text-gray-600\">\n            Date: {date.toLocaleDateString()}\n          </p>\n          <p className=\"text-sm\">\n            {data.format === 'frequency' ? 'Count:' : 'Progress:'} {data.originalValue}\n            {data.format === 'percentage' && '%'}\n            {data.format === 'frequency' && ' times'}\n            {data.format === 'duration' && (data.durationUnit === 'seconds' ? ' seconds' : ' minutes')}\n          </p>\n          {data.format === 'duration' && (\n            <p className=\"text-sm text-gray-600\">\n              {data.durationUnit === 'seconds' ? \n                `${data.y} seconds` : \n                `${Math.floor(data.y)} min ${Math.round((data.y - Math.floor(data.y)) * 100)} sec`\n              }\n            </p>\n          )}\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <Card data-goal-id={goalId || 'combined'}>\n      <CardHeader>\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <TrendingUp className=\"h-5 w-5\" />\n              <CardTitle>{chartTitle}</CardTitle>\n              {selectedPeriod && (\n                <div className=\"flex items-center gap-1 bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs\">\n                  <Filter className=\"h-3 w-3\" />\n                  Period {selectedPeriod.periodNumber}\n                </div>\n              )}\n            </div>\n            {goalId && currentGoal && (\n              <div className=\"space-y-1\">\n                <p className=\"text-sm text-gray-600\">\n                  <strong>Goal:</strong> {currentGoal.title}\n                </p>\n                {currentGoal.targetCriteria && (\n                  <p className=\"text-sm text-blue-600\">\n                    <strong>Target:</strong> {currentGoal.targetCriteria}\n                  </p>\n                )}\n              </div>\n            )}\n          </div>\n          \n          {hasData && (\n            <div className=\"flex items-center gap-2\">\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"outline\" size=\"sm\" className=\"flex items-center gap-2\">\n                    {getChartIcon(selectedChartType)}\n                    {getChartLabel(selectedChartType)}\n                    <ChevronDown className=\"h-4 w-4\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\">\n                  <DropdownMenuItem onClick={() => handleChartTypeChange('line')}>\n                    <LineChartIcon className=\"h-4 w-4 mr-2\" />\n                    Line Chart\n                  </DropdownMenuItem>\n                  <DropdownMenuItem onClick={() => handleChartTypeChange('bar')}>\n                    <BarChart3 className=\"h-4 w-4 mr-2\" />\n                    Bar Chart\n                  </DropdownMenuItem>\n                  <DropdownMenuItem onClick={() => handleChartTypeChange('pie')}>\n                    <PieChart className=\"h-4 w-4 mr-2\" />\n                    Pie Chart\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n              \n              {/* Support Level Filter for Percentage Goals Only */}\n              {goalId && currentGoal && currentGoal.dataCollectionType === 'percentage' && (\n                <Button\n                  variant={supportFilter === 'split' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => {\n                    const newFilter = supportFilter === 'split' ? 'all' : 'split';\n                    setSupportFilter(newFilter);\n                    sessionStorage.setItem(`supportFilter_${goalId || 'all'}_${studentId}`, newFilter);\n                  }}\n                  className=\"flex items-center gap-2\"\n                  data-testid=\"split-by-support-btn\"\n                >\n                  {supportFilter === 'split' ? 'Show All Together' : 'Split by Support'}\n                </Button>\n              )}\n            </div>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent>\n        {!hasData ? (\n          <div className=\"h-80 flex flex-col items-center justify-center text-center\">\n            <Calendar className=\"h-12 w-12 text-gray-400 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Data Points Yet</h3>\n            <p className=\"text-gray-600 max-w-sm\">\n              Start collecting data on student goals to see progress trends in this scatterplot.\n            </p>\n          </div>\n        ) : supportFilter === 'split' && goalId && currentGoal && currentGoal.dataCollectionType === 'percentage' ? (\n          /* Dual Chart Layout */\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            {/* Other Support Chart */}\n            <div className=\"bg-purple-50 p-4 rounded-lg border border-purple-200\">\n              <h4 className=\"text-sm font-semibold text-purple-800 mb-3 text-center\">\n                With Support-Data\n              </h4>\n              <div className=\"h-80\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  {selectedChartType === 'line' && (\n                    <LineChart data={otherSupportLineBarData} margin={{ top: 20, right: 20, bottom: 60, left: 60 }}>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis \n                        dataKey=\"date\" \n                        angle={-45}\n                        textAnchor=\"end\"\n                        height={80}\n                      />\n                      <YAxis \n                        domain={yAxisConfig.reversed ? [yAxisConfig.domain[1], yAxisConfig.domain[0]] : yAxisConfig.domain}\n                        ticks={yAxisConfig.reversed ? [...yAxisConfig.ticks].reverse() : yAxisConfig.ticks}\n                        tickFormatter={yAxisConfig.tickFormatter}\n                        allowDecimals={yAxisConfig.allowDecimals}\n                      />\n                      <Tooltip \n                        formatter={(value: any, name: string) => [`${value}${yAxisConfig.tickFormatter === ((v: number) => `${v}%`) ? '%' : ''}`, 'Progress']}\n                        labelFormatter={(label) => `Date: ${label}`}\n                      />\n\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"progress\" \n                        stroke=\"#A855F7\" \n                        strokeWidth={2}\n                        dot={{ fill: '#A855F7', strokeWidth: 2, r: 4 }}\n                        activeDot={{ r: 6 }}\n                        name=\"Other Support\"\n                      />\n                    </LineChart>\n                  )}\n\n                  {selectedChartType === 'bar' && (\n                    <BarChart data={otherSupportLineBarData} margin={{ top: 20, right: 20, bottom: 60, left: 60 }}>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis \n                        dataKey=\"date\" \n                        angle={-45}\n                        textAnchor=\"end\"\n                        height={80}\n                      />\n                      <YAxis \n                        domain={yAxisConfig.reversed ? [yAxisConfig.domain[1], yAxisConfig.domain[0]] : yAxisConfig.domain}\n                        ticks={yAxisConfig.reversed ? [...yAxisConfig.ticks].reverse() : yAxisConfig.ticks}\n                        tickFormatter={yAxisConfig.tickFormatter}\n                        allowDecimals={yAxisConfig.allowDecimals}\n                      />\n                      <Tooltip \n                        formatter={(value: any, name: string) => [`${value}${yAxisConfig.tickFormatter === ((v: number) => `${v}%`) ? '%' : ''}`, 'Progress']}\n                        labelFormatter={(label) => `Date: ${label}`}\n                      />\n\n                      <Bar \n                        dataKey=\"progress\" \n                        fill=\"#A855F7\" \n                        name=\"Other Support\"\n                      />\n                    </BarChart>\n                  )}\n\n                  {selectedChartType === 'pie' && otherSupportLineBarData.length > 0 && (\n                    <RechartsPieChart>\n                      <Pie\n                        data={otherSupportLineBarData}\n                        cx=\"50%\"\n                        cy=\"50%\"\n                        labelLine={false}\n                        label={({ date, progress }: any) => `${date}: ${progress}${isPercentageFormat ? '%' : ''}`}\n                        outerRadius={80}\n                        fill=\"#A855F7\"\n                        dataKey=\"progress\"\n                      >\n                        {otherSupportLineBarData.map((entry: any, index: number) => (\n                          <Cell key={`cell-${index}`} fill=\"#A855F7\" />\n                        ))}\n                      </Pie>\n                      <Tooltip formatter={(value: any) => [`${value}${isPercentageFormat ? '%' : ''}`, 'Progress']} />\n                    </RechartsPieChart>\n                  )}\n                </ResponsiveContainer>\n              </div>\n            </div>\n\n            {/* Independent Support Chart */}\n            <div className=\"bg-blue-50 p-4 rounded-lg border border-blue-200\">\n              <h4 className=\"text-sm font-semibold text-blue-800 mb-3 text-center\">\n                Independent-Data\n              </h4>\n              <div className=\"h-80\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  {selectedChartType === 'line' && (\n                    <LineChart data={independentLineBarData} margin={{ top: 20, right: 20, bottom: 60, left: 60 }}>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis \n                        dataKey=\"date\" \n                        angle={-45}\n                        textAnchor=\"end\"\n                        height={80}\n                      />\n                      <YAxis \n                        domain={yAxisConfig.reversed ? [yAxisConfig.domain[1], yAxisConfig.domain[0]] : yAxisConfig.domain}\n                        ticks={yAxisConfig.reversed ? [...yAxisConfig.ticks].reverse() : yAxisConfig.ticks}\n                        tickFormatter={yAxisConfig.tickFormatter}\n                        allowDecimals={yAxisConfig.allowDecimals}\n                      />\n                      <Tooltip \n                        formatter={(value: any, name: string) => [`${value}${yAxisConfig.tickFormatter === ((v: number) => `${v}%`) ? '%' : ''}`, 'Progress']}\n                        labelFormatter={(label) => `Date: ${label}`}\n                      />\n\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"progress\" \n                        stroke=\"#2563EB\" \n                        strokeWidth={2}\n                        dot={{ fill: '#2563EB', strokeWidth: 2, r: 4 }}\n                        activeDot={{ r: 6 }}\n                        name=\"Independent\"\n                      />\n                    </LineChart>\n                  )}\n\n                  {selectedChartType === 'bar' && (\n                    <BarChart data={independentLineBarData} margin={{ top: 20, right: 20, bottom: 60, left: 60 }}>\n                      <CartesianGrid strokeDasharray=\"3 3\" />\n                      <XAxis \n                        dataKey=\"date\" \n                        angle={-45}\n                        textAnchor=\"end\"\n                        height={80}\n                      />\n                      <YAxis \n                        domain={yAxisConfig.reversed ? [yAxisConfig.domain[1], yAxisConfig.domain[0]] : yAxisConfig.domain}\n                        ticks={yAxisConfig.reversed ? [...yAxisConfig.ticks].reverse() : yAxisConfig.ticks}\n                        tickFormatter={yAxisConfig.tickFormatter}\n                        allowDecimals={yAxisConfig.allowDecimals}\n                      />\n                      <Tooltip \n                        formatter={(value: any, name: string) => [`${value}${yAxisConfig.tickFormatter === ((v: number) => `${v}%`) ? '%' : ''}`, 'Progress']}\n                        labelFormatter={(label) => `Date: ${label}`}\n                      />\n\n                      <Bar \n                        dataKey=\"progress\" \n                        fill=\"#2563EB\" \n                        name=\"Independent\"\n                      />\n                    </BarChart>\n                  )}\n\n                  {selectedChartType === 'pie' && independentLineBarData.length > 0 && (\n                    <RechartsPieChart>\n                      <Pie\n                        data={independentLineBarData}\n                        cx=\"50%\"\n                        cy=\"50%\"\n                        labelLine={false}\n                        label={({ date, progress }: any) => `${date}: ${progress}${isPercentageFormat ? '%' : ''}`}\n                        outerRadius={80}\n                        fill=\"#2563EB\"\n                        dataKey=\"progress\"\n                      >\n                        {independentLineBarData.map((entry: any, index: number) => (\n                          <Cell key={`cell-${index}`} fill=\"#2563EB\" />\n                        ))}\n                      </Pie>\n                      <Tooltip formatter={(value: any) => [`${value}${isPercentageFormat ? '%' : ''}`, 'Progress']} />\n                    </RechartsPieChart>\n                  )}\n                </ResponsiveContainer>\n              </div>\n            </div>\n          </div>\n        ) : (\n          /* Single Chart Layout */\n          <div className=\"h-80\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              {selectedChartType === 'line' && (\n                <LineChart data={lineBarData} margin={{ top: 20, right: 20, bottom: 60, left: 60 }}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis \n                    dataKey=\"date\" \n                    angle={-45}\n                    textAnchor=\"end\"\n                    height={80}\n                  />\n                  <YAxis \n                    domain={yAxisConfig.reversed ? [yAxisConfig.domain[1], yAxisConfig.domain[0]] : yAxisConfig.domain}\n                    ticks={yAxisConfig.reversed ? [...yAxisConfig.ticks].reverse() : yAxisConfig.ticks}\n                    tickFormatter={yAxisConfig.tickFormatter}\n                    allowDecimals={yAxisConfig.allowDecimals}\n                  />\n                  <Tooltip \n                    formatter={(value: any, name: string) => [`${value}${isPercentageFormat ? '%' : ''}`, 'Progress']}\n                    labelFormatter={(label) => `Date: ${label}`}\n                  />\n\n                  <Line \n                    type=\"monotone\" \n                    dataKey=\"progress\" \n                    stroke=\"#3b82f6\" \n                    strokeWidth={2}\n                    dot={{ fill: '#3b82f6', strokeWidth: 2, r: 4 }}\n                    activeDot={{ r: 6 }}\n                    name=\"Progress\"\n                  />\n                </LineChart>\n              )}\n\n              {selectedChartType === 'bar' && (\n                <BarChart data={lineBarData} margin={{ top: 20, right: 20, bottom: 60, left: 60 }}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis \n                    dataKey=\"date\" \n                    angle={-45}\n                    textAnchor=\"end\"\n                    height={80}\n                  />\n                  <YAxis \n                    domain={yAxisConfig.reversed ? [yAxisConfig.domain[1], yAxisConfig.domain[0]] : yAxisConfig.domain}\n                    ticks={yAxisConfig.reversed ? [...yAxisConfig.ticks].reverse() : yAxisConfig.ticks}\n                    tickFormatter={yAxisConfig.tickFormatter}\n                    allowDecimals={yAxisConfig.allowDecimals}\n                  />\n                  <Tooltip \n                    formatter={(value: any, name: string) => [`${value}${isPercentageFormat ? '%' : ''}`, 'Progress']}\n                    labelFormatter={(label) => `Date: ${label}`}\n                  />\n\n                  <Bar \n                    dataKey=\"progress\" \n                    fill=\"#3b82f6\" \n                    name=\"Progress\"\n                  />\n                </BarChart>\n              )}\n\n              {selectedChartType === 'pie' && lineBarData.length > 0 && (\n                <RechartsPieChart>\n                  <Pie\n                    data={lineBarData}\n                    cx=\"50%\"\n                    cy=\"50%\"\n                    labelLine={false}\n                    label={({ date, progress }: any) => `${date}: ${progress}${isPercentageFormat ? '%' : ''}`}\n                    outerRadius={80}\n                    fill=\"#8884d8\"\n                    dataKey=\"progress\"\n                  >\n                    {lineBarData.map((entry: any, index: number) => (\n                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                    ))}\n                  </Pie>\n                  <Tooltip formatter={(value: any) => [`${value}${isPercentageFormat ? '%' : ''}`, 'Progress']} />\n                </RechartsPieChart>\n              )}\n            </ResponsiveContainer>\n          </div>\n        )}\n        \n        {hasData && (\n          <div className=\"mt-4 text-xs text-gray-600\">\n            <p>\n              * Different data collection types are normalized to percentage scale for comparison\n            </p>\n            <p>\n              * Frequency data is scaled (Ã—10), Duration data shows seconds as % of minute\n            </p>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","path":null,"size_bytes":30927,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":971,"size_tokens":null},"client/src/components/add-goal-modal.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { z } from \"zod\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { Plus, Trash2 } from \"lucide-react\";\nimport TargetCriteriaInput from \"@/components/target-criteria-input\";\n\nconst objectiveSchema = z.object({\n  description: z.string().min(1, \"Objective description is required\"),\n  targetCriteria: z.string().optional(),\n  targetDate: z.string().optional(),\n  status: z.string().default(\"active\"),\n});\n\nconst addGoalSchema = z.object({\n  title: z.string().min(1, \"Goal title is required\"),\n  description: z.string().min(1, \"Goal description is required\"),\n  targetCriteria: z.string().optional(),\n  levelOfSupport: z.array(z.string()).optional().default([]),\n  customLevelOfSupport: z.string().optional(),\n  dataCollectionType: z.string().default(\"percentage\"),\n  frequencyDirection: z.string().optional(),\n  status: z.string().default(\"active\"),\n  objectives: z.array(objectiveSchema).optional().default([]),\n});\n\ntype AddGoalFormData = z.infer<typeof addGoalSchema>;\n\ninterface AddGoalModalProps {\n  studentId: number;\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess?: () => void;\n}\n\nexport default function AddGoalModal({ studentId, isOpen, onClose, onSuccess }: AddGoalModalProps) {\n  const { toast } = useToast();\n  const [isCustomSupport, setIsCustomSupport] = useState(false);\n\n  const form = useForm<AddGoalFormData>({\n    resolver: zodResolver(addGoalSchema),\n    defaultValues: {\n      title: \"\",\n      description: \"\",\n      targetCriteria: \"\",\n      levelOfSupport: [],\n      customLevelOfSupport: \"\",\n      dataCollectionType: \"percentage\",\n      frequencyDirection: \"\",\n      status: \"active\",\n      objectives: [],\n    },\n  });\n\n  const addGoalMutation = useMutation({\n    mutationFn: async (data: AddGoalFormData) => {\n      // Combine selected support levels with custom level if provided\n      let finalLevelOfSupport = [...(data.levelOfSupport || [])];\n      if (isCustomSupport && data.customLevelOfSupport) {\n        finalLevelOfSupport.push(data.customLevelOfSupport);\n      }\n      \n      const { customLevelOfSupport, objectives, ...requestData } = data;\n      const goalData = { ...requestData, levelOfSupport: finalLevelOfSupport, objectives };\n      await apiRequest(\"POST\", `/api/students/${studentId}/goals`, goalData);\n    },\n    onSuccess: () => {\n      // Clear all cache to force immediate refresh\n      queryClient.clear();\n      \n      toast({\n        title: \"Success\",\n        description: \"Goal added successfully!\",\n      });\n      form.reset();\n      setIsCustomSupport(false);\n      onSuccess?.();\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      \n      toast({\n        title: \"Error\",\n        description: \"Failed to add goal. Please try again.\",\n        variant: \"destructive\",\n      });\n      console.error(\"Error adding goal:\", error);\n    },\n  });\n\n  const onSubmit = (data: AddGoalFormData) => {\n    addGoalMutation.mutate(data);\n  };\n\n  const handleClose = () => {\n    form.reset();\n    setIsCustomSupport(false);\n    onClose();\n  };\n\n  const supportLevels = [\n    { id: \"independent\", label: \"Independent\" },\n    { id: \"verbal\", label: \"Verbal\" },\n    { id: \"visual\", label: \"Visual\" },\n    { id: \"written\", label: \"Written\" },\n    { id: \"model-of-task\", label: \"Model of Task\" },\n    { id: \"self-correction\", label: \"Self-Correction\" },\n    { id: \"gesture\", label: \"Gesture\" }\n  ];\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent \n        className=\"sm:max-w-4xl w-full\"\n        style={{\n          maxHeight: '85vh',\n          height: 'auto',\n          overflow: 'visible'\n        }}\n      >\n        <DialogHeader>\n          <DialogTitle>Add New Goal</DialogTitle>\n        </DialogHeader>\n        \n        <div \n          style={{\n            maxHeight: 'calc(85vh - 80px)',\n            overflow: 'auto',\n            paddingRight: '4px',\n            marginRight: '-4px'\n          }}\n        >\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"title\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Goal Title</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"e.g., Reading Comprehension\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Goal Description</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      rows={3}\n                      placeholder=\"e.g., Student will read grade-level passages and answer comprehension questions with 80% accuracy over 3 consecutive trials.\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"targetCriteria\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Target Criteria for Mastery</FormLabel>\n                  <FormControl>\n                    <TargetCriteriaInput\n                      value={field.value || ''}\n                      onChange={field.onChange}\n                      dataCollectionType={form.watch(\"dataCollectionType\")}\n                      placeholder=\"e.g., 80% accuracy over 3 consecutive trials\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"dataCollectionType\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Data Collection Type</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select data collection type...\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"frequency\">Frequency</SelectItem>\n                      <SelectItem value=\"percentage\">Attempts in Trials (Percentages)</SelectItem>\n                      <SelectItem value=\"duration\">Duration</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            {form.watch(\"dataCollectionType\") === \"frequency\" && (\n              <FormField\n                control={form.control}\n                name=\"frequencyDirection\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Frequency Direction</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Is this goal to increase or decrease frequency?\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"increase\">Increase Frequency</SelectItem>\n                        <SelectItem value=\"decrease\">Decrease Frequency</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            )}\n\n            <FormField\n              control={form.control}\n              name=\"levelOfSupport\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Level of Support (Select all that apply)</FormLabel>\n                  <div className=\"grid grid-cols-2 gap-3 mt-2\">\n                    {supportLevels.map((level) => (\n                      <div key={level.id} className=\"flex items-center space-x-2\">\n                        <Checkbox\n                          id={level.id}\n                          checked={field.value?.includes(level.id) || false}\n                          onCheckedChange={(checked) => {\n                            const currentValues = field.value || [];\n                            if (checked) {\n                              field.onChange([...currentValues, level.id]);\n                            } else {\n                              field.onChange(currentValues.filter(value => value !== level.id));\n                            }\n                          }}\n                        />\n                        <label\n                          htmlFor={level.id}\n                          className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                        >\n                          {level.label}\n                        </label>\n                      </div>\n                    ))}\n                    \n                    {/* Custom Support Option - included in grid for consistent spacing */}\n                    <div className=\"flex items-center space-x-2\">\n                      <Checkbox\n                        id=\"custom-support\"\n                        checked={isCustomSupport}\n                        onCheckedChange={(checked) => {\n                          setIsCustomSupport(checked as boolean);\n                          if (!checked) {\n                            form.setValue(\"customLevelOfSupport\", \"\");\n                          }\n                        }}\n                      />\n                      <label\n                        htmlFor=\"custom-support\"\n                        className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                      >\n                        Custom\n                      </label>\n                    </div>\n                  </div>\n                  \n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            {/* Custom Level of Support Input */}\n            {isCustomSupport && (\n              <FormField\n                control={form.control}\n                name=\"customLevelOfSupport\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Custom Level of Support</FormLabel>\n                    <FormControl>\n                      <Input \n                        placeholder=\"Enter your custom level of support...\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            )}\n\n            {/* Objectives Section */}\n            <Card className=\"border-2 border-blue-200 bg-blue-50/30\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center justify-between text-blue-900\">\n                  ðŸ“‹ Goal Objectives ({form.watch(\"objectives\")?.length || 0})\n                  <Button\n                    type=\"button\"\n                    variant=\"default\"\n                    size=\"sm\"\n                    className=\"bg-blue-600 hover:bg-blue-700\"\n                    onClick={() => {\n                      const currentObjectives = form.getValues(\"objectives\") || [];\n                      form.setValue(\"objectives\", [\n                        ...currentObjectives,\n                        { description: \"\", targetCriteria: \"\", targetDate: \"\", status: \"active\" }\n                      ]);\n                    }}\n                  >\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Add Objective\n                  </Button>\n                </CardTitle>\n                <p className=\"text-sm text-blue-700 mt-2\">\n                  Add specific, measurable objectives that support this goal. You can add as many objectives as needed during goal creation.\n                </p>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {form.watch(\"objectives\")?.map((_, index) => (\n                  <div key={index} className=\"p-4 border rounded-lg space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <h4 className=\"font-medium\">Objective {index + 1}</h4>\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => {\n                          const currentObjectives = form.getValues(\"objectives\") || [];\n                          form.setValue(\"objectives\", currentObjectives.filter((_, i) => i !== index));\n                        }}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                    \n                    <FormField\n                      control={form.control}\n                      name={`objectives.${index}.description`}\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Objective Description</FormLabel>\n                          <FormControl>\n                            <Textarea\n                              rows={2}\n                              placeholder=\"e.g., Student will answer who/what questions about familiar stories with 80% accuracy\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    \n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                      <FormField\n                        control={form.control}\n                        name={`objectives.${index}.targetCriteria`}\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Target Criteria for Mastery</FormLabel>\n                            <FormControl>\n                              <TargetCriteriaInput\n                                value={field.value || ''}\n                                onChange={field.onChange}\n                                dataCollectionType={form.watch(\"dataCollectionType\")}\n                                placeholder=\"e.g., 80% accuracy over 4 trials\"\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      \n                      <FormField\n                        control={form.control}\n                        name={`objectives.${index}.targetDate`}\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Target Date (Optional)</FormLabel>\n                            <FormControl>\n                              <Input type=\"date\" {...field} />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                  </div>\n                ))}\n                \n                {(!form.watch(\"objectives\") || form.watch(\"objectives\")?.length === 0) && (\n                  <div className=\"text-center py-6 px-4 border-2 border-dashed border-blue-300 rounded-lg bg-white\">\n                    <div className=\"text-blue-400 mb-2\">ðŸ“</div>\n                    <p className=\"text-sm text-blue-600 font-medium mb-1\">\n                      No objectives added yet\n                    </p>\n                    <p className=\"text-xs text-blue-500\">\n                      Click \"Add Objective\" above to create specific objectives for this goal. You can also add them later.\n                    </p>\n                  </div>\n                )}\n                \n\n              </CardContent>\n            </Card>\n\n            <FormField\n              control={form.control}\n              name=\"status\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Status</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"active\">Active</SelectItem>\n                      <SelectItem value=\"mastered\">Mastered</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex justify-end space-x-3 pt-4\">\n              <Button \n                type=\"button\" \n                variant=\"outline\"\n                onClick={handleClose}\n                disabled={addGoalMutation.isPending}\n              >\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={addGoalMutation.isPending}\n              >\n                {addGoalMutation.isPending && (\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                )}\n                Add Goal\n              </Button>\n            </div>\n            </form>\n          </Form>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":19158,"size_tokens":null},"server/userMigration.ts":{"content":"import { storage } from './storage';\n\n/**\n * User Data Migration and Ownership Utilities\n * Ensures proper user ownership while preserving access to existing data\n */\n\nexport class UserMigrationService {\n  \n  /**\n   * Migrate all students from one user to another\n   * Useful for consolidating test data under a single user account\n   */\n  static async migrateStudentsToUser(fromUserId: string, toUserId: string) {\n    try {\n      console.log(`Migrating students from ${fromUserId} to ${toUserId}`);\n      \n      // Get all students from source user\n      const students = await storage.getStudentsByUserId(fromUserId);\n      console.log(`Found ${students.length} students to migrate`);\n      \n      // Update each student's userId\n      const migratedStudents = [];\n      for (const student of students) {\n        const updated = await storage.updateStudent(student.id, { userId: toUserId });\n        migratedStudents.push(updated);\n        console.log(`Migrated student ${student.id}: ${student.name}`);\n      }\n      \n      console.log(`Successfully migrated ${migratedStudents.length} students`);\n      return migratedStudents;\n    } catch (error) {\n      console.error('Migration failed:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * Validate that all students belong to the correct user\n   */\n  static async validateUserOwnership(userId: string) {\n    try {\n      const students = await storage.getStudentsByUserId(userId);\n      const invalidStudents = students.filter(student => student.userId !== userId);\n      \n      if (invalidStudents.length > 0) {\n        console.warn(`Found ${invalidStudents.length} students with incorrect ownership`);\n        return { valid: false, invalidStudents };\n      }\n      \n      console.log(`All ${students.length} students have correct ownership`);\n      return { valid: true, studentCount: students.length };\n    } catch (error) {\n      console.error('Ownership validation failed:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * Get students with strict ownership validation\n   */\n  static async getStudentsWithStrictOwnership(userId: string) {\n    try {\n      const students = await storage.getStudentsByUserId(userId);\n      \n      // Filter out any students that don't belong to this user\n      const ownedStudents = students.filter(student => student.userId === userId);\n      \n      if (ownedStudents.length !== students.length) {\n        console.warn(`Filtered out ${students.length - ownedStudents.length} students with incorrect ownership`);\n      }\n      \n      return ownedStudents;\n    } catch (error) {\n      console.error('Error getting students with strict ownership:', error);\n      throw error;\n    }\n  }\n}","path":null,"size_bytes":2681,"size_tokens":null},"client/src/components/clear-data-modal.tsx":{"content":"import { useState } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { AlertTriangle, Trash2 } from \"lucide-react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ClearDataModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  type: \"student\" | \"all\" | \"remove\";\n  studentId?: number;\n  studentName?: string;\n}\n\nexport function ClearDataModal({ isOpen, onClose, type, studentId, studentName }: ClearDataModalProps) {\n  const [confirmText, setConfirmText] = useState(\"\");\n  const [currentStep, setCurrentStep] = useState(1);\n  const [finalConfirmation, setFinalConfirmation] = useState(false);\n  const [dataBackedUp, setDataBackedUp] = useState(false);\n  const [reportsDownloaded, setReportsDownloaded] = useState(false);\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const expectedText = type === \"student\" ? \"CLEAR STUDENT\" : type === \"remove\" ? \"REMOVE STUDENT\" : \"CLEAR ALL DATA\";\n  const isTextConfirmed = confirmText === expectedText;\n  const isStep2Ready = currentStep === 2 && dataBackedUp && reportsDownloaded;\n  const isReadyForFinalStep = currentStep === 4 && isTextConfirmed && finalConfirmation;\n\n  const clearMutation = useMutation({\n    mutationFn: async () => {\n      if (type === \"student\" && studentId) {\n        await apiRequest(\"DELETE\", `/api/students/${studentId}/clear-data`);\n      } else if (type === \"remove\" && studentId) {\n        await apiRequest(\"DELETE\", `/api/students/${studentId}/remove-from-caseload`);\n      } else {\n        await apiRequest(\"DELETE\", \"/api/users/clear-all-data\");\n      }\n    },\n    onSuccess: () => {\n      // Invalidate relevant caches\n      if (type === \"student\") {\n        queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}`] });\n        queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/goals`] });\n        queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/all-data-points`] });\n        queryClient.invalidateQueries({ queryKey: [`/api/students/${studentId}/objectives`] });\n      } else if (type === \"remove\") {\n        queryClient.invalidateQueries({ queryKey: [\"/api/students\"] });\n        // Redirect to home page after removing student\n        setTimeout(() => {\n          window.location.href = \"/\";\n        }, 1000);\n      } else {\n        queryClient.invalidateQueries({ queryKey: [\"/api/students\"] });\n        queryClient.invalidateQueries({ queryKey: [\"/api/reporting-periods\"] });\n      }\n      \n      toast({\n        title: type === \"remove\" ? \"Student Removed\" : \"Data Cleared\",\n        description: type === \"student\" \n          ? `All data for ${studentName} has been cleared.`\n          : type === \"remove\" \n          ? `${studentName} has been removed from your caseload.`\n          : \"All students and data have been cleared from your caseload.\",\n        variant: \"default\",\n      });\n      \n      onClose();\n      setConfirmText(\"\");\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: type === \"remove\" \n          ? `Failed to remove student from caseload: ${error.message}`\n          : `Failed to clear data: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleNext = () => {\n    if (currentStep < 4) {\n      setCurrentStep(currentStep + 1);\n    }\n  };\n\n  const handleSubmit = () => {\n    if (isReadyForFinalStep) {\n      clearMutation.mutate();\n    }\n  };\n\n  const handleClose = () => {\n    onClose();\n    setConfirmText(\"\");\n    setCurrentStep(1);\n    setFinalConfirmation(false);\n    setDataBackedUp(false);\n    setReportsDownloaded(false);\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-red-100\">\n              <AlertTriangle className=\"h-5 w-5 text-red-600\" />\n            </div>\n            <div className=\"flex-1\">\n              <DialogTitle className=\"text-lg font-semibold\">\n                {type === \"student\" ? \"Clear Student Data\" : type === \"remove\" ? \"Remove Student from Caseload\" : \"Clear All Data\"} - Step {currentStep} of 4\n              </DialogTitle>\n              <DialogDescription className=\"text-sm text-gray-600\">\n                Multiple confirmations required - This action cannot be undone\n              </DialogDescription>\n            </div>\n            <div className=\"flex space-x-1\">\n              {[1, 2, 3, 4].map((step) => (\n                <div\n                  key={step}\n                  className={`w-3 h-3 rounded-full ${\n                    step <= currentStep \n                      ? 'bg-red-500' \n                      : 'bg-gray-300'\n                  }`}\n                />\n              ))}\n            </div>\n          </div>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          {/* Step 1: Warning */}\n          {currentStep === 1 && (\n            <div className=\"space-y-4\">\n              <div className=\"rounded-lg bg-red-50 p-4 border border-red-200\">\n                <h4 className=\"font-medium text-red-800 mb-2\">\n                  âš ï¸ WARNING: This is a PERMANENT action\n                </h4>\n                <p className=\"text-sm text-red-700\">\n                  {type === \"student\" \n                    ? `You are about to permanently delete ALL data for ${studentName}. This includes goals, objectives, and all progress tracking data.`\n                    : type === \"remove\"\n                    ? `You are about to permanently remove ${studentName} from your caseload. This will delete the student record AND all associated data (goals, objectives, and progress tracking).`\n                    : \"You are about to permanently delete YOUR ENTIRE CASELOAD. This includes all students, goals, objectives, progress data, and reporting periods.\"\n                  }\n                </p>\n              </div>\n              \n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                <h4 className=\"font-medium text-blue-800 mb-2\">ðŸ“¥ RECOMMENDED: Save Your Data First</h4>\n                <p className=\"text-sm text-blue-700 mb-2\">\n                  Before proceeding, we strongly recommend downloading your data:\n                </p>\n                <ul className=\"text-sm text-blue-700 space-y-1\">\n                  <li>â€¢ Export raw data tables as PDF from each student's Raw Data tab</li>\n                  <li>â€¢ Print progress charts from each student's Reports tab</li>\n                  <li>â€¢ Save any important notes or documentation</li>\n                  {type === \"all\" && <li>â€¢ Consider backing up your entire teaching portfolio</li>}\n                </ul>\n              </div>\n\n              <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n                <h4 className=\"font-medium text-yellow-800 mb-2\">âš ï¸ Important considerations:</h4>\n                <ul className=\"text-sm text-yellow-700 space-y-1\">\n                  <li>â€¢ This action cannot be undone</li>\n                  <li>â€¢ Data cannot be recovered after deletion</li>\n                  <li>â€¢ All progress tracking will be permanently lost</li>\n                  {type === \"all\" && <li>â€¢ You will lose all your teaching portfolio data</li>}\n                </ul>\n              </div>\n            </div>\n          )}\n\n          {/* Step 2: Data Backup Confirmation */}\n          {currentStep === 2 && (\n            <div className=\"space-y-4\">\n              <div className=\"rounded-lg bg-blue-50 p-4 border border-blue-200\">\n                <h4 className=\"font-bold text-blue-800 mb-3\">\n                  ðŸ“¥ BACKUP YOUR DATA FIRST\n                </h4>\n                <p className=\"text-sm text-blue-700 mb-3\">\n                  Before continuing, you must back up your important data. Once deleted, this information cannot be recovered.\n                </p>\n                \n                <div className=\"space-y-3\">\n                  <div className=\"bg-white p-3 rounded border border-blue-200\">\n                    <h5 className=\"font-medium text-blue-800 mb-2\">Required Actions:</h5>\n                    <ul className=\"text-sm text-blue-700 space-y-1\">\n                      {type === \"student\" ? (\n                        <>\n                          <li>â€¢ Go to {studentName}'s Raw Data tab and click \"Print PDF\" to save all data points</li>\n                          <li>â€¢ Go to {studentName}'s Reports tab and click \"Print Charts\" to save progress charts</li>\n                          <li>â€¢ Save any important notes or objectives documentation</li>\n                        </>\n                      ) : (\n                        <>\n                          <li>â€¢ Visit each student's Raw Data tab and export PDF reports</li>\n                          <li>â€¢ Visit each student's Reports tab and print progress charts</li>\n                          <li>â€¢ Export any reporting period configurations</li>\n                          <li>â€¢ Save your complete teaching portfolio</li>\n                        </>\n                      )}\n                    </ul>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center space-x-2\">\n                      <input\n                        type=\"checkbox\"\n                        id=\"dataBackup\"\n                        checked={dataBackedUp}\n                        onChange={(e) => setDataBackedUp(e.target.checked)}\n                        className=\"w-4 h-4 text-blue-600 border-blue-300 rounded focus:ring-blue-500\"\n                      />\n                      <label htmlFor=\"dataBackup\" className=\"text-sm text-gray-700\">\n                        âœ“ I have downloaded all raw data PDFs\n                      </label>\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-2\">\n                      <input\n                        type=\"checkbox\"\n                        id=\"reportsBackup\"\n                        checked={reportsDownloaded}\n                        onChange={(e) => setReportsDownloaded(e.target.checked)}\n                        className=\"w-4 h-4 text-blue-600 border-blue-300 rounded focus:ring-blue-500\"\n                      />\n                      <label htmlFor=\"reportsBackup\" className=\"text-sm text-gray-700\">\n                        âœ“ I have printed all progress charts and reports\n                      </label>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\n                <p className=\"text-sm text-gray-700\">\n                  <strong>Note:</strong> You must confirm both backup actions above before proceeding to the next step.\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* Step 3: Data Review */}\n          {currentStep === 3 && (\n            <div className=\"space-y-4\">\n              <div className=\"rounded-lg bg-red-50 p-4 border border-red-200\">\n                <h4 className=\"font-medium text-red-800 mb-2\">\n                  Data that will be PERMANENTLY DELETED:\n                </h4>\n                <ul className=\"text-sm text-red-700 space-y-1\">\n                  {type === \"student\" ? (\n                    <>\n                      <li>â€¢ All goals for {studentName}</li>\n                      <li>â€¢ All objectives for {studentName}</li>\n                      <li>â€¢ All progress data points for {studentName}</li>\n                      <li>â€¢ The student will remain in your caseload</li>\n                    </>\n                  ) : (\n                    <>\n                      <li>â€¢ All students in your caseload</li>\n                      <li>â€¢ All goals and objectives</li>\n                      <li>â€¢ All progress data points</li>\n                      <li>â€¢ All reporting periods</li>\n                      <li>â€¢ Your entire teaching portfolio</li>\n                    </>\n                  )}\n                </ul>\n              </div>\n              \n              <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\n                <p className=\"text-sm text-gray-700\">\n                  Are you absolutely certain you want to proceed with this permanent deletion?\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* Step 4: Final Confirmation */}\n          {currentStep === 4 && (\n            <div className=\"space-y-4\">\n              <div className=\"rounded-lg bg-red-100 p-4 border-2 border-red-300\">\n                <h4 className=\"font-bold text-red-900 mb-2\">\n                  ðŸš¨ FINAL CONFIRMATION REQUIRED\n                </h4>\n                <p className=\"text-sm text-red-800 mb-3\">\n                  This is your last chance to cancel. Once you proceed, all data will be permanently lost.\n                </p>\n              </div>\n\n              <div className=\"space-y-3\">\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">\n                    Type <span className=\"font-bold text-red-600\">{expectedText}</span> to continue:\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={confirmText}\n                    onChange={(e) => setConfirmText(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500\"\n                    placeholder={expectedText}\n                  />\n                </div>\n                \n                <div className=\"flex items-center space-x-2\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"finalConfirm\"\n                    checked={finalConfirmation}\n                    onChange={(e) => setFinalConfirmation(e.target.checked)}\n                    className=\"w-4 h-4 text-red-600 border-red-300 rounded focus:ring-red-500\"\n                  />\n                  <label htmlFor=\"finalConfirm\" className=\"text-sm text-gray-700\">\n                    I understand this action is permanent and cannot be undone\n                  </label>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        <DialogFooter className=\"gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={handleClose}\n            disabled={clearMutation.isPending}\n          >\n            Cancel\n          </Button>\n          \n          {currentStep < 4 ? (\n            <Button\n              variant=\"outline\"\n              onClick={handleNext}\n              disabled={clearMutation.isPending || (currentStep === 2 && (!dataBackedUp || !reportsDownloaded))}\n              className=\"bg-orange-50 border-orange-300 text-orange-700 hover:bg-orange-100\"\n            >\n              {currentStep === 2 ? 'Data Backed Up - Continue' : 'Continue'}\n            </Button>\n          ) : (\n            <Button\n              variant=\"destructive\"\n              onClick={handleSubmit}\n              disabled={!isReadyForFinalStep || clearMutation.isPending}\n              className=\"min-w-[140px]\"\n            >\n              {clearMutation.isPending ? (\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent\" />\n                  Clearing...\n                </div>\n              ) : (\n                <div className=\"flex items-center gap-2\">\n                  <Trash2 className=\"h-4 w-4\" />\n                  PERMANENTLY DELETE\n                </div>\n              )}\n            </Button>\n          )}\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}","path":null,"size_bytes":16245,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n// Reporting Period Types\nexport interface ReportingPeriod {\n  periodNumber: number;\n  startDate: string;\n  endDate: string;\n}\n\nexport interface ReportingData {\n  periods: ReportingPeriod[];\n  periodLength: string;\n}\n\n// Get the current reporting period based on today's date\nexport function getCurrentReportingPeriod(reportingData: ReportingData | null): ReportingPeriod | null {\n  if (!reportingData || !reportingData.periods.length) {\n    return null;\n  }\n\n  const today = new Date();\n  return reportingData.periods.find(period => {\n    const start = new Date(period.startDate);\n    const end = new Date(period.endDate);\n    return today >= start && today <= end;\n  }) || null;\n}\n\n// Filter data points to only include those within a specific date range\nexport function filterDataPointsByDateRange<T extends { date: string | Date }>(\n  dataPoints: T[], \n  startDate: string, \n  endDate: string\n): T[] {\n  const start = new Date(startDate);\n  const end = new Date(endDate);\n  \n  return dataPoints.filter(dataPoint => {\n    const dataDate = new Date(dataPoint.date);\n    return dataDate >= start && dataDate <= end;\n  });\n}\n\n// Filter data points to only include those within the current reporting period\nexport function filterDataPointsByCurrentPeriod<T extends { date: string | Date }>(\n  dataPoints: T[], \n  reportingData: ReportingData | null\n): T[] {\n  const currentPeriod = getCurrentReportingPeriod(reportingData);\n  \n  if (!currentPeriod) {\n    // If no current period, return all data points (fallback behavior)\n    return dataPoints;\n  }\n  \n  return filterDataPointsByDateRange(dataPoints, currentPeriod.startDate, currentPeriod.endDate);\n}\n\n// Filter data points to only include those within a specific reporting period\nexport function filterDataPointsByPeriod<T extends { date: string | Date }>(\n  dataPoints: T[], \n  period: ReportingPeriod | null\n): T[] {\n  if (!period) {\n    // If no period specified, return all data points\n    return dataPoints;\n  }\n  \n  return filterDataPointsByDateRange(dataPoints, period.startDate, period.endDate);\n}\n","path":null,"size_bytes":2225,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/edit-data-point-modal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { z } from \"zod\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\n\nconst editDataPointSchema = z.object({\n  date: z.string()\n    .min(1, \"Date is required\")\n    .regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\")\n    .refine((date) => {\n      const parsed = new Date(date);\n      return !isNaN(parsed.getTime());\n    }, \"Invalid date\"),\n  progressValue: z.string()\n    .min(1, \"Progress value is required\")\n    .refine((val) => {\n      const num = parseFloat(val);\n      return !isNaN(num) && num >= -999 && num <= 999;\n    }, \"Value must be a number between -999 and 999\"),\n  durationUnit: z.string().refine((val) => !val || val === \"seconds\" || val === \"minutes\", \n    \"Duration unit must be seconds or minutes\").optional(),\n  levelOfSupport: z.array(z.string().max(100)).max(20).optional(),\n  anecdotalInfo: z.string().max(2000, \"Notes must be 2000 characters or less\").optional(),\n  numerator: z.string().optional().refine((val) => {\n    if (!val || val === '') return true;\n    const num = parseInt(val);\n    return !isNaN(num) && num >= 0 && num <= 9999;\n  }, \"Numerator must be between 0 and 9999\"),\n  denominator: z.string().optional().refine((val) => {\n    if (!val || val === '') return true;\n    const num = parseInt(val);\n    return !isNaN(num) && num >= 1 && num <= 9999;\n  }, \"Denominator must be between 1 and 9999\"),\n});\n\ntype EditDataPointFormData = z.infer<typeof editDataPointSchema>;\n\ninterface DataPoint {\n  id: number;\n  goalId: number;\n  goalTitle: string;\n  date: string;\n  progressValue: string;\n  progressFormat: 'percentage' | 'frequency' | 'duration';\n  numerator?: number;\n  denominator?: number;\n  durationUnit?: string;\n  levelOfSupport?: string;\n  anecdotalInfo?: string;\n  dataCollectionType?: string;\n}\n\ninterface EditDataPointModalProps {\n  dataPoint: DataPoint;\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess?: () => void;\n}\n\nconst supportLevels = [\n  \"independent\",\n  \"verbal\",\n  \"visual\",\n  \"written\",\n  \"model-of-task\",\n  \"self-correction\",\n  \"gesture\"\n];\n\nconst supportLevelLabels: Record<string, string> = {\n  \"independent\": \"Independent\",\n  \"verbal\": \"Verbal\",\n  \"visual\": \"Visual\",\n  \"written\": \"Written\",\n  \"model-of-task\": \"Model of Task\",\n  \"self-correction\": \"Self-Correction\",\n  \"gesture\": \"Gesture\"\n};\n\nexport default function EditDataPointModal({ dataPoint, isOpen, onClose, onSuccess }: EditDataPointModalProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedSupport, setSelectedSupport] = useState<string[]>([]);\n\n  const form = useForm<EditDataPointFormData>({\n    resolver: zodResolver(editDataPointSchema),\n    defaultValues: {\n      date: dataPoint.date ? new Date(dataPoint.date).toISOString().split('T')[0] : '',\n      progressValue: dataPoint.progressValue || '',\n      durationUnit: dataPoint.durationUnit || 'minutes',\n      levelOfSupport: [],\n      anecdotalInfo: dataPoint.anecdotalInfo || '',\n      numerator: dataPoint.numerator?.toString() || '',\n      denominator: dataPoint.denominator?.toString() || '',\n    },\n  });\n\n  // Parse level of support when component mounts or dataPoint changes\n  useEffect(() => {\n    if (dataPoint.levelOfSupport) {\n      try {\n        const parsed = JSON.parse(dataPoint.levelOfSupport);\n        const supportArray = Array.isArray(parsed) ? parsed : [parsed];\n        setSelectedSupport(supportArray);\n        form.setValue('levelOfSupport', supportArray);\n      } catch {\n        // If not JSON, treat as single value\n        const singleSupport = [dataPoint.levelOfSupport];\n        setSelectedSupport(singleSupport);\n        form.setValue('levelOfSupport', singleSupport);\n      }\n    }\n  }, [dataPoint, form]);\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: EditDataPointFormData) => {\n      const updateData = {\n        date: data.date,\n        progressValue: data.progressValue,\n        durationUnit: data.durationUnit,\n        levelOfSupport: JSON.stringify(selectedSupport),\n        anecdotalInfo: data.anecdotalInfo,\n        numerator: data.numerator ? parseInt(data.numerator) : null,\n        denominator: data.denominator ? parseInt(data.denominator) : null,\n      };\n\n      return apiRequest('PATCH', `/api/data-points/${dataPoint.id}`, updateData);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Data point updated successfully!\",\n      });\n      \n      // Invalidate and refetch relevant queries - use studentId from the data point\n      queryClient.invalidateQueries({ queryKey: [`/api/students`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/goals/${dataPoint.goalId}/data-points`] });\n      \n      onSuccess?.();\n      onClose();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update data point\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSupportChange = (supportLevel: string, checked: boolean) => {\n    const newSupport = checked \n      ? [...selectedSupport, supportLevel]\n      : selectedSupport.filter(s => s !== supportLevel);\n    \n    setSelectedSupport(newSupport);\n    form.setValue('levelOfSupport', newSupport);\n  };\n\n  const onSubmit = (data: EditDataPointFormData) => {\n    updateMutation.mutate(data);\n  };\n\n  // Generate options for minutes dropdown (duration goals)\n  const minutesOptions: { value: string; label: string }[] = [];\n  for (let min = 0; min < 60; min++) {\n    for (let sec = (min === 0 ? 1 : 1); sec < 60; sec++) {\n      const decimalValue = min + (sec / 100);\n      const label = `${min}m ${sec}s`;\n      minutesOptions.push({ value: decimalValue.toFixed(2), label });\n    }\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>Edit Data Point</DialogTitle>\n          <p className=\"text-sm text-muted-foreground\">\n            Goal: {dataPoint.goalTitle}\n          </p>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            {/* Date Field */}\n            <FormField\n              control={form.control}\n              name=\"date\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Date</FormLabel>\n                  <FormControl>\n                    <Input type=\"date\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            {/* Progress Value - Dynamic based on data collection type */}\n            {dataPoint.progressFormat === 'duration' ? (\n              <div className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"progressValue\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Duration Value</FormLabel>\n                      <FormControl>\n                        <Select value={field.value} onValueChange={field.onChange}>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select duration...\" />\n                          </SelectTrigger>\n                          <SelectContent className=\"max-h-[200px]\">\n                            {minutesOptions.map((option) => (\n                              <SelectItem key={option.value} value={option.value}>\n                                {option.label} ({option.value})\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"durationUnit\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Time Unit</FormLabel>\n                      <FormControl>\n                        <select \n                          {...field} \n                          className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                        >\n                          <option value=\"seconds\">Seconds</option>\n                          <option value=\"minutes\">Minutes</option>\n                        </select>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n            ) : dataPoint.progressFormat === 'frequency' ? (\n              <FormField\n                control={form.control}\n                name=\"progressValue\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Frequency Count</FormLabel>\n                    <FormControl>\n                      <Input \n                        type=\"number\" \n                        min=\"0\" \n                        step=\"1\"\n                        placeholder=\"Enter frequency count...\" \n                        {...field} \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            ) : (\n              <div className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"progressValue\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Percentage Value</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          min=\"0\" \n                          max=\"100\" \n                          step=\"0.01\"\n                          placeholder=\"Enter percentage...\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"numerator\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Correct Trials</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            min=\"0\"\n                            placeholder=\"Correct...\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"denominator\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Total Trials</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            min=\"1\"\n                            placeholder=\"Total...\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n              </div>\n            )}\n\n            {/* Level of Support */}\n            <div className=\"space-y-3\">\n              <FormLabel>Level of Support</FormLabel>\n              <div className=\"grid grid-cols-2 gap-2\">\n                {supportLevels.map((level) => (\n                  <div key={level} className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id={level}\n                      checked={selectedSupport.includes(level)}\n                      onCheckedChange={(checked) => handleSupportChange(level, checked as boolean)}\n                    />\n                    <label\n                      htmlFor={level}\n                      className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                    >\n                      {supportLevelLabels[level]}\n                    </label>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Anecdotal Info */}\n            <FormField\n              control={form.control}\n              name=\"anecdotalInfo\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Notes</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      placeholder=\"Add any additional notes about this data point...\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex justify-end space-x-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={updateMutation.isPending}>\n                {updateMutation.isPending ? \"Updating...\" : \"Update Data Point\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","path":null,"size_bytes":14697,"size_tokens":null},"client/src/components/goal-progress-card.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar, Edit2, Trash2, Bell } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useMasteryReview } from \"@/hooks/use-mastery-review\";\n\ninterface Goal {\n  id: number;\n  title: string;\n  description: string;\n  targetCriteria?: string;\n  status: string;\n  dataCollectionType: string;\n  currentProgress: number;\n  averageScore: number;\n  trend: number;\n  lastScore: number;\n  dataPointsCount: number;\n  updatedAt: string;\n}\n\ninterface GoalProgressCardProps {\n  goal: Goal;\n  studentId: number;\n  onEditGoal?: () => void;\n  onDeleteGoal?: () => void;\n}\n\nexport default function GoalProgressCard({ goal, studentId, onEditGoal, onDeleteGoal }: GoalProgressCardProps) {\n  const { needsReview, markAsReviewed } = useMasteryReview(studentId);\n  const showReviewNotification = needsReview(goal.id, 'goal');\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'mastered':\n        return 'bg-red-100 text-red-800';\n      case 'active':\n        return 'bg-green-100 text-green-800';\n      case 'discontinued':\n        return 'bg-gray-100 text-gray-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getProgressColor = (progress: number) => {\n    return 'bg-blue-500';\n  };\n\n  const formatTrend = (trend: number) => {\n    if (trend > 0) return `+${trend.toFixed(1)}%`;\n    if (trend < 0) return `${trend.toFixed(1)}%`;\n    return '0%';\n  };\n\n  return (\n    <Card className=\"hover:shadow-md transition-shadow\">\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between mb-4\">\n          <div className=\"flex-1\">\n            <h4 className=\"text-lg font-semibold text-gray-900 mb-2\">{goal.title}</h4>\n            <p className=\"text-gray-600 text-sm line-clamp-2\">{goal.description}</p>\n            {goal.targetCriteria && (\n              <p className=\"text-sm text-blue-600 mt-1\">\n                <strong>Target:</strong> {goal.targetCriteria}\n              </p>\n            )}\n            <div className=\"flex items-center gap-2 mt-2\">\n              <Badge className={getStatusColor(goal.status)}>\n                {goal.status === 'mastered' ? 'Mastered' : \n                 goal.status === 'active' ? 'Active' : \n                 goal.status === 'discontinued' ? 'Discontinued' : goal.status}\n              </Badge>\n              {showReviewNotification && (\n                <Badge \n                  className=\"bg-orange-100 text-orange-800 cursor-pointer hover:bg-orange-200\"\n                  onClick={() => markAsReviewed(goal.id, 'goal')}\n                >\n                  <Bell className=\"h-3 w-3 mr-1\" />\n                  Review Mastery\n                </Badge>\n              )}\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2 ml-4\">\n            {onEditGoal && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={onEditGoal}\n              >\n                <Edit2 className=\"h-4 w-4\" />\n              </Button>\n            )}\n            {onDeleteGoal && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={onDeleteGoal}\n                className=\"text-red-600 hover:bg-red-50\"\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            )}\n          </div>\n        </div>\n\n        {/* Goal Progress Bar */}\n        <div className=\"mb-4\">\n          <div className=\"flex justify-between items-center mb-2\">\n            <span className=\"text-sm font-medium text-gray-700\">Current Progress</span>\n            <span className=\"text-sm font-semibold text-gray-900\">{goal.currentProgress?.toFixed(0) || 0}%</span>\n          </div>\n          <Progress \n            value={Math.min(Math.max(goal.currentProgress || 0, 0), 100)} \n            className=\"h-3 bg-gray-200\"\n          />\n        </div>\n\n        {/* Goal Statistics */}\n        {goal.dataCollectionType === 'percentage' ? (\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\">\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <p className=\"text-2xl font-bold text-gray-900\">{goal.dataPointsCount || 0}</p>\n              <p className=\"text-xs text-gray-600\">Data Points</p>\n            </div>\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <p className=\"text-2xl font-bold text-gray-900\">{goal.averageScore?.toFixed(0) || 0}%</p>\n              <p className=\"text-xs text-gray-600\">Average Score</p>\n            </div>\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <p className={`text-2xl font-bold ${goal.trend > 0 ? 'text-green-600' : goal.trend < 0 ? 'text-red-600' : 'text-gray-900'}`}>\n                {formatTrend(goal.trend || 0)}\n              </p>\n              <p className=\"text-xs text-gray-600\">Trend</p>\n            </div>\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <p className=\"text-2xl font-bold text-gray-900\">{goal.lastScore?.toFixed(0) || 0}%</p>\n              <p className=\"text-xs text-gray-600\">Last Score</p>\n            </div>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 gap-4 mb-4\">\n            <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n              <p className=\"text-2xl font-bold text-gray-900\">{goal.dataPointsCount || 0}</p>\n              <p className=\"text-xs text-gray-600\">Data Points</p>\n            </div>\n          </div>\n        )}\n\n        {/* Last Updated Info */}\n        <div className=\"pt-4 border-t border-gray-100\">\n          <div className=\"text-sm text-gray-600 flex items-center justify-center\">\n            <Calendar className=\"h-4 w-4 mr-1\" />\n            Last updated: {format(new Date(goal.updatedAt), \"MMM d\")}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":6106,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth } from \"./replitAuth\";\nimport { UserMigrationService } from \"./userMigration\";\nimport { insertStudentSchema, insertGoalSchema, insertDataPointSchema, insertObjectiveSchema, students, reportingPeriodsSubmitSchema } from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq } from \"drizzle-orm\";\nimport { z } from \"zod\";\n\nfunction safeParseInt(value: string, paramName: string): number | { error: string } {\n  const parsed = parseInt(value, 10);\n  if (isNaN(parsed) || !Number.isFinite(parsed)) {\n    return { error: `Invalid ${paramName}: must be a valid integer` };\n  }\n  if (parsed < 0 || parsed > 2147483647) {\n    return { error: `Invalid ${paramName}: value out of range` };\n  }\n  return parsed;\n}\n\nconst isDevelopment = process.env.NODE_ENV !== 'production';\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Debug endpoints - only available in development mode\n  if (isDevelopment) {\n    app.get('/api/debug/force-load', async (req, res) => {\n      try {\n        const students = await storage.getStudentsByUserId('4201332');\n        const studentsWithSummary = await Promise.all(\n          students.map(async (student) => {\n            const summary = await storage.getStudentSummary(student.id);\n            return { ...student, ...summary };\n          })\n        );\n        res.json(studentsWithSummary);\n      } catch (error) {\n        res.status(500).json({ message: \"Failed to force load students\" });\n      }\n    });\n\n    app.post('/api/test', (req, res) => {\n      res.json({ message: \"Server is working\", received: req.body });\n    });\n\n    app.get('/api/debug/goal-74', async (req, res) => {\n      try {\n        const goalId = 74;\n        const directDataPoints = await storage.getDataPointsByGoalId(goalId);\n        const progress = await storage.getGoalProgress(goalId);\n        res.json({\n          directDataPoints: directDataPoints.length,\n          progressDataPoints: progress.dataPoints.length,\n          latestDataPoints: directDataPoints.slice(0, 5).map(dp => ({\n            id: dp.id,\n            date: dp.date,\n            value: dp.progressValue\n          }))\n        });\n      } catch (error) {\n        res.status(500).json({ error: error instanceof Error ? error.message : \"Unknown error\" });\n      }\n    });\n  }\n\n  // Auth middleware - this sets up sessions first\n  await setupAuth(app);\n\n  // Admin login route - development mode only with env var credentials\n  if (isDevelopment) {\n    app.post('/api/auth/admin-login', async (req: any, res) => {\n      try {\n        const { username, password } = req.body;\n        const adminUsername = process.env.ADMIN_USERNAME || 'admin';\n        const adminPassword = process.env.ADMIN_PASSWORD;\n        \n        if (!adminPassword) {\n          return res.status(503).json({ message: \"Admin login not configured\" });\n        }\n        \n        if (username === adminUsername && password === adminPassword) {\n          await storage.upsertUser({\n            id: '4201332',\n            email: 'sandralindsey@speechpathai.com',\n            firstName: 'Sandra',\n            lastName: 'Lindsey',\n          });\n          \n          if (req.session) {\n            const adminUser = {\n              claims: { \n                sub: '4201332',\n                email: 'sandralindsey@speechpathai.com',\n                first_name: 'Sandra',\n                last_name: 'Lindsey'\n              },\n              expires_at: Math.floor(Date.now() / 1000) + (7 * 24 * 60 * 60),\n            };\n            \n            req.login(adminUser, (err: Error | null) => {\n              if (err) {\n                return res.status(500).json({ success: false, message: 'Session creation failed' });\n              }\n              \n              req.session.save((saveErr: Error | null) => {\n                res.json({ success: true, message: \"Admin login successful\", redirectTo: \"/\" });\n              });\n            });\n          } else {\n            res.status(500).json({ message: \"Session not available\" });\n          }\n        } else {\n          res.status(401).json({ message: \"Invalid admin credentials\" });\n        }\n      } catch (error) {\n        res.status(500).json({ message: \"Login failed\" });\n      }\n    });\n  }\n\n  // Auth debug routes - development mode only\n  if (isDevelopment) {\n    app.get('/api/auth/debug', (req: any, res) => {\n      res.json({\n        isAuthenticated: req.isAuthenticated(),\n        hasUser: !!req.user,\n        hasSession: !!req.session,\n        sessionId: req.sessionID,\n        userClaims: req.user?.claims || null,\n        expires_at: req.user?.expires_at || null,\n      });\n    });\n\n    app.get('/api/auth/test-login', async (req: any, res) => {\n      try {\n        await storage.upsertUser({\n          id: 'test-user-123',\n          email: 'test@example.com',\n          firstName: 'Test',\n          lastName: 'User',\n        });\n        \n        req.user = {\n          claims: { sub: 'test-user-123', email: 'test@example.com' },\n          expires_at: Math.floor(Date.now() / 1000) + 3600,\n        };\n        \n        req.session.passport = { user: req.user };\n        res.redirect('/');\n      } catch (error) {\n        res.status(500).json({ message: \"Failed to create test session\" });\n      }\n    });\n  }\n\n  app.get('/api/auth/user', async (req: any, res) => {\n    try {\n      // Development mode - return mock user data\n      const mockUser = {\n        id: '4201332',\n        email: 'sandralindsey@speechpathai.com',\n        firstName: 'Sandra',\n        lastName: 'Lindsey',\n        profileImageUrl: null,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      };\n      res.json(mockUser);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Debug endpoints - only available in development mode\n  if (isDevelopment) {\n    app.get('/api/debug/user-data', async (req: any, res) => {\n      try {\n        const userId = '4201332';\n        const allUsers = await storage.getAllUsers();\n        const allStudents = await storage.getAllStudents();\n        const userStudents = await storage.getStudentsByUserId(userId);\n        \n        res.json({\n          currentUserId: userId,\n          allUsers: allUsers.map(u => ({ id: u.id, email: u.email })),\n          allStudents: allStudents.map(s => ({ id: s.id, name: s.name, userId: s.userId })),\n          userStudents: userStudents.length\n        });\n      } catch (error) {\n        res.status(500).json({ message: \"Debug failed\" });\n      }\n    });\n\n    app.post('/api/debug/fix-user-data', async (req: any, res) => {\n      try {\n        const currentUserId = '4201332';\n        const testUserId = 'test-user-123';\n        \n        const result = await db\n          .update(students)\n          .set({ userId: currentUserId })\n          .where(eq(students.userId, testUserId))\n          .returning();\n        \n        res.json({\n          message: `Successfully transferred ${result.length} students to your account`,\n          transferredStudents: result.length\n        });\n      } catch (error) {\n        res.status(500).json({ message: \"Failed to fix user data\" });\n      }\n    });\n\n    app.get('/api/students/force-load', async (req, res) => {\n      try {\n        const students = await storage.getStudentsByUserId('4201332');\n        const studentsWithSummary = await Promise.all(\n          students.map(async (student) => {\n            const summary = await storage.getStudentSummary(student.id);\n            return { ...student, ...summary };\n          })\n        );\n        res.json(studentsWithSummary);\n      } catch (error) {\n        res.status(500).json({ message: \"Failed to force load students\" });\n      }\n    });\n  }\n\n  // Student routes with proper user ownership\n  app.get('/api/students', async (req: any, res) => {\n    try {\n      const userId = '4201332';\n      const students = await storage.getStudentsByUserId(userId);\n      \n      const studentsWithSummary = await Promise.all(\n        students.map(async (student) => {\n          const summary = await storage.getStudentSummary(student.id);\n          return { ...student, ...summary };\n        })\n      );\n      \n      res.json(studentsWithSummary);\n    } catch (error) {\n      console.error(\"Error fetching students:\", error);\n      res.status(500).json({ message: \"Failed to fetch students\" });\n    }\n  });\n\n  app.post('/api/students', async (req: any, res) => {\n    try {\n      const userId = '4201332';\n      const studentData = insertStudentSchema.parse({ ...req.body, userId });\n      const student = await storage.createStudent(studentData);\n      res.status(201).json(student);\n    } catch (error) {\n      console.error(\"Error creating student:\", error);\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid student data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to create student\" });\n      }\n    }\n  });\n\n  app.get('/api/students/:id', async (req: any, res) => {\n    try {\n      const studentId = parseInt(req.params.id);\n      const student = await storage.getStudentById(studentId);\n      \n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      \n      if (student.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const summary = await storage.getStudentSummary(studentId);\n      res.json({ ...student, ...summary });\n    } catch (error) {\n      console.error(\"Error fetching student:\", error);\n      res.status(500).json({ message: \"Failed to fetch student\" });\n    }\n  });\n\n  app.put('/api/students/:id', async (req: any, res) => {\n    try {\n      const studentId = parseInt(req.params.id);\n      const existingStudent = await storage.getStudentById(studentId);\n      \n      if (!existingStudent) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      // Verify ownership with fallback for user 4201332 and 42813322\n      const userId = '4201332';\n      if (existingStudent.userId !== userId && existingStudent.userId !== '4201332' && existingStudent.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const updateData = insertStudentSchema.partial().parse(req.body);\n      const student = await storage.updateStudent(studentId, updateData);\n      res.json(student);\n    } catch (error) {\n      console.error(\"Error updating student:\", error);\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid student data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to update student\" });\n      }\n    }\n  });\n\n  app.delete('/api/students/:id', async (req: any, res) => {\n    try {\n      const studentId = parseInt(req.params.id);\n      const existingStudent = await storage.getStudentById(studentId);\n      \n      if (!existingStudent) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      // Verify ownership with fallback for user 4201332 and 42813322\n      const userId = '4201332';\n      if (existingStudent.userId !== userId && existingStudent.userId !== '4201332' && existingStudent.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      await storage.deleteStudent(studentId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting student:\", error);\n      res.status(500).json({ message: \"Failed to delete student\" });\n    }\n  });\n\n  // Goal routes\n  app.get('/api/students/:studentId/goals', async (req: any, res) => {\n    try {\n      const studentId = parseInt(req.params.studentId);\n      const student = await storage.getStudentById(studentId);\n      \n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      // Verify ownership with fallback for user 4201332 and 42813322\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const goals = await storage.getGoalsByStudentId(studentId);\n      \n      \n      // Get progress data for each goal\n      const goalsWithProgress = await Promise.all(\n        goals.map(async (goal) => {\n          const progress = await storage.getGoalProgress(goal.id);\n          return {\n            ...goal,\n            currentProgress: progress.currentProgress,\n            averageScore: progress.averageScore,\n            trend: progress.trend,\n            lastScore: progress.lastScore,\n            dataPointsCount: progress.dataPoints.length,\n          };\n        })\n      );\n      \n      res.json(goalsWithProgress);\n    } catch (error) {\n      console.error(\"Error fetching goals:\", error);\n      res.status(500).json({ message: \"Failed to fetch goals\" });\n    }\n  });\n\n  app.post('/api/students/:studentId/goals', async (req: any, res) => {\n    try {\n      const studentId = parseInt(req.params.studentId);\n      const userId = '4201332';\n      console.log(\"Creating goal for student:\", studentId, \"user:\", userId);\n      console.log(\"Goal request body:\", req.body);\n      \n      const student = await storage.getStudentById(studentId);\n      \n      if (!student) {\n        console.log(\"Student not found:\", studentId);\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      // Verify ownership\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        console.log(\"Access denied - student belongs to:\", student.userId, \"but user is:\", userId);\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      // Check if student already has 15 goals (maximum limit)\n      const existingGoals = await storage.getGoalsByStudentId(studentId);\n      if (existingGoals.length >= 15) {\n        console.log(\"Student already has maximum goals:\", existingGoals.length);\n        return res.status(400).json({ message: \"Student already has maximum of 15 goals\" });\n      }\n\n      const { objectives: objectivesData, ...goalRequestData } = req.body;\n      \n      // Convert levelOfSupport array to JSON string for storage (same as data points)\n      if (goalRequestData.levelOfSupport && Array.isArray(goalRequestData.levelOfSupport)) {\n        goalRequestData.levelOfSupport = goalRequestData.levelOfSupport.length > 0 \n          ? JSON.stringify(goalRequestData.levelOfSupport) \n          : null;\n      }\n      \n      const goalData = insertGoalSchema.parse({\n        ...goalRequestData,\n        studentId,\n      });\n      \n      console.log(\"Parsed goal data:\", goalData);\n      const goal = await storage.createGoal(goalData);\n      console.log(\"Goal created successfully:\", goal.id);\n      \n      // Create objectives if provided\n      if (objectivesData && Array.isArray(objectivesData) && objectivesData.length > 0) {\n        console.log(\"Creating objectives for goal:\", goal.id);\n        const objectives = [];\n        \n        for (const objectiveData of objectivesData) {\n          const parsedObjective = insertObjectiveSchema.parse({\n            ...objectiveData,\n            goalId: goal.id,\n            studentId: studentId,\n          });\n          \n          const objective = await storage.createObjective(parsedObjective);\n          objectives.push(objective);\n        }\n        \n        console.log(\"Created objectives:\", objectives.length);\n        res.status(201).json({ ...goal, objectives });\n      } else {\n        res.status(201).json(goal);\n      }\n    } catch (error) {\n      console.error(\"Error creating goal:\", error);\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid goal data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to create goal\" });\n      }\n    }\n  });\n\n  app.get('/api/goals/:id', async (req: any, res) => {\n    try {\n      const goalId = parseInt(req.params.id);\n      const progress = await storage.getGoalProgress(goalId);\n      \n      // Verify ownership through student\n      const student = await storage.getStudentById(progress.goal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      res.json(progress);\n    } catch (error) {\n      console.error(\"Error fetching goal progress:\", error);\n      res.status(500).json({ message: \"Failed to fetch goal progress\" });\n    }\n  });\n\n  app.patch('/api/goals/:id', async (req: any, res) => {\n    try {\n      const goalId = parseInt(req.params.id);\n      const existingGoal = await storage.getGoalById(goalId);\n      \n      if (!existingGoal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n\n      // Verify ownership through student\n      const student = await storage.getStudentById(existingGoal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const updateData = insertGoalSchema.partial().parse(req.body);\n      const goal = await storage.updateGoal(goalId, updateData);\n      res.json(goal);\n    } catch (error) {\n      console.error(\"Error updating goal:\", error);\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid goal data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to update goal\" });\n      }\n    }\n  });\n\n  app.delete('/api/goals/:id', async (req: any, res) => {\n    try {\n      const goalId = parseInt(req.params.id);\n      const existingGoal = await storage.getGoalById(goalId);\n      \n      if (!existingGoal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n\n      // Verify ownership through student\n      const student = await storage.getStudentById(existingGoal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      await storage.deleteGoal(goalId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting goal:\", error);\n      res.status(500).json({ message: \"Failed to delete goal\" });\n    }\n  });\n\n  // Objectives routes\n  app.get('/api/goals/:goalId/objectives', async (req: any, res) => {\n    try {\n      const goalId = parseInt(req.params.goalId);\n      const goal = await storage.getGoalById(goalId);\n      \n      if (!goal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n\n      // Verify ownership through student\n      const student = await storage.getStudentById(goal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const objectives = await storage.getObjectivesByGoalId(goalId);\n      res.json(objectives);\n    } catch (error) {\n      console.error(\"Error fetching objectives:\", error);\n      res.status(500).json({ message: \"Failed to fetch objectives\" });\n    }\n  });\n\n  app.post('/api/goals/:goalId/objectives', async (req: any, res) => {\n    try {\n      const goalId = parseInt(req.params.goalId);\n      const goal = await storage.getGoalById(goalId);\n      \n      if (!goal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n\n      // Verify ownership through student\n      const student = await storage.getStudentById(goal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      // Check if goal already has 10 objectives (maximum limit)\n      const existingObjectives = await storage.getObjectivesByGoalId(goalId);\n      if (existingObjectives.length >= 10) {\n        console.log(\"Goal already has maximum objectives:\", existingObjectives.length);\n        return res.status(400).json({ message: \"Goal already has maximum of 10 objectives\" });\n      }\n\n      // Get student ID from the goal\n      const studentId = goal.studentId;\n\n      // Generate a title from description if not provided\n      const title = req.body.title || (req.body.description ? \n        req.body.description.substring(0, 50) + (req.body.description.length > 50 ? \"...\" : \"\") : \n        \"Untitled Objective\");\n      \n      const objectiveData = insertObjectiveSchema.parse({\n        ...req.body,\n        title,\n        goalId,\n        studentId,\n      });\n      \n      const objective = await storage.createObjective(objectiveData);\n      res.status(201).json(objective);\n    } catch (error) {\n      console.error(\"Error creating objective:\", error);\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid objective data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to create objective\" });\n      }\n    }\n  });\n\n  app.put('/api/objectives/:id', async (req: any, res) => {\n    try {\n      const objectiveId = parseInt(req.params.id);\n      const existingObjective = await storage.getObjectiveById(objectiveId);\n      \n      if (!existingObjective) {\n        return res.status(404).json({ message: \"Objective not found\" });\n      }\n\n      // Verify ownership through goal and student\n      const goal = await storage.getGoalById(existingObjective.goalId);\n      if (!goal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n\n      const student = await storage.getStudentById(goal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const updateData = insertObjectiveSchema.partial().parse(req.body);\n      const objective = await storage.updateObjective(objectiveId, updateData);\n      res.json(objective);\n    } catch (error) {\n      console.error(\"Error updating objective:\", error);\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid objective data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to update objective\" });\n      }\n    }\n  });\n\n  app.delete('/api/objectives/:id', async (req: any, res) => {\n    try {\n      const objectiveId = parseInt(req.params.id);\n      const existingObjective = await storage.getObjectiveById(objectiveId);\n      \n      if (!existingObjective) {\n        return res.status(404).json({ message: \"Objective not found\" });\n      }\n\n      // Verify ownership through goal and student\n      const goal = await storage.getGoalById(existingObjective.goalId);\n      if (!goal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n\n      const student = await storage.getStudentById(goal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      await storage.deleteObjective(objectiveId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting objective:\", error);\n      res.status(500).json({ message: \"Failed to delete objective\" });\n    }\n  });\n\n  // Get all objectives for a student\n  app.get('/api/students/:studentId/objectives', async (req: any, res) => {\n    try {\n      const studentId = parseInt(req.params.studentId);\n      const student = await storage.getStudentById(studentId);\n      \n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const objectives = await storage.getObjectivesByStudentId(studentId);\n      \n      // Enrich objectives with goal information\n      const objectivesWithGoals = await Promise.all(\n        objectives.map(async (objective) => {\n          const goal = await storage.getGoalById(objective.goalId);\n          return {\n            ...objective,\n            goalTitle: goal?.title || 'Unknown Goal',\n            goalDescription: goal?.description || '',\n          };\n        })\n      );\n\n      res.json(objectivesWithGoals);\n    } catch (error) {\n      console.error(\"Error fetching student objectives:\", error);\n      res.status(500).json({ message: \"Failed to fetch objectives\" });\n    }\n  });\n\n  // Get data points for a specific student (direct student-data point association)\n  app.get('/api/students/:studentId/data-points', async (req: any, res) => {\n    try {\n      const studentId = parseInt(req.params.studentId);\n      const student = await storage.getStudentById(studentId);\n      \n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      // Verify ownership with fallback for user 4201332 and 42813322\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const dataPoints = await storage.getDataPointsByStudentId(studentId);\n      res.json(dataPoints);\n    } catch (error) {\n      console.error(\"Error fetching student data points:\", error);\n      res.status(500).json({ message: \"Failed to fetch data points\" });\n    }\n  });\n\n  // Get objective progress with statistics\n  app.get('/api/objectives/:objectiveId/progress', async (req: any, res) => {\n    try {\n      const objectiveId = parseInt(req.params.objectiveId);\n      const objective = await storage.getObjectiveById(objectiveId);\n      \n      if (!objective) {\n        return res.status(404).json({ message: \"Objective not found\" });\n      }\n\n      // Verify ownership through student\n      const student = await storage.getStudentById(objective.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const progressData = await storage.getObjectiveProgress(objectiveId);\n      res.json(progressData);\n    } catch (error) {\n      console.error(\"Error fetching objective progress:\", error);\n      res.status(500).json({ message: \"Failed to fetch objective progress\" });\n    }\n  });\n\n  // Student data points route (all data points for a student across all goals)\n  app.get('/api/students/:studentId/all-data-points', async (req: any, res) => {\n    try {\n      const studentId = parseInt(req.params.studentId);\n      const student = await storage.getStudentById(studentId);\n      \n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      // Verify ownership with fallback for user 4201332 and 42813322\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      // Get all goals for this student\n      const goals = await storage.getGoalsByStudentId(studentId);\n      \n      // Get all data points for this student directly\n      const allDataPoints = await storage.getDataPointsByStudentId(studentId);\n      \n      // Add goal titles and objective info to data points\n      const dataPointsWithGoalInfo = await Promise.all(\n        allDataPoints.map(async (dp) => {\n          const goal = await storage.getGoalById(dp.goalId);\n          let objectiveInfo = null;\n          \n          // If this data point has an objective, get objective details\n          if (dp.objectiveId) {\n            const objective = await storage.getObjectiveById(dp.objectiveId);\n            objectiveInfo = {\n              objectiveId: dp.objectiveId,\n              objectiveDescription: objective?.description || 'Unknown Objective',\n              isObjectiveSpecific: true\n            };\n          }\n          \n          return {\n            ...dp,\n            goalTitle: goal?.title || 'Unknown Goal',\n            goalDataCollectionType: goal?.dataCollectionType || 'percentage',\n            ...objectiveInfo,\n            isObjectiveSpecific: !!dp.objectiveId,\n            dataType: dp.objectiveId ? 'Objective' : 'General Goal',\n          };\n        })\n      );\n\n      // Sort by date\n      dataPointsWithGoalInfo.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n      \n      res.json(dataPointsWithGoalInfo);\n    } catch (error) {\n      console.error(\"Error fetching student data points:\", error);\n      res.status(500).json({ message: \"Failed to fetch data points\" });\n    }\n  });\n\n  // Data point routes\n  app.get('/api/goals/:goalId/data-points', async (req: any, res) => {\n    try {\n      const goalId = parseInt(req.params.goalId);\n      const goal = await storage.getGoalById(goalId);\n      \n      if (!goal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n\n      // Verify ownership through student\n      const student = await storage.getStudentById(goal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      // Use optimized method that fetches all data in 2 queries instead of N+1\n      const allDataPoints = await storage.getAllDataPointsForGoalWithObjectives(goalId);\n      \n      // Sort by date (ascending for chronological display)\n      allDataPoints.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n      \n      res.json(allDataPoints);\n    } catch (error) {\n      console.error(\"Error fetching data points:\", error);\n      res.status(500).json({ message: \"Failed to fetch data points\" });\n    }\n  });\n\n  app.post('/api/goals/:goalId/data-points', async (req: any, res) => {\n    try {\n      const goalIdResult = safeParseInt(req.params.goalId, 'goalId');\n      if (typeof goalIdResult === 'object' && 'error' in goalIdResult) {\n        return res.status(400).json({ message: goalIdResult.error });\n      }\n      const goalId = goalIdResult;\n      const goal = await storage.getGoalById(goalId);\n      \n      if (!goal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n\n      // Verify ownership through student\n      const student = await storage.getStudentById(goal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      // Convert level of support array to JSON string for storage\n      const requestBody = { ...req.body };\n      if (requestBody.levelOfSupport && Array.isArray(requestBody.levelOfSupport)) {\n        requestBody.levelOfSupport = requestBody.levelOfSupport.length > 0 \n          ? JSON.stringify(requestBody.levelOfSupport) \n          : null;\n      }\n      \n      // Convert setting array to JSON string for storage (same as levelOfSupport)\n      if (requestBody.setting && Array.isArray(requestBody.setting)) {\n        requestBody.setting = requestBody.setting.length > 0 \n          ? JSON.stringify(requestBody.setting) \n          : null;\n      }\n      \n      // Convert progressValue to number if it's a string\n      if (requestBody.progressValue && typeof requestBody.progressValue === 'string') {\n        requestBody.progressValue = parseFloat(requestBody.progressValue);\n      }\n      \n      // The schema now handles date and number conversions automatically\n      const dataPointData = insertDataPointSchema.parse({\n        ...requestBody,\n        goalId,\n        studentId: goal.studentId, // Automatically assign student ID\n      });\n      \n      const dataPoint = await storage.createDataPoint(dataPointData);\n      \n      res.status(201).json(dataPoint);\n    } catch (error: any) {\n      console.error(\"Error creating data point:\", error);\n      console.error(\"Error stack:\", (error as Error)?.stack);\n      if (error instanceof z.ZodError) {\n        console.error(\"Zod validation errors:\", error.errors);\n        res.status(400).json({ message: \"Invalid data point data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to create data point\" });\n      }\n    }\n  });\n\n  // Update a data point\n  app.patch('/api/data-points/:id', async (req: any, res) => {\n    try {\n      const dataPointIdResult = safeParseInt(req.params.id, 'dataPointId');\n      if (typeof dataPointIdResult === 'object' && 'error' in dataPointIdResult) {\n        return res.status(400).json({ message: dataPointIdResult.error });\n      }\n      const dataPointId = dataPointIdResult;\n      const existingDataPoint = await storage.getDataPointById(dataPointId);\n      \n      if (!existingDataPoint) {\n        return res.status(404).json({ message: \"Data point not found\" });\n      }\n\n      // Verify ownership through student\n      const student = await storage.getStudentById(existingDataPoint.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      // Convert level of support to JSON string for storage if it's an array\n      const requestBody = { ...req.body };\n      if (requestBody.levelOfSupport) {\n        if (typeof requestBody.levelOfSupport === 'string') {\n          // If it's already a string, assume it's JSON or a single value\n          try {\n            JSON.parse(requestBody.levelOfSupport);\n            // It's valid JSON, keep as is\n          } catch {\n            // It's a single value, wrap in array and stringify\n            requestBody.levelOfSupport = JSON.stringify([requestBody.levelOfSupport]);\n          }\n        } else if (Array.isArray(requestBody.levelOfSupport)) {\n          requestBody.levelOfSupport = requestBody.levelOfSupport.length > 0 \n            ? JSON.stringify(requestBody.levelOfSupport) \n            : null;\n        }\n      }\n      \n      // Convert setting to JSON string for storage if it's an array\n      if (requestBody.setting) {\n        if (typeof requestBody.setting === 'string') {\n          // If it's already a string, assume it's JSON or a single value\n          try {\n            JSON.parse(requestBody.setting);\n            // It's valid JSON, keep as is\n          } catch {\n            // It's a single value, wrap in array and stringify\n            requestBody.setting = JSON.stringify([requestBody.setting]);\n          }\n        } else if (Array.isArray(requestBody.setting)) {\n          requestBody.setting = requestBody.setting.length > 0 \n            ? JSON.stringify(requestBody.setting) \n            : null;\n        }\n      }\n      \n      // Convert progressValue to number if it's a string\n      if (requestBody.progressValue && typeof requestBody.progressValue === 'string') {\n        requestBody.progressValue = parseFloat(requestBody.progressValue);\n      }\n\n      // Convert date string to proper format\n      if (requestBody.date && typeof requestBody.date === 'string') {\n        requestBody.date = new Date(requestBody.date + 'T12:00:00.000Z');\n      }\n      \n      // Parse and validate the update data\n      const updateData = insertDataPointSchema.partial().parse(requestBody);\n      \n      const dataPoint = await storage.updateDataPoint(dataPointId, updateData);\n      \n      res.json(dataPoint);\n    } catch (error: any) {\n      console.error(\"Error updating data point:\", error);\n      console.error(\"Error stack:\", (error as Error)?.stack);\n      if (error instanceof z.ZodError) {\n        console.error(\"Zod validation errors:\", error.errors);\n        res.status(400).json({ message: \"Invalid data point data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to update data point\" });\n      }\n    }\n  });\n\n  app.delete('/api/data-points/:id', async (req: any, res) => {\n    try {\n      const dataPointId = parseInt(req.params.id);\n      const existingDataPoint = await storage.getDataPointById(dataPointId);\n      \n      if (!existingDataPoint) {\n        return res.status(404).json({ message: \"Data point not found\" });\n      }\n\n      // Verify ownership through goal and student\n      const goal = await storage.getGoalById(existingDataPoint.goalId);\n      if (!goal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n\n      const student = await storage.getStudentById(goal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      await storage.deleteDataPoint(dataPointId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting data point:\", error);\n      res.status(500).json({ message: \"Failed to delete data point\" });\n    }\n  });\n\n  // Get all data points for a student (for raw data table)\n  app.get('/api/students/:studentId/data-points/all', async (req: any, res) => {\n    try {\n      const studentId = parseInt(req.params.studentId);\n      const student = await storage.getStudentById(studentId);\n      \n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      // Verify ownership\n      const userId = '4201332';\n      if (student.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      // Get all goals for this student\n      const goals = await storage.getGoalsByStudentId(studentId);\n      \n      // Get all data points for all goals\n      const allDataPoints = [];\n      for (const goal of goals) {\n        const dataPoints = await storage.getDataPointsByGoalId(goal.id);\n        \n        // Add goal title to each data point\n        const dataPointsWithGoal = dataPoints.map(dp => ({\n          ...dp,\n          goalTitle: goal.title,\n          goalId: goal.id\n        }));\n        \n        allDataPoints.push(...dataPointsWithGoal);\n      }\n      \n      // Sort by date (newest first)\n      allDataPoints.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n      \n      res.json(allDataPoints);\n    } catch (error) {\n      console.error(\"Error fetching all data points:\", error);\n      res.status(500).json({ message: \"Failed to fetch all data points\" });\n    }\n  });\n\n  // Paginated data points endpoints\n  app.get('/api/goals/:goalId/data-points/paginated', async (req: any, res) => {\n    try {\n      const goalIdResult = safeParseInt(req.params.goalId, 'goalId');\n      if (typeof goalIdResult === 'object' && 'error' in goalIdResult) {\n        return res.status(400).json({ message: goalIdResult.error });\n      }\n      const goalId = goalIdResult;\n      \n      const goal = await storage.getGoalById(goalId);\n      if (!goal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n      \n      const student = await storage.getStudentById(goal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n      \n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      const page = parseInt(req.query.page) || 1;\n      const limit = parseInt(req.query.limit) || 50;\n      \n      const result = await storage.getDataPointsByGoalIdPaginated(goalId, { page, limit });\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error fetching paginated data points:\", error);\n      res.status(500).json({ message: \"Failed to fetch paginated data points\" });\n    }\n  });\n\n  app.get('/api/students/:studentId/data-points/paginated', async (req: any, res) => {\n    try {\n      const studentIdResult = safeParseInt(req.params.studentId, 'studentId');\n      if (typeof studentIdResult === 'object' && 'error' in studentIdResult) {\n        return res.status(400).json({ message: studentIdResult.error });\n      }\n      const studentId = studentIdResult;\n      \n      const student = await storage.getStudentById(studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n      \n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      const page = parseInt(req.query.page) || 1;\n      const limit = parseInt(req.query.limit) || 50;\n      \n      const result = await storage.getDataPointsByStudentIdPaginated(studentId, { page, limit });\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error fetching paginated data points:\", error);\n      res.status(500).json({ message: \"Failed to fetch paginated data points\" });\n    }\n  });\n\n  // Batch data point operations\n  app.post('/api/goals/:goalId/data-points/batch', async (req: any, res) => {\n    try {\n      const goalIdResult = safeParseInt(req.params.goalId, 'goalId');\n      if (typeof goalIdResult === 'object' && 'error' in goalIdResult) {\n        return res.status(400).json({ message: goalIdResult.error });\n      }\n      const goalId = goalIdResult;\n      \n      const goal = await storage.getGoalById(goalId);\n      if (!goal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n      \n      const student = await storage.getStudentById(goal.studentId);\n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n      \n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      const { dataPoints: dataPointsToCreate } = req.body;\n      if (!Array.isArray(dataPointsToCreate)) {\n        return res.status(400).json({ message: \"dataPoints must be an array\" });\n      }\n      \n      if (dataPointsToCreate.length === 0) {\n        return res.status(400).json({ message: \"dataPoints array cannot be empty\" });\n      }\n      \n      if (dataPointsToCreate.length > 100) {\n        return res.status(400).json({ message: \"Cannot create more than 100 data points at once\" });\n      }\n      \n      const parsedDataPoints = dataPointsToCreate.map(dp => {\n        const requestBody = { ...dp };\n        if (requestBody.levelOfSupport && Array.isArray(requestBody.levelOfSupport)) {\n          requestBody.levelOfSupport = requestBody.levelOfSupport.length > 0 \n            ? JSON.stringify(requestBody.levelOfSupport) \n            : null;\n        }\n        if (requestBody.setting && Array.isArray(requestBody.setting)) {\n          requestBody.setting = requestBody.setting.length > 0 \n            ? JSON.stringify(requestBody.setting) \n            : null;\n        }\n        if (requestBody.progressValue && typeof requestBody.progressValue === 'string') {\n          requestBody.progressValue = parseFloat(requestBody.progressValue);\n        }\n        \n        return insertDataPointSchema.parse({\n          ...requestBody,\n          goalId,\n          studentId: goal.studentId,\n        });\n      });\n      \n      const createdDataPoints = await storage.createDataPointsBatch(parsedDataPoints);\n      res.status(201).json({ \n        success: true, \n        created: createdDataPoints.length,\n        dataPoints: createdDataPoints \n      });\n    } catch (error: any) {\n      console.error(\"Error batch creating data points:\", error);\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data point data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to batch create data points\" });\n      }\n    }\n  });\n\n  app.delete('/api/data-points/batch', async (req: any, res) => {\n    try {\n      const { ids } = req.body;\n      if (!Array.isArray(ids)) {\n        return res.status(400).json({ message: \"ids must be an array\" });\n      }\n      \n      if (ids.length === 0) {\n        return res.status(400).json({ message: \"ids array cannot be empty\" });\n      }\n      \n      if (ids.length > 100) {\n        return res.status(400).json({ message: \"Cannot delete more than 100 data points at once\" });\n      }\n      \n      const parsedIds = ids.map(id => {\n        const parsed = parseInt(id);\n        if (isNaN(parsed)) {\n          throw new Error(`Invalid id: ${id}`);\n        }\n        return parsed;\n      });\n      \n      const userId = '4201332';\n      for (const id of parsedIds) {\n        const dataPoint = await storage.getDataPointById(id);\n        if (!dataPoint) {\n          return res.status(404).json({ message: `Data point ${id} not found` });\n        }\n        const student = await storage.getStudentById(dataPoint.studentId);\n        if (!student || (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322')) {\n          return res.status(403).json({ message: `Access denied for data point ${id}` });\n        }\n      }\n      \n      const result = await storage.deleteDataPointsBatch(parsedIds);\n      res.json({ success: true, ...result });\n    } catch (error) {\n      console.error(\"Error batch deleting data points:\", error);\n      res.status(500).json({ message: \"Failed to batch delete data points\" });\n    }\n  });\n\n  // Admin routes (for database administrator)\n  app.get('/api/admin/stats', async (req, res) => {\n    try {\n      const users = await storage.getAllUsers();\n      const students = await storage.getAllStudents();\n      const goals = await storage.getAllGoals();\n      const dataPoints = await storage.getAllDataPoints();\n\n      const stats = {\n        totalUsers: users.length,\n        totalStudents: students.length,\n        totalGoals: goals.length,\n        totalDataPoints: dataPoints.length,\n        recentActivity: [] // Can be expanded later\n      };\n\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching admin stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch admin stats\" });\n    }\n  });\n\n  app.get('/api/admin/users', async (req, res) => {\n    try {\n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching all users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  app.get('/api/admin/students', async (req, res) => {\n    try {\n      const students = await storage.getAllStudentsWithDetails();\n      res.json(students);\n    } catch (error) {\n      console.error(\"Error fetching all students:\", error);\n      res.status(500).json({ message: \"Failed to fetch students\" });\n    }\n  });\n\n  app.get('/api/admin/goals', async (req, res) => {\n    try {\n      const goals = await storage.getAllGoalsWithDetails();\n      res.json(goals);\n    } catch (error) {\n      console.error(\"Error fetching all goals:\", error);\n      res.status(500).json({ message: \"Failed to fetch goals\" });\n    }\n  });\n\n  app.delete('/api/admin/users/:userId', async (req, res) => {\n    try {\n      const userId = req.params.userId;\n      await storage.deleteUser(userId);\n      res.json({ message: \"User deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      res.status(500).json({ message: \"Failed to delete user\" });\n    }\n  });\n\n  app.get('/api/admin/schema', async (req, res) => {\n    try {\n      const schema = await storage.getDatabaseSchema();\n      res.json(schema);\n    } catch (error) {\n      console.error(\"Error fetching database schema:\", error);\n      res.status(500).json({ message: \"Failed to fetch database schema\" });\n    }\n  });\n\n  app.get('/api/admin/table/:tableName', async (req, res) => {\n    try {\n      const tableName = req.params.tableName;\n      const rawPage = parseInt(req.query.page as string);\n      const rawLimit = parseInt(req.query.limit as string);\n      \n      const page = isNaN(rawPage) || rawPage < 1 ? 1 : rawPage;\n      const limit = isNaN(rawLimit) || rawLimit < 1 ? 100 : Math.min(rawLimit, 500);\n      const offset = (page - 1) * limit;\n      \n      let allData: any[] = [];\n      \n      switch (tableName) {\n        case 'users':\n          allData = await storage.getAllUsers();\n          break;\n        case 'students':\n          allData = await storage.getAllStudents();\n          break;\n        case 'goals':\n          allData = await storage.getAllGoals();\n          break;\n        case 'data_points':\n        case 'dataPoints':\n          allData = await storage.getAllDataPoints();\n          break;\n        case 'sessions':\n          allData = await storage.getAllSessions();\n          break;\n        case 'reporting_periods':\n        case 'reportingPeriods':\n          allData = await storage.getAllReportingPeriods();\n          break;\n        case 'objectives':\n          allData = await storage.getAllObjectives();\n          break;\n        default:\n          return res.status(404).json({ message: \"Table not found\" });\n      }\n      \n      const total = allData.length;\n      const totalPages = Math.ceil(total / limit);\n      const paginatedData = allData.slice(offset, offset + limit);\n      \n      res.json({\n        data: paginatedData,\n        total,\n        page,\n        limit,\n        totalPages\n      });\n    } catch (error) {\n      console.error(`Error fetching table ${req.params.tableName}:`, error);\n      res.status(500).json({ message: \"Failed to fetch table data\" });\n    }\n  });\n\n  // Admin data verification endpoints\n  app.get('/api/admin/verify/user/:userId', async (req, res) => {\n    try {\n      const userId = req.params.userId;\n      const verification = await storage.verifyUserData(userId);\n      res.json(verification);\n    } catch (error) {\n      console.error(\"Error verifying user data:\", error);\n      res.status(500).json({ message: \"Failed to verify user data\" });\n    }\n  });\n\n  app.get('/api/admin/verify/student/:studentId', async (req, res) => {\n    try {\n      const studentId = parseInt(req.params.studentId);\n      const verification = await storage.verifyStudentData(studentId);\n      res.json(verification);\n    } catch (error) {\n      console.error(\"Error verifying student data:\", error);\n      res.status(500).json({ message: \"Failed to verify student data\" });\n    }\n  });\n\n  app.get('/api/admin/verify/goal/:goalId', async (req, res) => {\n    try {\n      const goalId = parseInt(req.params.goalId);\n      const verification = await storage.verifyGoalData(goalId);\n      res.json(verification);\n    } catch (error) {\n      console.error(\"Error verifying goal data:\", error);\n      res.status(500).json({ message: \"Failed to verify goal data\" });\n    }\n  });\n\n  app.get('/api/admin/sample-data/:userId', async (req, res) => {\n    try {\n      const userId = req.params.userId;\n      const sampleData = await storage.getSampleUserData(userId);\n      res.json(sampleData);\n    } catch (error) {\n      console.error(\"Error fetching sample data:\", error);\n      res.status(500).json({ message: \"Failed to fetch sample data\" });\n    }\n  });\n\n  // Clear data routes\n  app.delete('/api/students/:studentId/clear-data', async (req: any, res) => {\n    try {\n      const studentId = parseInt(req.params.studentId);\n      const student = await storage.getStudentById(studentId);\n      \n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      // Verify ownership\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      await storage.clearStudentData(studentId);\n      res.json({ message: \"Student data cleared successfully\" });\n    } catch (error) {\n      console.error(\"Error clearing student data:\", error);\n      res.status(500).json({ message: \"Failed to clear student data\" });\n    }\n  });\n\n  app.delete('/api/users/clear-all-data', async (req: any, res) => {\n    try {\n      const userId = '4201332';\n      await storage.clearAllUserData(userId);\n      res.json({ message: \"All user data cleared successfully\" });\n    } catch (error) {\n      console.error(\"Error clearing all user data:\", error);\n      res.status(500).json({ message: \"Failed to clear all data\" });\n    }\n  });\n\n  app.delete('/api/students/:studentId/remove-from-caseload', async (req: any, res) => {\n    try {\n      const studentId = parseInt(req.params.studentId);\n      const student = await storage.getStudentById(studentId);\n      \n      if (!student) {\n        return res.status(404).json({ message: \"Student not found\" });\n      }\n\n      // Verify ownership\n      const userId = '4201332';\n      if (student.userId !== userId && student.userId !== '4201332' && student.userId !== '42813322') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      await storage.removeStudentFromCaseload(studentId);\n      res.json({ message: \"Student removed from caseload successfully\" });\n    } catch (error) {\n      console.error(\"Error removing student from caseload:\", error);\n      res.status(500).json({ message: \"Failed to remove student from caseload\" });\n    }\n  });\n\n  // Reporting periods routes\n  app.get('/api/reporting-periods', async (req: any, res) => {\n    try {\n      const userId = '4201332'; // Development mode - use fixed user ID\n      console.log(\"Fetching reporting periods for user ID:\", userId);\n      \n      const periods = await storage.getReportingPeriodsByUserId(userId);\n      console.log(\"Found reporting periods:\", periods.length);\n      \n      if (periods.length === 0) {\n        res.json({ periods: [], periodLength: null });\n        return;\n      }\n      \n      // Group periods by periodLength and return structured data\n      const periodLength = periods[0]?.periodLength || null;\n      res.json({\n        periods: periods.map(p => ({\n          periodNumber: p.periodNumber,\n          startDate: p.startDate,\n          endDate: p.endDate\n        })),\n        periodLength\n      });\n    } catch (error) {\n      console.error(\"Error fetching reporting periods:\", error);\n      res.status(500).json({ message: \"Failed to fetch reporting periods\" });\n    }\n  });\n\n  app.post('/api/reporting-periods', async (req: any, res) => {\n    try {\n      const userId = '4201332'; // Development mode - use fixed user ID\n      const { periods, periodLength } = req.body;\n      \n      // Validate using the new schema\n      const validatedData = reportingPeriodsSubmitSchema.safeParse({ periods, periodLength });\n      \n      if (!validatedData.success) {\n        return res.status(400).json({ \n          message: \"Invalid periods data\", \n          errors: validatedData.error.errors \n        });\n      }\n      \n      await storage.saveReportingPeriods(userId, validatedData.data.periods, validatedData.data.periodLength);\n      \n      res.json({ message: \"Reporting periods saved successfully\" });\n    } catch (error) {\n      console.error(\"Error saving reporting periods:\", error);\n      res.status(500).json({ message: \"Failed to save reporting periods\" });\n    }\n  });\n\n  app.delete('/api/reporting-periods', async (req: any, res) => {\n    try {\n      const userId = '4201332'; // Development mode - use fixed user ID\n      console.log(\"Deleting reporting periods for user ID:\", userId);\n      \n      await storage.deleteReportingPeriodsByUserId(userId);\n      console.log(\"Successfully deleted reporting periods from database\");\n      \n      res.json({ message: \"Reporting periods deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting reporting periods:\", error);\n      res.status(500).json({ message: \"Failed to delete reporting periods\" });\n    }\n  });\n\n  // Migration endpoints for user ownership management\n  app.post('/api/admin/migrate-all-students/:targetUserId', async (req, res) => {\n    try {\n      const targetUserId = req.params.targetUserId;\n      console.log(`Starting migration of all students to user ${targetUserId}`);\n      \n      // Get all students from all users\n      const allUsers = ['4201332', '42813322']; // Known test users\n      let totalMigrated = 0;\n      \n      for (const sourceUserId of allUsers) {\n        if (sourceUserId !== targetUserId) {\n          console.log(`Migrating students from ${sourceUserId} to ${targetUserId}`);\n          const migrated = await UserMigrationService.migrateStudentsToUser(sourceUserId, targetUserId);\n          totalMigrated += migrated.length;\n        }\n      }\n      \n      // Verify final ownership\n      const validation = await UserMigrationService.validateUserOwnership(targetUserId);\n      \n      res.json({\n        success: true,\n        totalMigrated,\n        finalStudentCount: validation.studentCount,\n        message: `Successfully migrated ${totalMigrated} students to user ${targetUserId}`\n      });\n    } catch (error) {\n      console.error(\"Migration failed:\", error);\n      res.status(500).json({ \n        success: false,\n        message: \"Migration failed\",\n        error: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  app.get('/api/admin/validate-ownership/:userId', async (req, res) => {\n    try {\n      const userId = req.params.userId;\n      const validation = await UserMigrationService.validateUserOwnership(userId);\n      res.json(validation);\n    } catch (error) {\n      console.error(\"Validation failed:\", error);\n      res.status(500).json({ message: \"Validation failed\", error: error instanceof Error ? error.message : \"Unknown error\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","path":null,"size_bytes":59750,"size_tokens":null},"client/src/components/reporting-periods-display.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar, Clock, Edit } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ReportingPeriod {\n  periodNumber: number;\n  startDate: string;\n  endDate: string;\n}\n\ninterface ReportingPeriodsData {\n  periodLength: string;\n  periods: ReportingPeriod[];\n  savedAt: string;\n}\n\nexport default function ReportingPeriodsDisplay() {\n  const [reportingData, setReportingData] = useState<ReportingPeriodsData | null>(null);\n  const [editingPeriod, setEditingPeriod] = useState<ReportingPeriod | null>(null);\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\n  const [editStartDate, setEditStartDate] = useState(\"\");\n  const [editEndDate, setEditEndDate] = useState(\"\");\n  const { toast } = useToast();\n\n  // Load reporting periods from database\n  useEffect(() => {\n    const fetchReportingPeriods = async () => {\n      try {\n        const response = await fetch('/api/reporting-periods');\n        if (response.ok) {\n          const data = await response.json();\n          if (data.periods && data.periods.length > 0) {\n            setReportingData({\n              periodLength: data.periodLength,\n              periods: data.periods,\n              savedAt: new Date().toISOString()\n            });\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching reporting periods:', error);\n      }\n    };\n\n    fetchReportingPeriods();\n  }, []);\n\n  const handleEditPeriod = (period: ReportingPeriod) => {\n    setEditingPeriod(period);\n    setEditStartDate(period.startDate);\n    setEditEndDate(period.endDate);\n    setIsEditModalOpen(true);\n  };\n\n  const handleSaveEdit = async () => {\n    if (!editingPeriod || !reportingData) return;\n\n    if (!editStartDate || !editEndDate) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in both start and end dates.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (new Date(editStartDate + 'T12:00:00') >= new Date(editEndDate + 'T12:00:00')) {\n      toast({\n        title: \"Error\",\n        description: \"Start date must be before end date.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const updatedPeriods = reportingData.periods.map(period =>\n      period.periodNumber === editingPeriod.periodNumber\n        ? { ...period, startDate: editStartDate, endDate: editEndDate }\n        : period\n    );\n\n    // Save to database\n    try {\n      const response = await fetch('/api/reporting-periods', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          periods: updatedPeriods,\n          periodLength: reportingData.periodLength\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to save to database');\n      }\n\n      const updatedData = {\n        ...reportingData,\n        periods: updatedPeriods,\n        savedAt: new Date().toISOString()\n      };\n      setReportingData(updatedData);\n    } catch (error) {\n      console.error('Error saving updated period:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to save changes. Please try again.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setIsEditModalOpen(false);\n    setEditingPeriod(null);\n\n    toast({\n      title: \"Success\",\n      description: `Period ${editingPeriod.periodNumber} has been updated successfully.`,\n    });\n\n    // Trigger a page refresh to update the calendar\n    window.location.reload();\n  };\n\n  const handleCancelEdit = () => {\n    setIsEditModalOpen(false);\n    setEditingPeriod(null);\n    setEditStartDate(\"\");\n    setEditEndDate(\"\");\n  };\n\n  if (!reportingData) {\n    return (\n      <Card>\n        <CardContent className=\"p-6 text-center\">\n          <Calendar className=\"h-8 w-8 text-gray-400 mx-auto mb-2\" />\n          <p className=\"text-gray-600\">No reporting periods configured</p>\n          <p className=\"text-sm text-gray-500\">Use the Configure Reporting Periods button to set up your school's schedule</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const getCurrentPeriod = () => {\n    const today = new Date();\n    return reportingData.periods.find(period => {\n      const start = new Date(period.startDate);\n      const end = new Date(period.endDate);\n      return today >= start && today <= end;\n    });\n  };\n\n  const currentPeriod = getCurrentPeriod();\n  const periodLengthLabel = reportingData.periodLength === \"4.5weeks\" || reportingData.periodLength === \"4.5-weeks\" ? \"4.5 weeks\" : \"3 weeks\";\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center justify-between\">\n          <div className=\"flex items-center\">\n            <Clock className=\"h-5 w-5 mr-2\" />\n            Reporting Periods\n          </div>\n          <Badge variant=\"outline\">\n            {periodLengthLabel} ({reportingData.periods.length} periods)\n          </Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {currentPeriod && (\n          <div className=\"p-3 bg-green-50 rounded-lg border border-green-200\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"font-medium text-green-900\">Current Period {currentPeriod.periodNumber}</span>\n              <Badge className=\"bg-green-600 text-white\">Active</Badge>\n            </div>\n            <p className=\"text-sm text-green-700 mt-1\">\n              {format(new Date(currentPeriod.startDate + 'T12:00:00'), \"MMM d\")} - {format(new Date(currentPeriod.endDate + 'T12:00:00'), \"MMM d, yyyy\")}\n            </p>\n          </div>\n        )}\n        \n        <div className=\"space-y-2\">\n          <h4 className=\"font-medium text-gray-900\">All Periods</h4>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 max-h-64 overflow-y-auto\">\n            {reportingData.periods.map((period) => {\n              const isActive = currentPeriod?.periodNumber === period.periodNumber;\n              const isPast = new Date() > new Date(period.endDate + 'T12:00:00');\n              \n              return (\n                <Button\n                  key={period.periodNumber}\n                  variant=\"ghost\"\n                  onClick={() => handleEditPeriod(period)}\n                  className={`p-2 h-auto text-left justify-start hover:opacity-80 ${\n                    isActive \n                      ? 'bg-green-50 border-green-200 text-green-900 hover:bg-green-100'\n                      : isPast\n                      ? 'bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100'\n                      : 'bg-blue-50 border-blue-200 text-blue-900 hover:bg-blue-100'\n                  }`}\n                >\n                  <div className=\"w-full\">\n                    <div className=\"font-medium text-sm flex items-center justify-between\">\n                      Period {period.periodNumber}\n                      <Edit className=\"h-3 w-3\" />\n                    </div>\n                    <div className=\"text-xs\">\n                      {format(new Date(period.startDate + 'T12:00:00'), \"MMM d\")} - {format(new Date(period.endDate + 'T12:00:00'), \"MMM d\")}\n                    </div>\n                  </div>\n                </Button>\n              );\n            })}\n          </div>\n        </div>\n        \n        <div className=\"text-xs text-gray-500 pt-2 border-t\">\n          Configured on {format(new Date(reportingData.savedAt || new Date()), \"MMM d, yyyy 'at' h:mm a\")}\n        </div>\n      </CardContent>\n\n      {/* Edit Period Modal */}\n      <Dialog open={isEditModalOpen} onOpenChange={setIsEditModalOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center\">\n              <Edit className=\"h-4 w-4 mr-2\" />\n              Edit Period {editingPeriod?.periodNumber}\n            </DialogTitle>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 pt-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-start-date\">Start Date</Label>\n              <Input\n                id=\"edit-start-date\"\n                type=\"date\"\n                value={editStartDate}\n                onChange={(e) => setEditStartDate(e.target.value)}\n              />\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-end-date\">End Date</Label>\n              <Input\n                id=\"edit-end-date\"\n                type=\"date\"\n                value={editEndDate}\n                onChange={(e) => setEditEndDate(e.target.value)}\n              />\n            </div>\n            \n            <div className=\"flex justify-end space-x-2 pt-4\">\n              <Button variant=\"outline\" onClick={handleCancelEdit}>\n                Cancel\n              </Button>\n              <Button onClick={handleSaveEdit}>\n                Save Changes\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </Card>\n  );\n}","path":null,"size_bytes":9446,"size_tokens":null},"client/src/pages/landing.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { GraduationCap, BarChart3, Users, Target } from \"lucide-react\";\n\nexport default function Landing() {\n\n\n\n  return (\n    <div className=\"min-h-screen bg-white\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b border-gray-100\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-20\">\n            <div className=\"flex items-center\">\n              <GraduationCap className=\"h-10 w-10 text-blue-900 mr-4\" />\n              <h1 className=\"text-2xl font-bold text-blue-900\">Special Education Data Collection App</h1>\n            </div>\n            <div className=\"flex space-x-4\">\n              <Button \n                onClick={() => window.location.href = '/api/login'} \n                size=\"lg\"\n                className=\"bg-blue-900 hover:bg-blue-800 text-white px-8 py-3\"\n              >\n                Get Started\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Hero Section */}\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"text-center py-20\">\n          <h2 className=\"text-5xl font-bold text-blue-900 mb-6\">\n            Streamline Your IEP Goal Tracking\n          </h2>\n          <p className=\"text-xl text-blue-800 max-w-4xl mx-auto mb-10\">\n            A comprehensive data collection platform designed specifically for special education teachers \n            to track student progress, manage IEP goals, and generate meaningful reports with ease and precision.\n          </p>\n          <Button \n            onClick={() => window.location.href = '/api/login'} \n            size=\"lg\"\n            className=\"bg-blue-900 hover:bg-blue-800 text-white px-12 py-4 text-lg font-semibold\"\n          >\n            Start Tracking Progress Today\n          </Button>\n        </div>\n\n        {/* Features Grid */}\n        <div className=\"py-16 bg-gray-50\">\n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <h3 className=\"text-3xl font-bold text-blue-900 text-center mb-12\">Powerful Features for Special Education</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n              <Card className=\"hover:shadow-lg transition-shadow bg-white border-gray-200\">\n                <CardContent className=\"pt-8 pb-6\">\n                  <div className=\"text-center mb-6\">\n                    <div className=\"p-4 bg-blue-100 rounded-full inline-flex\">\n                      <Users className=\"h-8 w-8 text-blue-900\" />\n                    </div>\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-blue-900 mb-4 text-center\">Student Management</h3>\n                  <p className=\"text-blue-800 text-center\">\n                    Easily create and manage student profiles with individual goal tracking and comprehensive progress monitoring.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"hover:shadow-lg transition-shadow bg-white border-gray-200\">\n                <CardContent className=\"pt-8 pb-6\">\n                  <div className=\"text-center mb-6\">\n                    <div className=\"p-4 bg-blue-100 rounded-full inline-flex\">\n                      <Target className=\"h-8 w-8 text-blue-900\" />\n                    </div>\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-blue-900 mb-4 text-center\">Goal-Specific Tracking</h3>\n                  <p className=\"text-blue-800 text-center\">\n                    Track each IEP goal individually with detailed progress bars, performance analytics, and trend analysis.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"hover:shadow-lg transition-shadow bg-white border-gray-200\">\n                <CardContent className=\"pt-8 pb-6\">\n                  <div className=\"text-center mb-6\">\n                    <div className=\"p-4 bg-blue-100 rounded-full inline-flex\">\n                      <BarChart3 className=\"h-8 w-8 text-blue-900\" />\n                    </div>\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-blue-900 mb-4 text-center\">Data Visualization</h3>\n                  <p className=\"text-blue-800 text-center\">\n                    Generate comprehensive reports and interactive charts for IEP meetings and progress reviews.\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n\n        {/* Key Features */}\n        <div className=\"py-16\">\n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div className=\"bg-white rounded-2xl shadow-lg p-12\">\n              <h3 className=\"text-3xl font-bold text-blue-900 mb-8 text-center\">Comprehensive IEP Data Management</h3>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-10\">\n                <div className=\"space-y-6\">\n                  <div className=\"flex items-start\">\n                    <div className=\"flex-shrink-0 w-8 h-8 bg-blue-900 rounded-full flex items-center justify-center mr-4 mt-1\">\n                      <div className=\"w-3 h-3 bg-white rounded-full\"></div>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold text-blue-900 text-lg mb-2\">Individual Goal Progress Tracking</h4>\n                      <p className=\"text-blue-800\">Separate progress monitoring for each IEP goal with detailed analytics and no data aggregation</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-start\">\n                    <div className=\"flex-shrink-0 w-8 h-8 bg-blue-900 rounded-full flex items-center justify-center mr-4 mt-1\">\n                      <div className=\"w-3 h-3 bg-white rounded-full\"></div>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold text-blue-900 text-lg mb-2\">Flexible Data Entry</h4>\n                      <p className=\"text-blue-800\">Support for percentage, fraction, frequency, and duration-based data collection methods</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-start\">\n                    <div className=\"flex-shrink-0 w-8 h-8 bg-blue-900 rounded-full flex items-center justify-center mr-4 mt-1\">\n                      <div className=\"w-3 h-3 bg-white rounded-full\"></div>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold text-blue-900 text-lg mb-2\">Interactive Dashboard</h4>\n                      <p className=\"text-blue-800\">Comprehensive overview with goal counts, data points, and real-time progress updates</p>\n                    </div>\n                  </div>\n                </div>\n                <div className=\"space-y-6\">\n                  <div className=\"flex items-start\">\n                    <div className=\"flex-shrink-0 w-8 h-8 bg-blue-900 rounded-full flex items-center justify-center mr-4 mt-1\">\n                      <div className=\"w-3 h-3 bg-white rounded-full\"></div>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold text-blue-900 text-lg mb-2\">Detailed Progress Reports</h4>\n                      <p className=\"text-blue-800\">Individual charts and scatterplots for each goal with trend analysis and performance insights</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-start\">\n                    <div className=\"flex-shrink-0 w-8 h-8 bg-blue-900 rounded-full flex items-center justify-center mr-4 mt-1\">\n                      <div className=\"w-3 h-3 bg-white rounded-full\"></div>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold text-blue-900 text-lg mb-2\">Support Level Documentation</h4>\n                      <p className=\"text-blue-800\">Track and document the level of support provided during each data collection session</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-start\">\n                    <div className=\"flex-shrink-0 w-8 h-8 bg-blue-900 rounded-full flex items-center justify-center mr-4 mt-1\">\n                      <div className=\"w-3 h-3 bg-white rounded-full\"></div>\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold text-blue-900 text-lg mb-2\">Detailed Observations</h4>\n                      <p className=\"text-blue-800\">Capture comprehensive anecdotal notes and observations for each data point</p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Call to Action */}\n        <div className=\"bg-blue-900 py-16\">\n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n            <h3 className=\"text-3xl font-bold text-white mb-6\">Ready to Transform Your IEP Data Management?</h3>\n            <p className=\"text-blue-100 mb-10 max-w-3xl mx-auto text-xl\">\n              Join special education teachers who are already using our platform to streamline their IEP goal tracking, improve data accuracy, and save valuable time.\n            </p>\n            <Button \n              onClick={() => window.location.href = '/api/login'} \n              size=\"lg\"\n              className=\"bg-white hover:bg-gray-100 text-blue-900 px-12 py-4 text-lg font-semibold\"\n            >\n              Start Your Free Trial Today\n            </Button>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <footer className=\"bg-white py-8 border-t border-gray-200\">\n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n            <p className=\"text-blue-800 mb-4\">\n              Â© 2025 Special Education Data Collection App. Designed for special education professionals.\n            </p>\n            <a \n              href=\"/admin\" \n              className=\"text-sm text-gray-500 hover:text-blue-800 transition-colors\"\n            >\n              website administrator Sandra Lindsey\n            </a>\n          </div>\n        </footer>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":10428,"size_tokens":null},"client/src/components/reporting-periods-modal.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Calendar, Plus, Save } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ReportingPeriod {\n  periodNumber: number;\n  startDate: string;\n  endDate: string;\n}\n\ninterface ReportingPeriodsModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSave: (periods: ReportingPeriod[], periodLength: string) => void;\n}\n\nexport default function ReportingPeriodsModal({ isOpen, onClose, onSave }: ReportingPeriodsModalProps) {\n  const { toast } = useToast();\n  const [periodLength, setPeriodLength] = useState<string>(\"\");\n  const [periods, setPeriods] = useState<ReportingPeriod[]>([]);\n\n  const periodOptions = [\n    { value: \"4.5-weeks\", label: \"4.5 weeks (8 reporting periods)\", count: 8 },\n    { value: \"3-weeks\", label: \"3 weeks (12 reporting periods)\", count: 12 }\n  ];\n\n  const handlePeriodLengthChange = (value: string) => {\n    setPeriodLength(value);\n    const selectedOption = periodOptions.find(opt => opt.value === value);\n    if (selectedOption) {\n      const newPeriods: ReportingPeriod[] = Array.from({ length: selectedOption.count }, (_, index) => ({\n        periodNumber: index + 1,\n        startDate: \"\",\n        endDate: \"\"\n      }));\n      setPeriods(newPeriods);\n    }\n  };\n\n  const updatePeriod = (index: number, field: 'startDate' | 'endDate', value: string) => {\n    const updatedPeriods = [...periods];\n    updatedPeriods[index] = { ...updatedPeriods[index], [field]: value };\n    setPeriods(updatedPeriods);\n  };\n\n  const handleSave = async () => {\n    if (!periodLength) {\n      toast({\n        title: \"Error\",\n        description: \"Please select a reporting period length.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const incompletePeriods = periods.filter(p => !p.startDate || !p.endDate);\n    if (incompletePeriods.length > 0) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all start and end dates for all reporting periods.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate date order\n    for (const period of periods) {\n      if (new Date(period.startDate) >= new Date(period.endDate)) {\n        toast({\n          title: \"Error\",\n          description: `Period ${period.periodNumber}: Start date must be before end date.`,\n          variant: \"destructive\",\n        });\n        return;\n      }\n    }\n\n    try {\n      await onSave(periods, periodLength);\n      toast({\n        title: \"Success\",\n        description: \"Reporting periods have been saved successfully.\",\n      });\n      \n      // Trigger a page refresh to update the calendar\n      setTimeout(() => {\n        window.location.reload();\n      }, 1000);\n      \n      onClose();\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to save reporting periods. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleReset = () => {\n    setPeriodLength(\"\");\n    setPeriods([]);\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center\">\n            <Calendar className=\"h-5 w-5 mr-2\" />\n            Configure Reporting Periods\n          </DialogTitle>\n        </DialogHeader>\n        \n        <div className=\"space-y-6\">\n          {/* Period Length Selection */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"period-length\">Reporting Period Length</Label>\n            <Select value={periodLength} onValueChange={handlePeriodLengthChange}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Select reporting period length\" />\n              </SelectTrigger>\n              <SelectContent>\n                {periodOptions.map((option) => (\n                  <SelectItem key={option.value} value={option.value}>\n                    {option.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Date Input Fields */}\n          {periods.length > 0 && (\n            <div className=\"space-y-4\">\n              <h3 className=\"text-lg font-semibold\">Reporting Period Dates</h3>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {periods.map((period, index) => (\n                  <Card key={period.periodNumber} className=\"p-4\">\n                    <CardHeader className=\"pb-3\">\n                      <CardTitle className=\"text-sm\">Period {period.periodNumber}</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      <div>\n                        <Label htmlFor={`start-${index}`} className=\"text-xs\">Start Date</Label>\n                        <Input\n                          id={`start-${index}`}\n                          type=\"date\"\n                          value={period.startDate}\n                          onChange={(e) => updatePeriod(index, 'startDate', e.target.value)}\n                          className=\"mt-1\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor={`end-${index}`} className=\"text-xs\">End Date</Label>\n                        <Input\n                          id={`end-${index}`}\n                          type=\"date\"\n                          value={period.endDate}\n                          onChange={(e) => updatePeriod(index, 'endDate', e.target.value)}\n                          className=\"mt-1\"\n                        />\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Action Buttons */}\n          <div className=\"flex justify-between pt-4\">\n            <Button variant=\"outline\" onClick={handleReset}>\n              Reset\n            </Button>\n            <div className=\"space-x-2\">\n              <Button variant=\"outline\" onClick={onClose}>\n                Cancel\n              </Button>\n              <Button onClick={handleSave} disabled={periods.length === 0}>\n                <Save className=\"h-4 w-4 mr-2\" />\n                Save Reporting Periods\n              </Button>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport function ReportingPeriodsButton() {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const { toast } = useToast();\n\n  const handleSavePeriods = async (periods: any[], periodLength: string) => {\n    const dataToSave = {\n      periodLength,\n      periods,\n    };\n    \n    console.log(\"Saving reporting periods to database:\", dataToSave);\n    \n    try {\n      const response = await fetch('/api/reporting-periods', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(dataToSave),\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Failed to save: ${response.statusText}`);\n      }\n      \n      console.log(\"Successfully saved reporting periods to database\");\n    } catch (error) {\n      console.error(\"Error saving reporting periods:\", error);\n      throw error;\n    }\n  };\n\n  return (\n    <>\n      <Button \n        variant=\"outline\" \n        onClick={() => setIsModalOpen(true)}\n        className=\"w-full justify-start\"\n      >\n        <Calendar className=\"h-4 w-4 mr-2\" />\n        Configure Reporting Periods\n      </Button>\n      \n      <ReportingPeriodsModal\n        isOpen={isModalOpen}\n        onClose={() => setIsModalOpen(false)}\n        onSave={handleSavePeriods}\n      />\n    </>\n  );\n}","path":null,"size_bytes":8136,"size_tokens":null},"client/src/components/goal-chart.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell, BarChart, Bar, ComposedChart } from \"recharts\";\nimport { Download, Printer, LineChart as LineChartIcon, PieChart as PieChartIcon, BarChart3, TrendingUp, Filter } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { filterDataPointsByPeriod, ReportingPeriod } from \"@/lib/utils\";\n\ninterface GoalChartProps {\n  goalId: number;\n  selectedPeriod?: ReportingPeriod | null; // Optional: if provided, filter data by specific reporting period\n}\n\ntype ChartType = 'line' | 'pie' | 'bar';\n\nexport default function GoalChart({ goalId, selectedPeriod }: GoalChartProps) {\n  const [selectedChartType, setSelectedChartType] = useState<ChartType>(() => {\n    // Get chart type preference from sessionStorage\n    const savedChartType = sessionStorage.getItem(`chartType_${goalId}`) as ChartType;\n  \n    return savedChartType || 'line';\n  });\n\n  const [showTrendLine, setShowTrendLine] = useState(() => {\n    // Get trend line preference from sessionStorage\n    const savedTrendPref = sessionStorage.getItem(`showTrend_${goalId}`);\n    return savedTrendPref ? savedTrendPref === 'true' : true; // Default to true\n  });\n\n  const [dataFilter, setDataFilter] = useState<'all' | 'objectives'>(() => {\n    const savedFilter = sessionStorage.getItem(`dataFilter_${goalId}`) as 'all' | 'objectives';\n    return savedFilter || 'all';\n  });\n\n  const [supportFilter, setSupportFilter] = useState<'all' | 'split'>(() => {\n    const savedSupportFilter = sessionStorage.getItem(`supportFilter_${goalId}`) as 'all' | 'split';\n    return savedSupportFilter || 'all';\n  });\n\n  // Listen for changes to sessionStorage chart type preference\n  useEffect(() => {\n    const checkForChartTypeChange = () => {\n      const currentChartType = sessionStorage.getItem(`chartType_${goalId}`) as ChartType;\n      if (currentChartType && currentChartType !== selectedChartType) {\n        setSelectedChartType(currentChartType);\n      }\n    };\n\n    // Check immediately and set up an interval to check periodically\n    checkForChartTypeChange();\n    const interval = setInterval(checkForChartTypeChange, 100);\n\n    return () => clearInterval(interval);\n  }, [goalId, selectedChartType]);\n  \n  // Fetch goal details with unified data points (existing endpoint already returns both)\n  const { data: goalProgress, isLoading, error } = useQuery({\n    queryKey: [`/api/goals/${goalId}`],\n    enabled: !!goalId,\n    staleTime: 0,\n    gcTime: 0,\n  });\n\n\n\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-center h-80\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (error || !goalProgress) {\n    return (\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"text-center py-8\">\n            <p className=\"text-gray-600\">Failed to load goal data</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const { goal, dataPoints } = goalProgress as any;\n\n  // Prepare chart data with objective indicators\n  let filteredDataPoints = Array.isArray(dataPoints) ? dataPoints : [];\n  \n  // Apply data filter\n  if (dataFilter === 'objectives') {\n    console.log('ðŸ” Filtering for objectives only...');\n    console.log('ðŸ“Š Total data points before filter:', filteredDataPoints.length);\n    console.log('ðŸŽ¯ Raw data sample:', filteredDataPoints.slice(0, 2));\n    console.log('âœ… Data points with isObjectiveSpecific true:', filteredDataPoints.filter((point: any) => point.isObjectiveSpecific === true).length);\n    console.log('ðŸ”— Data points with objectiveId:', filteredDataPoints.filter((point: any) => point.objectiveId !== null).length);\n    filteredDataPoints = filteredDataPoints.filter((point: any) => point.isObjectiveSpecific === true);\n    console.log('ðŸŽ¯ Filtered data points count:', filteredDataPoints.length);\n    console.log('ðŸ“‹ Filtered data sample:', filteredDataPoints.slice(0, 2));\n  }\n\n  // Apply reporting period filtering if a specific period is selected\n  if (selectedPeriod) {\n    filteredDataPoints = filterDataPointsByPeriod(filteredDataPoints, selectedPeriod);\n  }\n  \n  const chartData = filteredDataPoints\n    .map((point: any, index: number) => ({\n      index: index + 1,\n      date: format(new Date(point.date), \"MMM d\"),\n      fullDate: point.date,\n      progress: parseFloat(point.progressValue.toString()),\n      originalValue: parseFloat(point.progressValue.toString()),\n      support: point.levelOfSupport || 'Not specified',\n      notes: point.anecdotalInfo || '',\n      durationUnit: point.durationUnit || '',\n      numerator: point.numerator,\n      denominator: point.denominator,\n      isObjectiveSpecific: point.objectiveId !== null && point.objectiveId !== undefined,\n      objectiveDescription: point.objectiveDescription || null,\n      dataType: point.dataType || (point.isObjectiveSpecific ? 'Objective' : 'General Goal'),\n    }))\n    .sort((a: any, b: any) => new Date(a.fullDate).getTime() - new Date(b.fullDate).getTime()) // Show oldest to newest\n    .slice(-10); // Show last 10 data points\n\n  // Helper function to calculate evenly spaced ticks\n  const calculateEvenTicks = (min: number, max: number, idealCount: number = 5): number[] => {\n    if (min === max) return [min];\n    \n    const range = max - min;\n    const step = Math.ceil(range / (idealCount - 1));\n    const ticks = [];\n    \n    for (let i = 0; i < idealCount; i++) {\n      const tick = min + (i * step);\n      if (tick <= max) ticks.push(tick);\n    }\n    \n    // Ensure max value is included\n    if (ticks[ticks.length - 1] !== max) {\n      ticks.push(max);\n    }\n    \n    return ticks;\n  };\n\n  // Calculate Y-axis configuration based on data collection type\n  let yAxisConfig = {\n    domain: [0, 100] as [number, number],\n    ticks: [0, 25, 50, 75, 100] as number[],\n    tickFormatter: (value: number) => `${value}%`,\n    tooltipFormatter: (value: number) => `${value.toFixed(1)}%`,\n    isFrequency: false,\n    isReversed: false\n  };\n\n  if (goal.dataCollectionType === 'frequency') {\n    const frequencyValues = chartData.map((d: any) => d.originalValue);\n    const minValue = Math.min(...frequencyValues, 0);\n    const maxValue = Math.max(...frequencyValues, 1);\n    const padding = Math.ceil((maxValue - minValue) * 0.1) || 1;\n    const domainMin = Math.max(0, minValue - padding);\n    const domainMax = maxValue + padding;\n    \n    yAxisConfig = {\n      domain: [domainMin, domainMax] as [number, number],\n      ticks: calculateEvenTicks(domainMin, domainMax, 5),\n      tickFormatter: (value: number) => Math.round(value).toString(),\n      tooltipFormatter: (value: number) => Math.round(value).toString(),\n      isFrequency: true,\n      isReversed: goal.frequencyDirection === 'decrease'\n    };\n  } else if (goal.dataCollectionType === 'duration') {\n    const durationValues = chartData.map((d: any) => d.originalValue);\n    const minValue = Math.min(...durationValues, 0);\n    const maxValue = Math.max(...durationValues, 1);\n    const padding = Math.ceil((maxValue - minValue) * 0.1) || 1;\n    const domainMin = Math.max(0, minValue - padding);\n    const domainMax = maxValue + padding;\n    \n    yAxisConfig = {\n      domain: [domainMin, domainMax] as [number, number],\n      ticks: calculateEvenTicks(domainMin, domainMax, 5),\n      tickFormatter: (value: number) => {\n        // Value is in minutes (e.g., 1.10 = 1 minute 10 seconds)\n        const totalMinutes = Math.floor(value);\n        const seconds = Math.round((value - totalMinutes) * 100); // Convert decimal to seconds\n        // For duration goals, always show in minutes:seconds format unless it's 0\n        if (value === 0) {\n          return \"0:00\";\n        }\n        return `${totalMinutes}:${seconds.toString().padStart(2, '0')}`;\n      },\n      tooltipFormatter: (value: number) => {\n        // Value is in minutes (e.g., 1.10 = 1 minute 10 seconds)\n        const totalMinutes = Math.floor(value);\n        const seconds = Math.round((value - totalMinutes) * 100); // Convert decimal to seconds\n        if (value === 0) {\n          return \"0 minutes 0 seconds\";\n        }\n        return `${totalMinutes} min ${seconds} sec`;\n      },\n      isFrequency: false,\n      isReversed: false\n    };\n  }\n\n  // Helper function to check if support levels include \"independent\"\n  const hasIndependentSupport = (supportData: string) => {\n    if (!supportData || supportData === 'Not specified') return true; // Treat no support as independent\n    try {\n      const supportLevels = JSON.parse(supportData);\n      return Array.isArray(supportLevels) && supportLevels.includes('independent');\n    } catch {\n      return supportData === 'independent';\n    }\n  };\n\n  // Filter data based on selection\n  const filteredData = dataFilter === 'objectives' \n    ? chartData.filter(item => item.isObjectiveSpecific)\n    : chartData;\n\n  // Split data by support level for percentage goals when support filter is 'split'\n  const independentData = supportFilter === 'split' && goal.dataCollectionType === 'percentage'\n    ? filteredData.filter(item => hasIndependentSupport(item.support))\n    : filteredData;\n\n  const otherSupportData = supportFilter === 'split' && goal.dataCollectionType === 'percentage'\n    ? filteredData.filter(item => !hasIndependentSupport(item.support))\n    : [];\n\n  // For frequency charts, use original values instead of progress values\n  const displayData = goal.dataCollectionType === 'frequency' || goal.dataCollectionType === 'duration'\n    ? independentData.map((d: any) => ({ ...d, progress: d.originalValue }))\n    : independentData;\n\n  const displayDataOtherSupport = goal.dataCollectionType === 'frequency' || goal.dataCollectionType === 'duration'\n    ? otherSupportData.map((d: any) => ({ ...d, progress: d.originalValue }))\n    : otherSupportData;\n\n  // Custom tooltip component\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      const data = payload[0].payload;\n      const date = new Date(data.fullDate);\n      \n      // Parse level of support\n      let supportLevels = [];\n      try {\n        if (data.support && data.support !== 'Not specified') {\n          supportLevels = JSON.parse(data.support);\n        }\n      } catch (e) {\n        supportLevels = data.support === 'Not specified' ? [] : [data.support];\n      }\n\n      // Format support levels for display\n      const formatSupport = (levels: string[]) => {\n        if (!levels || levels.length === 0) return 'Independent';\n        return levels.map(level => {\n          switch (level) {\n            case 'independent': return 'Independent';\n            case 'verbal-prompt': return 'Verbal Prompt';\n            case 'visual-prompt': return 'Visual Prompt';\n            case 'gestural-prompt': return 'Gestural Prompt';\n            case 'physical-prompt': return 'Physical Prompt';\n            case 'hand-over-hand': return 'Hand-over-Hand';\n            default: return level;\n          }\n        }).join(', ');\n      };\n\n      return (\n        <div className=\"bg-white p-4 border rounded-lg shadow-lg min-w-[250px]\">\n          <p className=\"font-semibold text-lg mb-2\">{goal.title}</p>\n          <div className=\"space-y-1 text-sm\">\n            <p><strong>Date:</strong> {date.toLocaleDateString('en-US', { \n              weekday: 'short', \n              year: 'numeric', \n              month: 'short', \n              day: 'numeric' \n            })}</p>\n            \n            <p><strong>\n              {goal.dataCollectionType === 'frequency' ? 'Count:' : \n               goal.dataCollectionType === 'duration' ? 'Duration:' : 'Progress:'}\n            </strong> {yAxisConfig.tooltipFormatter(data.progress)}\n            {goal.dataCollectionType === 'frequency' && ' times'}\n            </p>\n\n            {goal.dataCollectionType === 'percentage' && data.numerator !== null && data.denominator !== null && (\n              <p><strong>Trials:</strong> {data.numerator} correct out of {data.denominator} attempts</p>\n            )}\n\n            <p><strong>Support Level:</strong> {formatSupport(supportLevels)}</p>\n            \n            {data.isObjectiveSpecific && data.objectiveDescription && (\n              <p><strong>Objective:</strong> {data.objectiveDescription}</p>\n            )}\n            \n            <p><strong>Data Type:</strong> {data.dataType}</p>\n\n            {data.notes && data.notes.trim() && (\n              <div className=\"mt-2 pt-2 border-t border-gray-200\">\n                <p><strong>Notes:</strong></p>\n                <p className=\"text-gray-700 italic\">{data.notes}</p>\n              </div>\n            )}\n          </div>\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <Card data-goal-id={goalId}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <div className=\"flex items-center gap-2\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Progress Chart: {goal.title}\n            </h3>\n            {selectedPeriod && (\n              <div className=\"flex items-center gap-1 bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs\">\n                <Filter className=\"h-3 w-3\" />\n                Period {selectedPeriod.periodNumber}\n              </div>\n            )}\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <Select\n              value={selectedChartType}\n              onValueChange={(value: ChartType) => {\n                setSelectedChartType(value);\n                sessionStorage.setItem(`chartType_${goalId}`, value);\n              }}\n            >\n              <SelectTrigger className=\"w-40\">\n                <SelectValue placeholder=\"Chart Type\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"line\">\n                  <div className=\"flex items-center\">\n                    <LineChartIcon className=\"h-4 w-4 mr-2\" />\n                    Line Chart\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"bar\">\n                  <div className=\"flex items-center\">\n                    <BarChart3 className=\"h-4 w-4 mr-2\" />\n                    Bar Chart\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"pie\">\n                  <div className=\"flex items-center\">\n                    <PieChartIcon className=\"h-4 w-4 mr-2\" />\n                    Pie Chart\n                  </div>\n                </SelectItem>\n              </SelectContent>\n            </Select>\n            \n            {/* Trend Line Toggle - Only show for line and bar charts */}\n            {(selectedChartType === 'line' || selectedChartType === 'bar') && (\n              <Button\n                variant={showTrendLine ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => {\n                  const newValue = !showTrendLine;\n                  setShowTrendLine(newValue);\n                  sessionStorage.setItem(`showTrend_${goalId}`, String(newValue));\n                }}\n              >\n                <TrendingUp className=\"h-4 w-4 mr-2\" />\n                {showTrendLine ? \"Hide\" : \"Show\"} Trend\n              </Button>\n            )}\n\n            {/* Data Filter Toggle */}\n            <Button\n              variant={dataFilter === 'objectives' ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => {\n                const newFilter = dataFilter === 'all' ? 'objectives' : 'all';\n                setDataFilter(newFilter);\n                sessionStorage.setItem(`dataFilter_${goalId}`, newFilter);\n              }}\n            >\n              {dataFilter === 'all' ? 'Show Only Objectives' : 'Show All Data'}\n            </Button>\n\n            {/* Support Level Filter Toggle - Only for percentage goals */}\n            {goal.dataCollectionType === 'percentage' && (\n              <Button\n                variant={supportFilter === 'split' ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => {\n                  const newFilter = supportFilter === 'all' ? 'split' : 'all';\n                  setSupportFilter(newFilter);\n                  sessionStorage.setItem(`supportFilter_${goalId}`, newFilter);\n                }}\n              >\n                {supportFilter === 'all' ? 'Split by Support' : 'Show All Together'}\n              </Button>\n            )}\n            \n            <Button variant=\"outline\" size=\"sm\">\n              <Download className=\"h-4 w-4 mr-1\" />\n              Export\n            </Button>\n            <Button variant=\"outline\" size=\"sm\">\n              <Printer className=\"h-4 w-4 mr-1\" />\n              Print\n            </Button>\n          </div>\n        </div>\n\n        {chartData.length === 0 ? (\n          <div className=\"text-center py-16\">\n            <p className=\"text-gray-600\">\n              {dataFilter === 'objectives' \n                ? 'No objective-specific data points available for this goal'\n                : 'No data points available for this goal'\n              }\n            </p>\n            <p className=\"text-sm text-gray-500 mt-1\">\n              {dataFilter === 'objectives' \n                ? 'Try switching to \"Show All Data\" or add objective-specific data points'\n                : 'Add some data points to see the progress chart'\n              }\n            </p>\n          </div>\n        ) : (\n          <>\n            {/* Chart Container - Single or Dual based on support filter */}\n            {supportFilter === 'split' && goal.dataCollectionType === 'percentage' ? (\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\">\n                {/* Independent Support Chart */}\n                <div className=\"bg-blue-50 rounded-lg p-4\">\n                  <h4 className=\"text-sm font-semibold text-blue-800 mb-3 text-center\">Independent Support Data</h4>\n                  <div className=\"h-80\">\n                    {displayData.length === 0 ? (\n                      <div className=\"flex items-center justify-center h-full text-gray-500 text-sm\">\n                        No independent support data points\n                      </div>\n                    ) : (\n                      <div className=\"h-full\">\n                        {/* Render chart based on selected type for independent data */}\n                        {selectedChartType === 'line' && (\n                          <ResponsiveContainer width=\"100%\" height=\"100%\">\n                            <LineChart data={displayData}>\n                              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n                              <XAxis dataKey=\"date\" stroke=\"#666\" fontSize={11} />\n                              <YAxis \n                                domain={yAxisConfig.domain}\n                                ticks={yAxisConfig.ticks}\n                                stroke=\"#666\"\n                                fontSize={11}\n                                tickFormatter={yAxisConfig.tickFormatter}\n                              />\n                              <Tooltip content={<CustomTooltip />} />\n                              <Line\n                                type=\"monotone\"\n                                dataKey=\"progress\"\n                                stroke=\"#3b82f6\"\n                                strokeWidth={2}\n                                dot={{ fill: \"#3b82f6\", r: 4 }}\n                                name=\"Independent Progress\"\n                              />\n                            </LineChart>\n                          </ResponsiveContainer>\n                        )}\n                        {selectedChartType === 'bar' && (\n                          <ResponsiveContainer width=\"100%\" height=\"100%\">\n                            <BarChart data={displayData}>\n                              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n                              <XAxis dataKey=\"date\" stroke=\"#666\" fontSize={11} />\n                              <YAxis \n                                domain={yAxisConfig.domain}\n                                ticks={yAxisConfig.ticks}\n                                stroke=\"#666\"\n                                fontSize={11}\n                                tickFormatter={yAxisConfig.tickFormatter}\n                              />\n                              <Tooltip content={<CustomTooltip />} />\n                              <Bar dataKey=\"progress\" fill=\"#3b82f6\" radius={[4, 4, 0, 0]} />\n                            </BarChart>\n                          </ResponsiveContainer>\n                        )}\n                        {selectedChartType === 'pie' && (\n                          <ResponsiveContainer width=\"100%\" height=\"100%\">\n                            <PieChart>\n                              <Pie\n                                data={displayData.map((item: any, index: number) => ({\n                                  ...item,\n                                  name: item.date,\n                                  value: item.progress,\n                                  fill: `hsl(${200 + (index * 30)}, 70%, 50%)`\n                                }))}\n                                cx=\"50%\" cy=\"50%\" outerRadius={80} fill=\"#3b82f6\" dataKey=\"value\"\n                                label={({ name, value }) => `${name}: ${yAxisConfig.tickFormatter(value)}`}\n                              />\n                              <Tooltip formatter={(value: any) => [yAxisConfig.tickFormatter(value), 'Independent Progress']} />\n                            </PieChart>\n                          </ResponsiveContainer>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n                \n                {/* Other Support Chart */}\n                <div className=\"bg-orange-50 rounded-lg p-4\">\n                  <h4 className=\"text-sm font-semibold text-orange-800 mb-3 text-center\">Any Other Support Data</h4>\n                  <div className=\"h-80\">\n                    {displayDataOtherSupport.length === 0 ? (\n                      <div className=\"flex items-center justify-center h-full text-gray-500 text-sm\">\n                        No other support data points\n                      </div>\n                    ) : (\n                      <div className=\"h-full\">\n                        {/* Render chart based on selected type for other support data */}\n                        {selectedChartType === 'line' && (\n                          <ResponsiveContainer width=\"100%\" height=\"100%\">\n                            <LineChart data={displayDataOtherSupport}>\n                              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n                              <XAxis dataKey=\"date\" stroke=\"#666\" fontSize={11} />\n                              <YAxis \n                                domain={yAxisConfig.domain}\n                                ticks={yAxisConfig.ticks}\n                                stroke=\"#666\"\n                                fontSize={11}\n                                tickFormatter={yAxisConfig.tickFormatter}\n                              />\n                              <Tooltip content={<CustomTooltip />} />\n                              <Line\n                                type=\"monotone\"\n                                dataKey=\"progress\"\n                                stroke=\"#3b82f6\"\n                                strokeWidth={2}\n                                dot={{ fill: \"#3b82f6\", r: 4 }}\n                                name=\"Supported Progress\"\n                              />\n                            </LineChart>\n                          </ResponsiveContainer>\n                        )}\n                        {selectedChartType === 'bar' && (\n                          <ResponsiveContainer width=\"100%\" height=\"100%\">\n                            <BarChart data={displayDataOtherSupport}>\n                              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n                              <XAxis dataKey=\"date\" stroke=\"#666\" fontSize={11} />\n                              <YAxis \n                                domain={yAxisConfig.domain}\n                                ticks={yAxisConfig.ticks}\n                                stroke=\"#666\"\n                                fontSize={11}\n                                tickFormatter={yAxisConfig.tickFormatter}\n                              />\n                              <Tooltip content={<CustomTooltip />} />\n                              <Bar dataKey=\"progress\" fill=\"#3b82f6\" radius={[4, 4, 0, 0]} />\n                            </BarChart>\n                          </ResponsiveContainer>\n                        )}\n                        {selectedChartType === 'pie' && (\n                          <ResponsiveContainer width=\"100%\" height=\"100%\">\n                            <PieChart>\n                              <Pie\n                                data={displayDataOtherSupport.map((item: any, index: number) => ({\n                                  ...item,\n                                  name: item.date,\n                                  value: item.progress,\n                                  fill: `hsl(${30 + (index * 30)}, 70%, 50%)`\n                                }))}\n                                cx=\"50%\" cy=\"50%\" outerRadius={80} fill=\"#F97316\" dataKey=\"value\"\n                                label={({ name, value }) => `${name}: ${yAxisConfig.tickFormatter(value)}`}\n                              />\n                              <Tooltip formatter={(value: any) => [yAxisConfig.tickFormatter(value), 'Supported Progress']} />\n                            </PieChart>\n                          </ResponsiveContainer>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <div className=\"h-80 mb-6\">\n                {selectedChartType === 'line' && (\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <LineChart data={displayData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n                    <XAxis \n                      dataKey=\"date\" \n                      stroke=\"#666\"\n                      fontSize={12}\n                    />\n                    <YAxis \n                      domain={yAxisConfig.isReversed ? [yAxisConfig.domain[1], yAxisConfig.domain[0]] : yAxisConfig.domain}\n                      ticks={yAxisConfig.isReversed ? [...yAxisConfig.ticks].reverse() : yAxisConfig.ticks}\n                      stroke=\"#666\"\n                      fontSize={12}\n                      tickFormatter={yAxisConfig.tickFormatter}\n                      allowDecimals={!yAxisConfig.isFrequency}\n                      label={{ \n                        value: goal.dataCollectionType === 'frequency' ? 'Count' : \n                               goal.dataCollectionType === 'duration' ? 'Duration (mm:ss)' : 'Progress (%)', \n                        angle: -90, \n                        position: 'insideLeft' \n                      }}\n                    />\n                    <Tooltip content={<CustomTooltip />} />\n                    <Legend />\n                    {showTrendLine && (\n                      <Line\n                        type=\"monotone\"\n                        dataKey=\"progress\"\n                        stroke=\"#3b82f6\"\n                        strokeWidth={3}\n                        dot={(props) => {\n                          const { cx, cy, payload } = props;\n                          const isObjective = payload?.isObjectiveSpecific;\n                          return (\n                            <circle\n                              cx={cx}\n                              cy={cy}\n                              r={isObjective ? 6 : 4}\n                              fill=\"#3b82f6\"\n                              stroke=\"#1e40af\"\n                              strokeWidth={2}\n                            />\n                          );\n                        }}\n                        activeDot={{ r: 8, stroke: \"#000\", strokeWidth: 2 }}\n                        name=\"All Data Points\"\n                      />\n                    )}\n                  </LineChart>\n                </ResponsiveContainer>\n              )}\n                \n              {selectedChartType === 'bar' && (\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <ComposedChart data={displayData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\n                    <XAxis \n                      dataKey=\"date\" \n                      stroke=\"#666\"\n                      fontSize={12}\n                    />\n                    <YAxis \n                      domain={yAxisConfig.isReversed ? [yAxisConfig.domain[1], yAxisConfig.domain[0]] : yAxisConfig.domain}\n                      ticks={yAxisConfig.isReversed ? [...yAxisConfig.ticks].reverse() : yAxisConfig.ticks}\n                      stroke=\"#666\"\n                      fontSize={12}\n                      tickFormatter={yAxisConfig.tickFormatter}\n                      allowDecimals={!yAxisConfig.isFrequency}\n                      label={{ \n                        value: goal.dataCollectionType === 'frequency' ? 'Count' : \n                               goal.dataCollectionType === 'duration' ? 'Duration (mm:ss)' : 'Progress (%)', \n                        angle: -90, \n                        position: 'insideLeft' \n                      }}\n                    />\n                    <Tooltip content={<CustomTooltip />} />\n                    <Legend />\n                    <Bar\n                      dataKey=\"progress\"\n                      fill=\"#3b82f6\"\n                      radius={[4, 4, 0, 0]}\n                      name=\"Progress Data\"\n                    />\n                    {showTrendLine && (\n                      <Line\n                        type=\"monotone\"\n                        dataKey=\"progress\"\n                        stroke=\"#3b82f6\"\n                        strokeWidth={2}\n                        strokeDasharray=\"5 5\"\n                        dot={false}\n                        connectNulls={true}\n                        name=\"Trend\"\n                      />\n                    )}\n                  </ComposedChart>\n                </ResponsiveContainer>\n              )}\n                \n              {selectedChartType === 'pie' && (\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <PieChart>\n                    <Pie\n                      data={displayData.map((item: any, index: number) => ({\n                        ...item,\n                        name: item.date,\n                        value: item.progress,\n                        fill: `hsl(${200 + (index * 30)}, 70%, 50%)`\n                      }))}\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      labelLine={false}\n                      label={({ name, value }) => `${name}: ${yAxisConfig.tickFormatter(value)}`}\n                      outerRadius={100}\n                      fill=\"#8884d8\"\n                      dataKey=\"value\"\n                    >\n                      {displayData.map((entry: any, index: number) => (\n                        <Cell key={`cell-${index}`} fill={`hsl(${200 + (index * 30)}, 70%, 50%)`} />\n                      ))}\n                    </Pie>\n                    <Tooltip formatter={(value: any) => [yAxisConfig.tickFormatter(value), goal.dataCollectionType === 'frequency' ? 'Count' : goal.dataCollectionType === 'duration' ? 'Duration' : 'Progress']} />\n                  </PieChart>\n                </ResponsiveContainer>\n              )}\n              </div>\n            )}\n\n            {/* Data Type Legend */}\n            <div className=\"flex justify-center gap-6 mb-4 p-3 bg-gray-50 rounded-lg\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-4 h-4 rounded-full bg-blue-600\"></div>\n                <span className=\"text-sm font-medium\">General Goal Data</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-4 h-4 rounded-full bg-green-600\"></div>\n                <span className=\"text-sm font-medium\">Objective-Specific Data</span>\n              </div>\n            </div>\n\n            {/* Chart Statistics */}\n            {goal.dataCollectionType === 'percentage' ? (\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 pt-6 border-t border-gray-100\">\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900\">\n                    {dataPoints.length > 0 ? Math.round(parseFloat(dataPoints[dataPoints.length - 1].progressValue?.toString() || '0')) : 0}%\n                  </p>\n                  <p className=\"text-sm text-gray-600\">Current Progress</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900\">\n                    {dataPoints.length > 0 ? Math.round(dataPoints.reduce((sum: any, point: any) => sum + parseFloat(point.progressValue?.toString() || '0'), 0) / dataPoints.length) : 0}%\n                  </p>\n                  <p className=\"text-sm text-gray-600\">Average Score</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900\">\n                    0%\n                  </p>\n                  <p className=\"text-sm text-gray-600\">Trend</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900\">\n                    {filteredDataPoints.length}\n                  </p>\n                  <p className=\"text-sm text-gray-600\">Data Points</p>\n                </div>\n              </div>\n            ) : goal.dataCollectionType === 'frequency' ? (\n              <div className=\"grid grid-cols-3 gap-4 pt-6 border-t border-gray-100\">\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900\">\n                    {dataPoints.length > 0 ? Math.round(parseFloat(dataPoints[dataPoints.length - 1].progressValue?.toString() || '0')) : 0}\n                  </p>\n                  <p className=\"text-sm text-gray-600\">Current Frequency</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900\">\n                    {dataPoints.length > 0 ? Math.round(dataPoints.reduce((sum: any, point: any) => sum + parseFloat(point.progressValue?.toString() || '0'), 0) / dataPoints.length) : 0}\n                  </p>\n                  <p className=\"text-sm text-gray-600\">Average Frequency</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900\">\n                    {dataPoints.length}\n                  </p>\n                  <p className=\"text-sm text-gray-600\">Data Points</p>\n                </div>\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-2 gap-4 pt-6 border-t border-gray-100\">\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900\">\n                    {(goalProgress as any).currentProgress?.toFixed(0) || '0'}%\n                  </p>\n                  <p className=\"text-sm text-gray-600\">Current Progress</p>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-2xl font-bold text-gray-900\">\n                    {dataPoints.length}\n                  </p>\n                  <p className=\"text-sm text-gray-600\">Data Points</p>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n\n        {/* Goal Summary Report */}\n        <div className=\"mt-8 p-6 bg-gray-50 rounded-lg\">\n          <h4 className=\"text-lg font-semibold text-gray-900 mb-4\">Goal Summary Report</h4>\n          <div className=\"prose max-w-none text-sm\">\n            <p className=\"text-gray-700 mb-4\">\n              <strong>Goal Statement:</strong> {goal.description}\n            </p>\n            <p className=\"text-gray-700 mb-4\">\n              <strong>Current Status:</strong> {goal.status === 'active' ? 'The student is actively working toward this goal.' : \n                goal.status === 'mastered' ? 'The student has mastered this goal.' : \n                'This goal has been discontinued.'}\n            </p>\n\n            <p className=\"text-gray-700\">\n              <strong>Data Collection:</strong> {dataPoints.length} data points have been collected for this goal.\n            </p>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":37445,"size_tokens":null},"client/src/components/edit-goal-modal.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { z } from \"zod\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\n\nconst editGoalSchema = z.object({\n  title: z.string().min(1, \"Title is required\"),\n  description: z.string().min(1, \"Description is required\"),\n  targetCriteria: z.string().optional(),\n  dataCollectionType: z.string().optional(),\n  frequencyDirection: z.string().optional(),\n  status: z.string().optional(),\n});\n\ntype EditGoalFormData = z.infer<typeof editGoalSchema>;\n\ninterface Goal {\n  id: number;\n  title: string;\n  description: string;\n  targetCriteria: string | null;\n  dataCollectionType: string | null;\n  frequencyDirection: string | null;\n  status: string;\n  levelOfSupport: string | null;\n}\n\ninterface EditGoalModalProps {\n  goal: Goal;\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess?: () => void;\n}\n\nconst supportLevels = [\n  \"Independent\",\n  \"Verbal\",\n  \"Visual\", \n  \"Written\",\n  \"Model of Task\",\n  \"Self-Correction\",\n  \"Gesture\",\n  \"Custom\"\n];\n\nexport default function EditGoalModal({ goal, isOpen, onClose, onSuccess }: EditGoalModalProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedSupport, setSelectedSupport] = useState<string[]>(() => {\n    if (!goal.levelOfSupport) return [];\n    \n    try {\n      const parsed = JSON.parse(goal.levelOfSupport);\n      // Normalize case: convert stored lowercase values to match UI capitalized values\n      return parsed.map((level: string) => {\n        const lowerLevel = level.toLowerCase();\n        // Find matching support level with proper capitalization\n        const matchedLevel = supportLevels.find(sl => sl.toLowerCase() === lowerLevel);\n        return matchedLevel || level; // fallback to original if no match\n      });\n    } catch {\n      return [];\n    }\n  });\n  const [customSupport, setCustomSupport] = useState<string>(\"\");\n\n  const form = useForm<EditGoalFormData>({\n    resolver: zodResolver(editGoalSchema),\n    defaultValues: {\n      title: goal.title,\n      description: goal.description,\n      targetCriteria: goal.targetCriteria || \"\",\n      dataCollectionType: goal.dataCollectionType || \"percentage\",\n      frequencyDirection: goal.frequencyDirection || \"\",\n      status: goal.status,\n    },\n  });\n\n  const mutation = useMutation({\n    mutationFn: async (data: EditGoalFormData) => {\n      let finalSupport = [...selectedSupport];\n      \n      // If Custom is selected and customSupport has value, replace \"Custom\" with the custom value\n      if (selectedSupport.includes(\"Custom\") && customSupport.trim()) {\n        finalSupport = finalSupport.filter(s => s !== \"Custom\");\n        finalSupport.push(customSupport.trim());\n      }\n      \n      const submitData = {\n        ...data,\n        levelOfSupport: finalSupport.length > 0 ? JSON.stringify(finalSupport) : null,\n      };\n      \n      const response = await fetch(`/api/goals/${goal.id}`, {\n        method: \"PATCH\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(submitData),\n      });\n      \n      if (!response.ok) {\n        throw new Error(\"Failed to update goal\");\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Goal updated successfully!\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/students\"] });\n      form.reset();\n      onSuccess?.();\n      onClose();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\", \n        description: \"Failed to update goal. Please try again.\",\n        variant: \"destructive\",\n      });\n      console.error(\"Error updating goal:\", error);\n    },\n  });\n\n  const onSubmit = (data: EditGoalFormData) => {\n    mutation.mutate(data);\n  };\n\n  const handleSupportChange = (level: string, checked: boolean) => {\n    if (level === \"Custom\") {\n      if (checked) {\n        setSelectedSupport(prev => [...prev, level]);\n      } else {\n        setSelectedSupport(prev => prev.filter(l => l !== level));\n        setCustomSupport(\"\");\n      }\n    } else {\n      if (checked) {\n        setSelectedSupport(prev => [...prev, level]);\n      } else {\n        setSelectedSupport(prev => prev.filter(l => l !== level));\n      }\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"max-w-2xl w-full\"\n        style={{\n          maxHeight: '85vh',\n          height: 'auto',\n          overflow: 'visible'\n        }}\n      >\n        <DialogHeader>\n          <DialogTitle>Edit Goal</DialogTitle>\n        </DialogHeader>\n        \n        <div \n          style={{\n            maxHeight: 'calc(85vh - 80px)',\n            overflow: 'auto',\n            paddingRight: '4px',\n            marginRight: '-4px'\n          }}\n        >\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            <FormField\n              control={form.control}\n              name=\"title\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Goal Title</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Enter goal title\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Description</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      placeholder=\"Describe the goal in detail\"\n                      className=\"min-h-[100px]\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"targetCriteria\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Target Criteria</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder=\"e.g., 80% accuracy over 3 consecutive trials\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"dataCollectionType\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Data Collection Type</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select data collection type...\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"frequency\">Frequency</SelectItem>\n                      <SelectItem value=\"percentage\">Attempts in Trials (Percentages)</SelectItem>\n                      <SelectItem value=\"duration\">Duration</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            {form.watch(\"dataCollectionType\") === \"frequency\" && (\n              <FormField\n                control={form.control}\n                name=\"frequencyDirection\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Frequency Direction</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Is this goal to increase or decrease frequency?\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"increase\">Increase Frequency</SelectItem>\n                        <SelectItem value=\"decrease\">Decrease Frequency</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            )}\n\n            <FormField\n              control={form.control}\n              name=\"status\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Status</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select status\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"active\">Active</SelectItem>\n                      <SelectItem value=\"completed\">Completed</SelectItem>\n                      <SelectItem value=\"discontinued\">Discontinued</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"space-y-3\">\n              <label className=\"text-sm font-medium\">Level of Support</label>\n              <div className=\"space-y-2\">\n                {supportLevels.map((level) => (\n                  <div key={level} className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id={level}\n                      checked={selectedSupport.includes(level)}\n                      onCheckedChange={(checked) => \n                        handleSupportChange(level, checked as boolean)\n                      }\n                    />\n                    <label htmlFor={level} className=\"text-sm font-medium\">\n                      {level}\n                    </label>\n                  </div>\n                ))}\n              </div>\n              \n              {/* Custom Support Input */}\n              {selectedSupport.includes(\"Custom\") && (\n                <div className=\"mt-3\">\n                  <Input\n                    placeholder=\"Enter your custom level of support...\"\n                    value={customSupport}\n                    onChange={(e) => setCustomSupport(e.target.value)}\n                  />\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={mutation.isPending}>\n                {mutation.isPending ? \"Updating...\" : \"Update Goal\"}\n              </Button>\n            </div>\n            </form>\n          </Form>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","path":null,"size_bytes":11793,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport Landing from \"@/pages/landing\";\nimport Home from \"@/pages/home\";\nimport StudentDetail from \"@/pages/student-detail\";\nimport GroupCollection from \"@/pages/group-collection\";\nimport NotFound from \"@/pages/not-found\";\nimport AdminPage from \"@/pages/admin\";\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  // Show loading state while checking authentication\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-white flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-900 mx-auto\"></div>\n          <p className=\"mt-4 text-blue-800\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <Switch>\n      {/* Landing page for unauthenticated users or explicit landing route */}\n      <Route path=\"/landing\" component={Landing} />\n      \n      {/* Root path routing based on authentication */}\n      <Route path=\"/\">\n        {isAuthenticated ? <Home /> : <Landing />}\n      </Route>\n      \n      {/* Protected routes - require authentication */}\n      <Route path=\"/students/:id\">\n        {isAuthenticated ? <StudentDetail /> : <Landing />}\n      </Route>\n      \n      <Route path=\"/group-collection\">\n        {isAuthenticated ? <GroupCollection /> : <Landing />}\n      </Route>\n      \n      <Route path=\"/admin\">\n        {isAuthenticated ? <AdminPage /> : <Landing />}\n      </Route>\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":2036,"size_tokens":null},"tests/setup.ts":{"content":"import { vi } from 'vitest';\n\nexport const mockDb = {\n  select: vi.fn().mockReturnThis(),\n  from: vi.fn().mockReturnThis(),\n  where: vi.fn().mockReturnThis(),\n  orderBy: vi.fn().mockReturnThis(),\n  limit: vi.fn().mockReturnThis(),\n  offset: vi.fn().mockReturnThis(),\n  leftJoin: vi.fn().mockReturnThis(),\n  innerJoin: vi.fn().mockReturnThis(),\n  insert: vi.fn().mockReturnThis(),\n  values: vi.fn().mockReturnThis(),\n  returning: vi.fn().mockResolvedValue([]),\n  update: vi.fn().mockReturnThis(),\n  set: vi.fn().mockReturnThis(),\n  delete: vi.fn().mockReturnThis(),\n};\n\nexport function resetMocks() {\n  Object.values(mockDb).forEach(mock => {\n    if (typeof mock.mockReset === 'function') {\n      mock.mockReset();\n      mock.mockReturnThis();\n    }\n  });\n}\n\nexport function createMockUser(overrides = {}) {\n  return {\n    id: '4201332',\n    email: 'test@example.com',\n    firstName: 'Test',\n    lastName: 'User',\n    profileImageUrl: null,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    ...overrides,\n  };\n}\n\nexport function createMockStudent(overrides = {}) {\n  return {\n    id: 1,\n    userId: '4201332',\n    name: 'Test Student',\n    grade: '3rd',\n    iepDueDate: new Date('2025-12-01'),\n    relatedServices: null,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    ...overrides,\n  };\n}\n\nexport function createMockGoal(overrides = {}) {\n  return {\n    id: 1,\n    studentId: 1,\n    title: 'Test Goal',\n    description: 'Test goal description',\n    targetCriteria: '80% accuracy over 4/5 trials',\n    levelOfSupport: '[\"verbal\", \"visual\"]',\n    dataCollectionType: 'percentage' as const,\n    frequencyDirection: null,\n    status: 'active' as const,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    ...overrides,\n  };\n}\n\nexport function createMockObjective(overrides = {}) {\n  return {\n    id: 1,\n    goalId: 1,\n    studentId: 1,\n    title: null,\n    description: 'Test objective description',\n    targetCriteria: '80% accuracy',\n    targetDate: null,\n    status: 'active' as const,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    ...overrides,\n  };\n}\n\nexport function createMockDataPoint(overrides = {}) {\n  return {\n    id: 1,\n    goalId: 1,\n    objectiveId: null,\n    studentId: 1,\n    date: new Date(),\n    progressValue: '75.00',\n    progressFormat: 'percentage' as const,\n    numerator: 3,\n    denominator: 4,\n    durationUnit: null,\n    levelOfSupport: '[\"verbal\"]',\n    setting: '[\"general-education\"]',\n    anecdotalInfo: 'Test note',\n    createdAt: new Date(),\n    ...overrides,\n  };\n}\n\nexport function createMockReportingPeriod(overrides = {}) {\n  return {\n    id: 1,\n    userId: '4201332',\n    periodData: JSON.stringify({\n      periods: [\n        { periodNumber: 1, startDate: '2025-08-25', endDate: '2025-09-26' },\n      ],\n      periodLength: '4.5-weeks',\n    }),\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    ...overrides,\n  };\n}\n","path":null,"size_bytes":2894,"size_tokens":null},"vitest.config.ts":{"content":"import { defineConfig } from 'vitest/config';\nimport path from 'path';\n\nexport default defineConfig({\n  test: {\n    globals: true,\n    environment: 'node',\n    include: ['tests/**/*.test.ts'],\n    coverage: {\n      provider: 'v8',\n      reporter: ['text', 'json', 'html'],\n      include: ['server/**/*.ts', 'shared/**/*.ts'],\n      exclude: ['**/node_modules/**', '**/dist/**'],\n    },\n    testTimeout: 30000,\n    hookTimeout: 30000,\n  },\n  resolve: {\n    alias: {\n      '@shared': path.resolve(__dirname, './shared'),\n      '@': path.resolve(__dirname, './client/src'),\n    },\n  },\n});\n","path":null,"size_bytes":587,"size_tokens":null},"tests/unit/schema.test.ts":{"content":"import { describe, it, expect } from 'vitest';\nimport {\n  insertStudentSchema,\n  insertGoalSchema,\n  insertObjectiveSchema,\n  insertDataPointSchema,\n  DATA_COLLECTION_TYPES,\n  GOAL_STATUSES,\n  FREQUENCY_DIRECTIONS,\n  PROGRESS_FORMATS,\n  DURATION_UNITS,\n} from '../../shared/schema';\nimport { createBoundaryValues } from '../factories';\n\ndescribe('Schema Validation', () => {\n  const boundaries = createBoundaryValues();\n\n  describe('insertStudentSchema', () => {\n    it('should validate a valid student', () => {\n      const validStudent = {\n        userId: '4201332',\n        name: 'Test Student',\n        grade: '3rd',\n        iepDueDate: '2025-12-01',\n        relatedServices: 'Speech Therapy',\n      };\n\n      const result = insertStudentSchema.safeParse(validStudent);\n      expect(result.success).toBe(true);\n    });\n\n    it('should reject empty student name', () => {\n      const invalidStudent = {\n        userId: '4201332',\n        name: '',\n        grade: '3rd',\n      };\n\n      const result = insertStudentSchema.safeParse(invalidStudent);\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.errors[0].message).toContain('Student name is required');\n      }\n    });\n\n    it('should reject name exceeding 100 characters', () => {\n      const invalidStudent = {\n        userId: '4201332',\n        name: 'A'.repeat(101),\n        grade: '3rd',\n      };\n\n      const result = insertStudentSchema.safeParse(invalidStudent);\n      expect(result.success).toBe(false);\n    });\n\n    it('should accept student with minimum required fields', () => {\n      const minStudent = {\n        userId: '4201332',\n        name: 'A',\n      };\n\n      const result = insertStudentSchema.safeParse(minStudent);\n      expect(result.success).toBe(true);\n    });\n\n    it('should handle empty IEP due date', () => {\n      const student = {\n        userId: '4201332',\n        name: 'Test Student',\n        iepDueDate: '',\n      };\n\n      const result = insertStudentSchema.safeParse(student);\n      expect(result.success).toBe(true);\n    });\n\n    it('should transform valid date string to Date object', () => {\n      const student = {\n        userId: '4201332',\n        name: 'Test Student',\n        iepDueDate: '2025-12-01',\n      };\n\n      const result = insertStudentSchema.safeParse(student);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.iepDueDate instanceof Date).toBe(true);\n      }\n    });\n\n    it('should reject or throw for invalid date format', () => {\n      const student = {\n        userId: '4201332',\n        name: 'Test Student',\n        iepDueDate: 'not-a-date',\n      };\n\n      try {\n        const result = insertStudentSchema.safeParse(student);\n        expect(result.success).toBe(false);\n      } catch (error) {\n        expect(error).toBeDefined();\n      }\n    });\n\n    it('should throw error for malformed date in transform', () => {\n      const student = {\n        userId: '4201332',\n        name: 'Test Student',\n        iepDueDate: 'invalid',\n      };\n\n      expect(() => insertStudentSchema.parse(student)).toThrow('Invalid date format');\n    });\n  });\n\n  describe('insertGoalSchema', () => {\n    it('should validate a valid goal', () => {\n      const validGoal = {\n        studentId: 1,\n        title: 'Test Goal',\n        description: 'Test description',\n        targetCriteria: '80% accuracy',\n        dataCollectionType: 'percentage',\n        status: 'active',\n      };\n\n      const result = insertGoalSchema.safeParse(validGoal);\n      expect(result.success).toBe(true);\n    });\n\n    it('should reject empty goal title', () => {\n      const invalidGoal = {\n        studentId: 1,\n        title: '',\n        description: 'Test description',\n      };\n\n      const result = insertGoalSchema.safeParse(invalidGoal);\n      expect(result.success).toBe(false);\n      if (!result.success) {\n        expect(result.error.errors[0].message).toContain('Goal title is required');\n      }\n    });\n\n    it('should reject empty goal description', () => {\n      const invalidGoal = {\n        studentId: 1,\n        title: 'Test Goal',\n        description: '',\n      };\n\n      const result = insertGoalSchema.safeParse(invalidGoal);\n      expect(result.success).toBe(false);\n    });\n\n    it('should accept maximum length title (200 chars)', () => {\n      const goal = {\n        studentId: 1,\n        title: boundaries.maxLengthTitle,\n        description: 'Test description',\n      };\n\n      const result = insertGoalSchema.safeParse(goal);\n      expect(result.success).toBe(true);\n    });\n\n    it('should reject title exceeding 200 characters', () => {\n      const goal = {\n        studentId: 1,\n        title: 'A'.repeat(201),\n        description: 'Test description',\n      };\n\n      const result = insertGoalSchema.safeParse(goal);\n      expect(result.success).toBe(false);\n    });\n\n    it('should accept maximum length description (2000 chars)', () => {\n      const goal = {\n        studentId: 1,\n        title: 'Test Goal',\n        description: boundaries.maxLengthDescription,\n      };\n\n      const result = insertGoalSchema.safeParse(goal);\n      expect(result.success).toBe(true);\n    });\n\n    it('should validate all data collection types', () => {\n      DATA_COLLECTION_TYPES.forEach((type) => {\n        const goal = {\n          studentId: 1,\n          title: 'Test Goal',\n          description: 'Test description',\n          dataCollectionType: type,\n        };\n\n        const result = insertGoalSchema.safeParse(goal);\n        expect(result.success).toBe(true);\n      });\n    });\n\n    it('should reject invalid data collection type', () => {\n      const goal = {\n        studentId: 1,\n        title: 'Test Goal',\n        description: 'Test description',\n        dataCollectionType: 'invalid',\n      };\n\n      const result = insertGoalSchema.safeParse(goal);\n      expect(result.success).toBe(false);\n    });\n\n    it('should validate all goal statuses', () => {\n      GOAL_STATUSES.forEach((status) => {\n        const goal = {\n          studentId: 1,\n          title: 'Test Goal',\n          description: 'Test description',\n          status,\n        };\n\n        const result = insertGoalSchema.safeParse(goal);\n        expect(result.success).toBe(true);\n      });\n    });\n\n    it('should handle empty frequencyDirection by converting to null', () => {\n      const goal = {\n        studentId: 1,\n        title: 'Test Goal',\n        description: 'Test description',\n        frequencyDirection: '',\n      };\n\n      const result = insertGoalSchema.safeParse(goal);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.frequencyDirection).toBeNull();\n      }\n    });\n\n    it('should accept valid frequency directions', () => {\n      FREQUENCY_DIRECTIONS.forEach((direction) => {\n        const goal = {\n          studentId: 1,\n          title: 'Test Goal',\n          description: 'Test description',\n          frequencyDirection: direction,\n        };\n\n        const result = insertGoalSchema.safeParse(goal);\n        expect(result.success).toBe(true);\n      });\n    });\n\n    it('should default dataCollectionType to percentage', () => {\n      const goal = {\n        studentId: 1,\n        title: 'Test Goal',\n        description: 'Test description',\n      };\n\n      const result = insertGoalSchema.safeParse(goal);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.dataCollectionType).toBe('percentage');\n      }\n    });\n\n    it('should default status to active', () => {\n      const goal = {\n        studentId: 1,\n        title: 'Test Goal',\n        description: 'Test description',\n      };\n\n      const result = insertGoalSchema.safeParse(goal);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.status).toBe('active');\n      }\n    });\n  });\n\n  describe('insertObjectiveSchema', () => {\n    it('should validate a valid objective', () => {\n      const validObjective = {\n        goalId: 1,\n        studentId: 1,\n        description: 'Test objective description',\n        targetCriteria: '80% accuracy',\n        status: 'active',\n      };\n\n      const result = insertObjectiveSchema.safeParse(validObjective);\n      expect(result.success).toBe(true);\n    });\n\n    it('should reject empty objective description', () => {\n      const invalidObjective = {\n        goalId: 1,\n        studentId: 1,\n        description: '',\n      };\n\n      const result = insertObjectiveSchema.safeParse(invalidObjective);\n      expect(result.success).toBe(false);\n    });\n\n    it('should allow optional title', () => {\n      const objective = {\n        goalId: 1,\n        studentId: 1,\n        description: 'Test description',\n        title: null,\n      };\n\n      const result = insertObjectiveSchema.safeParse(objective);\n      expect(result.success).toBe(true);\n    });\n\n    it('should handle empty target date', () => {\n      const objective = {\n        goalId: 1,\n        studentId: 1,\n        description: 'Test description',\n        targetDate: '',\n      };\n\n      const result = insertObjectiveSchema.safeParse(objective);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.targetDate).toBeUndefined();\n      }\n    });\n\n    it('should transform valid target date string to Date', () => {\n      const objective = {\n        goalId: 1,\n        studentId: 1,\n        description: 'Test description',\n        targetDate: '2025-12-01',\n      };\n\n      const result = insertObjectiveSchema.safeParse(objective);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.targetDate instanceof Date).toBe(true);\n      }\n    });\n  });\n\n  describe('insertDataPointSchema', () => {\n    it('should validate a valid data point', () => {\n      const validDataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75,\n        progressFormat: 'percentage',\n        numerator: 3,\n        denominator: 4,\n      };\n\n      const result = insertDataPointSchema.safeParse(validDataPoint);\n      expect(result.success).toBe(true);\n    });\n\n    it('should transform progressValue number to string', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75.5,\n        progressFormat: 'percentage',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(typeof result.data.progressValue).toBe('string');\n      }\n    });\n\n    it('should accept minimum progress value (-999)', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: boundaries.minProgressValue,\n        progressFormat: 'percentage',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(true);\n    });\n\n    it('should accept maximum progress value (999)', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: boundaries.maxProgressValue,\n        progressFormat: 'percentage',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(true);\n    });\n\n    it('should reject progress value below -999', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: -1000,\n        progressFormat: 'percentage',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(false);\n    });\n\n    it('should reject progress value above 999', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 1000,\n        progressFormat: 'percentage',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(false);\n    });\n\n    it('should validate all progress formats', () => {\n      PROGRESS_FORMATS.forEach((format) => {\n        const dataPoint = {\n          goalId: 1,\n          studentId: 1,\n          date: new Date(),\n          progressValue: 50,\n          progressFormat: format,\n        };\n\n        const result = insertDataPointSchema.safeParse(dataPoint);\n        expect(result.success).toBe(true);\n      });\n    });\n\n    it('should accept maximum numerator (9999)', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 100,\n        progressFormat: 'percentage',\n        numerator: boundaries.maxNumerator,\n        denominator: 10,\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(true);\n    });\n\n    it('should reject numerator above 9999', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 100,\n        progressFormat: 'percentage',\n        numerator: 10000,\n        denominator: 10,\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(false);\n    });\n\n    it('should reject negative numerator', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 100,\n        progressFormat: 'percentage',\n        numerator: -1,\n        denominator: 10,\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(false);\n    });\n\n    it('should reject denominator of 0', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 100,\n        progressFormat: 'percentage',\n        numerator: 5,\n        denominator: 0,\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(false);\n    });\n\n    it('should validate duration units', () => {\n      DURATION_UNITS.forEach((unit) => {\n        const dataPoint = {\n          goalId: 1,\n          studentId: 1,\n          date: new Date(),\n          progressValue: 5,\n          progressFormat: 'duration',\n          durationUnit: unit,\n        };\n\n        const result = insertDataPointSchema.safeParse(dataPoint);\n        expect(result.success).toBe(true);\n      });\n    });\n\n    it('should allow optional objectiveId', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75,\n        progressFormat: 'percentage',\n        objectiveId: null,\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(true);\n    });\n\n    it('should accept valid objectiveId', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75,\n        progressFormat: 'percentage',\n        objectiveId: 5,\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(true);\n    });\n\n    it('should enforce anecdotal info max length (2000)', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75,\n        progressFormat: 'percentage',\n        anecdotalInfo: 'A'.repeat(2001),\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(false);\n    });\n\n    it('should accept maximum anecdotal info length (2000)', () => {\n      const dataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75,\n        progressFormat: 'percentage',\n        anecdotalInfo: 'A'.repeat(2000),\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPoint);\n      expect(result.success).toBe(true);\n    });\n  });\n\n  describe('Enum Constants', () => {\n    it('should have correct data collection types', () => {\n      expect(DATA_COLLECTION_TYPES).toEqual(['percentage', 'frequency', 'duration']);\n    });\n\n    it('should have correct goal statuses', () => {\n      expect(GOAL_STATUSES).toEqual(['active', 'mastered', 'discontinued']);\n    });\n\n    it('should have correct frequency directions', () => {\n      expect(FREQUENCY_DIRECTIONS).toEqual(['increase', 'decrease']);\n    });\n\n    it('should have correct progress formats', () => {\n      expect(PROGRESS_FORMATS).toEqual(['percentage', 'fraction', 'frequency', 'duration']);\n    });\n\n    it('should have correct duration units', () => {\n      expect(DURATION_UNITS).toEqual(['seconds', 'minutes']);\n    });\n  });\n});\n","path":null,"size_bytes":16701,"size_tokens":null},"tests/factories.ts":{"content":"let idCounter = 1;\n\nexport function resetIdCounter() {\n  idCounter = 1;\n}\n\nexport function generateId(): number {\n  return idCounter++;\n}\n\nexport function createStudentFactory(count: number, userId: string = '4201332') {\n  return Array.from({ length: count }, (_, i) => ({\n    id: generateId(),\n    userId,\n    name: `Student ${i + 1}`,\n    grade: `${(i % 12) + 1}${['st', 'nd', 'rd'][i % 3] || 'th'}`,\n    iepDueDate: new Date(Date.now() + (i * 30 * 24 * 60 * 60 * 1000)),\n    relatedServices: i % 2 === 0 ? 'Speech Therapy' : null,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  }));\n}\n\nexport function createGoalFactory(count: number, studentId: number) {\n  const dataTypes = ['percentage', 'frequency', 'duration'] as const;\n  const statuses = ['active', 'mastered', 'discontinued'] as const;\n  \n  return Array.from({ length: count }, (_, i) => ({\n    id: generateId(),\n    studentId,\n    title: `Goal ${i + 1}`,\n    description: `Description for goal ${i + 1}`,\n    targetCriteria: '80% accuracy over 4/5 trials',\n    levelOfSupport: JSON.stringify(['verbal', 'visual']),\n    dataCollectionType: dataTypes[i % 3],\n    frequencyDirection: dataTypes[i % 3] === 'frequency' ? 'increase' : null,\n    status: statuses[i % 3],\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  }));\n}\n\nexport function createObjectiveFactory(count: number, goalId: number, studentId: number) {\n  const statuses = ['active', 'mastered', 'discontinued'] as const;\n  \n  return Array.from({ length: count }, (_, i) => ({\n    id: generateId(),\n    goalId,\n    studentId,\n    title: null,\n    description: `Objective ${i + 1} description`,\n    targetCriteria: '80% accuracy',\n    targetDate: i % 2 === 0 ? new Date(Date.now() + (30 * 24 * 60 * 60 * 1000)) : null,\n    status: statuses[i % 3],\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  }));\n}\n\nexport function createDataPointFactory(\n  count: number, \n  goalId: number, \n  studentId: number,\n  options: {\n    progressFormat?: 'percentage' | 'frequency' | 'duration';\n    objectiveId?: number | null;\n    dateSpread?: number;\n  } = {}\n) {\n  const { \n    progressFormat = 'percentage', \n    objectiveId = null,\n    dateSpread = 1\n  } = options;\n  \n  return Array.from({ length: count }, (_, i) => {\n    let progressValue: string;\n    let numerator: number | null = null;\n    let denominator: number | null = null;\n    \n    if (progressFormat === 'percentage') {\n      progressValue = (50 + (i * 5) % 50).toFixed(2);\n      numerator = Math.floor(Math.random() * 10);\n      denominator = 10;\n    } else if (progressFormat === 'frequency') {\n      progressValue = (i + 1).toString();\n    } else {\n      progressValue = ((i + 1) * 5).toFixed(2);\n    }\n    \n    return {\n      id: generateId(),\n      goalId,\n      objectiveId,\n      studentId,\n      date: new Date(Date.now() - (i * dateSpread * 24 * 60 * 60 * 1000)),\n      progressValue,\n      progressFormat,\n      numerator,\n      denominator,\n      durationUnit: progressFormat === 'duration' ? 'minutes' : null,\n      levelOfSupport: JSON.stringify(['verbal']),\n      setting: JSON.stringify(['general-education']),\n      anecdotalInfo: `Data point ${i + 1} notes`,\n      createdAt: new Date(),\n    };\n  });\n}\n\nexport function createMaxLoadDataset() {\n  resetIdCounter();\n  \n  const students = createStudentFactory(50);\n  const goals: ReturnType<typeof createGoalFactory> = [];\n  const objectives: ReturnType<typeof createObjectiveFactory> = [];\n  const dataPoints: ReturnType<typeof createDataPointFactory> = [];\n  \n  students.forEach(student => {\n    const studentGoals = createGoalFactory(15, student.id);\n    goals.push(...studentGoals);\n    \n    studentGoals.forEach(goal => {\n      const goalObjectives = createObjectiveFactory(10, goal.id, student.id);\n      objectives.push(...goalObjectives);\n      \n      const goalDataPoints = createDataPointFactory(100, goal.id, student.id, {\n        progressFormat: goal.dataCollectionType as 'percentage' | 'frequency' | 'duration',\n      });\n      dataPoints.push(...goalDataPoints);\n    });\n  });\n  \n  return { students, goals, objectives, dataPoints };\n}\n\nexport function createEmptyDataset() {\n  return {\n    students: [],\n    goals: [],\n    objectives: [],\n    dataPoints: [],\n  };\n}\n\nexport function createBoundaryValues() {\n  return {\n    maxLengthTitle: 'A'.repeat(200),\n    maxLengthDescription: 'B'.repeat(2000),\n    maxLengthTargetCriteria: 'C'.repeat(500),\n    minProgressValue: -999,\n    maxProgressValue: 999,\n    maxNumerator: 9999,\n    maxDenominator: 9999,\n    emptyString: '',\n    nullValue: null,\n    undefinedValue: undefined,\n  };\n}\n","path":null,"size_bytes":4605,"size_tokens":null},"tests/routes/routes.test.ts":{"content":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { \n  createMockStudent, \n  createMockGoal, \n  createMockDataPoint,\n} from '../setup';\nimport {\n  createBoundaryValues,\n  resetIdCounter,\n  createStudentFactory,\n  createGoalFactory,\n  createDataPointFactory,\n} from '../factories';\nimport {\n  insertStudentSchema,\n  insertGoalSchema,\n  insertDataPointSchema,\n} from '../../shared/schema';\n\ndescribe('API Route Data Validation', () => {\n  const boundaries = createBoundaryValues();\n\n  beforeEach(() => {\n    resetIdCounter();\n  });\n\n  describe('Student Creation Validation', () => {\n    it('should validate student with all fields', () => {\n      const studentData = {\n        userId: '4201332',\n        name: 'Test Student',\n        grade: '3rd',\n        iepDueDate: '2025-12-01',\n        relatedServices: 'Speech Therapy',\n      };\n\n      const result = insertStudentSchema.safeParse(studentData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should validate student with minimum fields', () => {\n      const studentData = {\n        userId: '4201332',\n        name: 'A',\n      };\n\n      const result = insertStudentSchema.safeParse(studentData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should reject empty request body', () => {\n      const result = insertStudentSchema.safeParse({});\n      expect(result.success).toBe(false);\n    });\n\n    it('should reject null name', () => {\n      const result = insertStudentSchema.safeParse({\n        userId: '4201332',\n        name: null,\n      });\n      expect(result.success).toBe(false);\n    });\n\n    it('should handle maximum student load', () => {\n      const students = createStudentFactory(100);\n      \n      students.forEach(student => {\n        const result = insertStudentSchema.safeParse({\n          userId: student.userId,\n          name: student.name,\n          grade: student.grade,\n        });\n        expect(result.success).toBe(true);\n      });\n    });\n  });\n\n  describe('Goal Creation Validation', () => {\n    it('should validate goal with all fields', () => {\n      const goalData = {\n        studentId: 1,\n        title: 'Math Skills',\n        description: 'Student will improve math problem-solving skills',\n        targetCriteria: '80% accuracy over 4/5 trials',\n        dataCollectionType: 'percentage',\n        frequencyDirection: null,\n        status: 'active',\n      };\n\n      const result = insertGoalSchema.safeParse(goalData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should validate goal with minimum fields', () => {\n      const goalData = {\n        studentId: 1,\n        title: 'A',\n        description: 'B',\n      };\n\n      const result = insertGoalSchema.safeParse(goalData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should reject goal without studentId', () => {\n      const goalData = {\n        title: 'Test Goal',\n        description: 'Description',\n      };\n\n      const result = insertGoalSchema.safeParse(goalData);\n      expect(result.success).toBe(false);\n    });\n\n    it('should validate all data collection types', () => {\n      const types = ['percentage', 'frequency', 'duration'];\n      \n      types.forEach(type => {\n        const goalData = {\n          studentId: 1,\n          title: `${type} Goal`,\n          description: 'Description',\n          dataCollectionType: type,\n        };\n\n        const result = insertGoalSchema.safeParse(goalData);\n        expect(result.success).toBe(true);\n      });\n    });\n\n    it('should handle frequency goals with direction', () => {\n      const goalData = {\n        studentId: 1,\n        title: 'Frequency Goal',\n        description: 'Description',\n        dataCollectionType: 'frequency',\n        frequencyDirection: 'increase',\n      };\n\n      const result = insertGoalSchema.safeParse(goalData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should convert empty frequencyDirection to null', () => {\n      const goalData = {\n        studentId: 1,\n        title: 'Percentage Goal',\n        description: 'Description',\n        dataCollectionType: 'percentage',\n        frequencyDirection: '',\n      };\n\n      const result = insertGoalSchema.safeParse(goalData);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(result.data.frequencyDirection).toBeNull();\n      }\n    });\n\n    it('should handle maximum goals per student', () => {\n      const goals = createGoalFactory(15, 1);\n      \n      goals.forEach(goal => {\n        const result = insertGoalSchema.safeParse({\n          studentId: goal.studentId,\n          title: goal.title,\n          description: goal.description,\n          dataCollectionType: goal.dataCollectionType,\n        });\n        expect(result.success).toBe(true);\n      });\n    });\n\n    it('should validate boundary title length (200 chars)', () => {\n      const goalData = {\n        studentId: 1,\n        title: boundaries.maxLengthTitle,\n        description: 'Description',\n      };\n\n      const result = insertGoalSchema.safeParse(goalData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should reject title exceeding 200 chars', () => {\n      const goalData = {\n        studentId: 1,\n        title: 'A'.repeat(201),\n        description: 'Description',\n      };\n\n      const result = insertGoalSchema.safeParse(goalData);\n      expect(result.success).toBe(false);\n    });\n\n    it('should validate boundary description length (2000 chars)', () => {\n      const goalData = {\n        studentId: 1,\n        title: 'Goal',\n        description: boundaries.maxLengthDescription,\n      };\n\n      const result = insertGoalSchema.safeParse(goalData);\n      expect(result.success).toBe(true);\n    });\n  });\n\n  describe('Data Point Creation Validation', () => {\n    it('should validate data point with all fields', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75,\n        progressFormat: 'percentage',\n        numerator: 3,\n        denominator: 4,\n        levelOfSupport: '[\"verbal\"]',\n        setting: '[\"general-education\"]',\n        anecdotalInfo: 'Test notes',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should validate data point with minimum fields', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 50,\n        progressFormat: 'percentage',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should transform progressValue to string', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75.5,\n        progressFormat: 'percentage',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(true);\n      if (result.success) {\n        expect(typeof result.data.progressValue).toBe('string');\n        expect(result.data.progressValue).toBe('75.5');\n      }\n    });\n\n    it('should reject progress value above maximum (999)', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 1000,\n        progressFormat: 'percentage',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(false);\n    });\n\n    it('should reject progress value below minimum (-999)', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: -1000,\n        progressFormat: 'percentage',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(false);\n    });\n\n    it('should accept boundary progress values', () => {\n      const minDataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: -999,\n        progressFormat: 'frequency',\n      };\n\n      const maxDataPoint = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 999,\n        progressFormat: 'frequency',\n      };\n\n      expect(insertDataPointSchema.safeParse(minDataPoint).success).toBe(true);\n      expect(insertDataPointSchema.safeParse(maxDataPoint).success).toBe(true);\n    });\n\n    it('should validate all progress formats', () => {\n      const formats = ['percentage', 'fraction', 'frequency', 'duration'];\n      \n      formats.forEach(format => {\n        const dataPointData = {\n          goalId: 1,\n          studentId: 1,\n          date: new Date(),\n          progressValue: 50,\n          progressFormat: format,\n        };\n\n        const result = insertDataPointSchema.safeParse(dataPointData);\n        expect(result.success).toBe(true);\n      });\n    });\n\n    it('should reject invalid progress format', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 50,\n        progressFormat: 'invalid',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(false);\n    });\n\n    it('should reject negative numerator', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 50,\n        progressFormat: 'percentage',\n        numerator: -1,\n        denominator: 10,\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(false);\n    });\n\n    it('should reject zero denominator', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 50,\n        progressFormat: 'percentage',\n        numerator: 5,\n        denominator: 0,\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(false);\n    });\n\n    it('should accept maximum numerator (9999)', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 100,\n        progressFormat: 'percentage',\n        numerator: 9999,\n        denominator: 9999,\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should reject numerator above maximum', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 100,\n        progressFormat: 'percentage',\n        numerator: 10000,\n        denominator: 10,\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(false);\n    });\n\n    it('should validate duration units', () => {\n      const units = ['seconds', 'minutes'];\n      \n      units.forEach(unit => {\n        const dataPointData = {\n          goalId: 1,\n          studentId: 1,\n          date: new Date(),\n          progressValue: 5,\n          progressFormat: 'duration',\n          durationUnit: unit,\n        };\n\n        const result = insertDataPointSchema.safeParse(dataPointData);\n        expect(result.success).toBe(true);\n      });\n    });\n\n    it('should reject invalid duration unit', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 5,\n        progressFormat: 'duration',\n        durationUnit: 'hours',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(false);\n    });\n\n    it('should handle optional objectiveId', () => {\n      const withObjective = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75,\n        progressFormat: 'percentage',\n        objectiveId: 5,\n      };\n\n      const withoutObjective = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75,\n        progressFormat: 'percentage',\n        objectiveId: null,\n      };\n\n      expect(insertDataPointSchema.safeParse(withObjective).success).toBe(true);\n      expect(insertDataPointSchema.safeParse(withoutObjective).success).toBe(true);\n    });\n\n    it('should enforce anecdotal info max length', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75,\n        progressFormat: 'percentage',\n        anecdotalInfo: 'A'.repeat(2001),\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(false);\n    });\n\n    it('should accept maximum anecdotal info length (2000)', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75,\n        progressFormat: 'percentage',\n        anecdotalInfo: 'A'.repeat(2000),\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should handle maximum data points load', () => {\n      const dataPoints = createDataPointFactory(100, 1, 1);\n      \n      dataPoints.forEach(dp => {\n        const result = insertDataPointSchema.safeParse({\n          goalId: dp.goalId,\n          studentId: dp.studentId,\n          date: dp.date,\n          progressValue: parseFloat(dp.progressValue),\n          progressFormat: dp.progressFormat,\n        });\n        expect(result.success).toBe(true);\n      });\n    });\n  });\n\n  describe('Edge Cases', () => {\n    it('should handle special characters in text fields', () => {\n      const goalData = {\n        studentId: 1,\n        title: \"Student's Goal: \\\"Literacy\\\" & Math <100%>\",\n        description: \"Description with 'quotes' and \\\"double quotes\\\" & symbols\",\n      };\n\n      const result = insertGoalSchema.safeParse(goalData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should handle unicode characters', () => {\n      const studentData = {\n        userId: '4201332',\n        name: 'JosÃ© GarcÃ­a-LÃ³pez',\n      };\n\n      const result = insertStudentSchema.safeParse(studentData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should handle emoji in text fields', () => {\n      const goalData = {\n        studentId: 1,\n        title: 'Reading Goals ðŸ“š',\n        description: 'Student will read books ðŸ“–',\n      };\n\n      const result = insertGoalSchema.safeParse(goalData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should handle whitespace-only strings', () => {\n      const studentData = {\n        userId: '4201332',\n        name: '   ',\n      };\n\n      const result = insertStudentSchema.safeParse(studentData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should handle zero values correctly', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 0,\n        progressFormat: 'percentage',\n        numerator: 0,\n        denominator: 10,\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should handle decimal progress values', () => {\n      const dataPointData = {\n        goalId: 1,\n        studentId: 1,\n        date: new Date(),\n        progressValue: 75.333333,\n        progressFormat: 'percentage',\n      };\n\n      const result = insertDataPointSchema.safeParse(dataPointData);\n      expect(result.success).toBe(true);\n    });\n  });\n\n  describe('Empty Data Scenarios', () => {\n    it('should reject completely empty objects', () => {\n      expect(insertStudentSchema.safeParse({}).success).toBe(false);\n      expect(insertGoalSchema.safeParse({}).success).toBe(false);\n      expect(insertDataPointSchema.safeParse({}).success).toBe(false);\n    });\n\n    it('should handle null values appropriately', () => {\n      const goalData = {\n        studentId: 1,\n        title: 'Goal',\n        description: 'Description',\n        targetCriteria: null,\n        levelOfSupport: null,\n        frequencyDirection: null,\n      };\n\n      const result = insertGoalSchema.safeParse(goalData);\n      expect(result.success).toBe(true);\n    });\n\n    it('should handle undefined values appropriately', () => {\n      const studentData = {\n        userId: '4201332',\n        name: 'Student',\n        grade: undefined,\n        iepDueDate: undefined,\n        relatedServices: undefined,\n      };\n\n      const result = insertStudentSchema.safeParse(studentData);\n      expect(result.success).toBe(true);\n    });\n  });\n});\n","path":null,"size_bytes":16631,"size_tokens":null},"tests/storage/storage.test.ts":{"content":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\nimport { \n  createMockStudent, \n  createMockGoal, \n  createMockObjective, \n  createMockDataPoint,\n  createMockUser,\n  createMockReportingPeriod,\n} from '../setup';\nimport {\n  createStudentFactory,\n  createGoalFactory,\n  createObjectiveFactory,\n  createDataPointFactory,\n  createMaxLoadDataset,\n  createEmptyDataset,\n  resetIdCounter,\n} from '../factories';\n\nconst mockQueryResult = vi.fn();\n\nvi.mock('../../server/db', () => ({\n  db: {\n    select: vi.fn(() => ({\n      from: vi.fn(() => ({\n        where: vi.fn(() => ({\n          orderBy: vi.fn(() => mockQueryResult()),\n          limit: vi.fn(() => ({\n            offset: vi.fn(() => mockQueryResult()),\n          })),\n        })),\n        leftJoin: vi.fn(() => ({\n          where: vi.fn(() => mockQueryResult()),\n        })),\n        orderBy: vi.fn(() => mockQueryResult()),\n      })),\n    })),\n    insert: vi.fn(() => ({\n      values: vi.fn(() => ({\n        returning: vi.fn(() => mockQueryResult()),\n      })),\n    })),\n    update: vi.fn(() => ({\n      set: vi.fn(() => ({\n        where: vi.fn(() => ({\n          returning: vi.fn(() => mockQueryResult()),\n        })),\n      })),\n    })),\n    delete: vi.fn(() => ({\n      where: vi.fn(() => ({\n        returning: vi.fn(() => mockQueryResult()),\n      })),\n    })),\n  },\n}));\n\ndescribe('Storage Functions', () => {\n  beforeEach(() => {\n    resetIdCounter();\n    mockQueryResult.mockReset();\n  });\n\n  afterEach(() => {\n    vi.clearAllMocks();\n  });\n\n  describe('Student Operations', () => {\n    describe('Empty Data Scenarios', () => {\n      it('should return empty array when no students exist', async () => {\n        mockQueryResult.mockResolvedValue([]);\n        \n        const { students } = createEmptyDataset();\n        expect(students).toEqual([]);\n        expect(students.length).toBe(0);\n      });\n\n      it('should handle student with minimal required fields', () => {\n        const minimalStudent = {\n          userId: '4201332',\n          name: 'A',\n        };\n        \n        expect(minimalStudent.name.length).toBeGreaterThanOrEqual(1);\n        expect(minimalStudent.userId).toBeDefined();\n      });\n    });\n\n    describe('Maximum Load Scenarios', () => {\n      it('should handle 50 students', () => {\n        const students = createStudentFactory(50);\n        \n        expect(students.length).toBe(50);\n        students.forEach((student, index) => {\n          expect(student.name).toBe(`Student ${index + 1}`);\n          expect(student.userId).toBe('4201332');\n        });\n      });\n\n      it('should generate unique IDs for all students', () => {\n        resetIdCounter();\n        const students = createStudentFactory(100);\n        const ids = students.map(s => s.id);\n        const uniqueIds = new Set(ids);\n        \n        expect(uniqueIds.size).toBe(students.length);\n      });\n    });\n\n    describe('Data Integrity', () => {\n      it('should maintain correct user ownership', () => {\n        const userId = 'test-user-123';\n        const students = createStudentFactory(5, userId);\n        \n        students.forEach(student => {\n          expect(student.userId).toBe(userId);\n        });\n      });\n\n      it('should handle various grade formats', () => {\n        const students = createStudentFactory(12);\n        \n        students.forEach(student => {\n          expect(student.grade).toMatch(/^\\d+(st|nd|rd|th)$/);\n        });\n      });\n    });\n  });\n\n  describe('Goal Operations', () => {\n    describe('Empty Data Scenarios', () => {\n      it('should return empty array when no goals exist for student', () => {\n        const { goals } = createEmptyDataset();\n        expect(goals).toEqual([]);\n      });\n    });\n\n    describe('Maximum Load Scenarios', () => {\n      it('should handle 15 goals per student (maximum allowed)', () => {\n        const goals = createGoalFactory(15, 1);\n        \n        expect(goals.length).toBe(15);\n        goals.forEach(goal => {\n          expect(goal.studentId).toBe(1);\n        });\n      });\n\n      it('should distribute data collection types correctly', () => {\n        const goals = createGoalFactory(9, 1);\n        \n        const percentageGoals = goals.filter(g => g.dataCollectionType === 'percentage');\n        const frequencyGoals = goals.filter(g => g.dataCollectionType === 'frequency');\n        const durationGoals = goals.filter(g => g.dataCollectionType === 'duration');\n        \n        expect(percentageGoals.length).toBe(3);\n        expect(frequencyGoals.length).toBe(3);\n        expect(durationGoals.length).toBe(3);\n      });\n\n      it('should set frequencyDirection only for frequency goals', () => {\n        const goals = createGoalFactory(9, 1);\n        \n        goals.forEach(goal => {\n          if (goal.dataCollectionType === 'frequency') {\n            expect(goal.frequencyDirection).toBe('increase');\n          } else {\n            expect(goal.frequencyDirection).toBeNull();\n          }\n        });\n      });\n    });\n\n    describe('Status Validation', () => {\n      it('should distribute statuses correctly', () => {\n        const goals = createGoalFactory(9, 1);\n        \n        const activeGoals = goals.filter(g => g.status === 'active');\n        const masteredGoals = goals.filter(g => g.status === 'mastered');\n        const discontinuedGoals = goals.filter(g => g.status === 'discontinued');\n        \n        expect(activeGoals.length).toBe(3);\n        expect(masteredGoals.length).toBe(3);\n        expect(discontinuedGoals.length).toBe(3);\n      });\n    });\n\n    describe('Level of Support Validation', () => {\n      it('should store level of support as valid JSON', () => {\n        const goal = createMockGoal();\n        \n        expect(() => JSON.parse(goal.levelOfSupport!)).not.toThrow();\n        const parsed = JSON.parse(goal.levelOfSupport!);\n        expect(Array.isArray(parsed)).toBe(true);\n      });\n    });\n  });\n\n  describe('Objective Operations', () => {\n    describe('Empty Data Scenarios', () => {\n      it('should return empty array when no objectives exist', () => {\n        const { objectives } = createEmptyDataset();\n        expect(objectives).toEqual([]);\n      });\n    });\n\n    describe('Maximum Load Scenarios', () => {\n      it('should handle 10 objectives per goal (maximum allowed)', () => {\n        const objectives = createObjectiveFactory(10, 1, 1);\n        \n        expect(objectives.length).toBe(10);\n        objectives.forEach(obj => {\n          expect(obj.goalId).toBe(1);\n          expect(obj.studentId).toBe(1);\n        });\n      });\n    });\n\n    describe('Target Date Handling', () => {\n      it('should set target date for some objectives', () => {\n        const objectives = createObjectiveFactory(4, 1, 1);\n        \n        const withDate = objectives.filter(o => o.targetDate !== null);\n        const withoutDate = objectives.filter(o => o.targetDate === null);\n        \n        expect(withDate.length).toBe(2);\n        expect(withoutDate.length).toBe(2);\n      });\n    });\n  });\n\n  describe('Data Point Operations', () => {\n    describe('Empty Data Scenarios', () => {\n      it('should return empty array when no data points exist', () => {\n        const { dataPoints } = createEmptyDataset();\n        expect(dataPoints).toEqual([]);\n      });\n\n      it('should handle goal with no data points', async () => {\n        mockQueryResult.mockResolvedValue([]);\n        \n        const goal = createMockGoal();\n        const dataPoints: any[] = [];\n        \n        expect(dataPoints.length).toBe(0);\n      });\n    });\n\n    describe('Maximum Load Scenarios', () => {\n      it('should handle 100 data points per goal', () => {\n        const dataPoints = createDataPointFactory(100, 1, 1);\n        \n        expect(dataPoints.length).toBe(100);\n        dataPoints.forEach(dp => {\n          expect(dp.goalId).toBe(1);\n          expect(dp.studentId).toBe(1);\n        });\n      });\n\n      it('should generate unique IDs for all data points', () => {\n        resetIdCounter();\n        const dataPoints = createDataPointFactory(200, 1, 1);\n        const ids = dataPoints.map(dp => dp.id);\n        const uniqueIds = new Set(ids);\n        \n        expect(uniqueIds.size).toBe(dataPoints.length);\n      });\n\n      it('should handle full dataset load', () => {\n        const { students, goals, objectives, dataPoints } = createMaxLoadDataset();\n        \n        expect(students.length).toBe(50);\n        expect(goals.length).toBe(50 * 15);\n        expect(objectives.length).toBe(50 * 15 * 10);\n        expect(dataPoints.length).toBe(50 * 15 * 100);\n      });\n    });\n\n    describe('Progress Format Validation', () => {\n      it('should handle percentage format correctly', () => {\n        const dataPoints = createDataPointFactory(10, 1, 1, { \n          progressFormat: 'percentage' \n        });\n        \n        dataPoints.forEach(dp => {\n          expect(dp.progressFormat).toBe('percentage');\n          const value = parseFloat(dp.progressValue);\n          expect(value).toBeGreaterThanOrEqual(0);\n          expect(value).toBeLessThanOrEqual(100);\n        });\n      });\n\n      it('should handle frequency format correctly', () => {\n        const dataPoints = createDataPointFactory(10, 1, 1, { \n          progressFormat: 'frequency' \n        });\n        \n        dataPoints.forEach(dp => {\n          expect(dp.progressFormat).toBe('frequency');\n          const value = parseInt(dp.progressValue);\n          expect(Number.isInteger(value)).toBe(true);\n        });\n      });\n\n      it('should handle duration format correctly', () => {\n        const dataPoints = createDataPointFactory(10, 1, 1, { \n          progressFormat: 'duration' \n        });\n        \n        dataPoints.forEach(dp => {\n          expect(dp.progressFormat).toBe('duration');\n          expect(dp.durationUnit).toBe('minutes');\n        });\n      });\n    });\n\n    describe('Objective Association', () => {\n      it('should allow data points without objective', () => {\n        const dp = createMockDataPoint({ objectiveId: null });\n        expect(dp.objectiveId).toBeNull();\n      });\n\n      it('should allow data points with objective', () => {\n        const dataPoints = createDataPointFactory(5, 1, 1, { \n          objectiveId: 5 \n        });\n        \n        dataPoints.forEach(dp => {\n          expect(dp.objectiveId).toBe(5);\n        });\n      });\n    });\n\n    describe('Date Handling', () => {\n      it('should spread dates correctly', () => {\n        const dataPoints = createDataPointFactory(10, 1, 1, { \n          dateSpread: 1 \n        });\n        \n        const dates = dataPoints.map(dp => dp.date.getTime());\n        const uniqueDates = new Set(dates);\n        \n        expect(uniqueDates.size).toBe(10);\n      });\n\n      it('should order dates from newest to oldest', () => {\n        const dataPoints = createDataPointFactory(5, 1, 1, { \n          dateSpread: 1 \n        });\n        \n        for (let i = 0; i < dataPoints.length - 1; i++) {\n          expect(dataPoints[i].date.getTime()).toBeGreaterThanOrEqual(\n            dataPoints[i + 1].date.getTime()\n          );\n        }\n      });\n    });\n\n    describe('JSON Field Validation', () => {\n      it('should store levelOfSupport as valid JSON', () => {\n        const dp = createMockDataPoint();\n        \n        expect(() => JSON.parse(dp.levelOfSupport!)).not.toThrow();\n        const parsed = JSON.parse(dp.levelOfSupport!);\n        expect(Array.isArray(parsed)).toBe(true);\n      });\n\n      it('should store setting as valid JSON', () => {\n        const dp = createMockDataPoint();\n        \n        expect(() => JSON.parse(dp.setting!)).not.toThrow();\n        const parsed = JSON.parse(dp.setting!);\n        expect(Array.isArray(parsed)).toBe(true);\n      });\n    });\n  });\n\n  describe('Reporting Period Operations', () => {\n    describe('Empty Data Scenarios', () => {\n      it('should handle missing reporting periods', () => {\n        const reportingPeriod = null;\n        expect(reportingPeriod).toBeNull();\n      });\n    });\n\n    describe('Data Validation', () => {\n      it('should store period data as valid JSON', () => {\n        const rp = createMockReportingPeriod();\n        \n        expect(() => JSON.parse(rp.periodData)).not.toThrow();\n        const parsed = JSON.parse(rp.periodData);\n        expect(parsed.periods).toBeDefined();\n        expect(parsed.periodLength).toBeDefined();\n      });\n\n      it('should maintain user ownership', () => {\n        const rp = createMockReportingPeriod({ userId: 'test-user' });\n        expect(rp.userId).toBe('test-user');\n      });\n    });\n  });\n\n  describe('Analytics Functions', () => {\n    describe('Progress Calculation', () => {\n      it('should calculate average from data points', () => {\n        const dataPoints = createDataPointFactory(5, 1, 1, { \n          progressFormat: 'percentage' \n        });\n        \n        const values = dataPoints.map(dp => parseFloat(dp.progressValue));\n        const average = values.reduce((a, b) => a + b, 0) / values.length;\n        \n        expect(average).toBeGreaterThanOrEqual(0);\n        expect(average).toBeLessThanOrEqual(100);\n      });\n\n      it('should handle empty data points for average', () => {\n        const dataPoints: any[] = [];\n        \n        if (dataPoints.length === 0) {\n          expect(dataPoints.length).toBe(0);\n        }\n      });\n    });\n\n    describe('Trend Detection', () => {\n      it('should detect increasing trend', () => {\n        const dataPoints = [\n          { progressValue: '50' },\n          { progressValue: '60' },\n          { progressValue: '70' },\n          { progressValue: '80' },\n        ];\n        \n        const values = dataPoints.map(dp => parseFloat(dp.progressValue));\n        const isIncreasing = values.every((val, i, arr) => \n          i === 0 || val >= arr[i - 1]\n        );\n        \n        expect(isIncreasing).toBe(true);\n      });\n\n      it('should detect decreasing trend', () => {\n        const dataPoints = [\n          { progressValue: '80' },\n          { progressValue: '70' },\n          { progressValue: '60' },\n          { progressValue: '50' },\n        ];\n        \n        const values = dataPoints.map(dp => parseFloat(dp.progressValue));\n        const isDecreasing = values.every((val, i, arr) => \n          i === 0 || val <= arr[i - 1]\n        );\n        \n        expect(isDecreasing).toBe(true);\n      });\n    });\n  });\n\n  describe('Edge Cases', () => {\n    it('should handle special characters in text fields', () => {\n      const goal = createMockGoal({\n        title: \"Student's Goal: \\\"Literacy\\\" & Math <100%>\",\n        description: \"Description with 'quotes' and \\\"double quotes\\\"\",\n      });\n      \n      expect(goal.title).toContain(\"'\");\n      expect(goal.title).toContain('\"');\n      expect(goal.description).toContain(\"'\");\n    });\n\n    it('should handle unicode characters', () => {\n      const goal = createMockGoal({\n        title: 'Goal with Ã©mojis ðŸ“š and Ã¼Ã±Ã­Ã§Ã¶dÃ©',\n      });\n      \n      expect(goal.title).toContain('ðŸ“š');\n      expect(goal.title).toContain('Ã¼');\n    });\n\n    it('should handle null vs undefined correctly', () => {\n      const goal = createMockGoal({\n        frequencyDirection: null,\n        targetCriteria: undefined,\n      });\n      \n      expect(goal.frequencyDirection).toBeNull();\n    });\n\n    it('should handle boundary date values', () => {\n      const farFutureDate = new Date('2100-12-31');\n      const farPastDate = new Date('1900-01-01');\n      \n      const futureDp = createMockDataPoint({ date: farFutureDate });\n      const pastDp = createMockDataPoint({ date: farPastDate });\n      \n      expect(futureDp.date.getFullYear()).toBe(2100);\n      expect(pastDp.date.getFullYear()).toBe(1900);\n    });\n\n    it('should handle decimal precision in progress values', () => {\n      const dp = createMockDataPoint({ progressValue: '75.99' });\n      \n      const value = parseFloat(dp.progressValue);\n      expect(value).toBe(75.99);\n      expect(dp.progressValue).toBe('75.99');\n    });\n  });\n\n  describe('Pagination Operations', () => {\n    it('should calculate correct pagination parameters', () => {\n      const page = 2;\n      const limit = 25;\n      const offset = (page - 1) * limit;\n      \n      expect(offset).toBe(25);\n    });\n\n    it('should handle page 1 with zero offset', () => {\n      const page = 1;\n      const limit = 50;\n      const offset = (page - 1) * limit;\n      \n      expect(offset).toBe(0);\n    });\n\n    it('should calculate correct total pages', () => {\n      const total = 127;\n      const limit = 50;\n      const totalPages = Math.ceil(total / limit);\n      \n      expect(totalPages).toBe(3);\n    });\n\n    it('should enforce maximum page size limit', () => {\n      const requestedLimit = 500;\n      const maxLimit = 100;\n      const enforcedLimit = Math.min(requestedLimit, maxLimit);\n      \n      expect(enforcedLimit).toBe(100);\n    });\n\n    it('should enforce minimum page size limit', () => {\n      const requestedLimit = 0;\n      const minLimit = 1;\n      const enforcedLimit = Math.max(requestedLimit, minLimit);\n      \n      expect(enforcedLimit).toBe(1);\n    });\n\n    it('should return correct pagination metadata', () => {\n      const dataPoints = Array.from({ length: 10 }, (_, i) => \n        createMockDataPoint({ id: i + 1 })\n      );\n      \n      const total = 127;\n      const page = 2;\n      const limit = 10;\n      const totalPages = Math.ceil(total / limit);\n      \n      const response = {\n        data: dataPoints,\n        total,\n        page,\n        limit,\n        totalPages\n      };\n      \n      expect(response.data.length).toBe(10);\n      expect(response.total).toBe(127);\n      expect(response.page).toBe(2);\n      expect(response.limit).toBe(10);\n      expect(response.totalPages).toBe(13);\n    });\n  });\n\n  describe('Batch Operations', () => {\n    it('should validate batch size limits', () => {\n      const maxBatchSize = 100;\n      const validBatch = 50;\n      const invalidBatch = 150;\n      \n      expect(validBatch <= maxBatchSize).toBe(true);\n      expect(invalidBatch <= maxBatchSize).toBe(false);\n    });\n\n    it('should handle empty batch gracefully', () => {\n      const emptyBatch: any[] = [];\n      \n      expect(emptyBatch.length).toBe(0);\n    });\n\n    it('should create multiple data points in batch', () => {\n      const dataPointsToCreate = Array.from({ length: 5 }, (_, i) => \n        createMockDataPoint({ \n          id: i + 1, \n          goalId: 1, \n          studentId: 1,\n          progressValue: `${(i + 1) * 20}` \n        })\n      );\n      \n      expect(dataPointsToCreate.length).toBe(5);\n      expect(dataPointsToCreate[0].progressValue).toBe('20');\n      expect(dataPointsToCreate[4].progressValue).toBe('100');\n    });\n\n    it('should validate all data points before batch insert', () => {\n      const validDataPoint = createMockDataPoint({\n        goalId: 1,\n        studentId: 1,\n        progressValue: '75',\n        date: new Date(),\n      });\n      \n      const isValid = (dp: any) => \n        dp.goalId && \n        dp.studentId && \n        dp.progressValue !== undefined &&\n        dp.date instanceof Date;\n      \n      expect(isValid(validDataPoint)).toBe(true);\n    });\n\n    it('should return batch delete count', () => {\n      const idsToDelete = [1, 2, 3, 4, 5];\n      const deletedCount = idsToDelete.length;\n      \n      const result = { deletedCount };\n      \n      expect(result.deletedCount).toBe(5);\n    });\n\n    it('should handle mixed valid and invalid IDs in batch delete', () => {\n      const validIds = [1, 2, 3];\n      const mixedIds = [1, 2, 'invalid', null, 5];\n      \n      const parsedIds = mixedIds.filter(id => \n        typeof id === 'number' && !isNaN(id)\n      );\n      \n      expect(parsedIds).toEqual([1, 2, 5]);\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should categorize database errors correctly', () => {\n      const errorTypes = {\n        CONNECTION: 'CONNECTION',\n        QUERY: 'QUERY',\n        TRANSACTION: 'TRANSACTION',\n        TIMEOUT: 'TIMEOUT',\n        UNKNOWN: 'UNKNOWN'\n      };\n      \n      expect(errorTypes.CONNECTION).toBe('CONNECTION');\n      expect(errorTypes.QUERY).toBe('QUERY');\n      expect(errorTypes.TRANSACTION).toBe('TRANSACTION');\n      expect(errorTypes.TIMEOUT).toBe('TIMEOUT');\n      expect(errorTypes.UNKNOWN).toBe('UNKNOWN');\n    });\n\n    it('should detect transient errors for retry logic', () => {\n      const transientErrorMessages = [\n        'connection timeout',\n        'connection refused', \n        'ECONNRESET',\n        'too many connections',\n        'database is starting'\n      ];\n      \n      const isTransientError = (message: string) => \n        transientErrorMessages.some(pattern => \n          message.toLowerCase().includes(pattern.toLowerCase())\n        );\n      \n      expect(isTransientError('Connection timeout occurred')).toBe(true);\n      expect(isTransientError('ECONNRESET in socket')).toBe(true);\n      expect(isTransientError('Invalid SQL syntax')).toBe(false);\n    });\n\n    it('should implement retry with exponential backoff', () => {\n      const baseDelay = 1000;\n      const maxRetries = 3;\n      \n      const delays = Array.from({ length: maxRetries }, (_, attempt) => \n        baseDelay * Math.pow(2, attempt)\n      );\n      \n      expect(delays).toEqual([1000, 2000, 4000]);\n    });\n\n    it('should include operation context in error logs', () => {\n      const context = {\n        operation: 'getDataPointsByGoalId',\n        goalId: 123,\n        userId: '4201332'\n      };\n      \n      const errorLog = {\n        message: 'Database query failed',\n        context,\n        timestamp: new Date().toISOString()\n      };\n      \n      expect(errorLog.context.operation).toBe('getDataPointsByGoalId');\n      expect(errorLog.context.goalId).toBe(123);\n    });\n\n    it('should track retry attempts in error state', () => {\n      const maxRetries = 3;\n      let attemptCount = 0;\n      \n      const simulateRetries = () => {\n        for (let i = 0; i < maxRetries; i++) {\n          attemptCount++;\n        }\n        return attemptCount;\n      };\n      \n      expect(simulateRetries()).toBe(3);\n    });\n  });\n});\n","path":null,"size_bytes":22067,"size_tokens":null},"server/dbUtils.ts":{"content":"import { pool } from \"./db\";\nimport { logDbError as logDbErrorToFile, logWarning, logDebug } from \"./logger\";\n\nexport enum DatabaseErrorType {\n  CONNECTION_ERROR = \"CONNECTION_ERROR\",\n  QUERY_ERROR = \"QUERY_ERROR\",\n  TIMEOUT_ERROR = \"TIMEOUT_ERROR\",\n  CONSTRAINT_VIOLATION = \"CONSTRAINT_VIOLATION\",\n  NOT_FOUND = \"NOT_FOUND\",\n  TRANSACTION_ERROR = \"TRANSACTION_ERROR\",\n  UNKNOWN = \"UNKNOWN\",\n}\n\nexport class DatabaseError extends Error {\n  public readonly type: DatabaseErrorType;\n  public readonly originalError: Error | unknown;\n  public readonly query?: string;\n  public readonly timestamp: Date;\n  public readonly retryable: boolean;\n\n  constructor(\n    message: string,\n    type: DatabaseErrorType,\n    originalError?: Error | unknown,\n    query?: string\n  ) {\n    super(message);\n    this.name = \"DatabaseError\";\n    this.type = type;\n    this.originalError = originalError;\n    this.query = query;\n    this.timestamp = new Date();\n    this.retryable = this.isRetryable(type, originalError);\n  }\n\n  private isRetryable(type: DatabaseErrorType, originalError: unknown): boolean {\n    if (type === DatabaseErrorType.CONNECTION_ERROR) return true;\n    if (type === DatabaseErrorType.TIMEOUT_ERROR) return true;\n    \n    if (originalError instanceof Error) {\n      const errorCode = (originalError as any).code;\n      const retryableCodes = [\n        \"ECONNRESET\",\n        \"ECONNREFUSED\",\n        \"ETIMEDOUT\",\n        \"EPIPE\",\n        \"57P01\", // admin_shutdown\n        \"57P02\", // crash_shutdown\n        \"57P03\", // cannot_connect_now\n        \"08006\", // connection_failure\n        \"08001\", // sqlclient_unable_to_establish_sqlconnection\n        \"08004\", // sqlserver_rejected_establishment_of_sqlconnection\n        \"40001\", // serialization_failure\n        \"40P01\", // deadlock_detected\n      ];\n      return retryableCodes.includes(errorCode);\n    }\n    return false;\n  }\n\n  toJSON() {\n    return {\n      name: this.name,\n      message: this.message,\n      type: this.type,\n      timestamp: this.timestamp.toISOString(),\n      retryable: this.retryable,\n      originalError: this.originalError instanceof Error \n        ? { message: this.originalError.message, code: (this.originalError as any).code }\n        : String(this.originalError),\n    };\n  }\n}\n\nfunction classifyError(error: unknown): DatabaseErrorType {\n  if (!(error instanceof Error)) {\n    return DatabaseErrorType.UNKNOWN;\n  }\n\n  const errorCode = (error as any).code;\n  const errorMessage = error.message.toLowerCase();\n\n  if (\n    errorCode === \"ECONNREFUSED\" ||\n    errorCode === \"ECONNRESET\" ||\n    errorCode === \"ENOTFOUND\" ||\n    errorMessage.includes(\"connection\") ||\n    errorMessage.includes(\"connect\")\n  ) {\n    return DatabaseErrorType.CONNECTION_ERROR;\n  }\n\n  if (\n    errorCode === \"ETIMEDOUT\" ||\n    errorMessage.includes(\"timeout\") ||\n    errorMessage.includes(\"timed out\")\n  ) {\n    return DatabaseErrorType.TIMEOUT_ERROR;\n  }\n\n  if (\n    errorCode === \"23505\" || // unique_violation\n    errorCode === \"23503\" || // foreign_key_violation\n    errorCode === \"23502\" || // not_null_violation\n    errorCode === \"23514\" || // check_violation\n    errorMessage.includes(\"constraint\") ||\n    errorMessage.includes(\"violates\")\n  ) {\n    return DatabaseErrorType.CONSTRAINT_VIOLATION;\n  }\n\n  if (\n    errorCode === \"40001\" || // serialization_failure\n    errorCode === \"40P01\" || // deadlock_detected\n    errorMessage.includes(\"transaction\") ||\n    errorMessage.includes(\"deadlock\")\n  ) {\n    return DatabaseErrorType.TRANSACTION_ERROR;\n  }\n\n  return DatabaseErrorType.QUERY_ERROR;\n}\n\nexport function logDatabaseError(\n  operation: string,\n  error: DatabaseError,\n  context?: Record<string, unknown>\n): void {\n  logDbErrorToFile(operation, error.originalError || error, {\n    errorType: error.type,\n    retryable: error.retryable,\n    timestamp: error.timestamp.toISOString(),\n    ...context,\n  });\n}\n\nexport function logDatabaseWarning(\n  operation: string,\n  message: string,\n  context?: Record<string, unknown>\n): void {\n  logWarning(`DB: ${operation} - ${message}`, context);\n}\n\nexport function logDatabaseInfo(\n  operation: string,\n  message: string,\n  context?: Record<string, unknown>\n): void {\n  logDebug(`DB: ${operation} - ${message}`, context);\n}\n\ninterface RetryOptions {\n  maxRetries?: number;\n  baseDelayMs?: number;\n  maxDelayMs?: number;\n  onRetry?: (attempt: number, error: DatabaseError) => void;\n}\n\nconst DEFAULT_RETRY_OPTIONS: Required<Omit<RetryOptions, \"onRetry\">> = {\n  maxRetries: 3,\n  baseDelayMs: 100,\n  maxDelayMs: 2000,\n};\n\nasync function delay(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nfunction calculateBackoff(attempt: number, baseDelay: number, maxDelay: number): number {\n  const exponentialDelay = baseDelay * Math.pow(2, attempt);\n  const jitter = Math.random() * 100;\n  return Math.min(exponentialDelay + jitter, maxDelay);\n}\n\nexport async function withDatabaseErrorHandling<T>(\n  operation: string,\n  fn: () => Promise<T>,\n  options?: RetryOptions & { context?: Record<string, unknown> }\n): Promise<T> {\n  const { \n    maxRetries = DEFAULT_RETRY_OPTIONS.maxRetries,\n    baseDelayMs = DEFAULT_RETRY_OPTIONS.baseDelayMs,\n    maxDelayMs = DEFAULT_RETRY_OPTIONS.maxDelayMs,\n    onRetry,\n    context,\n  } = options || {};\n\n  let lastError: DatabaseError | null = null;\n\n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\n    try {\n      const result = await fn();\n      \n      if (attempt > 0) {\n        logDatabaseInfo(operation, `Succeeded after ${attempt} retries`);\n      }\n      \n      return result;\n    } catch (error) {\n      const errorType = classifyError(error);\n      const dbError = new DatabaseError(\n        error instanceof Error ? error.message : String(error),\n        errorType,\n        error\n      );\n\n      lastError = dbError;\n\n      if (dbError.retryable && attempt < maxRetries) {\n        const delayMs = calculateBackoff(attempt, baseDelayMs, maxDelayMs);\n        logDatabaseWarning(operation, `Attempt ${attempt + 1} failed, retrying in ${delayMs}ms`, {\n          errorType,\n          attempt: attempt + 1,\n          maxRetries,\n        });\n\n        if (onRetry) {\n          onRetry(attempt + 1, dbError);\n        }\n\n        await delay(delayMs);\n        continue;\n      }\n\n      logDatabaseError(operation, dbError, context);\n      throw dbError;\n    }\n  }\n\n  throw lastError || new DatabaseError(\"Unknown error occurred\", DatabaseErrorType.UNKNOWN);\n}\n\nexport async function withTransaction<T>(\n  operation: string,\n  fn: (client: any) => Promise<T>,\n  options?: RetryOptions\n): Promise<T> {\n  return withDatabaseErrorHandling(\n    operation,\n    async () => {\n      const client = await pool.connect();\n      try {\n        await client.query(\"BEGIN\");\n        const result = await fn(client);\n        await client.query(\"COMMIT\");\n        return result;\n      } catch (error) {\n        await client.query(\"ROLLBACK\").catch((rollbackError) => {\n          console.error(`[DB_ERROR] Rollback failed for ${operation}:`, rollbackError);\n        });\n        throw error;\n      } finally {\n        client.release();\n      }\n    },\n    options\n  );\n}\n\nexport async function checkDatabaseHealth(): Promise<{\n  healthy: boolean;\n  latencyMs: number;\n  poolStats: { total: number; idle: number; waiting: number };\n  error?: string;\n}> {\n  const startTime = Date.now();\n  \n  try {\n    await pool.query(\"SELECT 1\");\n    const latencyMs = Date.now() - startTime;\n    \n    return {\n      healthy: true,\n      latencyMs,\n      poolStats: {\n        total: pool.totalCount,\n        idle: pool.idleCount,\n        waiting: pool.waitingCount,\n      },\n    };\n  } catch (error) {\n    const latencyMs = Date.now() - startTime;\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    \n    logDatabaseError(\"healthCheck\", new DatabaseError(\n      errorMessage,\n      DatabaseErrorType.CONNECTION_ERROR,\n      error\n    ));\n\n    return {\n      healthy: false,\n      latencyMs,\n      poolStats: {\n        total: pool.totalCount,\n        idle: pool.idleCount,\n        waiting: pool.waitingCount,\n      },\n      error: errorMessage,\n    };\n  }\n}\n\nexport function createSafeOperation<TArgs extends unknown[], TResult>(\n  operationName: string,\n  fn: (...args: TArgs) => Promise<TResult>,\n  options?: RetryOptions\n): (...args: TArgs) => Promise<TResult> {\n  return async (...args: TArgs): Promise<TResult> => {\n    return withDatabaseErrorHandling(\n      operationName,\n      () => fn(...args),\n      { ...options, context: { args: args.map(a => typeof a === 'object' ? '[object]' : a) } }\n    );\n  };\n}\n\nexport { pool };\n","path":null,"size_bytes":8615,"size_tokens":null},"server/logger.ts":{"content":"import winston from \"winston\";\nimport DailyRotateFile from \"winston-daily-rotate-file\";\nimport path from \"path\";\n\nconst isDevelopment = process.env.NODE_ENV !== \"production\";\n\nconst customFormat = winston.format.combine(\n  winston.format.timestamp({ format: \"YYYY-MM-DD HH:mm:ss\" }),\n  winston.format.errors({ stack: true }),\n  winston.format.printf(({ timestamp, level, message, ...meta }) => {\n    const metaString = Object.keys(meta).length ? ` ${JSON.stringify(meta)}` : \"\";\n    return `${timestamp} [${level.toUpperCase()}] ${message}${metaString}`;\n  })\n);\n\nconst consoleFormat = winston.format.combine(\n  winston.format.colorize({ all: true }),\n  winston.format.timestamp({ format: \"HH:mm:ss A\" }),\n  winston.format.printf(({ timestamp, level, message, ...meta }) => {\n    const metaString = Object.keys(meta).length ? ` ${JSON.stringify(meta)}` : \"\";\n    return `${timestamp} [${level}] ${message}${metaString}`;\n  })\n);\n\nconst fileTransport = new DailyRotateFile({\n  filename: path.join(\"logs\", \"app-%DATE%.log\"),\n  datePattern: \"YYYY-MM-DD\",\n  maxSize: \"20m\",\n  maxFiles: \"14d\",\n  format: customFormat,\n  level: \"info\",\n});\n\nconst errorFileTransport = new DailyRotateFile({\n  filename: path.join(\"logs\", \"error-%DATE%.log\"),\n  datePattern: \"YYYY-MM-DD\",\n  maxSize: \"20m\",\n  maxFiles: \"30d\",\n  format: customFormat,\n  level: \"error\",\n});\n\nconst consoleTransport = new winston.transports.Console({\n  format: consoleFormat,\n  level: isDevelopment ? \"debug\" : \"info\",\n});\n\nexport const logger = winston.createLogger({\n  level: isDevelopment ? \"debug\" : \"info\",\n  defaultMeta: { service: \"iep-tracker\" },\n  transports: [consoleTransport, fileTransport, errorFileTransport],\n  exceptionHandlers: [\n    new winston.transports.File({ filename: path.join(\"logs\", \"exceptions.log\") }),\n    consoleTransport,\n  ],\n  rejectionHandlers: [\n    new winston.transports.File({ filename: path.join(\"logs\", \"rejections.log\") }),\n    consoleTransport,\n  ],\n});\n\nexport function logAppStart(port: number): void {\n  logger.info(\"Application started\", {\n    port,\n    environment: process.env.NODE_ENV || \"development\",\n    nodeVersion: process.version,\n    pid: process.pid,\n  });\n}\n\nexport function logAppStop(reason: string): void {\n  logger.info(\"Application stopping\", { reason });\n}\n\nexport function logHttpRequest(\n  method: string,\n  path: string,\n  statusCode: number,\n  duration: number,\n  userId?: string\n): void {\n  const level = statusCode >= 500 ? \"error\" : statusCode >= 400 ? \"warn\" : \"info\";\n  logger[level](`${method} ${path} ${statusCode} in ${duration}ms`, {\n    method,\n    path,\n    statusCode,\n    duration,\n    ...(userId && { userId }),\n  });\n}\n\nexport function logDbOperation(\n  operation: string,\n  table: string,\n  duration?: number,\n  context?: Record<string, unknown>\n): void {\n  logger.debug(`DB: ${operation} on ${table}`, {\n    operation,\n    table,\n    ...(duration !== undefined && { duration: `${duration}ms` }),\n    ...context,\n  });\n}\n\nexport function logDbError(\n  operation: string,\n  error: Error | unknown,\n  context?: Record<string, unknown>\n): void {\n  const errorDetails =\n    error instanceof Error\n      ? { message: error.message, stack: error.stack, code: (error as any).code }\n      : { message: String(error) };\n\n  logger.error(`DB Error: ${operation}`, {\n    operation,\n    error: errorDetails,\n    ...context,\n  });\n}\n\nexport function logAuthEvent(\n  event: \"login\" | \"logout\" | \"session_created\" | \"session_expired\" | \"auth_failed\",\n  userId?: string,\n  context?: Record<string, unknown>\n): void {\n  const level = event === \"auth_failed\" ? \"warn\" : \"info\";\n  logger[level](`Auth: ${event}`, { event, ...(userId && { userId }), ...context });\n}\n\nexport function logBusinessOperation(\n  operation: string,\n  entity: string,\n  entityId?: string | number,\n  context?: Record<string, unknown>\n): void {\n  logger.info(`${operation}: ${entity}`, {\n    operation,\n    entity,\n    ...(entityId !== undefined && { entityId }),\n    ...context,\n  });\n}\n\nexport function logError(\n  message: string,\n  error?: Error | unknown,\n  context?: Record<string, unknown>\n): void {\n  const errorDetails =\n    error instanceof Error\n      ? { message: error.message, stack: error.stack }\n      : error\n      ? { message: String(error) }\n      : {};\n\n  logger.error(message, { ...errorDetails, ...context });\n}\n\nexport function logWarning(message: string, context?: Record<string, unknown>): void {\n  logger.warn(message, context);\n}\n\nexport function logInfo(message: string, context?: Record<string, unknown>): void {\n  logger.info(message, context);\n}\n\nexport function logDebug(message: string, context?: Record<string, unknown>): void {\n  logger.debug(message, context);\n}\n\nexport default logger;\n","path":null,"size_bytes":4717,"size_tokens":null}},"version":2}